<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DuplicateRecordFields #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-orphans #-}</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-comment">-- | A /Model/ of the Hydra head Protocol.</span><span>
</span><span id="line-6"></span><span class="hs-comment">--</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- This model integrates in a single state-machine like abstraction the whole behaviour of</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- a Hydra Head, taking into account both on-chain state and contracts, and off-chain</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- interactions. It is written from the point of view of a pre-defined set of Hydra node</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- /operators/ that want to create a channel between them.</span><span>
</span><span id="line-11"></span><span class="hs-comment">-- It's a &quot;happy path&quot; model that does not implement any kind of adversarial behaviour and</span><span>
</span><span id="line-12"></span><span class="hs-comment">-- whose transactions are very simple: Each tx is a payment of one Ada-only UTxO transferred</span><span>
</span><span id="line-13"></span><span class="hs-comment">-- to another party in full, without any change.</span><span>
</span><span id="line-14"></span><span class="hs-comment">--</span><span>
</span><span id="line-15"></span><span class="hs-comment">-- More intricate and specialised models shall be developed once we get a firmer grasp of</span><span>
</span><span id="line-16"></span><span class="hs-comment">-- the whole framework, injecting faults, taking into account more parts of the stack,</span><span>
</span><span id="line-17"></span><span class="hs-comment">-- modelling more complex transactions schemes...</span><span>
</span><span id="line-18"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Hydra.Model</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Cardano.Api</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">utxoFromTx</span></span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Semigroup.Internal.html#Any"><span class="hs-identifier">Any</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-keyword">label</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">lookup</span></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Api.UTxO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">pairs</span></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Api.UTxO</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">UTxO</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Binary</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">serialize'</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">unsafeDeserialize'</span></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent.Class.MonadSTM</span></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-27"></span><span>  </span><span class="annot"><span class="hs-identifier">MonadLabelledSTM</span></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>  </span><span class="annot"><span class="hs-identifier">labelTQueueIO</span></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>  </span><span class="annot"><span class="hs-identifier">labelTVarIO</span></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>  </span><span class="annot"><span class="hs-identifier">modifyTVar</span></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>  </span><span class="annot"><span class="hs-identifier">newTQueue</span></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>  </span><span class="annot"><span class="hs-identifier">newTVarIO</span></span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>  </span><span class="annot"><span class="hs-identifier">readTVarIO</span></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Class.MonadAsync</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Async</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">async</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">cancel</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">link</span></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Class.MonadFork</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">labelThisThread</span></span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.List.html"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.OldList.html#nub"><span class="hs-identifier">nub</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.List.html"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List</span></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/containers-0.6.7/src/Data.Map.html"><span class="hs-identifier">Data.Map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#%21"><span class="hs-operator">(!)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/containers-0.6.7/src/Data.Map.html"><span class="hs-identifier">Data.Map</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Maybe.html"><span class="hs-identifier">Data.Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Maybe.html#fromJust"><span class="hs-identifier">fromJust</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/containers-0.6.7/src/Data.Set.html"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Natural.html"><span class="hs-identifier">GHC.Natural</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Natural.html#wordToNatural"><span class="hs-identifier">wordToNatural</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.API.ClientInput</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ClientInput</span></span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.API.ClientInput</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Input</span></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.API.ServerOutput</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ServerOutput</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hydra.BehaviorSpec.html"><span class="hs-identifier">Hydra.BehaviorSpec</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-48"></span><span>  </span><span class="annot"><a href="Hydra.BehaviorSpec.html#SimulatedChainNetwork"><span class="hs-identifier">SimulatedChainNetwork</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-49"></span><span>  </span><span class="annot"><a href="Hydra.BehaviorSpec.html#TestHydraClient"><span class="hs-identifier">TestHydraClient</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-50"></span><span>  </span><span class="annot"><a href="Hydra.BehaviorSpec.html#createHydraNode"><span class="hs-identifier">createHydraNode</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-51"></span><span>  </span><span class="annot"><a href="Hydra.BehaviorSpec.html#createTestHydraClient"><span class="hs-identifier">createTestHydraClient</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-52"></span><span>  </span><span class="annot"><a href="Hydra.BehaviorSpec.html#shortLabel"><span class="hs-identifier">shortLabel</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span>  </span><span class="annot"><a href="Hydra.BehaviorSpec.html#waitMatch"><span class="hs-identifier">waitMatch</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-54"></span><span>  </span><span class="annot"><a href="Hydra.BehaviorSpec.html#waitUntilMatch"><span class="hs-identifier">waitUntilMatch</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-55"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Cardano.Api.Prelude</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">fromShelleyPaymentCredential</span></span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Chain</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">maximumNumberOfParties</span></span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Chain.Direct.State</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">initialChainState</span></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.HeadLogic</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Committed</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Ledger.Cardano</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">cardanoLedger</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mkSimpleTx</span></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Logging</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Tracer</span></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Logging.Messages</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">HydraLog</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">DirectChain</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Node</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hydra.Model.MockChain.html"><span class="hs-identifier">Hydra.Model.MockChain</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Model.MockChain.html#mockChainAndNetwork"><span class="hs-identifier">mockChainAndNetwork</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html"><span class="hs-identifier">Hydra.Model.Payment</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Model.Payment.html#CardanoSigningKey"><span class="hs-identifier">CardanoSigningKey</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html#Payment"><span class="hs-identifier">Payment</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html#applyTx"><span class="hs-identifier">applyTx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html#genAdaValue"><span class="hs-identifier">genAdaValue</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Node</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">runHydraNode</span></span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Tx.ContestationPeriod</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ContestationPeriod</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">UnsafeContestationPeriod</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Tx.Crypto</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">HydraKey</span></span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Tx.HeadParameters</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">HeadParameters</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Tx.IsTx</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">IsTx</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Tx.Party</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Party</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">deriveParty</span></span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Tx.Snapshot</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Snapshot</span></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Test.Hydra.Node.Fixture</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">defaultGlobals</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">defaultLedgerEnv</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">testNetworkId</span></span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Test.Hydra.Prelude</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">failure</span></span><span class="hs-special">)</span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Test.Hydra.Tx.Gen</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">genSigningKey</span></span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Test.QuickCheck</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">choose</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">elements</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">frequency</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">oneof</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">resize</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">sized</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">tabulate</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">vectorOf</span></span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Test.QuickCheck.DynamicLogic</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">DynLogicModel</span></span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Test.QuickCheck.StateModel</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Any</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">HasVariables</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">PostconditionM</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Realized</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">RunModel</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">StateModel</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Var</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">VarContext</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">counterexamplePost</span></span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Test.QuickCheck.StateModel.Variables</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">HasVariables</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Prelude.html"><span class="hs-identifier">Prelude</span></a></span><span> </span><span class="hs-keyword">qualified</span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span class="annot"><span class="hs-comment">-- * The Model</span></span><span>
</span><span id="line-82"></span><span>
</span><span id="line-83"></span><span class="annot"><span class="hs-comment">-- | State maintained by the model.</span></span><span>
</span><span id="line-84"></span><span class="hs-keyword">data</span><span> </span><span id="WorldState"><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-var">WorldState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="WorldState"><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-var">WorldState</span></a></span></span><span>
</span><span id="line-85"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AhydraParties%3AWorldState"><span class="annot"><span class="annottext">WorldState -&gt; [(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="Hydra.Model.html#%24sel%3AhydraParties%3AWorldState"><span class="hs-identifier hs-var hs-var">hydraParties</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SigningKey</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">HydraKey</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html#CardanoSigningKey"><span class="hs-identifier hs-type">CardanoSigningKey</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-86"></span><span>  </span><span class="hs-comment">-- ^ List of parties identified by both signing keys required to run protocol.</span><span>
</span><span id="line-87"></span><span>  </span><span class="hs-comment">-- This list must not contain any duplicated key.</span><span>
</span><span id="line-88"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AhydraState%3AWorldState"><span class="annot"><span class="annottext">WorldState -&gt; GlobalState
</span><a href="Hydra.Model.html#%24sel%3AhydraState%3AWorldState"><span class="hs-identifier hs-var hs-var">hydraState</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Model.html#GlobalState"><span class="hs-identifier hs-type">GlobalState</span></a></span><span>
</span><span id="line-89"></span><span>  </span><span class="hs-comment">-- ^ Expected consensus state</span><span>
</span><span id="line-90"></span><span>  </span><span class="hs-comment">-- All nodes should be in the same state.</span><span>
</span><span id="line-91"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-92"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679551363"><span id="local-6989586621679551369"><span class="annot"><span class="annottext">WorldState -&gt; WorldState -&gt; Bool
(WorldState -&gt; WorldState -&gt; Bool)
-&gt; (WorldState -&gt; WorldState -&gt; Bool) -&gt; Eq WorldState
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: WorldState -&gt; WorldState -&gt; Bool
== :: WorldState -&gt; WorldState -&gt; Bool
$c/= :: WorldState -&gt; WorldState -&gt; Bool
/= :: WorldState -&gt; WorldState -&gt; Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679551374"><span id="local-6989586621679551380"><span id="local-6989586621679551384"><span class="annot"><span class="annottext">Int -&gt; WorldState -&gt; ShowS
[WorldState] -&gt; ShowS
WorldState -&gt; String
(Int -&gt; WorldState -&gt; ShowS)
-&gt; (WorldState -&gt; String)
-&gt; ([WorldState] -&gt; ShowS)
-&gt; Show WorldState
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; WorldState -&gt; ShowS
showsPrec :: Int -&gt; WorldState -&gt; ShowS
$cshow :: WorldState -&gt; String
show :: WorldState -&gt; String
$cshowList :: [WorldState] -&gt; ShowS
showList :: [WorldState] -&gt; ShowS
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span class="hs-comment">-- | Global state of the Head protocol.</span><span>
</span><span id="line-95"></span><span class="hs-comment">-- While each participant in the Hydra Head protocol has its own private</span><span>
</span><span id="line-96"></span><span class="hs-comment">-- view of the state, we model the expected global state whose properties</span><span>
</span><span id="line-97"></span><span class="hs-comment">-- stem from the consensus built into the Head protocol. In other words, this</span><span>
</span><span id="line-98"></span><span class="hs-comment">-- state is what each node's local state should be /eventually/.</span><span>
</span><span id="line-99"></span><span class="hs-keyword">data</span><span> </span><span id="GlobalState"><span class="annot"><a href="Hydra.Model.html#GlobalState"><span class="hs-identifier hs-var">GlobalState</span></a></span></span><span>
</span><span id="line-100"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- | Start of the &quot;world&quot;.</span><span>
</span><span id="line-101"></span><span>    </span><span class="hs-comment">--  This state is left implicit in the node's logic as it</span><span>
</span><span id="line-102"></span><span>    </span><span class="hs-comment">--  represents that state where the node does not even</span><span>
</span><span id="line-103"></span><span>    </span><span class="hs-comment">--  exist.</span><span>
</span><span id="line-104"></span><span>    </span><span id="Start"><span class="annot"><a href="Hydra.Model.html#Start"><span class="hs-identifier hs-var">Start</span></a></span></span><span>
</span><span id="line-105"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Idle"><span class="annot"><a href="Hydra.Model.html#Idle"><span class="hs-identifier hs-var">Idle</span></a></span></span><span>
</span><span id="line-106"></span><span>      </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AidleParties%3AStart"><span class="annot"><span class="annottext">GlobalState -&gt; [Party]
</span><a href="Hydra.Model.html#%24sel%3AidleParties%3AStart"><span class="hs-identifier hs-var hs-var">idleParties</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Party</span></span><span class="hs-special">]</span><span>
</span><span id="line-107"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AcardanoKeys%3AStart"><span class="annot"><span class="annottext">GlobalState -&gt; [VerificationKey PaymentKey]
</span><a href="Hydra.Model.html#%24sel%3AcardanoKeys%3AStart"><span class="hs-identifier hs-var hs-var">cardanoKeys</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">VerificationKey</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PaymentKey</span></span><span class="hs-special">]</span><span>
</span><span id="line-108"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AidleContestationPeriod%3AStart"><span class="annot"><span class="annottext">GlobalState -&gt; ContestationPeriod
</span><a href="Hydra.Model.html#%24sel%3AidleContestationPeriod%3AStart"><span class="hs-identifier hs-var hs-var">idleContestationPeriod</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ContestationPeriod</span></span><span>
</span><span id="line-109"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AtoCommit%3AStart"><span class="annot"><span class="annottext">GlobalState -&gt; Uncommitted
</span><a href="Hydra.Model.html#%24sel%3AtoCommit%3AStart"><span class="hs-identifier hs-var hs-var">toCommit</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Model.html#Uncommitted"><span class="hs-identifier hs-type">Uncommitted</span></a></span><span>
</span><span id="line-110"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-111"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Initial"><span class="annot"><a href="Hydra.Model.html#Initial"><span class="hs-identifier hs-var">Initial</span></a></span></span><span>
</span><span id="line-112"></span><span>      </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AheadParameters%3AStart"><span class="annot"><span class="annottext">GlobalState -&gt; HeadParameters
</span><a href="Hydra.Model.html#%24sel%3AheadParameters%3AStart"><span class="hs-identifier hs-var hs-var">headParameters</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HeadParameters</span></span><span>
</span><span id="line-113"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="%24sel%3Acommits%3AStart"><span class="annot"><span class="annottext">GlobalState -&gt; Uncommitted
</span><a href="Hydra.Model.html#%24sel%3Acommits%3AStart"><span class="hs-identifier hs-var hs-var">commits</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Committed</span></span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html#Payment"><span class="hs-identifier hs-type">Payment</span></a></span><span>
</span><span id="line-114"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="%24sel%3ApendingCommits%3AStart"><span class="annot"><span class="annottext">GlobalState -&gt; Uncommitted
</span><a href="Hydra.Model.html#%24sel%3ApendingCommits%3AStart"><span class="hs-identifier hs-var hs-var">pendingCommits</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Model.html#Uncommitted"><span class="hs-identifier hs-type">Uncommitted</span></a></span><span>
</span><span id="line-115"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-116"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Open"><span class="annot"><a href="Hydra.Model.html#Open"><span class="hs-identifier hs-var">Open</span></a></span></span><span>
</span><span id="line-117"></span><span>      </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AheadParameters%3AStart"><span class="annot"><a href="Hydra.Model.html#%24sel%3AheadParameters%3AStart"><span class="hs-identifier hs-var">headParameters</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HeadParameters</span></span><span>
</span><span id="line-118"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AoffChainState%3AStart"><span class="annot"><span class="annottext">GlobalState -&gt; OffChainState
</span><a href="Hydra.Model.html#%24sel%3AoffChainState%3AStart"><span class="hs-identifier hs-var hs-var">offChainState</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Model.html#OffChainState"><span class="hs-identifier hs-type">OffChainState</span></a></span><span>
</span><span id="line-119"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="%24sel%3Acommitted%3AStart"><span class="annot"><span class="annottext">GlobalState -&gt; Uncommitted
</span><a href="Hydra.Model.html#%24sel%3Acommitted%3AStart"><span class="hs-identifier hs-var hs-var">committed</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Committed</span></span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html#Payment"><span class="hs-identifier hs-type">Payment</span></a></span><span>
</span><span id="line-120"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-121"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Closed"><span class="annot"><a href="Hydra.Model.html#Closed"><span class="hs-identifier hs-var">Closed</span></a></span></span><span>
</span><span id="line-122"></span><span>      </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AheadParameters%3AStart"><span class="annot"><a href="Hydra.Model.html#%24sel%3AheadParameters%3AStart"><span class="hs-identifier hs-var">headParameters</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HeadParameters</span></span><span>
</span><span id="line-123"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AclosedUTxO%3AStart"><span class="annot"><span class="annottext">GlobalState -&gt; UTxOType Payment
</span><a href="Hydra.Model.html#%24sel%3AclosedUTxO%3AStart"><span class="hs-identifier hs-var hs-var">closedUTxO</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTxOType</span></span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html#Payment"><span class="hs-identifier hs-type">Payment</span></a></span><span>
</span><span id="line-124"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-125"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Final"><span class="annot"><a href="Hydra.Model.html#Final"><span class="hs-identifier hs-var">Final</span></a></span></span><span> </span><span class="hs-special">{</span><span id="%24sel%3AfinalUTxO%3AStart"><span class="annot"><span class="annottext">GlobalState -&gt; UTxOType Payment
</span><a href="Hydra.Model.html#%24sel%3AfinalUTxO%3AStart"><span class="hs-identifier hs-var hs-var">finalUTxO</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTxOType</span></span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html#Payment"><span class="hs-identifier hs-type">Payment</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-126"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679551407"><span id="local-6989586621679551427"><span class="annot"><span class="annottext">GlobalState -&gt; GlobalState -&gt; Bool
(GlobalState -&gt; GlobalState -&gt; Bool)
-&gt; (GlobalState -&gt; GlobalState -&gt; Bool) -&gt; Eq GlobalState
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: GlobalState -&gt; GlobalState -&gt; Bool
== :: GlobalState -&gt; GlobalState -&gt; Bool
$c/= :: GlobalState -&gt; GlobalState -&gt; Bool
/= :: GlobalState -&gt; GlobalState -&gt; Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679551433"><span id="local-6989586621679551458"><span id="local-6989586621679551461"><span class="annot"><span class="annottext">Int -&gt; GlobalState -&gt; ShowS
[GlobalState] -&gt; ShowS
GlobalState -&gt; String
(Int -&gt; GlobalState -&gt; ShowS)
-&gt; (GlobalState -&gt; String)
-&gt; ([GlobalState] -&gt; ShowS)
-&gt; Show GlobalState
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; GlobalState -&gt; ShowS
showsPrec :: Int -&gt; GlobalState -&gt; ShowS
$cshow :: GlobalState -&gt; String
show :: GlobalState -&gt; String
$cshowList :: [GlobalState] -&gt; ShowS
showList :: [GlobalState] -&gt; ShowS
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span class="annot"><a href="Hydra.Model.html#isPendingCommitFrom"><span class="hs-identifier hs-type">isPendingCommitFrom</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Party</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hydra.Model.html#GlobalState"><span class="hs-identifier hs-type">GlobalState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-129"></span><span id="isPendingCommitFrom"><span class="annot"><span class="annottext">isPendingCommitFrom :: Party -&gt; GlobalState -&gt; Bool
</span><a href="Hydra.Model.html#isPendingCommitFrom"><span class="hs-identifier hs-var hs-var">isPendingCommitFrom</span></a></span></span><span> </span><span id="local-6989586621679551468"><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679551468"><span class="hs-identifier hs-var">party</span></a></span></span><span> </span><span class="annot"><a href="Hydra.Model.html#Initial"><span class="hs-identifier hs-type">Initial</span></a></span><span class="hs-special">{</span><span id="local-6989586621679551469"><span class="annot"><span class="annottext">Uncommitted
$sel:pendingCommits:Start :: GlobalState -&gt; Uncommitted
pendingCommits :: Uncommitted
</span><a href="Hydra.Model.html#%24sel%3ApendingCommits%3AStart"><span class="hs-identifier hs-var hs-var">pendingCommits</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-130"></span><span>  </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679551468"><span class="hs-identifier hs-var">party</span></a></span><span> </span><span class="annot"><span class="annottext">Party -&gt; Map Party [(CardanoSigningKey, Value)] -&gt; Bool
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#member"><span class="hs-operator hs-var">`Map.member`</span></a></span><span> </span><span class="annot"><span class="annottext">Map Party [(CardanoSigningKey, Value)]
Uncommitted
</span><a href="#local-6989586621679551469"><span class="hs-identifier hs-var">pendingCommits</span></a></span><span>
</span><span id="line-131"></span><span class="annot"><a href="Hydra.Model.html#isPendingCommitFrom"><span class="hs-identifier hs-var">isPendingCommitFrom</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">GlobalState
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-132"></span><span>
</span><span id="line-133"></span><span class="hs-keyword">type</span><span> </span><span id="Uncommitted"><span class="annot"><a href="Hydra.Model.html#Uncommitted"><span class="hs-identifier hs-var">Uncommitted</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map.Map</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Party</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">UTxOType</span></span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html#Payment"><span class="hs-identifier hs-type">Payment</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span class="hs-keyword">newtype</span><span> </span><span id="OffChainState"><span class="annot"><a href="Hydra.Model.html#OffChainState"><span class="hs-identifier hs-var">OffChainState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="OffChainState"><span class="annot"><a href="Hydra.Model.html#OffChainState"><span class="hs-identifier hs-var">OffChainState</span></a></span></span><span> </span><span class="hs-special">{</span><span id="%24sel%3AconfirmedUTxO%3AOffChainState"><span class="annot"><span class="annottext">OffChainState -&gt; UTxOType Payment
</span><a href="Hydra.Model.html#%24sel%3AconfirmedUTxO%3AOffChainState"><span class="hs-identifier hs-var hs-var">confirmedUTxO</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTxOType</span></span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html#Payment"><span class="hs-identifier hs-type">Payment</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-136"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679551474"><span id="local-6989586621679551478"><span class="annot"><span class="annottext">OffChainState -&gt; OffChainState -&gt; Bool
(OffChainState -&gt; OffChainState -&gt; Bool)
-&gt; (OffChainState -&gt; OffChainState -&gt; Bool) -&gt; Eq OffChainState
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: OffChainState -&gt; OffChainState -&gt; Bool
== :: OffChainState -&gt; OffChainState -&gt; Bool
$c/= :: OffChainState -&gt; OffChainState -&gt; Bool
/= :: OffChainState -&gt; OffChainState -&gt; Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679551482"><span id="local-6989586621679551487"><span id="local-6989586621679551490"><span class="annot"><span class="annottext">Int -&gt; OffChainState -&gt; ShowS
[OffChainState] -&gt; ShowS
OffChainState -&gt; String
(Int -&gt; OffChainState -&gt; ShowS)
-&gt; (OffChainState -&gt; String)
-&gt; ([OffChainState] -&gt; ShowS)
-&gt; Show OffChainState
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; OffChainState -&gt; ShowS
showsPrec :: Int -&gt; OffChainState -&gt; ShowS
$cshow :: OffChainState -&gt; String
show :: OffChainState -&gt; String
$cshowList :: [OffChainState] -&gt; ShowS
showList :: [OffChainState] -&gt; ShowS
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span class="hs-comment">-- This is needed to be able to use `WorldState` inside DL formulae</span><span>
</span><span id="line-139"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679551498"><span class="annot"><span class="hs-identifier hs-type">DynLogicModel</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span></span><span>
</span><span id="line-140"></span><span>
</span><span id="line-141"></span><span class="hs-keyword">type</span><span> </span><span id="ActualCommitted"><span class="annot"><a href="Hydra.Model.html#ActualCommitted"><span class="hs-identifier hs-var">ActualCommitted</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTxOType</span></span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html#Payment"><span class="hs-identifier hs-type">Payment</span></a></span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span class="annot"><span class="hs-comment">-- | Basic instantiation of `StateModel` for our `WorldState` state.</span></span><span>
</span><span id="line-144"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679551513"><span id="local-6989586621679551520"><span id="local-6989586621679551526"><span class="annot"><span class="hs-identifier hs-type">StateModel</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-145"></span><span>  </span><span class="hs-comment">-- The list of possible &quot;Actions&quot; within our `Model`</span><span>
</span><span id="line-146"></span><span>  </span><span class="hs-comment">-- Not all of them need to actually represent an actual user `Action`, but they</span><span>
</span><span id="line-147"></span><span>  </span><span class="hs-comment">-- can represent _observations_ which are useful when defining properties in</span><span>
</span><span id="line-148"></span><span>  </span><span class="hs-comment">-- DL. Those observations would usually not be generated.</span><span>
</span><span id="line-149"></span><span>  </span><span class="hs-keyword">data</span><span> </span><span id="Action"><span class="annot"><span class="hs-identifier hs-var">Action</span></span></span><span> </span><span id="local-6989586621679551529"><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679551529"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-150"></span><span>    </span><span id="Seed"><span class="annot"><a href="Hydra.Model.html#Seed"><span class="hs-identifier hs-var">Seed</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-151"></span><span>      </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AseedKeys%3ASeed"><span class="annot"><span class="annottext">Action WorldState () -&gt; [(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="Hydra.Model.html#%24sel%3AseedKeys%3ASeed"><span class="hs-identifier hs-var hs-var">seedKeys</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SigningKey</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">HydraKey</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html#CardanoSigningKey"><span class="hs-identifier hs-type">CardanoSigningKey</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-152"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AseedContestationPeriod%3ASeed"><span class="annot"><span class="annottext">Action WorldState () -&gt; ContestationPeriod
</span><a href="Hydra.Model.html#%24sel%3AseedContestationPeriod%3ASeed"><span class="hs-identifier hs-var hs-var">seedContestationPeriod</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ContestationPeriod</span></span><span>
</span><span id="line-153"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AtoCommit%3ASeed"><span class="annot"><span class="annottext">Action WorldState () -&gt; Uncommitted
</span><a href="Hydra.Model.html#%24sel%3AtoCommit%3ASeed"><span class="hs-identifier hs-var hs-var">toCommit</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Model.html#Uncommitted"><span class="hs-identifier hs-type">Uncommitted</span></a></span><span>
</span><span id="line-154"></span><span>      </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-155"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Action</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-156"></span><span>    </span><span class="hs-comment">-- NOTE: No records possible here as we would duplicate 'Party' fields with</span><span>
</span><span id="line-157"></span><span>    </span><span class="hs-comment">-- different return values.</span><span>
</span><span id="line-158"></span><span>    </span><span id="Init"><span class="annot"><a href="Hydra.Model.html#Init"><span class="hs-identifier hs-var">Init</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Party</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Action</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span>    </span><span id="Commit"><span class="annot"><a href="Hydra.Model.html#Commit"><span class="hs-identifier hs-var">Commit</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Party</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTxOType</span></span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html#Payment"><span class="hs-identifier hs-type">Payment</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Action</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span> </span><span class="annot"><a href="Hydra.Model.html#ActualCommitted"><span class="hs-identifier hs-type">ActualCommitted</span></a></span><span>
</span><span id="line-160"></span><span>    </span><span id="Decommit"><span class="annot"><a href="Hydra.Model.html#Decommit"><span class="hs-identifier hs-var">Decommit</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Party</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html#Payment"><span class="hs-identifier hs-type">Payment</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Action</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-161"></span><span>    </span><span id="Abort"><span class="annot"><a href="Hydra.Model.html#Abort"><span class="hs-identifier hs-var">Abort</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Party</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Action</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-162"></span><span>    </span><span id="Close"><span class="annot"><a href="Hydra.Model.html#Close"><span class="hs-identifier hs-var">Close</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Party</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Action</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-163"></span><span>    </span><span id="Fanout"><span class="annot"><a href="Hydra.Model.html#Fanout"><span class="hs-identifier hs-var">Fanout</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Party</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Action</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span>
</span><span id="line-164"></span><span>    </span><span id="NewTx"><span class="annot"><a href="Hydra.Model.html#NewTx"><span class="hs-identifier hs-var">NewTx</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Party</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html#Payment"><span class="hs-identifier hs-type">Payment</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Action</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html#Payment"><span class="hs-identifier hs-type">Payment</span></a></span><span>
</span><span id="line-165"></span><span>    </span><span id="Wait"><span class="annot"><a href="Hydra.Model.html#Wait"><span class="hs-identifier hs-var">Wait</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/time-1.12.2/src/Data.Time.Clock.Internal.DiffTime.html#DiffTime"><span class="hs-identifier hs-type">DiffTime</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Action</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-166"></span><span>    </span><span id="ObserveConfirmedTx"><span class="annot"><a href="Hydra.Model.html#ObserveConfirmedTx"><span class="hs-identifier hs-var">ObserveConfirmedTx</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html#Payment"><span class="hs-identifier hs-type">Payment</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Action</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span>    </span><span class="hs-comment">-- Check that all parties have observed the head as open</span><span>
</span><span id="line-168"></span><span>    </span><span id="ObserveHeadIsOpen"><span class="annot"><a href="Hydra.Model.html#ObserveHeadIsOpen"><span class="hs-identifier hs-var">ObserveHeadIsOpen</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Action</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-169"></span><span>    </span><span id="RollbackAndForward"><span class="annot"><a href="Hydra.Model.html#RollbackAndForward"><span class="hs-identifier hs-var">RollbackAndForward</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-bignum-1.3/src/GHC.Num.Natural.html#Natural"><span class="hs-identifier hs-type">Natural</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Action</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span>    </span><span id="CloseWithInitialSnapshot"><span class="annot"><a href="Hydra.Model.html#CloseWithInitialSnapshot"><span class="hs-identifier hs-var">CloseWithInitialSnapshot</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Party</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Action</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-171"></span><span>    </span><span id="StopTheWorld"><span class="annot"><a href="Hydra.Model.html#StopTheWorld"><span class="hs-identifier hs-var">StopTheWorld</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Action</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-172"></span><span>
</span><span id="line-173"></span><span>  </span><span id="local-6989586621679551553"><span class="annot"><span class="annottext">initialState :: WorldState
</span><a href="#local-6989586621679551553"><span class="hs-identifier hs-var hs-var hs-var hs-var">initialState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-174"></span><span>    </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span>
</span><span id="line-175"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:hydraParties:WorldState :: [(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="Hydra.Model.html#%24sel%3AhydraParties%3AWorldState"><span class="hs-identifier hs-var">hydraParties</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
forall a. Monoid a =&gt; a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#mempty"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-176"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:hydraState:WorldState :: GlobalState
</span><a href="Hydra.Model.html#%24sel%3AhydraState%3AWorldState"><span class="hs-identifier hs-var">hydraState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalState
</span><a href="Hydra.Model.html#Start"><span class="hs-identifier hs-var">Start</span></a></span><span>
</span><span id="line-177"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-178"></span><span>
</span><span id="line-179"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">arbitraryAction</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">VarContext</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Gen</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Action</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-180"></span><span>  </span><span id="local-6989586621679551605"><span class="annot"><span class="annottext">arbitraryAction :: VarContext -&gt; WorldState -&gt; Gen (Any (Action WorldState))
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">arbitraryAction</span></span></span><span> </span><span class="annot"><span class="annottext">VarContext
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679551606"><span class="annot"><span class="annottext">st :: WorldState
</span><a href="#local-6989586621679551606"><span class="hs-identifier hs-var">st</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span class="hs-special">{</span><span id="local-6989586621679551607"><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
$sel:hydraParties:WorldState :: WorldState -&gt; [(SigningKey HydraKey, CardanoSigningKey)]
hydraParties :: [(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="Hydra.Model.html#%24sel%3AhydraParties%3AWorldState"><span class="hs-identifier hs-var hs-var">hydraParties</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679551608"><span class="annot"><span class="annottext">GlobalState
$sel:hydraState:WorldState :: WorldState -&gt; GlobalState
hydraState :: GlobalState
</span><a href="Hydra.Model.html#%24sel%3AhydraState%3AWorldState"><span class="hs-identifier hs-var hs-var">hydraState</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-181"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">GlobalState
</span><a href="#local-6989586621679551608"><span class="hs-identifier hs-var">hydraState</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-182"></span><span>      </span><span class="annot"><span class="annottext">GlobalState
</span><a href="Hydra.Model.html#Start"><span class="hs-identifier hs-var">Start</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Action WorldState () -&gt; Any (Action WorldState))
-&gt; Gen (Action WorldState ()) -&gt; Gen (Any (Action WorldState))
forall a b. (a -&gt; b) -&gt; Gen a -&gt; Gen b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Action WorldState () -&gt; Any (Action WorldState)
forall a (f :: * -&gt; *). (Typeable a, Eq (f a)) =&gt; f a -&gt; Any f
</span><span class="hs-identifier hs-var">Some</span></span><span> </span><span class="annot"><span class="annottext">Gen (Action WorldState ())
</span><a href="Hydra.Model.html#genSeed"><span class="hs-identifier hs-var">genSeed</span></a></span><span>
</span><span id="line-183"></span><span>      </span><span class="annot"><a href="Hydra.Model.html#Idle"><span class="hs-identifier hs-type">Idle</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Action WorldState () -&gt; Any (Action WorldState)
forall a (f :: * -&gt; *). (Typeable a, Eq (f a)) =&gt; f a -&gt; Any f
</span><span class="hs-identifier hs-var">Some</span></span><span> </span><span class="annot"><span class="annottext">(Action WorldState () -&gt; Any (Action WorldState))
-&gt; Gen (Action WorldState ()) -&gt; Gen (Any (Action WorldState))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
-&gt; Gen (Action WorldState ())
forall b. [(SigningKey HydraKey, b)] -&gt; Gen (Action WorldState ())
</span><a href="Hydra.Model.html#genInit"><span class="hs-identifier hs-var">genInit</span></a></span><span> </span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="#local-6989586621679551607"><span class="hs-identifier hs-var">hydraParties</span></a></span><span>
</span><span id="line-184"></span><span>      </span><span class="annot"><a href="Hydra.Model.html#Initial"><span class="hs-identifier hs-type">Initial</span></a></span><span class="hs-special">{</span><span id="local-6989586621679551613"><span class="annot"><span class="annottext">Uncommitted
$sel:pendingCommits:Start :: GlobalState -&gt; Uncommitted
pendingCommits :: Uncommitted
</span><a href="Hydra.Model.html#%24sel%3ApendingCommits%3AStart"><span class="hs-identifier hs-var hs-var">pendingCommits</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-185"></span><span>        </span><span class="annot"><span class="annottext">[(Int, Gen (Any (Action WorldState)))]
-&gt; Gen (Any (Action WorldState))
forall a. [(Int, Gen a)] -&gt; Gen a
</span><span class="hs-identifier hs-var">frequency</span></span><span>
</span><span id="line-186"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Uncommitted -&gt; Gen (Any (Action WorldState))
</span><a href="#local-6989586621679551614"><span class="hs-identifier hs-var">genCommit</span></a></span><span> </span><span class="annot"><span class="annottext">Uncommitted
</span><a href="#local-6989586621679551613"><span class="hs-identifier hs-var">pendingCommits</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-187"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Gen (Any (Action WorldState))
</span><a href="#local-6989586621679551615"><span class="hs-identifier hs-var">genAbort</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-188"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-189"></span><span>      </span><span class="annot"><a href="Hydra.Model.html#Open"><span class="hs-identifier hs-type">Open</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:offChainState:Start :: GlobalState -&gt; OffChainState
</span><a href="Hydra.Model.html#%24sel%3AoffChainState%3AStart"><span class="hs-identifier hs-var">offChainState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Hydra.Model.html#OffChainState"><span class="hs-identifier hs-type">OffChainState</span></a></span><span class="hs-special">{</span><span id="local-6989586621679551616"><span class="annot"><span class="annottext">UTxOType Payment
$sel:confirmedUTxO:OffChainState :: OffChainState -&gt; UTxOType Payment
confirmedUTxO :: UTxOType Payment
</span><a href="Hydra.Model.html#%24sel%3AconfirmedUTxO%3AOffChainState"><span class="hs-identifier hs-var hs-var">confirmedUTxO</span></a></span></span><span class="hs-special">}</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-190"></span><span>        </span><span class="annot"><span class="annottext">UTxOType Payment -&gt; Gen (Any (Action WorldState))
</span><a href="#local-6989586621679551617"><span class="hs-identifier hs-var">genOpenActions</span></a></span><span> </span><span class="annot"><span class="annottext">UTxOType Payment
</span><a href="#local-6989586621679551616"><span class="hs-identifier hs-var">confirmedUTxO</span></a></span><span>
</span><span id="line-191"></span><span>      </span><span class="annot"><a href="Hydra.Model.html#Closed"><span class="hs-identifier hs-type">Closed</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-192"></span><span>        </span><span class="annot"><span class="annottext">[(Int, Gen (Any (Action WorldState)))]
-&gt; Gen (Any (Action WorldState))
forall a. [(Int, Gen a)] -&gt; Gen a
</span><span class="hs-identifier hs-var">frequency</span></span><span>
</span><span id="line-193"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Gen (Any (Action WorldState))
</span><a href="#local-6989586621679551618"><span class="hs-identifier hs-var">genFanout</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-194"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Gen (Any (Action WorldState))
</span><a href="#local-6989586621679551619"><span class="hs-identifier hs-var">genRollbackAndForward</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-195"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-196"></span><span>      </span><span class="annot"><a href="Hydra.Model.html#Final"><span class="hs-identifier hs-type">Final</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Action WorldState () -&gt; Any (Action WorldState))
-&gt; Gen (Action WorldState ()) -&gt; Gen (Any (Action WorldState))
forall a b. (a -&gt; b) -&gt; Gen a -&gt; Gen b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Action WorldState () -&gt; Any (Action WorldState)
forall a (f :: * -&gt; *). (Typeable a, Eq (f a)) =&gt; f a -&gt; Any f
</span><span class="hs-identifier hs-var">Some</span></span><span> </span><span class="annot"><span class="annottext">Gen (Action WorldState ())
</span><a href="Hydra.Model.html#genSeed"><span class="hs-identifier hs-var">genSeed</span></a></span><span>
</span><span id="line-197"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-198"></span><span>    </span><span class="annot"><a href="#local-6989586621679551614"><span class="hs-identifier hs-type">genCommit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Model.html#Uncommitted"><span class="hs-identifier hs-type">Uncommitted</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Gen</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Action</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-199"></span><span>    </span><span id="local-6989586621679551614"><span class="annot"><span class="annottext">genCommit :: Uncommitted -&gt; Gen (Any (Action WorldState))
</span><a href="#local-6989586621679551614"><span class="hs-identifier hs-var hs-var">genCommit</span></a></span></span><span> </span><span id="local-6989586621679551620"><span class="annot"><span class="annottext">Uncommitted
</span><a href="#local-6989586621679551620"><span class="hs-identifier hs-var">pending</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-200"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679551621"><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679551621"><span class="hs-identifier hs-var">party</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679551622"><span class="annot"><span class="annottext">[(CardanoSigningKey, Value)]
</span><a href="#local-6989586621679551622"><span class="hs-identifier hs-var">commits</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Party, [(CardanoSigningKey, Value)])]
-&gt; Gen (Party, [(CardanoSigningKey, Value)])
forall a. [a] -&gt; Gen a
</span><span class="hs-identifier hs-var">elements</span></span><span> </span><span class="annot"><span class="annottext">([(Party, [(CardanoSigningKey, Value)])]
 -&gt; Gen (Party, [(CardanoSigningKey, Value)]))
-&gt; [(Party, [(CardanoSigningKey, Value)])]
-&gt; Gen (Party, [(CardanoSigningKey, Value)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Map Party [(CardanoSigningKey, Value)]
-&gt; [(Party, [(CardanoSigningKey, Value)])]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#toList"><span class="hs-identifier hs-var">Map.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Map Party [(CardanoSigningKey, Value)]
Uncommitted
</span><a href="#local-6989586621679551620"><span class="hs-identifier hs-var">pending</span></a></span><span>
</span><span id="line-201"></span><span>      </span><span class="annot"><span class="annottext">Any (Action WorldState) -&gt; Gen (Any (Action WorldState))
forall a. a -&gt; Gen a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Any (Action WorldState) -&gt; Gen (Any (Action WorldState)))
-&gt; (Action WorldState (UTxOType Payment)
    -&gt; Any (Action WorldState))
-&gt; Action WorldState (UTxOType Payment)
-&gt; Gen (Any (Action WorldState))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Action WorldState [(CardanoSigningKey, Value)]
-&gt; Any (Action WorldState)
Action WorldState (UTxOType Payment) -&gt; Any (Action WorldState)
forall a (f :: * -&gt; *). (Typeable a, Eq (f a)) =&gt; f a -&gt; Any f
</span><span class="hs-identifier hs-var">Some</span></span><span> </span><span class="annot"><span class="annottext">(Action WorldState (UTxOType Payment)
 -&gt; Gen (Any (Action WorldState)))
-&gt; Action WorldState (UTxOType Payment)
-&gt; Gen (Any (Action WorldState))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Party -&gt; UTxOType Payment -&gt; Action WorldState (UTxOType Payment)
</span><a href="Hydra.Model.html#Commit"><span class="hs-identifier hs-var">Commit</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679551621"><span class="hs-identifier hs-var">party</span></a></span><span> </span><span class="annot"><span class="annottext">[(CardanoSigningKey, Value)]
UTxOType Payment
</span><a href="#local-6989586621679551622"><span class="hs-identifier hs-var">commits</span></a></span><span>
</span><span id="line-202"></span><span>
</span><span id="line-203"></span><span>    </span><span class="hs-comment">-- NOTE: Some actions depend on confirmed 'UTxO' in the head so</span><span>
</span><span id="line-204"></span><span>    </span><span class="hs-comment">-- we need to make sure there are funds to spend when generating a</span><span>
</span><span id="line-205"></span><span>    </span><span class="hs-comment">-- `NewTx` action for example but also want to make sure that after</span><span>
</span><span id="line-206"></span><span>    </span><span class="hs-comment">-- a 'Decommit' we are not left without any funds so further actions</span><span>
</span><span id="line-207"></span><span>    </span><span class="hs-comment">-- can be generated.</span><span>
</span><span id="line-208"></span><span>    </span><span class="annot"><a href="#local-6989586621679551617"><span class="hs-identifier hs-type">genOpenActions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTxOType</span></span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html#Payment"><span class="hs-identifier hs-type">Payment</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Gen</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Action</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-209"></span><span>    </span><span id="local-6989586621679551617"><span class="annot"><span class="annottext">genOpenActions :: UTxOType Payment -&gt; Gen (Any (Action WorldState))
</span><a href="#local-6989586621679551617"><span class="hs-identifier hs-var hs-var">genOpenActions</span></a></span></span><span> </span><span id="local-6989586621679551625"><span class="annot"><span class="annottext">UTxOType Payment
</span><a href="#local-6989586621679551625"><span class="hs-identifier hs-var">confirmedUTxO</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-210"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[(CardanoSigningKey, Value)] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[(CardanoSigningKey, Value)]
UTxOType Payment
</span><a href="#local-6989586621679551625"><span class="hs-identifier hs-var">confirmedUTxO</span></a></span><span>
</span><span id="line-211"></span><span>        </span><span class="hs-keyword">then</span><span>
</span><span id="line-212"></span><span>          </span><span class="annot"><span class="annottext">[Gen (Any (Action WorldState))] -&gt; Gen (Any (Action WorldState))
forall a. [Gen a] -&gt; Gen a
</span><span class="hs-identifier hs-var">oneof</span></span><span>
</span><span id="line-213"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Gen (Any (Action WorldState))
</span><a href="#local-6989586621679551627"><span class="hs-identifier hs-var">genClose</span></a></span><span>
</span><span id="line-214"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Gen (Any (Action WorldState))
</span><a href="#local-6989586621679551619"><span class="hs-identifier hs-var">genRollbackAndForward</span></a></span><span>
</span><span id="line-215"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-216"></span><span>        </span><span class="hs-keyword">else</span><span>
</span><span id="line-217"></span><span>          </span><span class="annot"><span class="annottext">[(Int, Gen (Any (Action WorldState)))]
-&gt; Gen (Any (Action WorldState))
forall a. [(Int, Gen a)] -&gt; Gen a
</span><span class="hs-identifier hs-var">frequency</span></span><span> </span><span class="annot"><span class="annottext">([(Int, Gen (Any (Action WorldState)))]
 -&gt; Gen (Any (Action WorldState)))
-&gt; [(Int, Gen (Any (Action WorldState)))]
-&gt; Gen (Any (Action WorldState))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-218"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Gen (Any (Action WorldState))
</span><a href="#local-6989586621679551628"><span class="hs-identifier hs-var">genNewTx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-219"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Gen (Any (Action WorldState))
</span><a href="#local-6989586621679551627"><span class="hs-identifier hs-var">genClose</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-220"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Gen (Any (Action WorldState))
</span><a href="#local-6989586621679551619"><span class="hs-identifier hs-var">genRollbackAndForward</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-221"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-222"></span><span>              </span><span class="annot"><span class="annottext">[(Int, Gen (Any (Action WorldState)))]
-&gt; [(Int, Gen (Any (Action WorldState)))]
-&gt; [(Int, Gen (Any (Action WorldState)))]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Gen (Any (Action WorldState))
</span><a href="#local-6989586621679551629"><span class="hs-identifier hs-var">genDecommit</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[(CardanoSigningKey, Value)] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[(CardanoSigningKey, Value)]
UTxOType Payment
</span><a href="#local-6989586621679551625"><span class="hs-identifier hs-var">confirmedUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3E"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">]</span><span>
</span><span id="line-223"></span><span>
</span><span id="line-224"></span><span>    </span><span class="annot"><a href="#local-6989586621679551629"><span class="hs-identifier hs-type">genDecommit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Gen</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Action</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-225"></span><span>    </span><span id="local-6989586621679551629"><span class="annot"><span class="annottext">genDecommit :: Gen (Any (Action WorldState))
</span><a href="#local-6989586621679551629"><span class="hs-identifier hs-var hs-var">genDecommit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-226"></span><span>      </span><span class="annot"><span class="annottext">WorldState -&gt; Gen (Party, Payment)
</span><a href="Hydra.Model.html#genPayment"><span class="hs-identifier hs-var">genPayment</span></a></span><span> </span><span class="annot"><span class="annottext">WorldState
</span><a href="#local-6989586621679551606"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">Gen (Party, Payment)
-&gt; ((Party, Payment) -&gt; Gen (Any (Action WorldState)))
-&gt; Gen (Any (Action WorldState))
forall a b. Gen a -&gt; (a -&gt; Gen b) -&gt; Gen b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679551633"><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679551633"><span class="hs-identifier hs-var">party</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679551634"><span class="annot"><span class="annottext">Payment
</span><a href="#local-6989586621679551634"><span class="hs-identifier hs-var">tx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Any (Action WorldState) -&gt; Gen (Any (Action WorldState))
forall a. a -&gt; Gen a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Any (Action WorldState) -&gt; Gen (Any (Action WorldState)))
-&gt; (Action WorldState () -&gt; Any (Action WorldState))
-&gt; Action WorldState ()
-&gt; Gen (Any (Action WorldState))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Action WorldState () -&gt; Any (Action WorldState)
forall a (f :: * -&gt; *). (Typeable a, Eq (f a)) =&gt; f a -&gt; Any f
</span><span class="hs-identifier hs-var">Some</span></span><span> </span><span class="annot"><span class="annottext">(Action WorldState () -&gt; Gen (Any (Action WorldState)))
-&gt; Action WorldState () -&gt; Gen (Any (Action WorldState))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Party -&gt; Payment -&gt; Action WorldState ()
</span><a href="Hydra.Model.html#Decommit"><span class="hs-identifier hs-var">Decommit</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679551633"><span class="hs-identifier hs-var">party</span></a></span><span> </span><span class="annot"><span class="annottext">Payment
</span><a href="#local-6989586621679551634"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-227"></span><span>
</span><span id="line-228"></span><span>    </span><span id="local-6989586621679551615"><span class="annot"><span class="annottext">genAbort :: Gen (Any (Action WorldState))
</span><a href="#local-6989586621679551615"><span class="hs-identifier hs-var hs-var">genAbort</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-229"></span><span>      </span><span class="annot"><span class="annottext">Action WorldState () -&gt; Any (Action WorldState)
forall a (f :: * -&gt; *). (Typeable a, Eq (f a)) =&gt; f a -&gt; Any f
</span><span class="hs-identifier hs-var">Some</span></span><span> </span><span class="annot"><span class="annottext">(Action WorldState () -&gt; Any (Action WorldState))
-&gt; ((SigningKey HydraKey, CardanoSigningKey)
    -&gt; Action WorldState ())
-&gt; (SigningKey HydraKey, CardanoSigningKey)
-&gt; Any (Action WorldState)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Party -&gt; Action WorldState ()
</span><a href="Hydra.Model.html#Abort"><span class="hs-identifier hs-var">Abort</span></a></span><span> </span><span class="annot"><span class="annottext">(Party -&gt; Action WorldState ())
-&gt; ((SigningKey HydraKey, CardanoSigningKey) -&gt; Party)
-&gt; (SigningKey HydraKey, CardanoSigningKey)
-&gt; Action WorldState ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">SigningKey HydraKey -&gt; Party
</span><span class="hs-identifier hs-var">deriveParty</span></span><span> </span><span class="annot"><span class="annottext">(SigningKey HydraKey -&gt; Party)
-&gt; ((SigningKey HydraKey, CardanoSigningKey)
    -&gt; SigningKey HydraKey)
-&gt; (SigningKey HydraKey, CardanoSigningKey)
-&gt; Party
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(SigningKey HydraKey, CardanoSigningKey) -&gt; SigningKey HydraKey
forall a b. (a, b) -&gt; a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">((SigningKey HydraKey, CardanoSigningKey)
 -&gt; Any (Action WorldState))
-&gt; Gen (SigningKey HydraKey, CardanoSigningKey)
-&gt; Gen (Any (Action WorldState))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
-&gt; Gen (SigningKey HydraKey, CardanoSigningKey)
forall a. [a] -&gt; Gen a
</span><span class="hs-identifier hs-var">elements</span></span><span> </span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="#local-6989586621679551607"><span class="hs-identifier hs-var">hydraParties</span></a></span><span>
</span><span id="line-230"></span><span>
</span><span id="line-231"></span><span>    </span><span id="local-6989586621679551628"><span class="annot"><span class="annottext">genNewTx :: Gen (Any (Action WorldState))
</span><a href="#local-6989586621679551628"><span class="hs-identifier hs-var hs-var">genNewTx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WorldState -&gt; Gen (Party, Payment)
</span><a href="Hydra.Model.html#genPayment"><span class="hs-identifier hs-var">genPayment</span></a></span><span> </span><span class="annot"><span class="annottext">WorldState
</span><a href="#local-6989586621679551606"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">Gen (Party, Payment)
-&gt; ((Party, Payment) -&gt; Gen (Any (Action WorldState)))
-&gt; Gen (Any (Action WorldState))
forall a b. Gen a -&gt; (a -&gt; Gen b) -&gt; Gen b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679551636"><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679551636"><span class="hs-identifier hs-var">party</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679551637"><span class="annot"><span class="annottext">Payment
</span><a href="#local-6989586621679551637"><span class="hs-identifier hs-var">transaction</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Any (Action WorldState) -&gt; Gen (Any (Action WorldState))
forall a. a -&gt; Gen a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Any (Action WorldState) -&gt; Gen (Any (Action WorldState)))
-&gt; (Action WorldState Payment -&gt; Any (Action WorldState))
-&gt; Action WorldState Payment
-&gt; Gen (Any (Action WorldState))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Action WorldState Payment -&gt; Any (Action WorldState)
forall a (f :: * -&gt; *). (Typeable a, Eq (f a)) =&gt; f a -&gt; Any f
</span><span class="hs-identifier hs-var">Some</span></span><span> </span><span class="annot"><span class="annottext">(Action WorldState Payment -&gt; Gen (Any (Action WorldState)))
-&gt; Action WorldState Payment -&gt; Gen (Any (Action WorldState))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Party -&gt; Payment -&gt; Action WorldState Payment
</span><a href="Hydra.Model.html#NewTx"><span class="hs-identifier hs-var">NewTx</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679551636"><span class="hs-identifier hs-var">party</span></a></span><span> </span><span class="annot"><span class="annottext">Payment
</span><a href="#local-6989586621679551637"><span class="hs-identifier hs-var">transaction</span></a></span><span>
</span><span id="line-232"></span><span>
</span><span id="line-233"></span><span>    </span><span id="local-6989586621679551627"><span class="annot"><span class="annottext">genClose :: Gen (Any (Action WorldState))
</span><a href="#local-6989586621679551627"><span class="hs-identifier hs-var hs-var">genClose</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-234"></span><span>      </span><span class="annot"><span class="annottext">Action WorldState () -&gt; Any (Action WorldState)
forall a (f :: * -&gt; *). (Typeable a, Eq (f a)) =&gt; f a -&gt; Any f
</span><span class="hs-identifier hs-var">Some</span></span><span> </span><span class="annot"><span class="annottext">(Action WorldState () -&gt; Any (Action WorldState))
-&gt; ((SigningKey HydraKey, CardanoSigningKey)
    -&gt; Action WorldState ())
-&gt; (SigningKey HydraKey, CardanoSigningKey)
-&gt; Any (Action WorldState)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Party -&gt; Action WorldState ()
</span><a href="Hydra.Model.html#Close"><span class="hs-identifier hs-var">Close</span></a></span><span> </span><span class="annot"><span class="annottext">(Party -&gt; Action WorldState ())
-&gt; ((SigningKey HydraKey, CardanoSigningKey) -&gt; Party)
-&gt; (SigningKey HydraKey, CardanoSigningKey)
-&gt; Action WorldState ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">SigningKey HydraKey -&gt; Party
</span><span class="hs-identifier hs-var">deriveParty</span></span><span> </span><span class="annot"><span class="annottext">(SigningKey HydraKey -&gt; Party)
-&gt; ((SigningKey HydraKey, CardanoSigningKey)
    -&gt; SigningKey HydraKey)
-&gt; (SigningKey HydraKey, CardanoSigningKey)
-&gt; Party
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(SigningKey HydraKey, CardanoSigningKey) -&gt; SigningKey HydraKey
forall a b. (a, b) -&gt; a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">((SigningKey HydraKey, CardanoSigningKey)
 -&gt; Any (Action WorldState))
-&gt; Gen (SigningKey HydraKey, CardanoSigningKey)
-&gt; Gen (Any (Action WorldState))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
-&gt; Gen (SigningKey HydraKey, CardanoSigningKey)
forall a. [a] -&gt; Gen a
</span><span class="hs-identifier hs-var">elements</span></span><span> </span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="#local-6989586621679551607"><span class="hs-identifier hs-var">hydraParties</span></a></span><span>
</span><span id="line-235"></span><span>
</span><span id="line-236"></span><span>    </span><span id="local-6989586621679551618"><span class="annot"><span class="annottext">genFanout :: Gen (Any (Action WorldState))
</span><a href="#local-6989586621679551618"><span class="hs-identifier hs-var hs-var">genFanout</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-237"></span><span>      </span><span class="annot"><span class="annottext">Action WorldState (UTxO' (TxOut CtxUTxO Era))
-&gt; Any (Action WorldState)
forall a (f :: * -&gt; *). (Typeable a, Eq (f a)) =&gt; f a -&gt; Any f
</span><span class="hs-identifier hs-var">Some</span></span><span> </span><span class="annot"><span class="annottext">(Action WorldState (UTxO' (TxOut CtxUTxO Era))
 -&gt; Any (Action WorldState))
-&gt; ((SigningKey HydraKey, CardanoSigningKey)
    -&gt; Action WorldState (UTxO' (TxOut CtxUTxO Era)))
-&gt; (SigningKey HydraKey, CardanoSigningKey)
-&gt; Any (Action WorldState)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Party -&gt; Action WorldState (UTxO' (TxOut CtxUTxO Era))
</span><a href="Hydra.Model.html#Fanout"><span class="hs-identifier hs-var">Fanout</span></a></span><span> </span><span class="annot"><span class="annottext">(Party -&gt; Action WorldState (UTxO' (TxOut CtxUTxO Era)))
-&gt; ((SigningKey HydraKey, CardanoSigningKey) -&gt; Party)
-&gt; (SigningKey HydraKey, CardanoSigningKey)
-&gt; Action WorldState (UTxO' (TxOut CtxUTxO Era))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">SigningKey HydraKey -&gt; Party
</span><span class="hs-identifier hs-var">deriveParty</span></span><span> </span><span class="annot"><span class="annottext">(SigningKey HydraKey -&gt; Party)
-&gt; ((SigningKey HydraKey, CardanoSigningKey)
    -&gt; SigningKey HydraKey)
-&gt; (SigningKey HydraKey, CardanoSigningKey)
-&gt; Party
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(SigningKey HydraKey, CardanoSigningKey) -&gt; SigningKey HydraKey
forall a b. (a, b) -&gt; a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">((SigningKey HydraKey, CardanoSigningKey)
 -&gt; Any (Action WorldState))
-&gt; Gen (SigningKey HydraKey, CardanoSigningKey)
-&gt; Gen (Any (Action WorldState))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
-&gt; Gen (SigningKey HydraKey, CardanoSigningKey)
forall a. [a] -&gt; Gen a
</span><span class="hs-identifier hs-var">elements</span></span><span> </span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="#local-6989586621679551607"><span class="hs-identifier hs-var">hydraParties</span></a></span><span>
</span><span id="line-238"></span><span>
</span><span id="line-239"></span><span>    </span><span id="local-6989586621679551619"><span class="annot"><span class="annottext">genRollbackAndForward :: Gen (Any (Action WorldState))
</span><a href="#local-6989586621679551619"><span class="hs-identifier hs-var hs-var">genRollbackAndForward</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-240"></span><span>      </span><span id="local-6989586621679551645"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679551645"><span class="hs-identifier hs-var">numberOfBlocks</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Word, Word) -&gt; Gen Word
forall a. Random a =&gt; (a, a) -&gt; Gen a
</span><span class="hs-identifier hs-var">choose</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-241"></span><span>      </span><span class="annot"><span class="annottext">Any (Action WorldState) -&gt; Gen (Any (Action WorldState))
forall a. a -&gt; Gen a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Any (Action WorldState) -&gt; Gen (Any (Action WorldState)))
-&gt; (Action WorldState () -&gt; Any (Action WorldState))
-&gt; Action WorldState ()
-&gt; Gen (Any (Action WorldState))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Action WorldState () -&gt; Any (Action WorldState)
forall a (f :: * -&gt; *). (Typeable a, Eq (f a)) =&gt; f a -&gt; Any f
</span><span class="hs-identifier hs-var">Some</span></span><span> </span><span class="annot"><span class="annottext">(Action WorldState () -&gt; Gen (Any (Action WorldState)))
-&gt; Action WorldState () -&gt; Gen (Any (Action WorldState))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Action WorldState ()
</span><a href="Hydra.Model.html#RollbackAndForward"><span class="hs-identifier hs-var">RollbackAndForward</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word -&gt; Natural
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Natural.html#wordToNatural"><span class="hs-identifier hs-var">wordToNatural</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679551645"><span class="hs-identifier hs-var">numberOfBlocks</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-242"></span><span>
</span><span id="line-243"></span><span>  </span><span id="local-6989586621679551646"><span class="annot"><span class="annottext">precondition :: forall a. WorldState -&gt; Action WorldState a -&gt; Bool
</span><a href="#local-6989586621679551646"><span class="hs-identifier hs-var hs-var hs-var hs-var">precondition</span></a></span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:hydraState:WorldState :: WorldState -&gt; GlobalState
</span><a href="Hydra.Model.html#%24sel%3AhydraState%3AWorldState"><span class="hs-identifier hs-var">hydraState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalState
</span><a href="Hydra.Model.html#Start"><span class="hs-identifier hs-var">Start</span></a></span><span class="hs-special">}</span><span> </span><span class="annot"><a href="Hydra.Model.html#Seed"><span class="hs-identifier hs-type">Seed</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-244"></span><span>    </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-245"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">precondition</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:hydraState:WorldState :: WorldState -&gt; GlobalState
</span><a href="Hydra.Model.html#%24sel%3AhydraState%3AWorldState"><span class="hs-identifier hs-var">hydraState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Hydra.Model.html#Idle"><span class="hs-identifier hs-type">Idle</span></a></span><span class="hs-special">{</span><span id="local-6989586621679551649"><span class="annot"><span class="annottext">[Party]
$sel:idleParties:Start :: GlobalState -&gt; [Party]
idleParties :: [Party]
</span><a href="Hydra.Model.html#%24sel%3AidleParties%3AStart"><span class="hs-identifier hs-var hs-var">idleParties</span></a></span></span><span class="hs-special">}</span><span class="hs-special">}</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Model.html#Init"><span class="hs-identifier hs-type">Init</span></a></span><span> </span><span id="local-6989586621679551654"><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679551654"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-246"></span><span>    </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679551654"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Party -&gt; [Party] -&gt; Bool
forall (f :: * -&gt; *) a.
(Foldable f, DisallowElem f, Eq a) =&gt;
a -&gt; f a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621679551649"><span class="hs-identifier hs-var">idleParties</span></a></span><span>
</span><span id="line-247"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">precondition</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:hydraState:WorldState :: WorldState -&gt; GlobalState
</span><a href="Hydra.Model.html#%24sel%3AhydraState%3AWorldState"><span class="hs-identifier hs-var">hydraState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Hydra.Model.html#Initial"><span class="hs-identifier hs-type">Initial</span></a></span><span class="hs-special">{</span><span id="local-6989586621679551656"><span class="annot"><span class="annottext">Uncommitted
$sel:pendingCommits:Start :: GlobalState -&gt; Uncommitted
pendingCommits :: Uncommitted
</span><a href="Hydra.Model.html#%24sel%3ApendingCommits%3AStart"><span class="hs-identifier hs-var hs-var">pendingCommits</span></a></span></span><span class="hs-special">}</span><span class="hs-special">}</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Model.html#Commit"><span class="hs-identifier hs-type">Commit</span></a></span><span> </span><span id="local-6989586621679551659"><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679551659"><span class="hs-identifier hs-var">party</span></a></span></span><span> </span><span class="annot"><span class="annottext">UTxOType Payment
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-248"></span><span>    </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679551659"><span class="hs-identifier hs-var">party</span></a></span><span> </span><span class="annot"><span class="annottext">Party -&gt; Map Party [(CardanoSigningKey, Value)] -&gt; Bool
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#member"><span class="hs-operator hs-var">`Map.member`</span></a></span><span> </span><span class="annot"><span class="annottext">Map Party [(CardanoSigningKey, Value)]
Uncommitted
</span><a href="#local-6989586621679551656"><span class="hs-identifier hs-var">pendingCommits</span></a></span><span>
</span><span id="line-249"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">precondition</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:hydraState:WorldState :: WorldState -&gt; GlobalState
</span><a href="Hydra.Model.html#%24sel%3AhydraState%3AWorldState"><span class="hs-identifier hs-var">hydraState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Hydra.Model.html#Initial"><span class="hs-identifier hs-type">Initial</span></a></span><span class="hs-special">{</span><span id="local-6989586621679551660"><span class="annot"><span class="annottext">Uncommitted
$sel:commits:Start :: GlobalState -&gt; Uncommitted
commits :: Uncommitted
</span><a href="Hydra.Model.html#%24sel%3Acommits%3AStart"><span class="hs-identifier hs-var hs-var">commits</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679551661"><span class="annot"><span class="annottext">Uncommitted
$sel:pendingCommits:Start :: GlobalState -&gt; Uncommitted
pendingCommits :: Uncommitted
</span><a href="Hydra.Model.html#%24sel%3ApendingCommits%3AStart"><span class="hs-identifier hs-var hs-var">pendingCommits</span></a></span></span><span class="hs-special">}</span><span class="hs-special">}</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Model.html#Abort"><span class="hs-identifier hs-type">Abort</span></a></span><span> </span><span id="local-6989586621679551666"><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679551666"><span class="hs-identifier hs-var">party</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-250"></span><span>    </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679551666"><span class="hs-identifier hs-var">party</span></a></span><span> </span><span class="annot"><span class="annottext">Party -&gt; Set Party -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#member"><span class="hs-operator hs-var">`Set.member`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Party [(CardanoSigningKey, Value)] -&gt; Set Party
forall k a. Map k a -&gt; Set k
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#keysSet"><span class="hs-identifier hs-var">Map.keysSet</span></a></span><span> </span><span class="annot"><span class="annottext">Map Party [(CardanoSigningKey, Value)]
Uncommitted
</span><a href="#local-6989586621679551661"><span class="hs-identifier hs-var">pendingCommits</span></a></span><span> </span><span class="annot"><span class="annottext">Set Party -&gt; Set Party -&gt; Set Party
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Map Party [(CardanoSigningKey, Value)] -&gt; Set Party
forall k a. Map k a -&gt; Set k
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#keysSet"><span class="hs-identifier hs-var">Map.keysSet</span></a></span><span> </span><span class="annot"><span class="annottext">Map Party [(CardanoSigningKey, Value)]
Uncommitted
</span><a href="#local-6989586621679551660"><span class="hs-identifier hs-var">commits</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-251"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">precondition</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:hydraState:WorldState :: WorldState -&gt; GlobalState
</span><a href="Hydra.Model.html#%24sel%3AhydraState%3AWorldState"><span class="hs-identifier hs-var">hydraState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Hydra.Model.html#Open"><span class="hs-identifier hs-type">Open</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">}</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Model.html#Close"><span class="hs-identifier hs-type">Close</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-252"></span><span>    </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-253"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">precondition</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:hydraState:WorldState :: WorldState -&gt; GlobalState
</span><a href="Hydra.Model.html#%24sel%3AhydraState%3AWorldState"><span class="hs-identifier hs-var">hydraState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Hydra.Model.html#Open"><span class="hs-identifier hs-type">Open</span></a></span><span class="hs-special">{</span><span id="local-6989586621679551670"><span class="annot"><span class="annottext">OffChainState
$sel:offChainState:Start :: GlobalState -&gt; OffChainState
offChainState :: OffChainState
</span><a href="Hydra.Model.html#%24sel%3AoffChainState%3AStart"><span class="hs-identifier hs-var hs-var">offChainState</span></a></span></span><span class="hs-special">}</span><span class="hs-special">}</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Model.html#NewTx"><span class="hs-identifier hs-type">NewTx</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679551675"><span class="annot"><span class="annottext">Payment
</span><a href="#local-6989586621679551675"><span class="hs-identifier hs-var">tx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-254"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Payment -&gt; CardanoSigningKey
</span><a href="Hydra.Model.Payment.html#%24sel%3Afrom%3APayment"><span class="hs-identifier hs-var">from</span></a></span><span> </span><span class="annot"><span class="annottext">Payment
</span><a href="#local-6989586621679551675"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Payment -&gt; Value
</span><a href="Hydra.Model.Payment.html#%24sel%3Avalue%3APayment"><span class="hs-identifier hs-var">value</span></a></span><span> </span><span class="annot"><span class="annottext">Payment
</span><a href="#local-6989586621679551675"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(CardanoSigningKey, Value) -&gt; [(CardanoSigningKey, Value)] -&gt; Bool
forall a. Eq a =&gt; a -&gt; [a] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Foldable.html#elem"><span class="hs-operator hs-var">`List.elem`</span></a></span><span> </span><span class="annot"><span class="annottext">OffChainState -&gt; UTxOType Payment
</span><a href="Hydra.Model.html#%24sel%3AconfirmedUTxO%3AOffChainState"><span class="hs-identifier hs-var">confirmedUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">OffChainState
</span><a href="#local-6989586621679551670"><span class="hs-identifier hs-var">offChainState</span></a></span><span>
</span><span id="line-255"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">precondition</span></span><span> </span><span class="annot"><span class="annottext">WorldState
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#Wait"><span class="hs-identifier hs-type">Wait</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-256"></span><span>    </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-257"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">precondition</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:hydraState:WorldState :: WorldState -&gt; GlobalState
</span><a href="Hydra.Model.html#%24sel%3AhydraState%3AWorldState"><span class="hs-identifier hs-var">hydraState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Hydra.Model.html#Open"><span class="hs-identifier hs-type">Open</span></a></span><span class="hs-special">{</span><span id="local-6989586621679551680"><span class="annot"><span class="annottext">OffChainState
$sel:offChainState:Start :: GlobalState -&gt; OffChainState
offChainState :: OffChainState
</span><a href="Hydra.Model.html#%24sel%3AoffChainState%3AStart"><span class="hs-identifier hs-var hs-var">offChainState</span></a></span></span><span class="hs-special">}</span><span class="hs-special">}</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Model.html#Decommit"><span class="hs-identifier hs-type">Decommit</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679551685"><span class="annot"><span class="annottext">Payment
</span><a href="#local-6989586621679551685"><span class="hs-identifier hs-var">tx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-258"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Payment -&gt; CardanoSigningKey
</span><a href="Hydra.Model.Payment.html#%24sel%3Afrom%3APayment"><span class="hs-identifier hs-var">from</span></a></span><span> </span><span class="annot"><span class="annottext">Payment
</span><a href="#local-6989586621679551685"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Payment -&gt; Value
</span><a href="Hydra.Model.Payment.html#%24sel%3Avalue%3APayment"><span class="hs-identifier hs-var">value</span></a></span><span> </span><span class="annot"><span class="annottext">Payment
</span><a href="#local-6989586621679551685"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(CardanoSigningKey, Value) -&gt; [(CardanoSigningKey, Value)] -&gt; Bool
forall a. Eq a =&gt; a -&gt; [a] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Foldable.html#elem"><span class="hs-operator hs-var">`List.elem`</span></a></span><span> </span><span class="annot"><span class="annottext">OffChainState -&gt; UTxOType Payment
</span><a href="Hydra.Model.html#%24sel%3AconfirmedUTxO%3AOffChainState"><span class="hs-identifier hs-var">confirmedUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">OffChainState
</span><a href="#local-6989586621679551680"><span class="hs-identifier hs-var">offChainState</span></a></span><span>
</span><span id="line-259"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">precondition</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:hydraState:WorldState :: WorldState -&gt; GlobalState
</span><a href="Hydra.Model.html#%24sel%3AhydraState%3AWorldState"><span class="hs-identifier hs-var">hydraState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Hydra.Model.html#Open"><span class="hs-identifier hs-type">Open</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">}</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Model.html#ObserveConfirmedTx"><span class="hs-identifier hs-type">ObserveConfirmedTx</span></a></span><span> </span><span class="annot"><span class="annottext">Var Payment
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-260"></span><span>    </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-261"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">precondition</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:hydraState:WorldState :: WorldState -&gt; GlobalState
</span><a href="Hydra.Model.html#%24sel%3AhydraState%3AWorldState"><span class="hs-identifier hs-var">hydraState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Hydra.Model.html#Open"><span class="hs-identifier hs-type">Open</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">}</span><span> </span><span class="annot"><span class="annottext">Action WorldState a
R:ActionWorldStatea a
</span><a href="Hydra.Model.html#ObserveHeadIsOpen"><span class="hs-identifier hs-var">ObserveHeadIsOpen</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-262"></span><span>    </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-263"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">precondition</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:hydraState:WorldState :: WorldState -&gt; GlobalState
</span><a href="Hydra.Model.html#%24sel%3AhydraState%3AWorldState"><span class="hs-identifier hs-var">hydraState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Hydra.Model.html#Closed"><span class="hs-identifier hs-type">Closed</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">}</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Model.html#Fanout"><span class="hs-identifier hs-type">Fanout</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-264"></span><span>    </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-265"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">precondition</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:hydraState:WorldState :: WorldState -&gt; GlobalState
</span><a href="Hydra.Model.html#%24sel%3AhydraState%3AWorldState"><span class="hs-identifier hs-var">hydraState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Hydra.Model.html#Open"><span class="hs-identifier hs-type">Open</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">}</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Model.html#CloseWithInitialSnapshot"><span class="hs-identifier hs-type">CloseWithInitialSnapshot</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-266"></span><span>    </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-267"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">precondition</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span class="hs-special">{</span><span id="local-6989586621679551690"><span class="annot"><span class="annottext">GlobalState
$sel:hydraState:WorldState :: WorldState -&gt; GlobalState
hydraState :: GlobalState
</span><a href="Hydra.Model.html#%24sel%3AhydraState%3AWorldState"><span class="hs-identifier hs-var hs-var">hydraState</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Model.html#RollbackAndForward"><span class="hs-identifier hs-type">RollbackAndForward</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-268"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">GlobalState
</span><a href="#local-6989586621679551690"><span class="hs-identifier hs-var">hydraState</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-269"></span><span>      </span><span class="annot"><a href="Hydra.Model.html#Start"><span class="hs-identifier hs-type">Start</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-270"></span><span>      </span><span class="annot"><a href="Hydra.Model.html#Idle"><span class="hs-identifier hs-type">Idle</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-271"></span><span>      </span><span class="annot"><a href="Hydra.Model.html#Initial"><span class="hs-identifier hs-type">Initial</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-272"></span><span>      </span><span class="annot"><a href="Hydra.Model.html#Open"><span class="hs-identifier hs-type">Open</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-273"></span><span>      </span><span class="annot"><a href="Hydra.Model.html#Closed"><span class="hs-identifier hs-type">Closed</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-274"></span><span>      </span><span class="annot"><a href="Hydra.Model.html#Final"><span class="hs-identifier hs-type">Final</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-275"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">precondition</span></span><span> </span><span class="annot"><span class="annottext">WorldState
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Action WorldState a
R:ActionWorldStatea a
</span><a href="Hydra.Model.html#StopTheWorld"><span class="hs-identifier hs-var">StopTheWorld</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-276"></span><span>    </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-277"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">precondition</span></span><span> </span><span class="annot"><span class="annottext">WorldState
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Action WorldState a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-278"></span><span>    </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-279"></span><span>
</span><span id="line-280"></span><span>  </span><span id="local-6989586621679551694"><span class="annot"><span class="annottext">nextState :: forall a.
Typeable a =&gt;
WorldState -&gt; Action WorldState a -&gt; Var a -&gt; WorldState
</span><a href="#local-6989586621679551694"><span class="hs-identifier hs-var hs-var hs-var hs-var">nextState</span></a></span></span><span> </span><span id="local-6989586621679551696"><span class="annot"><span class="annottext">s :: WorldState
</span><a href="#local-6989586621679551696"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span class="hs-special">{</span><span id="local-6989586621679551697"><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
$sel:hydraParties:WorldState :: WorldState -&gt; [(SigningKey HydraKey, CardanoSigningKey)]
hydraParties :: [(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="Hydra.Model.html#%24sel%3AhydraParties%3AWorldState"><span class="hs-identifier hs-var hs-var">hydraParties</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679551698"><span class="annot"><span class="annottext">GlobalState
$sel:hydraState:WorldState :: WorldState -&gt; GlobalState
hydraState :: GlobalState
</span><a href="Hydra.Model.html#%24sel%3AhydraState%3AWorldState"><span class="hs-identifier hs-var hs-var">hydraState</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679551699"><span class="annot"><span class="annottext">Action WorldState a
</span><a href="#local-6989586621679551699"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679551700"><span class="annot"><span class="annottext">Var a
</span><a href="#local-6989586621679551700"><span class="hs-identifier hs-var">_var</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-281"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Action WorldState a
</span><a href="#local-6989586621679551699"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-282"></span><span>      </span><span class="annot"><a href="Hydra.Model.html#Seed"><span class="hs-identifier hs-type">Seed</span></a></span><span class="hs-special">{</span><span id="local-6989586621679551704"><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
$sel:seedKeys:Seed :: Action WorldState () -&gt; [(SigningKey HydraKey, CardanoSigningKey)]
seedKeys :: [(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="Hydra.Model.html#%24sel%3AseedKeys%3ASeed"><span class="hs-identifier hs-var hs-var">seedKeys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679551705"><span class="annot"><span class="annottext">ContestationPeriod
$sel:seedContestationPeriod:Seed :: Action WorldState () -&gt; ContestationPeriod
seedContestationPeriod :: ContestationPeriod
</span><a href="Hydra.Model.html#%24sel%3AseedContestationPeriod%3ASeed"><span class="hs-identifier hs-var hs-var">seedContestationPeriod</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679551706"><span class="annot"><span class="annottext">Uncommitted
$sel:toCommit:Seed :: Action WorldState () -&gt; Uncommitted
toCommit :: Uncommitted
</span><a href="Hydra.Model.html#%24sel%3AtoCommit%3ASeed"><span class="hs-identifier hs-var hs-var">toCommit</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-283"></span><span>        </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:hydraParties:WorldState :: [(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="Hydra.Model.html#%24sel%3AhydraParties%3AWorldState"><span class="hs-identifier hs-var">hydraParties</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="#local-6989586621679551704"><span class="hs-identifier hs-var">seedKeys</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:hydraState:WorldState :: GlobalState
</span><a href="Hydra.Model.html#%24sel%3AhydraState%3AWorldState"><span class="hs-identifier hs-var">hydraState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalState
</span><a href="#local-6989586621679551707"><span class="hs-identifier hs-var">idleState</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-284"></span><span>       </span><span class="hs-keyword">where</span><span>
</span><span id="line-285"></span><span>        </span><span id="local-6989586621679551707"><span class="annot"><span class="annottext">idleState :: GlobalState
</span><a href="#local-6989586621679551707"><span class="hs-identifier hs-var hs-var">idleState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Hydra.Model.html#Idle"><span class="hs-identifier hs-type">Idle</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">[Party]
$sel:idleParties:Start :: [Party]
idleParties :: [Party]
</span><a href="Hydra.Model.html#%24sel%3AidleParties%3AStart"><span class="hs-identifier hs-var hs-var">idleParties</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[VerificationKey PaymentKey]
$sel:cardanoKeys:Start :: [VerificationKey PaymentKey]
cardanoKeys :: [VerificationKey PaymentKey]
</span><a href="Hydra.Model.html#%24sel%3AcardanoKeys%3AStart"><span class="hs-identifier hs-var hs-var">cardanoKeys</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ContestationPeriod
$sel:idleContestationPeriod:Start :: ContestationPeriod
idleContestationPeriod :: ContestationPeriod
</span><a href="Hydra.Model.html#%24sel%3AidleContestationPeriod%3AStart"><span class="hs-identifier hs-var hs-var">idleContestationPeriod</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Uncommitted
$sel:toCommit:Start :: Uncommitted
toCommit :: Uncommitted
</span><a href="Hydra.Model.html#%24sel%3AtoCommit%3AStart"><span class="hs-identifier hs-var hs-var">toCommit</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-286"></span><span>        </span><span id="local-6989586621679551708"><span class="annot"><span class="annottext">idleParties :: [Party]
</span><a href="#local-6989586621679551708"><span class="hs-identifier hs-var hs-var">idleParties</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((SigningKey HydraKey, CardanoSigningKey) -&gt; Party)
-&gt; [(SigningKey HydraKey, CardanoSigningKey)] -&gt; [Party]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SigningKey HydraKey -&gt; Party
</span><span class="hs-identifier hs-var">deriveParty</span></span><span> </span><span class="annot"><span class="annottext">(SigningKey HydraKey -&gt; Party)
-&gt; ((SigningKey HydraKey, CardanoSigningKey)
    -&gt; SigningKey HydraKey)
-&gt; (SigningKey HydraKey, CardanoSigningKey)
-&gt; Party
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(SigningKey HydraKey, CardanoSigningKey) -&gt; SigningKey HydraKey
forall a b. (a, b) -&gt; a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="#local-6989586621679551704"><span class="hs-identifier hs-var">seedKeys</span></a></span><span>
</span><span id="line-287"></span><span>        </span><span id="local-6989586621679551709"><span class="annot"><span class="annottext">cardanoKeys :: [VerificationKey PaymentKey]
</span><a href="#local-6989586621679551709"><span class="hs-identifier hs-var hs-var">cardanoKeys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((SigningKey HydraKey, CardanoSigningKey)
 -&gt; VerificationKey PaymentKey)
-&gt; [(SigningKey HydraKey, CardanoSigningKey)]
-&gt; [VerificationKey PaymentKey]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SigningKey PaymentKey -&gt; VerificationKey PaymentKey
forall keyrole.
(Key keyrole, HasTypeProxy keyrole) =&gt;
SigningKey keyrole -&gt; VerificationKey keyrole
</span><span class="hs-identifier hs-var">getVerificationKey</span></span><span> </span><span class="annot"><span class="annottext">(SigningKey PaymentKey -&gt; VerificationKey PaymentKey)
-&gt; ((SigningKey HydraKey, CardanoSigningKey)
    -&gt; SigningKey PaymentKey)
-&gt; (SigningKey HydraKey, CardanoSigningKey)
-&gt; VerificationKey PaymentKey
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">CardanoSigningKey -&gt; SigningKey PaymentKey
</span><a href="Hydra.Model.Payment.html#%24sel%3AsigningKey%3ACardanoSigningKey"><span class="hs-identifier hs-var">signingKey</span></a></span><span> </span><span class="annot"><span class="annottext">(CardanoSigningKey -&gt; SigningKey PaymentKey)
-&gt; ((SigningKey HydraKey, CardanoSigningKey) -&gt; CardanoSigningKey)
-&gt; (SigningKey HydraKey, CardanoSigningKey)
-&gt; SigningKey PaymentKey
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(SigningKey HydraKey, CardanoSigningKey) -&gt; CardanoSigningKey
forall a b. (a, b) -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="#local-6989586621679551704"><span class="hs-identifier hs-var">seedKeys</span></a></span><span>
</span><span id="line-288"></span><span>        </span><span id="local-6989586621679551710"><span class="annot"><span class="annottext">idleContestationPeriod :: ContestationPeriod
</span><a href="#local-6989586621679551710"><span class="hs-identifier hs-var hs-var">idleContestationPeriod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="#local-6989586621679551705"><span class="hs-identifier hs-var">seedContestationPeriod</span></a></span><span>
</span><span id="line-289"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-290"></span><span>      </span><span class="annot"><a href="Hydra.Model.html#Init"><span class="hs-identifier hs-type">Init</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-291"></span><span>        </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
$sel:hydraParties:WorldState :: [(SigningKey HydraKey, CardanoSigningKey)]
hydraParties :: [(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="Hydra.Model.html#%24sel%3AhydraParties%3AWorldState"><span class="hs-identifier hs-var hs-var">hydraParties</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:hydraState:WorldState :: GlobalState
</span><a href="Hydra.Model.html#%24sel%3AhydraState%3AWorldState"><span class="hs-identifier hs-var">hydraState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalState -&gt; GlobalState
</span><a href="#local-6989586621679551715"><span class="hs-identifier hs-var">mkInitialState</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalState
</span><a href="#local-6989586621679551698"><span class="hs-identifier hs-var">hydraState</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-292"></span><span>       </span><span class="hs-keyword">where</span><span>
</span><span id="line-293"></span><span>        </span><span id="local-6989586621679551715"><span class="annot"><span class="annottext">mkInitialState :: GlobalState -&gt; GlobalState
</span><a href="#local-6989586621679551715"><span class="hs-identifier hs-var hs-var">mkInitialState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-294"></span><span>          </span><span class="annot"><a href="Hydra.Model.html#Idle"><span class="hs-identifier hs-type">Idle</span></a></span><span class="hs-special">{</span><span id="local-6989586621679551725"><span class="annot"><span class="annottext">[Party]
$sel:idleParties:Start :: GlobalState -&gt; [Party]
idleParties :: [Party]
</span><a href="Hydra.Model.html#%24sel%3AidleParties%3AStart"><span class="hs-identifier hs-var hs-var">idleParties</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679551726"><span class="annot"><span class="annottext">ContestationPeriod
$sel:idleContestationPeriod:Start :: GlobalState -&gt; ContestationPeriod
idleContestationPeriod :: ContestationPeriod
</span><a href="Hydra.Model.html#%24sel%3AidleContestationPeriod%3AStart"><span class="hs-identifier hs-var hs-var">idleContestationPeriod</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679551727"><span class="annot"><span class="annottext">Uncommitted
$sel:toCommit:Start :: GlobalState -&gt; Uncommitted
toCommit :: Uncommitted
</span><a href="Hydra.Model.html#%24sel%3AtoCommit%3AStart"><span class="hs-identifier hs-var hs-var">toCommit</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-295"></span><span>            </span><span class="annot"><a href="Hydra.Model.html#Initial"><span class="hs-identifier hs-type">Initial</span></a></span><span>
</span><span id="line-296"></span><span>              </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:headParameters:Start :: HeadParameters
</span><a href="Hydra.Model.html#%24sel%3AheadParameters%3AStart"><span class="hs-identifier hs-var">headParameters</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-297"></span><span>                  </span><span class="annot"><span class="hs-identifier hs-type">HeadParameters</span></span><span>
</span><span id="line-298"></span><span>                    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:parties:HeadParameters :: [Party]
</span><a href="#local-6989586621679551729"><span class="hs-identifier hs-var">parties</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621679551725"><span class="hs-identifier hs-var">idleParties</span></a></span><span>
</span><span id="line-299"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:contestationPeriod:HeadParameters :: ContestationPeriod
</span><a href="#local-6989586621679551730"><span class="hs-identifier hs-var">contestationPeriod</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="#local-6989586621679551726"><span class="hs-identifier hs-var">idleContestationPeriod</span></a></span><span>
</span><span id="line-300"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-301"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:commits:Start :: Uncommitted
</span><a href="Hydra.Model.html#%24sel%3Acommits%3AStart"><span class="hs-identifier hs-var">commits</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Party [(CardanoSigningKey, Value)]
Uncommitted
forall a. Monoid a =&gt; a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#mempty"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-302"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:pendingCommits:Start :: Uncommitted
</span><a href="Hydra.Model.html#%24sel%3ApendingCommits%3AStart"><span class="hs-identifier hs-var">pendingCommits</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Uncommitted
</span><a href="#local-6989586621679551727"><span class="hs-identifier hs-var">toCommit</span></a></span><span>
</span><span id="line-303"></span><span>              </span><span class="hs-special">}</span><span>
</span><span id="line-304"></span><span>          </span><span class="annot"><span class="annottext">GlobalState
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; GlobalState
forall a t. (HasCallStack, IsText t) =&gt; t -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;unexpected state&quot;</span></span><span>
</span><span id="line-305"></span><span>      </span><span class="annot"><a href="Hydra.Model.html#Decommit"><span class="hs-identifier hs-type">Decommit</span></a></span><span> </span><span id="local-6989586621679551741"><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679551741"><span class="hs-identifier hs-var">_party</span></a></span></span><span> </span><span id="local-6989586621679551742"><span class="annot"><span class="annottext">Payment
</span><a href="#local-6989586621679551742"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-306"></span><span>        </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
$sel:hydraParties:WorldState :: [(SigningKey HydraKey, CardanoSigningKey)]
hydraParties :: [(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="Hydra.Model.html#%24sel%3AhydraParties%3AWorldState"><span class="hs-identifier hs-var hs-var">hydraParties</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:hydraState:WorldState :: GlobalState
</span><a href="Hydra.Model.html#%24sel%3AhydraState%3AWorldState"><span class="hs-identifier hs-var">hydraState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalState -&gt; GlobalState
</span><a href="#local-6989586621679551743"><span class="hs-identifier hs-var">updateWithDecommit</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalState
</span><a href="#local-6989586621679551698"><span class="hs-identifier hs-var">hydraState</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-307"></span><span>       </span><span class="hs-keyword">where</span><span>
</span><span id="line-308"></span><span>        </span><span id="local-6989586621679551743"><span class="annot"><span class="annottext">updateWithDecommit :: GlobalState -&gt; GlobalState
</span><a href="#local-6989586621679551743"><span class="hs-identifier hs-var hs-var">updateWithDecommit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-309"></span><span>          </span><span class="annot"><a href="Hydra.Model.html#Open"><span class="hs-identifier hs-type">Open</span></a></span><span class="hs-special">{</span><span id="local-6989586621679551744"><span class="annot"><span class="annottext">HeadParameters
$sel:headParameters:Start :: GlobalState -&gt; HeadParameters
headParameters :: HeadParameters
</span><a href="Hydra.Model.html#%24sel%3AheadParameters%3AStart"><span class="hs-identifier hs-var hs-var">headParameters</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679551745"><span class="annot"><span class="annottext">Uncommitted
$sel:committed:Start :: GlobalState -&gt; Uncommitted
committed :: Uncommitted
</span><a href="Hydra.Model.html#%24sel%3Acommitted%3AStart"><span class="hs-identifier hs-var hs-var">committed</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:offChainState:Start :: GlobalState -&gt; OffChainState
</span><a href="Hydra.Model.html#%24sel%3AoffChainState%3AStart"><span class="hs-identifier hs-var">offChainState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Hydra.Model.html#OffChainState"><span class="hs-identifier hs-type">OffChainState</span></a></span><span class="hs-special">{</span><span id="local-6989586621679551746"><span class="annot"><span class="annottext">UTxOType Payment
$sel:confirmedUTxO:OffChainState :: OffChainState -&gt; UTxOType Payment
confirmedUTxO :: UTxOType Payment
</span><a href="Hydra.Model.html#%24sel%3AconfirmedUTxO%3AOffChainState"><span class="hs-identifier hs-var hs-var">confirmedUTxO</span></a></span></span><span class="hs-special">}</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-310"></span><span>            </span><span class="annot"><a href="Hydra.Model.html#Open"><span class="hs-identifier hs-type">Open</span></a></span><span>
</span><span id="line-311"></span><span>              </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">HeadParameters
$sel:headParameters:Start :: HeadParameters
headParameters :: HeadParameters
</span><a href="Hydra.Model.html#%24sel%3AheadParameters%3AStart"><span class="hs-identifier hs-var hs-var">headParameters</span></a></span><span>
</span><span id="line-312"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Uncommitted
$sel:committed:Start :: Uncommitted
committed :: Uncommitted
</span><a href="Hydra.Model.html#%24sel%3Acommitted%3AStart"><span class="hs-identifier hs-var hs-var">committed</span></a></span><span>
</span><span id="line-313"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:offChainState:Start :: OffChainState
</span><a href="Hydra.Model.html#%24sel%3AoffChainState%3AStart"><span class="hs-identifier hs-var">offChainState</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-314"></span><span>                  </span><span class="annot"><a href="Hydra.Model.html#OffChainState"><span class="hs-identifier hs-type">OffChainState</span></a></span><span>
</span><span id="line-315"></span><span>                    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:confirmedUTxO:OffChainState :: UTxOType Payment
</span><a href="Hydra.Model.html#%24sel%3AconfirmedUTxO%3AOffChainState"><span class="hs-identifier hs-var">confirmedUTxO</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-316"></span><span>                        </span><span class="annot"><span class="annottext">(CardanoSigningKey, Value)
-&gt; [(CardanoSigningKey, Value)] -&gt; [(CardanoSigningKey, Value)]
forall a. Eq a =&gt; a -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.OldList.html#delete"><span class="hs-identifier hs-var">List.delete</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Payment -&gt; CardanoSigningKey
</span><a href="Hydra.Model.Payment.html#%24sel%3Afrom%3APayment"><span class="hs-identifier hs-var">from</span></a></span><span> </span><span class="annot"><span class="annottext">Payment
</span><a href="#local-6989586621679551742"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Payment -&gt; Value
</span><a href="Hydra.Model.Payment.html#%24sel%3Avalue%3APayment"><span class="hs-identifier hs-var">value</span></a></span><span> </span><span class="annot"><span class="annottext">Payment
</span><a href="#local-6989586621679551742"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(CardanoSigningKey, Value)]
UTxOType Payment
</span><a href="#local-6989586621679551746"><span class="hs-identifier hs-var">confirmedUTxO</span></a></span><span>
</span><span id="line-317"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-318"></span><span>              </span><span class="hs-special">}</span><span>
</span><span id="line-319"></span><span>          </span><span class="annot"><span class="annottext">GlobalState
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; GlobalState
forall a t. (HasCallStack, IsText t) =&gt; t -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;unexpected state&quot;</span></span><span>
</span><span id="line-320"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-321"></span><span>      </span><span class="annot"><a href="Hydra.Model.html#Commit"><span class="hs-identifier hs-type">Commit</span></a></span><span> </span><span id="local-6989586621679551760"><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679551760"><span class="hs-identifier hs-var">party</span></a></span></span><span> </span><span id="local-6989586621679551761"><span class="annot"><span class="annottext">UTxOType Payment
</span><a href="#local-6989586621679551761"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-322"></span><span>        </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
$sel:hydraParties:WorldState :: [(SigningKey HydraKey, CardanoSigningKey)]
hydraParties :: [(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="Hydra.Model.html#%24sel%3AhydraParties%3AWorldState"><span class="hs-identifier hs-var hs-var">hydraParties</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:hydraState:WorldState :: GlobalState
</span><a href="Hydra.Model.html#%24sel%3AhydraState%3AWorldState"><span class="hs-identifier hs-var">hydraState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalState -&gt; GlobalState
</span><a href="#local-6989586621679551762"><span class="hs-identifier hs-var">updateWithCommit</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalState
</span><a href="#local-6989586621679551698"><span class="hs-identifier hs-var">hydraState</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-323"></span><span>       </span><span class="hs-keyword">where</span><span>
</span><span id="line-324"></span><span>        </span><span id="local-6989586621679551762"><span class="annot"><span class="annottext">updateWithCommit :: GlobalState -&gt; GlobalState
</span><a href="#local-6989586621679551762"><span class="hs-identifier hs-var hs-var">updateWithCommit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-325"></span><span>          </span><span class="annot"><a href="Hydra.Model.html#Initial"><span class="hs-identifier hs-type">Initial</span></a></span><span class="hs-special">{</span><span id="local-6989586621679551763"><span class="annot"><span class="annottext">HeadParameters
$sel:headParameters:Start :: GlobalState -&gt; HeadParameters
headParameters :: HeadParameters
</span><a href="Hydra.Model.html#%24sel%3AheadParameters%3AStart"><span class="hs-identifier hs-var hs-var">headParameters</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679551764"><span class="annot"><span class="annottext">Uncommitted
$sel:commits:Start :: GlobalState -&gt; Uncommitted
commits :: Uncommitted
</span><a href="Hydra.Model.html#%24sel%3Acommits%3AStart"><span class="hs-identifier hs-var hs-var">commits</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679551765"><span class="annot"><span class="annottext">Uncommitted
$sel:pendingCommits:Start :: GlobalState -&gt; Uncommitted
pendingCommits :: Uncommitted
</span><a href="Hydra.Model.html#%24sel%3ApendingCommits%3AStart"><span class="hs-identifier hs-var hs-var">pendingCommits</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GlobalState
</span><a href="#local-6989586621679551766"><span class="hs-identifier hs-var">updatedState</span></a></span><span>
</span><span id="line-326"></span><span>           </span><span class="hs-keyword">where</span><span>
</span><span id="line-327"></span><span>            </span><span id="local-6989586621679551767"><span class="annot"><span class="annottext">commits' :: Map Party [(CardanoSigningKey, Value)]
</span><a href="#local-6989586621679551767"><span class="hs-identifier hs-var hs-var">commits'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Party
-&gt; [(CardanoSigningKey, Value)]
-&gt; Map Party [(CardanoSigningKey, Value)]
-&gt; Map Party [(CardanoSigningKey, Value)]
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">Map.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679551760"><span class="hs-identifier hs-var">party</span></a></span><span> </span><span class="annot"><span class="annottext">[(CardanoSigningKey, Value)]
UTxOType Payment
</span><a href="#local-6989586621679551761"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">Map Party [(CardanoSigningKey, Value)]
Uncommitted
</span><a href="#local-6989586621679551764"><span class="hs-identifier hs-var">commits</span></a></span><span>
</span><span id="line-328"></span><span>            </span><span id="local-6989586621679551769"><span class="annot"><span class="annottext">pendingCommits' :: Map Party [(CardanoSigningKey, Value)]
</span><a href="#local-6989586621679551769"><span class="hs-identifier hs-var hs-var">pendingCommits'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679551760"><span class="hs-identifier hs-var">party</span></a></span><span> </span><span class="annot"><span class="annottext">Party
-&gt; Map Party [(CardanoSigningKey, Value)]
-&gt; Map Party [(CardanoSigningKey, Value)]
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#delete"><span class="hs-operator hs-var">`Map.delete`</span></a></span><span> </span><span class="annot"><span class="annottext">Map Party [(CardanoSigningKey, Value)]
Uncommitted
</span><a href="#local-6989586621679551765"><span class="hs-identifier hs-var">pendingCommits</span></a></span><span>
</span><span id="line-329"></span><span>            </span><span id="local-6989586621679551766"><span class="annot"><span class="annottext">updatedState :: GlobalState
</span><a href="#local-6989586621679551766"><span class="hs-identifier hs-var hs-var">updatedState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-330"></span><span>              </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Map Party [(CardanoSigningKey, Value)] -&gt; Bool
forall a. Map Party a -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">Map Party [(CardanoSigningKey, Value)]
</span><a href="#local-6989586621679551769"><span class="hs-identifier hs-var">pendingCommits'</span></a></span><span>
</span><span id="line-331"></span><span>                </span><span class="hs-keyword">then</span><span>
</span><span id="line-332"></span><span>                  </span><span class="annot"><a href="Hydra.Model.html#Open"><span class="hs-identifier hs-type">Open</span></a></span><span>
</span><span id="line-333"></span><span>                    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">HeadParameters
$sel:headParameters:Start :: HeadParameters
headParameters :: HeadParameters
</span><a href="Hydra.Model.html#%24sel%3AheadParameters%3AStart"><span class="hs-identifier hs-var hs-var">headParameters</span></a></span><span>
</span><span id="line-334"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:committed:Start :: Uncommitted
</span><a href="Hydra.Model.html#%24sel%3Acommitted%3AStart"><span class="hs-identifier hs-var">committed</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Party [(CardanoSigningKey, Value)]
Uncommitted
</span><a href="#local-6989586621679551767"><span class="hs-identifier hs-var">commits'</span></a></span><span>
</span><span id="line-335"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:offChainState:Start :: OffChainState
</span><a href="Hydra.Model.html#%24sel%3AoffChainState%3AStart"><span class="hs-identifier hs-var">offChainState</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-336"></span><span>                        </span><span class="annot"><a href="Hydra.Model.html#OffChainState"><span class="hs-identifier hs-type">OffChainState</span></a></span><span>
</span><span id="line-337"></span><span>                          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:confirmedUTxO:OffChainState :: UTxOType Payment
</span><a href="Hydra.Model.html#%24sel%3AconfirmedUTxO%3AOffChainState"><span class="hs-identifier hs-var">confirmedUTxO</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[(CardanoSigningKey, Value)]] -&gt; [(CardanoSigningKey, Value)]
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#mconcat"><span class="hs-identifier hs-var">mconcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Party [(CardanoSigningKey, Value)]
-&gt; [[(CardanoSigningKey, Value)]]
forall k a. Map k a -&gt; [a]
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#elems"><span class="hs-identifier hs-var">Map.elems</span></a></span><span> </span><span class="annot"><span class="annottext">Map Party [(CardanoSigningKey, Value)]
</span><a href="#local-6989586621679551767"><span class="hs-identifier hs-var">commits'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-338"></span><span>                          </span><span class="hs-special">}</span><span>
</span><span id="line-339"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-340"></span><span>                </span><span class="hs-keyword">else</span><span>
</span><span id="line-341"></span><span>                  </span><span class="annot"><a href="Hydra.Model.html#Initial"><span class="hs-identifier hs-type">Initial</span></a></span><span>
</span><span id="line-342"></span><span>                    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">HeadParameters
$sel:headParameters:Start :: HeadParameters
headParameters :: HeadParameters
</span><a href="Hydra.Model.html#%24sel%3AheadParameters%3AStart"><span class="hs-identifier hs-var hs-var">headParameters</span></a></span><span>
</span><span id="line-343"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:commits:Start :: Uncommitted
</span><a href="Hydra.Model.html#%24sel%3Acommits%3AStart"><span class="hs-identifier hs-var">commits</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Party [(CardanoSigningKey, Value)]
Uncommitted
</span><a href="#local-6989586621679551767"><span class="hs-identifier hs-var">commits'</span></a></span><span>
</span><span id="line-344"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:pendingCommits:Start :: Uncommitted
</span><a href="Hydra.Model.html#%24sel%3ApendingCommits%3AStart"><span class="hs-identifier hs-var">pendingCommits</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Party [(CardanoSigningKey, Value)]
Uncommitted
</span><a href="#local-6989586621679551769"><span class="hs-identifier hs-var">pendingCommits'</span></a></span><span>
</span><span id="line-345"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-346"></span><span>          </span><span class="annot"><span class="annottext">GlobalState
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; GlobalState
forall a t. (HasCallStack, IsText t) =&gt; t -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;unexpected state&quot;</span></span><span>
</span><span id="line-347"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-348"></span><span>      </span><span class="annot"><a href="Hydra.Model.html#Abort"><span class="hs-identifier hs-type">Abort</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-349"></span><span>        </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
$sel:hydraParties:WorldState :: [(SigningKey HydraKey, CardanoSigningKey)]
hydraParties :: [(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="Hydra.Model.html#%24sel%3AhydraParties%3AWorldState"><span class="hs-identifier hs-var hs-var">hydraParties</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:hydraState:WorldState :: GlobalState
</span><a href="Hydra.Model.html#%24sel%3AhydraState%3AWorldState"><span class="hs-identifier hs-var">hydraState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalState -&gt; GlobalState
</span><a href="#local-6989586621679551773"><span class="hs-identifier hs-var">updateWithAbort</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalState
</span><a href="#local-6989586621679551698"><span class="hs-identifier hs-var">hydraState</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-350"></span><span>       </span><span class="hs-keyword">where</span><span>
</span><span id="line-351"></span><span>        </span><span id="local-6989586621679551773"><span class="annot"><span class="annottext">updateWithAbort :: GlobalState -&gt; GlobalState
</span><a href="#local-6989586621679551773"><span class="hs-identifier hs-var hs-var">updateWithAbort</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-352"></span><span>          </span><span class="annot"><a href="Hydra.Model.html#Initial"><span class="hs-identifier hs-type">Initial</span></a></span><span class="hs-special">{</span><span id="local-6989586621679551776"><span class="annot"><span class="annottext">Uncommitted
$sel:commits:Start :: GlobalState -&gt; Uncommitted
commits :: Uncommitted
</span><a href="Hydra.Model.html#%24sel%3Acommits%3AStart"><span class="hs-identifier hs-var hs-var">commits</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UTxOType Payment -&gt; GlobalState
</span><a href="Hydra.Model.html#Final"><span class="hs-identifier hs-var">Final</span></a></span><span> </span><span class="annot"><span class="annottext">[(CardanoSigningKey, Value)]
UTxOType Payment
</span><a href="#local-6989586621679551777"><span class="hs-identifier hs-var">committedUTxO</span></a></span><span>
</span><span id="line-353"></span><span>           </span><span class="hs-keyword">where</span><span>
</span><span id="line-354"></span><span>            </span><span id="local-6989586621679551777"><span class="annot"><span class="annottext">committedUTxO :: [(CardanoSigningKey, Value)]
</span><a href="#local-6989586621679551777"><span class="hs-identifier hs-var hs-var">committedUTxO</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[(CardanoSigningKey, Value)]] -&gt; [(CardanoSigningKey, Value)]
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#mconcat"><span class="hs-identifier hs-var">mconcat</span></a></span><span> </span><span class="annot"><span class="annottext">([[(CardanoSigningKey, Value)]] -&gt; [(CardanoSigningKey, Value)])
-&gt; [[(CardanoSigningKey, Value)]] -&gt; [(CardanoSigningKey, Value)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Map Party [(CardanoSigningKey, Value)]
-&gt; [[(CardanoSigningKey, Value)]]
forall k a. Map k a -&gt; [a]
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#elems"><span class="hs-identifier hs-var">Map.elems</span></a></span><span> </span><span class="annot"><span class="annottext">Map Party [(CardanoSigningKey, Value)]
Uncommitted
</span><a href="#local-6989586621679551776"><span class="hs-identifier hs-var">commits</span></a></span><span>
</span><span id="line-355"></span><span>          </span><span class="annot"><span class="annottext">GlobalState
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UTxOType Payment -&gt; GlobalState
</span><a href="Hydra.Model.html#Final"><span class="hs-identifier hs-var">Final</span></a></span><span> </span><span class="annot"><span class="annottext">[(CardanoSigningKey, Value)]
UTxOType Payment
forall a. Monoid a =&gt; a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#mempty"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-356"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-357"></span><span>      </span><span class="annot"><a href="Hydra.Model.html#Close"><span class="hs-identifier hs-type">Close</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-358"></span><span>        </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
$sel:hydraParties:WorldState :: [(SigningKey HydraKey, CardanoSigningKey)]
hydraParties :: [(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="Hydra.Model.html#%24sel%3AhydraParties%3AWorldState"><span class="hs-identifier hs-var hs-var">hydraParties</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:hydraState:WorldState :: GlobalState
</span><a href="Hydra.Model.html#%24sel%3AhydraState%3AWorldState"><span class="hs-identifier hs-var">hydraState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalState -&gt; GlobalState
</span><a href="#local-6989586621679551779"><span class="hs-identifier hs-var">updateWithClose</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalState
</span><a href="#local-6989586621679551698"><span class="hs-identifier hs-var">hydraState</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-359"></span><span>       </span><span class="hs-keyword">where</span><span>
</span><span id="line-360"></span><span>        </span><span id="local-6989586621679551779"><span class="annot"><span class="annottext">updateWithClose :: GlobalState -&gt; GlobalState
</span><a href="#local-6989586621679551779"><span class="hs-identifier hs-var hs-var">updateWithClose</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-361"></span><span>          </span><span class="annot"><a href="Hydra.Model.html#Open"><span class="hs-identifier hs-type">Open</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:offChainState:Start :: GlobalState -&gt; OffChainState
</span><a href="Hydra.Model.html#%24sel%3AoffChainState%3AStart"><span class="hs-identifier hs-var">offChainState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Hydra.Model.html#OffChainState"><span class="hs-identifier hs-type">OffChainState</span></a></span><span class="hs-special">{</span><span id="local-6989586621679551787"><span class="annot"><span class="annottext">UTxOType Payment
$sel:confirmedUTxO:OffChainState :: OffChainState -&gt; UTxOType Payment
confirmedUTxO :: UTxOType Payment
</span><a href="Hydra.Model.html#%24sel%3AconfirmedUTxO%3AOffChainState"><span class="hs-identifier hs-var hs-var">confirmedUTxO</span></a></span></span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span id="local-6989586621679551788"><span class="annot"><span class="annottext">HeadParameters
$sel:headParameters:Start :: GlobalState -&gt; HeadParameters
headParameters :: HeadParameters
</span><a href="Hydra.Model.html#%24sel%3AheadParameters%3AStart"><span class="hs-identifier hs-var hs-var">headParameters</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hydra.Model.html#Closed"><span class="hs-identifier hs-type">Closed</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">HeadParameters
$sel:headParameters:Start :: HeadParameters
headParameters :: HeadParameters
</span><a href="Hydra.Model.html#%24sel%3AheadParameters%3AStart"><span class="hs-identifier hs-var hs-var">headParameters</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:closedUTxO:Start :: UTxOType Payment
</span><a href="Hydra.Model.html#%24sel%3AclosedUTxO%3AStart"><span class="hs-identifier hs-var">closedUTxO</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTxOType Payment
</span><a href="#local-6989586621679551787"><span class="hs-identifier hs-var">confirmedUTxO</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-362"></span><span>          </span><span class="annot"><span class="annottext">GlobalState
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; GlobalState
forall a t. (HasCallStack, IsText t) =&gt; t -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;unexpected state&quot;</span></span><span>
</span><span id="line-363"></span><span>      </span><span class="annot"><a href="Hydra.Model.html#Fanout"><span class="hs-identifier hs-type">Fanout</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-364"></span><span>        </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
$sel:hydraParties:WorldState :: [(SigningKey HydraKey, CardanoSigningKey)]
hydraParties :: [(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="Hydra.Model.html#%24sel%3AhydraParties%3AWorldState"><span class="hs-identifier hs-var hs-var">hydraParties</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:hydraState:WorldState :: GlobalState
</span><a href="Hydra.Model.html#%24sel%3AhydraState%3AWorldState"><span class="hs-identifier hs-var">hydraState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalState -&gt; GlobalState
</span><a href="#local-6989586621679551790"><span class="hs-identifier hs-var">updateWithFanout</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalState
</span><a href="#local-6989586621679551698"><span class="hs-identifier hs-var">hydraState</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-365"></span><span>       </span><span class="hs-keyword">where</span><span>
</span><span id="line-366"></span><span>        </span><span id="local-6989586621679551790"><span class="annot"><span class="annottext">updateWithFanout :: GlobalState -&gt; GlobalState
</span><a href="#local-6989586621679551790"><span class="hs-identifier hs-var hs-var">updateWithFanout</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-367"></span><span>          </span><span class="annot"><a href="Hydra.Model.html#Closed"><span class="hs-identifier hs-type">Closed</span></a></span><span class="hs-special">{</span><span id="local-6989586621679551798"><span class="annot"><span class="annottext">UTxOType Payment
$sel:closedUTxO:Start :: GlobalState -&gt; UTxOType Payment
closedUTxO :: UTxOType Payment
</span><a href="Hydra.Model.html#%24sel%3AclosedUTxO%3AStart"><span class="hs-identifier hs-var hs-var">closedUTxO</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UTxOType Payment -&gt; GlobalState
</span><a href="Hydra.Model.html#Final"><span class="hs-identifier hs-var">Final</span></a></span><span> </span><span class="annot"><span class="annottext">UTxOType Payment
</span><a href="#local-6989586621679551798"><span class="hs-identifier hs-var">closedUTxO</span></a></span><span>
</span><span id="line-368"></span><span>          </span><span class="annot"><span class="annottext">GlobalState
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; GlobalState
forall a t. (HasCallStack, IsText t) =&gt; t -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;unexpected state&quot;</span></span><span>
</span><span id="line-369"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-370"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Model.html#NewTx"><span class="hs-identifier hs-type">NewTx</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679551806"><span class="annot"><span class="annottext">Payment
</span><a href="#local-6989586621679551806"><span class="hs-identifier hs-var">tx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-371"></span><span>        </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
$sel:hydraParties:WorldState :: [(SigningKey HydraKey, CardanoSigningKey)]
hydraParties :: [(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="Hydra.Model.html#%24sel%3AhydraParties%3AWorldState"><span class="hs-identifier hs-var hs-var">hydraParties</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:hydraState:WorldState :: GlobalState
</span><a href="Hydra.Model.html#%24sel%3AhydraState%3AWorldState"><span class="hs-identifier hs-var">hydraState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalState -&gt; GlobalState
</span><a href="#local-6989586621679551807"><span class="hs-identifier hs-var">updateWithNewTx</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalState
</span><a href="#local-6989586621679551698"><span class="hs-identifier hs-var">hydraState</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-372"></span><span>       </span><span class="hs-keyword">where</span><span>
</span><span id="line-373"></span><span>        </span><span id="local-6989586621679551807"><span class="annot"><span class="annottext">updateWithNewTx :: GlobalState -&gt; GlobalState
</span><a href="#local-6989586621679551807"><span class="hs-identifier hs-var hs-var">updateWithNewTx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-374"></span><span>          </span><span class="annot"><a href="Hydra.Model.html#Open"><span class="hs-identifier hs-type">Open</span></a></span><span class="hs-special">{</span><span id="local-6989586621679551808"><span class="annot"><span class="annottext">HeadParameters
$sel:headParameters:Start :: GlobalState -&gt; HeadParameters
headParameters :: HeadParameters
</span><a href="Hydra.Model.html#%24sel%3AheadParameters%3AStart"><span class="hs-identifier hs-var hs-var">headParameters</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679551809"><span class="annot"><span class="annottext">Uncommitted
$sel:committed:Start :: GlobalState -&gt; Uncommitted
committed :: Uncommitted
</span><a href="Hydra.Model.html#%24sel%3Acommitted%3AStart"><span class="hs-identifier hs-var hs-var">committed</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:offChainState:Start :: GlobalState -&gt; OffChainState
</span><a href="Hydra.Model.html#%24sel%3AoffChainState%3AStart"><span class="hs-identifier hs-var">offChainState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Hydra.Model.html#OffChainState"><span class="hs-identifier hs-type">OffChainState</span></a></span><span class="hs-special">{</span><span id="local-6989586621679551810"><span class="annot"><span class="annottext">UTxOType Payment
$sel:confirmedUTxO:OffChainState :: OffChainState -&gt; UTxOType Payment
confirmedUTxO :: UTxOType Payment
</span><a href="Hydra.Model.html#%24sel%3AconfirmedUTxO%3AOffChainState"><span class="hs-identifier hs-var hs-var">confirmedUTxO</span></a></span></span><span class="hs-special">}</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-375"></span><span>            </span><span class="annot"><a href="Hydra.Model.html#Open"><span class="hs-identifier hs-type">Open</span></a></span><span>
</span><span id="line-376"></span><span>              </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">HeadParameters
$sel:headParameters:Start :: HeadParameters
headParameters :: HeadParameters
</span><a href="Hydra.Model.html#%24sel%3AheadParameters%3AStart"><span class="hs-identifier hs-var hs-var">headParameters</span></a></span><span>
</span><span id="line-377"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Uncommitted
$sel:committed:Start :: Uncommitted
committed :: Uncommitted
</span><a href="Hydra.Model.html#%24sel%3Acommitted%3AStart"><span class="hs-identifier hs-var hs-var">committed</span></a></span><span>
</span><span id="line-378"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:offChainState:Start :: OffChainState
</span><a href="Hydra.Model.html#%24sel%3AoffChainState%3AStart"><span class="hs-identifier hs-var">offChainState</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-379"></span><span>                  </span><span class="annot"><a href="Hydra.Model.html#OffChainState"><span class="hs-identifier hs-type">OffChainState</span></a></span><span>
</span><span id="line-380"></span><span>                    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:confirmedUTxO:OffChainState :: UTxOType Payment
</span><a href="Hydra.Model.html#%24sel%3AconfirmedUTxO%3AOffChainState"><span class="hs-identifier hs-var">confirmedUTxO</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTxOType Payment
</span><a href="#local-6989586621679551810"><span class="hs-identifier hs-var">confirmedUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">UTxOType Payment -&gt; Payment -&gt; UTxOType Payment
</span><a href="Hydra.Model.Payment.html#applyTx"><span class="hs-operator hs-var">`applyTx`</span></a></span><span> </span><span class="annot"><span class="annottext">Payment
</span><a href="#local-6989586621679551806"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-381"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-382"></span><span>              </span><span class="hs-special">}</span><span>
</span><span id="line-383"></span><span>          </span><span class="annot"><span class="annottext">GlobalState
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; GlobalState
forall a t. (HasCallStack, IsText t) =&gt; t -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;unexpected state&quot;</span></span><span>
</span><span id="line-384"></span><span>      </span><span class="annot"><a href="Hydra.Model.html#CloseWithInitialSnapshot"><span class="hs-identifier hs-type">CloseWithInitialSnapshot</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-385"></span><span>        </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
$sel:hydraParties:WorldState :: [(SigningKey HydraKey, CardanoSigningKey)]
hydraParties :: [(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="Hydra.Model.html#%24sel%3AhydraParties%3AWorldState"><span class="hs-identifier hs-var hs-var">hydraParties</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:hydraState:WorldState :: GlobalState
</span><a href="Hydra.Model.html#%24sel%3AhydraState%3AWorldState"><span class="hs-identifier hs-var">hydraState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalState -&gt; GlobalState
</span><a href="#local-6989586621679551812"><span class="hs-identifier hs-var">updateWithClose</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalState
</span><a href="#local-6989586621679551698"><span class="hs-identifier hs-var">hydraState</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-386"></span><span>       </span><span class="hs-keyword">where</span><span>
</span><span id="line-387"></span><span>        </span><span id="local-6989586621679551812"><span class="annot"><span class="annottext">updateWithClose :: GlobalState -&gt; GlobalState
</span><a href="#local-6989586621679551812"><span class="hs-identifier hs-var hs-var">updateWithClose</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-388"></span><span>          </span><span class="annot"><a href="Hydra.Model.html#Open"><span class="hs-identifier hs-type">Open</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:offChainState:Start :: GlobalState -&gt; OffChainState
</span><a href="Hydra.Model.html#%24sel%3AoffChainState%3AStart"><span class="hs-identifier hs-var">offChainState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Hydra.Model.html#OffChainState"><span class="hs-identifier hs-type">OffChainState</span></a></span><span class="hs-special">{</span><span id="local-6989586621679551820"><span class="annot"><span class="annottext">UTxOType Payment
$sel:confirmedUTxO:OffChainState :: OffChainState -&gt; UTxOType Payment
confirmedUTxO :: UTxOType Payment
</span><a href="Hydra.Model.html#%24sel%3AconfirmedUTxO%3AOffChainState"><span class="hs-identifier hs-var hs-var">confirmedUTxO</span></a></span></span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span id="local-6989586621679551821"><span class="annot"><span class="annottext">HeadParameters
$sel:headParameters:Start :: GlobalState -&gt; HeadParameters
headParameters :: HeadParameters
</span><a href="Hydra.Model.html#%24sel%3AheadParameters%3AStart"><span class="hs-identifier hs-var hs-var">headParameters</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hydra.Model.html#Closed"><span class="hs-identifier hs-type">Closed</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">HeadParameters
$sel:headParameters:Start :: HeadParameters
headParameters :: HeadParameters
</span><a href="Hydra.Model.html#%24sel%3AheadParameters%3AStart"><span class="hs-identifier hs-var hs-var">headParameters</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:closedUTxO:Start :: UTxOType Payment
</span><a href="Hydra.Model.html#%24sel%3AclosedUTxO%3AStart"><span class="hs-identifier hs-var">closedUTxO</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTxOType Payment
</span><a href="#local-6989586621679551820"><span class="hs-identifier hs-var">confirmedUTxO</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-389"></span><span>          </span><span class="annot"><span class="annottext">GlobalState
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; GlobalState
forall a t. (HasCallStack, IsText t) =&gt; t -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;unexpected state&quot;</span></span><span>
</span><span id="line-390"></span><span>      </span><span class="annot"><a href="Hydra.Model.html#RollbackAndForward"><span class="hs-identifier hs-type">RollbackAndForward</span></a></span><span> </span><span id="local-6989586621679551823"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679551823"><span class="hs-identifier hs-var">_numberOfBlocks</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WorldState
</span><a href="#local-6989586621679551696"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-391"></span><span>      </span><span class="annot"><a href="Hydra.Model.html#Wait"><span class="hs-identifier hs-type">Wait</span></a></span><span> </span><span class="annot"><span class="annottext">DiffTime
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WorldState
</span><a href="#local-6989586621679551696"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-392"></span><span>      </span><span class="annot"><a href="Hydra.Model.html#ObserveConfirmedTx"><span class="hs-identifier hs-type">ObserveConfirmedTx</span></a></span><span> </span><span class="annot"><span class="annottext">Var Payment
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WorldState
</span><a href="#local-6989586621679551696"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-393"></span><span>      </span><span class="annot"><span class="annottext">Action WorldState a
R:ActionWorldStatea a
</span><a href="Hydra.Model.html#ObserveHeadIsOpen"><span class="hs-identifier hs-var">ObserveHeadIsOpen</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WorldState
</span><a href="#local-6989586621679551696"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-394"></span><span>      </span><span class="annot"><span class="annottext">Action WorldState a
R:ActionWorldStatea a
</span><a href="Hydra.Model.html#StopTheWorld"><span class="hs-identifier hs-var">StopTheWorld</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WorldState
</span><a href="#local-6989586621679551696"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-395"></span><span>
</span><span id="line-396"></span><span>  </span><span id="local-6989586621679551829"><span class="annot"><span class="annottext">shrinkAction :: forall a.
Typeable a =&gt;
VarContext
-&gt; WorldState -&gt; Action WorldState a -&gt; [Any (Action WorldState)]
</span><a href="#local-6989586621679551829"><span class="hs-identifier hs-var hs-var hs-var hs-var">shrinkAction</span></a></span></span><span> </span><span id="local-6989586621679551831"><span class="annot"><span class="annottext">VarContext
</span><a href="#local-6989586621679551831"><span class="hs-identifier hs-var">_ctx</span></a></span></span><span> </span><span id="local-6989586621679551832"><span class="annot"><span class="annottext">WorldState
</span><a href="#local-6989586621679551832"><span class="hs-identifier hs-var">_st</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-397"></span><span>    </span><span id="local-6989586621679551833"><span class="annot"><span class="annottext">seed :: Action WorldState a
</span><a href="#local-6989586621679551833"><span class="hs-identifier hs-var">seed</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Hydra.Model.html#Seed"><span class="hs-identifier hs-type">Seed</span></a></span><span class="hs-special">{</span><span id="local-6989586621679551848"><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
$sel:seedKeys:Seed :: Action WorldState () -&gt; [(SigningKey HydraKey, CardanoSigningKey)]
seedKeys :: [(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="Hydra.Model.html#%24sel%3AseedKeys%3ASeed"><span class="hs-identifier hs-var hs-var">seedKeys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679551849"><span class="annot"><span class="annottext">Uncommitted
$sel:toCommit:Seed :: Action WorldState () -&gt; Uncommitted
toCommit :: Uncommitted
</span><a href="Hydra.Model.html#%24sel%3AtoCommit%3ASeed"><span class="hs-identifier hs-var hs-var">toCommit</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-398"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Action WorldState () -&gt; Any (Action WorldState)
forall a (f :: * -&gt; *). (Typeable a, Eq (f a)) =&gt; f a -&gt; Any f
</span><span class="hs-identifier hs-var">Some</span></span><span> </span><span class="annot"><span class="annottext">Action WorldState a
</span><a href="#local-6989586621679551833"><span class="hs-identifier hs-var">seed</span></a></span><span class="hs-special">{</span><span class="annot"><a href="Hydra.Model.html#%24sel%3AseedKeys%3ASeed"><span class="hs-identifier hs-var">seedKeys</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679551850"><span class="hs-identifier hs-type">seedKeys'</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-identifier">toCommit</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679551851"><span class="hs-identifier hs-type">toCommit'</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-399"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679551850"><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="#local-6989586621679551850"><span class="hs-identifier hs-var">seedKeys'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
-&gt; [[(SigningKey HydraKey, CardanoSigningKey)]]
forall a. Arbitrary a =&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">shrink</span></span><span> </span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="#local-6989586621679551848"><span class="hs-identifier hs-var">seedKeys</span></a></span><span>
</span><span id="line-400"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679551851"><span class="annot"><span class="annottext">toCommit' :: Map Party [(CardanoSigningKey, Value)]
</span><a href="#local-6989586621679551851"><span class="hs-identifier hs-var hs-var">toCommit'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Party -&gt; [(CardanoSigningKey, Value)] -&gt; Bool)
-&gt; Map Party [(CardanoSigningKey, Value)]
-&gt; Map Party [(CardanoSigningKey, Value)]
forall k a. (k -&gt; a -&gt; Bool) -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#filterWithKey"><span class="hs-identifier hs-var">Map.filterWithKey</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679551854"><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679551854"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="annot"><span class="annottext">[(CardanoSigningKey, Value)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679551854"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Party -&gt; [Party] -&gt; Bool
forall (f :: * -&gt; *) a.
(Foldable f, DisallowElem f, Eq a) =&gt;
a -&gt; f a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SigningKey HydraKey -&gt; Party
</span><span class="hs-identifier hs-var">deriveParty</span></span><span> </span><span class="annot"><span class="annottext">(SigningKey HydraKey -&gt; Party)
-&gt; ((SigningKey HydraKey, CardanoSigningKey)
    -&gt; SigningKey HydraKey)
-&gt; (SigningKey HydraKey, CardanoSigningKey)
-&gt; Party
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(SigningKey HydraKey, CardanoSigningKey) -&gt; SigningKey HydraKey
forall a b. (a, b) -&gt; a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">((SigningKey HydraKey, CardanoSigningKey) -&gt; Party)
-&gt; [(SigningKey HydraKey, CardanoSigningKey)] -&gt; [Party]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="#local-6989586621679551850"><span class="hs-identifier hs-var">seedKeys'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map Party [(CardanoSigningKey, Value)]
Uncommitted
</span><a href="#local-6989586621679551849"><span class="hs-identifier hs-var">toCommit</span></a></span><span>
</span><span id="line-401"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-402"></span><span>    </span><span id="local-6989586621679551855"><span class="annot"><span class="annottext">Action WorldState a
</span><a href="#local-6989586621679551855"><span class="hs-identifier hs-var">_other</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-403"></span><span>
</span><span id="line-404"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasVariables</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-405"></span><span>  </span><span id="local-6989586621679551863"><span class="annot"><span class="annottext">getAllVariables :: WorldState -&gt; Set (Any Var)
</span><a href="#local-6989586621679551863"><span class="hs-identifier hs-var hs-var hs-var hs-var">getAllVariables</span></a></span></span><span> </span><span class="annot"><span class="annottext">WorldState
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set (Any Var)
forall a. Monoid a =&gt; a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#mempty"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-406"></span><span>
</span><span id="line-407"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679551865"><span class="annot"><span class="hs-identifier hs-type">HasVariables</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Action</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679551865"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-408"></span><span>  </span><span id="local-6989586621679551871"><span class="annot"><span class="annottext">getAllVariables :: Action WorldState a -&gt; Set (Any Var)
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">getAllVariables</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-409"></span><span>    </span><span class="annot"><a href="Hydra.Model.html#ObserveConfirmedTx"><span class="hs-identifier hs-type">ObserveConfirmedTx</span></a></span><span> </span><span id="local-6989586621679551875"><span class="annot"><span class="annottext">Var Payment
</span><a href="#local-6989586621679551875"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Any Var -&gt; Set (Any Var)
forall a. a -&gt; Set a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#singleton"><span class="hs-identifier hs-var">Set.singleton</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var Payment -&gt; Any Var
forall a (f :: * -&gt; *). (Typeable a, Eq (f a)) =&gt; f a -&gt; Any f
</span><span class="hs-identifier hs-var">Some</span></span><span> </span><span class="annot"><span class="annottext">Var Payment
</span><a href="#local-6989586621679551875"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-410"></span><span>    </span><span id="local-6989586621679551877"><span class="annot"><span class="annottext">Action WorldState a
</span><a href="#local-6989586621679551877"><span class="hs-identifier hs-var">_other</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set (Any Var)
forall a. Monoid a =&gt; a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#mempty"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-411"></span><span>
</span><span id="line-412"></span><span id="local-6989586621679551879"><span id="local-6989586621679551881"><span id="local-6989586621679551885"><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621679551887"><span class="annot"><a href="#local-6989586621679551887"><span class="hs-keyword hs-type">stock</span></a></span></span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Show.html#Show"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Action</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679551887"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-413"></span><span id="local-6989586621679551889"><span id="local-6989586621679551891"><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621679550597"><span class="annot"><a href="#local-6989586621679550597"><span class="hs-keyword hs-type">stock</span></a></span></span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-type">Eq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Action</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679550597"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-414"></span><span>
</span><span id="line-415"></span><span class="annot"><span class="hs-comment">-- ** Generator Helper</span></span><span>
</span><span id="line-416"></span><span>
</span><span id="line-417"></span><span class="annot"><a href="Hydra.Model.html#genSeed"><span class="hs-identifier hs-type">genSeed</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Gen</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Action</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-418"></span><span id="genSeed"><span class="annot"><span class="annottext">genSeed :: Gen (Action WorldState ())
</span><a href="Hydra.Model.html#genSeed"><span class="hs-identifier hs-var hs-var">genSeed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-419"></span><span>  </span><span id="local-6989586621679551893"><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="#local-6989586621679551893"><span class="hs-identifier hs-var">seedKeys</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; Gen [(SigningKey HydraKey, CardanoSigningKey)]
-&gt; Gen [(SigningKey HydraKey, CardanoSigningKey)]
forall a. Int -&gt; Gen a -&gt; Gen a
</span><span class="hs-identifier hs-var">resize</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier hs-var">maximumNumberOfParties</span></span><span> </span><span class="annot"><span class="annottext">Gen [(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="Hydra.Model.html#partyKeys"><span class="hs-identifier hs-var">partyKeys</span></a></span><span>
</span><span id="line-420"></span><span>  </span><span id="local-6989586621679551895"><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="#local-6989586621679551895"><span class="hs-identifier hs-var">seedContestationPeriod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Gen ContestationPeriod
</span><a href="Hydra.Model.html#genContestationPeriod"><span class="hs-identifier hs-var">genContestationPeriod</span></a></span><span>
</span><span id="line-421"></span><span>  </span><span id="local-6989586621679551897"><span class="annot"><span class="annottext">Map Party [(CardanoSigningKey, Value)]
</span><a href="#local-6989586621679551897"><span class="hs-identifier hs-var">toCommit</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Map Party [(CardanoSigningKey, Value)]]
-&gt; Map Party [(CardanoSigningKey, Value)]
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#mconcat"><span class="hs-identifier hs-var">mconcat</span></a></span><span> </span><span class="annot"><span class="annottext">([Map Party [(CardanoSigningKey, Value)]]
 -&gt; Map Party [(CardanoSigningKey, Value)])
-&gt; Gen [Map Party [(CardanoSigningKey, Value)]]
-&gt; Gen (Map Party [(CardanoSigningKey, Value)])
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">((SigningKey HydraKey, CardanoSigningKey)
 -&gt; Gen (Map Party [(CardanoSigningKey, Value)]))
-&gt; [(SigningKey HydraKey, CardanoSigningKey)]
-&gt; Gen [Map Party [(CardanoSigningKey, Value)]]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">(SigningKey HydraKey, CardanoSigningKey)
-&gt; Gen (Map Party [(CardanoSigningKey, Value)])
</span><a href="Hydra.Model.html#genToCommit"><span class="hs-identifier hs-var">genToCommit</span></a></span><span> </span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="#local-6989586621679551893"><span class="hs-identifier hs-var">seedKeys</span></a></span><span>
</span><span id="line-422"></span><span>  </span><span class="annot"><span class="annottext">Action WorldState () -&gt; Gen (Action WorldState ())
forall a. a -&gt; Gen a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Action WorldState () -&gt; Gen (Action WorldState ()))
-&gt; Action WorldState () -&gt; Gen (Action WorldState ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><a href="Hydra.Model.html#Seed"><span class="hs-identifier hs-type">Seed</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
$sel:seedKeys:Seed :: [(SigningKey HydraKey, CardanoSigningKey)]
seedKeys :: [(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="Hydra.Model.html#%24sel%3AseedKeys%3ASeed"><span class="hs-identifier hs-var hs-var">seedKeys</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ContestationPeriod
$sel:seedContestationPeriod:Seed :: ContestationPeriod
seedContestationPeriod :: ContestationPeriod
</span><a href="Hydra.Model.html#%24sel%3AseedContestationPeriod%3ASeed"><span class="hs-identifier hs-var hs-var">seedContestationPeriod</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map Party [(CardanoSigningKey, Value)]
Uncommitted
$sel:toCommit:Seed :: Uncommitted
toCommit :: Map Party [(CardanoSigningKey, Value)]
</span><a href="Hydra.Model.html#%24sel%3AtoCommit%3ASeed"><span class="hs-identifier hs-var hs-var">toCommit</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-423"></span><span>
</span><span id="line-424"></span><span class="annot"><a href="Hydra.Model.html#genToCommit"><span class="hs-identifier hs-type">genToCommit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SigningKey</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">HydraKey</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html#CardanoSigningKey"><span class="hs-identifier hs-type">CardanoSigningKey</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Gen</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Party</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Model.Payment.html#CardanoSigningKey"><span class="hs-identifier hs-type">CardanoSigningKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-425"></span><span id="genToCommit"><span class="annot"><span class="annottext">genToCommit :: (SigningKey HydraKey, CardanoSigningKey)
-&gt; Gen (Map Party [(CardanoSigningKey, Value)])
</span><a href="Hydra.Model.html#genToCommit"><span class="hs-identifier hs-var hs-var">genToCommit</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679551900"><span class="annot"><span class="annottext">SigningKey HydraKey
</span><a href="#local-6989586621679551900"><span class="hs-identifier hs-var">hk</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679551901"><span class="annot"><span class="annottext">CardanoSigningKey
</span><a href="#local-6989586621679551901"><span class="hs-identifier hs-var">ck</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-426"></span><span>  </span><span id="local-6989586621679551902"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679551902"><span class="hs-identifier hs-var">value</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Gen Value
</span><a href="Hydra.Model.Payment.html#genAdaValue"><span class="hs-identifier hs-var">genAdaValue</span></a></span><span>
</span><span id="line-427"></span><span>  </span><span class="annot"><span class="annottext">Map Party [(CardanoSigningKey, Value)]
-&gt; Gen (Map Party [(CardanoSigningKey, Value)])
forall a. a -&gt; Gen a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Map Party [(CardanoSigningKey, Value)]
 -&gt; Gen (Map Party [(CardanoSigningKey, Value)]))
-&gt; Map Party [(CardanoSigningKey, Value)]
-&gt; Gen (Map Party [(CardanoSigningKey, Value)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Party
-&gt; [(CardanoSigningKey, Value)]
-&gt; Map Party [(CardanoSigningKey, Value)]
forall k a. k -&gt; a -&gt; Map k a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#singleton"><span class="hs-identifier hs-var">Map.singleton</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SigningKey HydraKey -&gt; Party
</span><span class="hs-identifier hs-var">deriveParty</span></span><span> </span><span class="annot"><span class="annottext">SigningKey HydraKey
</span><a href="#local-6989586621679551900"><span class="hs-identifier hs-var">hk</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">CardanoSigningKey
</span><a href="#local-6989586621679551901"><span class="hs-identifier hs-var">ck</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679551902"><span class="hs-identifier hs-var">value</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-428"></span><span>
</span><span id="line-429"></span><span class="annot"><a href="Hydra.Model.html#genContestationPeriod"><span class="hs-identifier hs-type">genContestationPeriod</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Gen</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ContestationPeriod</span></span><span>
</span><span id="line-430"></span><span id="genContestationPeriod"><span class="annot"><span class="annottext">genContestationPeriod :: Gen ContestationPeriod
</span><a href="Hydra.Model.html#genContestationPeriod"><span class="hs-identifier hs-var hs-var">genContestationPeriod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-431"></span><span>  </span><span id="local-6989586621679551904"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679551904"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Word, Word) -&gt; Gen Word
forall a. Random a =&gt; (a, a) -&gt; Gen a
</span><span class="hs-identifier hs-var">choose</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">200</span></span><span class="hs-special">)</span><span>
</span><span id="line-432"></span><span>  </span><span class="annot"><span class="annottext">ContestationPeriod -&gt; Gen ContestationPeriod
forall a. a -&gt; Gen a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(ContestationPeriod -&gt; Gen ContestationPeriod)
-&gt; ContestationPeriod -&gt; Gen ContestationPeriod
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; ContestationPeriod
</span><span class="hs-identifier hs-var">UnsafeContestationPeriod</span></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; ContestationPeriod) -&gt; Natural -&gt; ContestationPeriod
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Word -&gt; Natural
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Natural.html#wordToNatural"><span class="hs-identifier hs-var">wordToNatural</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679551904"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-433"></span><span>
</span><span id="line-434"></span><span id="local-6989586621679550606"><span class="annot"><a href="Hydra.Model.html#genInit"><span class="hs-identifier hs-type">genInit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SigningKey</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">HydraKey</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679550606"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Gen</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Action</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-435"></span><span id="genInit"><span class="annot"><span class="annottext">genInit :: forall b. [(SigningKey HydraKey, b)] -&gt; Gen (Action WorldState ())
</span><a href="Hydra.Model.html#genInit"><span class="hs-identifier hs-var hs-var">genInit</span></a></span></span><span> </span><span id="local-6989586621679551908"><span class="annot"><span class="annottext">[(SigningKey HydraKey, b)]
</span><a href="#local-6989586621679551908"><span class="hs-identifier hs-var">hydraParties</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-436"></span><span>  </span><span id="local-6989586621679551909"><span class="annot"><span class="annottext">SigningKey HydraKey
</span><a href="#local-6989586621679551909"><span class="hs-identifier hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(SigningKey HydraKey, b) -&gt; SigningKey HydraKey
forall a b. (a, b) -&gt; a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">((SigningKey HydraKey, b) -&gt; SigningKey HydraKey)
-&gt; Gen (SigningKey HydraKey, b) -&gt; Gen (SigningKey HydraKey)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[(SigningKey HydraKey, b)] -&gt; Gen (SigningKey HydraKey, b)
forall a. [a] -&gt; Gen a
</span><span class="hs-identifier hs-var">elements</span></span><span> </span><span class="annot"><span class="annottext">[(SigningKey HydraKey, b)]
</span><a href="#local-6989586621679551908"><span class="hs-identifier hs-var">hydraParties</span></a></span><span>
</span><span id="line-437"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679551910"><span class="annot"><span class="annottext">party :: Party
</span><a href="#local-6989586621679551910"><span class="hs-identifier hs-var hs-var">party</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SigningKey HydraKey -&gt; Party
</span><span class="hs-identifier hs-var">deriveParty</span></span><span> </span><span class="annot"><span class="annottext">SigningKey HydraKey
</span><a href="#local-6989586621679551909"><span class="hs-identifier hs-var">key</span></a></span><span>
</span><span id="line-438"></span><span>  </span><span class="annot"><span class="annottext">Action WorldState () -&gt; Gen (Action WorldState ())
forall a. a -&gt; Gen a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Action WorldState () -&gt; Gen (Action WorldState ()))
-&gt; Action WorldState () -&gt; Gen (Action WorldState ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Party -&gt; Action WorldState ()
</span><a href="Hydra.Model.html#Init"><span class="hs-identifier hs-var">Init</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679551910"><span class="hs-identifier hs-var">party</span></a></span><span>
</span><span id="line-439"></span><span>
</span><span id="line-440"></span><span class="annot"><a href="Hydra.Model.html#genPayment"><span class="hs-identifier hs-type">genPayment</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Gen</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Party</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html#Payment"><span class="hs-identifier hs-type">Payment</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-441"></span><span id="genPayment"><span class="annot"><span class="annottext">genPayment :: WorldState -&gt; Gen (Party, Payment)
</span><a href="Hydra.Model.html#genPayment"><span class="hs-identifier hs-var hs-var">genPayment</span></a></span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span class="hs-special">{</span><span id="local-6989586621679551911"><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
$sel:hydraParties:WorldState :: WorldState -&gt; [(SigningKey HydraKey, CardanoSigningKey)]
hydraParties :: [(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="Hydra.Model.html#%24sel%3AhydraParties%3AWorldState"><span class="hs-identifier hs-var hs-var">hydraParties</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679551912"><span class="annot"><span class="annottext">GlobalState
$sel:hydraState:WorldState :: WorldState -&gt; GlobalState
hydraState :: GlobalState
</span><a href="Hydra.Model.html#%24sel%3AhydraState%3AWorldState"><span class="hs-identifier hs-var hs-var">hydraState</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-442"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">GlobalState
</span><a href="#local-6989586621679551912"><span class="hs-identifier hs-var">hydraState</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-443"></span><span>    </span><span class="annot"><a href="Hydra.Model.html#Open"><span class="hs-identifier hs-type">Open</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:offChainState:Start :: GlobalState -&gt; OffChainState
</span><a href="Hydra.Model.html#%24sel%3AoffChainState%3AStart"><span class="hs-identifier hs-var">offChainState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Hydra.Model.html#OffChainState"><span class="hs-identifier hs-type">OffChainState</span></a></span><span class="hs-special">{</span><span id="local-6989586621679551913"><span class="annot"><span class="annottext">UTxOType Payment
$sel:confirmedUTxO:OffChainState :: OffChainState -&gt; UTxOType Payment
confirmedUTxO :: UTxOType Payment
</span><a href="Hydra.Model.html#%24sel%3AconfirmedUTxO%3AOffChainState"><span class="hs-identifier hs-var hs-var">confirmedUTxO</span></a></span></span><span class="hs-special">}</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-444"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679551914"><span class="annot"><span class="annottext">CardanoSigningKey
</span><a href="#local-6989586621679551914"><span class="hs-identifier hs-var">from</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679551915"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679551915"><span class="hs-identifier hs-var">value</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-445"></span><span>        </span><span class="annot"><span class="annottext">[(CardanoSigningKey, Value)] -&gt; Gen (CardanoSigningKey, Value)
forall a. [a] -&gt; Gen a
</span><span class="hs-identifier hs-var">elements</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((CardanoSigningKey, Value) -&gt; Bool)
-&gt; [(CardanoSigningKey, Value)] -&gt; [(CardanoSigningKey, Value)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#not"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; ((CardanoSigningKey, Value) -&gt; Bool)
-&gt; (CardanoSigningKey, Value)
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[(AssetId, Quantity)] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">([(AssetId, Quantity)] -&gt; Bool)
-&gt; ((CardanoSigningKey, Value) -&gt; [(AssetId, Quantity)])
-&gt; (CardanoSigningKey, Value)
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; [(AssetId, Quantity)]
</span><span class="hs-identifier hs-var">valueToList</span></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; [(AssetId, Quantity)])
-&gt; ((CardanoSigningKey, Value) -&gt; Value)
-&gt; (CardanoSigningKey, Value)
-&gt; [(AssetId, Quantity)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(CardanoSigningKey, Value) -&gt; Value
forall a b. (a, b) -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(CardanoSigningKey, Value)]
UTxOType Payment
</span><a href="#local-6989586621679551913"><span class="hs-identifier hs-var">confirmedUTxO</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-446"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679551918"><span class="annot"><span class="annottext">party :: Party
</span><a href="#local-6989586621679551918"><span class="hs-identifier hs-var hs-var">party</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SigningKey HydraKey -&gt; Party
</span><span class="hs-identifier hs-var">deriveParty</span></span><span> </span><span class="annot"><span class="annottext">(SigningKey HydraKey -&gt; Party) -&gt; SigningKey HydraKey -&gt; Party
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(SigningKey HydraKey, CardanoSigningKey) -&gt; SigningKey HydraKey
forall a b. (a, b) -&gt; a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">((SigningKey HydraKey, CardanoSigningKey) -&gt; SigningKey HydraKey)
-&gt; (SigningKey HydraKey, CardanoSigningKey) -&gt; SigningKey HydraKey
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (SigningKey HydraKey, CardanoSigningKey)
-&gt; (SigningKey HydraKey, CardanoSigningKey)
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Maybe.html#fromJust"><span class="hs-identifier hs-var">fromJust</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (SigningKey HydraKey, CardanoSigningKey)
 -&gt; (SigningKey HydraKey, CardanoSigningKey))
-&gt; Maybe (SigningKey HydraKey, CardanoSigningKey)
-&gt; (SigningKey HydraKey, CardanoSigningKey)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((SigningKey HydraKey, CardanoSigningKey) -&gt; Bool)
-&gt; [(SigningKey HydraKey, CardanoSigningKey)]
-&gt; Maybe (SigningKey HydraKey, CardanoSigningKey)
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Foldable.html#find"><span class="hs-identifier hs-var">List.find</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">CardanoSigningKey -&gt; CardanoSigningKey -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">CardanoSigningKey
</span><a href="#local-6989586621679551914"><span class="hs-identifier hs-var">from</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(CardanoSigningKey -&gt; Bool)
-&gt; ((SigningKey HydraKey, CardanoSigningKey) -&gt; CardanoSigningKey)
-&gt; (SigningKey HydraKey, CardanoSigningKey)
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(SigningKey HydraKey, CardanoSigningKey) -&gt; CardanoSigningKey
forall a b. (a, b) -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="#local-6989586621679551911"><span class="hs-identifier hs-var">hydraParties</span></a></span><span>
</span><span id="line-447"></span><span>      </span><span class="hs-comment">-- NOTE: It's perfectly possible this yields a payment to self and it</span><span>
</span><span id="line-448"></span><span>      </span><span class="hs-comment">-- assumes hydraParties is not empty else `elements` will crash</span><span>
</span><span id="line-449"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SigningKey HydraKey
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679551920"><span class="annot"><span class="annottext">CardanoSigningKey
</span><a href="#local-6989586621679551920"><span class="hs-identifier hs-var">to</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
-&gt; Gen (SigningKey HydraKey, CardanoSigningKey)
forall a. [a] -&gt; Gen a
</span><span class="hs-identifier hs-var">elements</span></span><span> </span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="#local-6989586621679551911"><span class="hs-identifier hs-var">hydraParties</span></a></span><span>
</span><span id="line-450"></span><span>      </span><span class="annot"><span class="annottext">(Party, Payment) -&gt; Gen (Party, Payment)
forall a. a -&gt; Gen a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679551918"><span class="hs-identifier hs-var">party</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html#Payment"><span class="hs-identifier hs-type">Payment</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">CardanoSigningKey
$sel:from:Payment :: CardanoSigningKey
from :: CardanoSigningKey
</span><a href="Hydra.Model.Payment.html#%24sel%3Afrom%3APayment"><span class="hs-identifier hs-var hs-var">from</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CardanoSigningKey
to :: CardanoSigningKey
$sel:to:Payment :: CardanoSigningKey
</span><a href="#local-6989586621679551920"><span class="hs-identifier hs-var hs-var">to</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Value
$sel:value:Payment :: Value
value :: Value
</span><a href="Hydra.Model.Payment.html#%24sel%3Avalue%3APayment"><span class="hs-identifier hs-var hs-var">value</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-451"></span><span>    </span><span class="annot"><span class="annottext">GlobalState
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Gen (Party, Payment)
forall a t. (HasCallStack, IsText t) =&gt; t -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Gen (Party, Payment)) -&gt; Text -&gt; Gen (Party, Payment)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;genPayment impossible in state: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalState -&gt; Text
forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">GlobalState
</span><a href="#local-6989586621679551912"><span class="hs-identifier hs-var">hydraState</span></a></span><span>
</span><span id="line-452"></span><span>
</span><span id="line-453"></span><span id="local-6989586621679550688"><span class="annot"><a href="Hydra.Model.html#unsafeConstructorName"><span class="hs-identifier hs-type">unsafeConstructorName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Show.html#Show"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679550688"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679550688"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span></span><span>
</span><span id="line-454"></span><span id="unsafeConstructorName"><span class="annot"><span class="annottext">unsafeConstructorName :: forall a. Show a =&gt; a -&gt; String
</span><a href="Hydra.Model.html#unsafeConstructorName"><span class="hs-identifier hs-var hs-var">unsafeConstructorName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String
forall a. HasCallStack =&gt; [a] -&gt; a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.List.html#head"><span class="hs-identifier hs-var">Prelude.head</span></a></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; String) -&gt; (a -&gt; [String]) -&gt; a -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String]
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.OldList.html#words"><span class="hs-identifier hs-var">Prelude.words</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; [String]) -&gt; (a -&gt; String) -&gt; a -&gt; [String]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; String
forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span>
</span><span id="line-455"></span><span>
</span><span id="line-456"></span><span class="hs-comment">-- | Generate a list of pairs of Hydra/Cardano signing keys.</span><span>
</span><span id="line-457"></span><span class="hs-comment">--  All the keys in this list are guaranteed to be unique.</span><span>
</span><span id="line-458"></span><span class="annot"><a href="Hydra.Model.html#partyKeys"><span class="hs-identifier hs-type">partyKeys</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Gen</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SigningKey</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">HydraKey</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html#CardanoSigningKey"><span class="hs-identifier hs-type">CardanoSigningKey</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-459"></span><span id="partyKeys"><span class="annot"><span class="annottext">partyKeys :: Gen [(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="Hydra.Model.html#partyKeys"><span class="hs-identifier hs-var hs-var">partyKeys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-460"></span><span>  </span><span class="annot"><span class="annottext">(Int -&gt; Gen [(SigningKey HydraKey, CardanoSigningKey)])
-&gt; Gen [(SigningKey HydraKey, CardanoSigningKey)]
forall a. (Int -&gt; Gen a) -&gt; Gen a
</span><span class="hs-identifier hs-var">sized</span></span><span> </span><span class="annot"><span class="annottext">((Int -&gt; Gen [(SigningKey HydraKey, CardanoSigningKey)])
 -&gt; Gen [(SigningKey HydraKey, CardanoSigningKey)])
-&gt; (Int -&gt; Gen [(SigningKey HydraKey, CardanoSigningKey)])
-&gt; Gen [(SigningKey HydraKey, CardanoSigningKey)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679551934"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679551934"><span class="hs-identifier hs-var">len</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-461"></span><span>    </span><span id="local-6989586621679551935"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679551935"><span class="hs-identifier hs-var">numParties</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; Gen Int
forall a. Random a =&gt; (a, a) -&gt; Gen a
</span><span class="hs-identifier hs-var">choose</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679551934"><span class="hs-identifier hs-var">len</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-462"></span><span>    </span><span id="local-6989586621679551936"><span class="annot"><span class="annottext">[SigningKey HydraKey]
</span><a href="#local-6989586621679551936"><span class="hs-identifier hs-var">hks</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[SigningKey HydraKey] -&gt; [SigningKey HydraKey]
forall a. Eq a =&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.OldList.html#nub"><span class="hs-identifier hs-var">nub</span></a></span><span> </span><span class="annot"><span class="annottext">([SigningKey HydraKey] -&gt; [SigningKey HydraKey])
-&gt; Gen [SigningKey HydraKey] -&gt; Gen [SigningKey HydraKey]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Gen (SigningKey HydraKey) -&gt; Gen [SigningKey HydraKey]
forall a. Int -&gt; Gen a -&gt; Gen [a]
</span><span class="hs-identifier hs-var">vectorOf</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679551935"><span class="hs-identifier hs-var">numParties</span></a></span><span> </span><span class="annot"><span class="annottext">Gen (SigningKey HydraKey)
forall a. Arbitrary a =&gt; Gen a
</span><span class="hs-identifier hs-var">arbitrary</span></span><span>
</span><span id="line-463"></span><span>    </span><span id="local-6989586621679551938"><span class="annot"><span class="annottext">[CardanoSigningKey]
</span><a href="#local-6989586621679551938"><span class="hs-identifier hs-var">cks</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[CardanoSigningKey] -&gt; [CardanoSigningKey]
forall a. Eq a =&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.OldList.html#nub"><span class="hs-identifier hs-var">nub</span></a></span><span> </span><span class="annot"><span class="annottext">([CardanoSigningKey] -&gt; [CardanoSigningKey])
-&gt; ([SigningKey PaymentKey] -&gt; [CardanoSigningKey])
-&gt; [SigningKey PaymentKey]
-&gt; [CardanoSigningKey]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(SigningKey PaymentKey -&gt; CardanoSigningKey)
-&gt; [SigningKey PaymentKey] -&gt; [CardanoSigningKey]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">SigningKey PaymentKey -&gt; CardanoSigningKey
</span><a href="Hydra.Model.Payment.html#CardanoSigningKey"><span class="hs-identifier hs-var">CardanoSigningKey</span></a></span><span> </span><span class="annot"><span class="annottext">([SigningKey PaymentKey] -&gt; [CardanoSigningKey])
-&gt; Gen [SigningKey PaymentKey] -&gt; Gen [CardanoSigningKey]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Gen (SigningKey PaymentKey) -&gt; Gen [SigningKey PaymentKey]
forall a. Int -&gt; Gen a -&gt; Gen [a]
</span><span class="hs-identifier hs-var">vectorOf</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679551935"><span class="hs-identifier hs-var">numParties</span></a></span><span> </span><span class="annot"><span class="annottext">Gen (SigningKey PaymentKey)
</span><span class="hs-identifier hs-var">genSigningKey</span></span><span>
</span><span id="line-464"></span><span>    </span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
-&gt; Gen [(SigningKey HydraKey, CardanoSigningKey)]
forall a. a -&gt; Gen a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">([(SigningKey HydraKey, CardanoSigningKey)]
 -&gt; Gen [(SigningKey HydraKey, CardanoSigningKey)])
-&gt; [(SigningKey HydraKey, CardanoSigningKey)]
-&gt; Gen [(SigningKey HydraKey, CardanoSigningKey)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[SigningKey HydraKey]
-&gt; [CardanoSigningKey]
-&gt; [(SigningKey HydraKey, CardanoSigningKey)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[SigningKey HydraKey]
</span><a href="#local-6989586621679551936"><span class="hs-identifier hs-var">hks</span></a></span><span> </span><span class="annot"><span class="annottext">[CardanoSigningKey]
</span><a href="#local-6989586621679551938"><span class="hs-identifier hs-var">cks</span></a></span><span>
</span><span id="line-465"></span><span>
</span><span id="line-466"></span><span class="annot"><span class="hs-comment">-- * Running the model</span></span><span>
</span><span id="line-467"></span><span>
</span><span id="line-468"></span><span class="hs-comment">-- | Concrete state needed to run actions against the implementation.</span><span>
</span><span id="line-469"></span><span class="hs-comment">-- This state is used and might be updated when actually `perform`ing actions generated from the `StateModel`.</span><span>
</span><span id="line-470"></span><span class="hs-keyword">data</span><span> </span><span id="Nodes"><span class="annot"><a href="Hydra.Model.html#Nodes"><span class="hs-identifier hs-var">Nodes</span></a></span></span><span> </span><span id="local-6989586621679550697"><span class="annot"><a href="#local-6989586621679550697"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Nodes"><span class="annot"><a href="Hydra.Model.html#Nodes"><span class="hs-identifier hs-var">Nodes</span></a></span></span><span>
</span><span id="line-471"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3Anodes%3ANodes"><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Nodes m -&gt; Map Party (TestHydraClient Tx m)
</span><a href="Hydra.Model.html#%24sel%3Anodes%3ANodes"><span class="hs-identifier hs-var hs-var">nodes</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map.Map</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Party</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.BehaviorSpec.html#TestHydraClient"><span class="hs-identifier hs-type">TestHydraClient</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span> </span><span class="annot"><a href="#local-6989586621679550697"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-472"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Map from party identifiers to a /handle/ for interacting with a node.</span></span><span>
</span><span id="line-473"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3Alogger%3ANodes"><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Nodes m -&gt; Tracer m (HydraLog Tx ())
</span><a href="Hydra.Model.html#%24sel%3Alogger%3ANodes"><span class="hs-identifier hs-var hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tracer</span></span><span> </span><span class="annot"><a href="#local-6989586621679550697"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HydraLog</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-474"></span><span>  </span><span class="hs-comment">-- ^ Logger used by each node.</span><span>
</span><span id="line-475"></span><span>  </span><span class="hs-comment">-- The reason we put this here is because the concrete value needs to be</span><span>
</span><span id="line-476"></span><span>  </span><span class="hs-comment">-- instantiated upon the test run initialisation, outiside of the model.</span><span>
</span><span id="line-477"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3Athreads%3ANodes"><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Nodes m -&gt; [Async m ()]
</span><a href="Hydra.Model.html#%24sel%3Athreads%3ANodes"><span class="hs-identifier hs-var hs-var">threads</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Async</span></span><span> </span><span class="annot"><a href="#local-6989586621679550697"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-478"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ List of threads spawned when executing `RunMonad`</span></span><span>
</span><span id="line-479"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3Achain%3ANodes"><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Nodes m -&gt; SimulatedChainNetwork Tx m
</span><a href="Hydra.Model.html#%24sel%3Achain%3ANodes"><span class="hs-identifier hs-var hs-var">chain</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.BehaviorSpec.html#SimulatedChainNetwork"><span class="hs-identifier hs-type">SimulatedChainNetwork</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span> </span><span class="annot"><a href="#local-6989586621679550697"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-480"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-481"></span><span>
</span><span id="line-482"></span><span class="hs-comment">-- NOTE: This newtype is needed to allow its use in typeclass instances</span><span>
</span><span id="line-483"></span><span class="hs-keyword">newtype</span><span> </span><span id="RunState"><span class="annot"><a href="Hydra.Model.html#RunState"><span class="hs-identifier hs-var">RunState</span></a></span></span><span> </span><span id="local-6989586621679550709"><span class="annot"><a href="#local-6989586621679550709"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="RunState"><span class="annot"><a href="Hydra.Model.html#RunState"><span class="hs-identifier hs-var">RunState</span></a></span></span><span> </span><span class="hs-special">{</span><span id="%24sel%3AnodesState%3ARunState"><span class="annot"><span class="annottext">forall (m :: * -&gt; *). RunState m -&gt; TVar m (Nodes m)
</span><a href="Hydra.Model.html#%24sel%3AnodesState%3ARunState"><span class="hs-identifier hs-var hs-var">nodesState</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TVar</span></span><span> </span><span class="annot"><a href="#local-6989586621679550709"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Model.html#Nodes"><span class="hs-identifier hs-type">Nodes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679550709"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><span id="line-484"></span><span>
</span><span id="line-485"></span><span class="hs-comment">-- | Our execution `MonadTrans`former.</span><span>
</span><span id="line-486"></span><span class="hs-comment">--</span><span>
</span><span id="line-487"></span><span class="hs-comment">-- This type is needed in order to keep the execution monad `m` abstract  and thus</span><span>
</span><span id="line-488"></span><span class="hs-comment">-- simplify the definition of the `RunModel` instance which requires a proper definition</span><span>
</span><span id="line-489"></span><span class="hs-comment">-- of `Realized`  type family. See [this issue](https://github.com/input-output-hk/quickcheck-dynamic/issues/29)</span><span>
</span><span id="line-490"></span><span class="hs-comment">-- for a discussion on why this monad is needed.</span><span>
</span><span id="line-491"></span><span class="hs-comment">--</span><span>
</span><span id="line-492"></span><span class="hs-comment">-- We could perhaps getaway with it and just have a type based on `IOSim` monad</span><span>
</span><span id="line-493"></span><span class="hs-comment">-- but this is cumbersome to write.</span><span>
</span><span id="line-494"></span><span class="hs-keyword">newtype</span><span> </span><span id="RunMonad"><span class="annot"><a href="Hydra.Model.html#RunMonad"><span class="hs-identifier hs-var">RunMonad</span></a></span></span><span> </span><span id="local-6989586621679550713"><span class="annot"><a href="#local-6989586621679550713"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679550714"><span class="annot"><a href="#local-6989586621679550714"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="RunMonad"><span class="annot"><a href="Hydra.Model.html#RunMonad"><span class="hs-identifier hs-var">RunMonad</span></a></span></span><span> </span><span class="hs-special">{</span><span id="%24sel%3ArunMonad%3ARunMonad"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. RunMonad m a -&gt; ReaderT (RunState m) m a
</span><a href="Hydra.Model.html#%24sel%3ArunMonad%3ARunMonad"><span class="hs-identifier hs-var hs-var">runMonad</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Reader.html#ReaderT"><span class="hs-identifier hs-type">ReaderT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Model.html#RunState"><span class="hs-identifier hs-type">RunState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679550713"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679550713"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679550714"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-495"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">newtype</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679551952"><span id="local-6989586621679551957"><span class="annot"><span class="annottext">(forall a b. (a -&gt; b) -&gt; RunMonad m a -&gt; RunMonad m b)
-&gt; (forall a b. a -&gt; RunMonad m b -&gt; RunMonad m a)
-&gt; Functor (RunMonad m)
forall a b. a -&gt; RunMonad m b -&gt; RunMonad m a
forall a b. (a -&gt; b) -&gt; RunMonad m a -&gt; RunMonad m b
forall (m :: * -&gt; *) a b.
Functor m =&gt;
a -&gt; RunMonad m b -&gt; RunMonad m a
forall (m :: * -&gt; *) a b.
Functor m =&gt;
(a -&gt; b) -&gt; RunMonad m a -&gt; RunMonad m b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
$cfmap :: forall (m :: * -&gt; *) a b.
Functor m =&gt;
(a -&gt; b) -&gt; RunMonad m a -&gt; RunMonad m b
fmap :: forall a b. (a -&gt; b) -&gt; RunMonad m a -&gt; RunMonad m b
$c&lt;$ :: forall (m :: * -&gt; *) a b.
Functor m =&gt;
a -&gt; RunMonad m b -&gt; RunMonad m a
&lt;$ :: forall a b. a -&gt; RunMonad m b -&gt; RunMonad m a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#Functor"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679551967"><span id="local-6989586621679551972"><span id="local-6989586621679551976"><span id="local-6989586621679551980"><span id="local-6989586621679551984"><span class="annot"><span class="annottext">Functor (RunMonad m)
Functor (RunMonad m) =&gt;
(forall a. a -&gt; RunMonad m a)
-&gt; (forall a b.
    RunMonad m (a -&gt; b) -&gt; RunMonad m a -&gt; RunMonad m b)
-&gt; (forall a b c.
    (a -&gt; b -&gt; c) -&gt; RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m c)
-&gt; (forall a b. RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m b)
-&gt; (forall a b. RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m a)
-&gt; Applicative (RunMonad m)
forall a. a -&gt; RunMonad m a
forall a b. RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m a
forall a b. RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m b
forall a b. RunMonad m (a -&gt; b) -&gt; RunMonad m a -&gt; RunMonad m b
forall a b c.
(a -&gt; b -&gt; c) -&gt; RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m c
forall (f :: * -&gt; *).
Functor f =&gt;
(forall a. a -&gt; f a)
-&gt; (forall a b. f (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b c. (a -&gt; b -&gt; c) -&gt; f a -&gt; f b -&gt; f c)
-&gt; (forall a b. f a -&gt; f b -&gt; f b)
-&gt; (forall a b. f a -&gt; f b -&gt; f a)
-&gt; Applicative f
forall (m :: * -&gt; *). Applicative m =&gt; Functor (RunMonad m)
forall (m :: * -&gt; *) a. Applicative m =&gt; a -&gt; RunMonad m a
forall (m :: * -&gt; *) a b.
Applicative m =&gt;
RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m a
forall (m :: * -&gt; *) a b.
Applicative m =&gt;
RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m b
forall (m :: * -&gt; *) a b.
Applicative m =&gt;
RunMonad m (a -&gt; b) -&gt; RunMonad m a -&gt; RunMonad m b
forall (m :: * -&gt; *) a b c.
Applicative m =&gt;
(a -&gt; b -&gt; c) -&gt; RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m c
$cpure :: forall (m :: * -&gt; *) a. Applicative m =&gt; a -&gt; RunMonad m a
pure :: forall a. a -&gt; RunMonad m a
$c&lt;*&gt; :: forall (m :: * -&gt; *) a b.
Applicative m =&gt;
RunMonad m (a -&gt; b) -&gt; RunMonad m a -&gt; RunMonad m b
&lt;*&gt; :: forall a b. RunMonad m (a -&gt; b) -&gt; RunMonad m a -&gt; RunMonad m b
$cliftA2 :: forall (m :: * -&gt; *) a b c.
Applicative m =&gt;
(a -&gt; b -&gt; c) -&gt; RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m c
liftA2 :: forall a b c.
(a -&gt; b -&gt; c) -&gt; RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m c
$c*&gt; :: forall (m :: * -&gt; *) a b.
Applicative m =&gt;
RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m b
*&gt; :: forall a b. RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m b
$c&lt;* :: forall (m :: * -&gt; *) a b.
Applicative m =&gt;
RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m a
&lt;* :: forall a b. RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#Applicative"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Applicative</span></a></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679551995"><span id="local-6989586621679552000"><span id="local-6989586621679552004"><span class="annot"><span class="annottext">Applicative (RunMonad m)
Applicative (RunMonad m) =&gt;
(forall a b. RunMonad m a -&gt; (a -&gt; RunMonad m b) -&gt; RunMonad m b)
-&gt; (forall a b. RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m b)
-&gt; (forall a. a -&gt; RunMonad m a)
-&gt; Monad (RunMonad m)
forall a. a -&gt; RunMonad m a
forall a b. RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m b
forall a b. RunMonad m a -&gt; (a -&gt; RunMonad m b) -&gt; RunMonad m b
forall (m :: * -&gt; *). Monad m =&gt; Applicative (RunMonad m)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; RunMonad m a
forall (m :: * -&gt; *) a b.
Monad m =&gt;
RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m b
forall (m :: * -&gt; *) a b.
Monad m =&gt;
RunMonad m a -&gt; (a -&gt; RunMonad m b) -&gt; RunMonad m b
forall (m :: * -&gt; *).
Applicative m =&gt;
(forall a b. m a -&gt; (a -&gt; m b) -&gt; m b)
-&gt; (forall a b. m a -&gt; m b -&gt; m b)
-&gt; (forall a. a -&gt; m a)
-&gt; Monad m
$c&gt;&gt;= :: forall (m :: * -&gt; *) a b.
Monad m =&gt;
RunMonad m a -&gt; (a -&gt; RunMonad m b) -&gt; RunMonad m b
&gt;&gt;= :: forall a b. RunMonad m a -&gt; (a -&gt; RunMonad m b) -&gt; RunMonad m b
$c&gt;&gt; :: forall (m :: * -&gt; *) a b.
Monad m =&gt;
RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m b
&gt;&gt; :: forall a b. RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m b
$creturn :: forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; RunMonad m a
return :: forall a. a -&gt; RunMonad m a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#Monad"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Monad</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679552014"><span id="local-6989586621679552019"><span id="local-6989586621679552023"><span class="annot"><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/mtl-2.3.1/src/Control.Monad.Reader.Class.html#MonadReader"><span class="hs-identifier hs-type">MonadReader</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Model.html#RunState"><span class="hs-identifier hs-type">RunState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679550713"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679552035"><span id="local-6989586621679552042"><span id="local-6989586621679552046"><span id="local-6989586621679552050"><span class="annot"><span class="annottext">Monad (RunMonad m)
Monad (RunMonad m) =&gt;
(forall e a. Exception e =&gt; e -&gt; RunMonad m a)
-&gt; (forall a b c.
    RunMonad m a
    -&gt; (a -&gt; RunMonad m b) -&gt; (a -&gt; RunMonad m c) -&gt; RunMonad m c)
-&gt; (forall a b c.
    RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m c -&gt; RunMonad m c)
-&gt; (forall a b. RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m a)
-&gt; MonadThrow (RunMonad m)
forall e a. Exception e =&gt; e -&gt; RunMonad m a
forall a b. RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m a
forall a b c.
RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m c -&gt; RunMonad m c
forall a b c.
RunMonad m a
-&gt; (a -&gt; RunMonad m b) -&gt; (a -&gt; RunMonad m c) -&gt; RunMonad m c
forall (m :: * -&gt; *).
Monad m =&gt;
(forall e a. Exception e =&gt; e -&gt; m a)
-&gt; (forall a b c. m a -&gt; (a -&gt; m b) -&gt; (a -&gt; m c) -&gt; m c)
-&gt; (forall a b c. m a -&gt; m b -&gt; m c -&gt; m c)
-&gt; (forall a b. m a -&gt; m b -&gt; m a)
-&gt; MonadThrow m
forall (m :: * -&gt; *). MonadThrow m =&gt; Monad (RunMonad m)
forall (m :: * -&gt; *) e a.
(MonadThrow m, Exception e) =&gt;
e -&gt; RunMonad m a
forall (m :: * -&gt; *) a b.
MonadThrow m =&gt;
RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m a
forall (m :: * -&gt; *) a b c.
MonadThrow m =&gt;
RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m c -&gt; RunMonad m c
forall (m :: * -&gt; *) a b c.
MonadThrow m =&gt;
RunMonad m a
-&gt; (a -&gt; RunMonad m b) -&gt; (a -&gt; RunMonad m c) -&gt; RunMonad m c
$cthrowIO :: forall (m :: * -&gt; *) e a.
(MonadThrow m, Exception e) =&gt;
e -&gt; RunMonad m a
throwIO :: forall e a. Exception e =&gt; e -&gt; RunMonad m a
$cbracket :: forall (m :: * -&gt; *) a b c.
MonadThrow m =&gt;
RunMonad m a
-&gt; (a -&gt; RunMonad m b) -&gt; (a -&gt; RunMonad m c) -&gt; RunMonad m c
bracket :: forall a b c.
RunMonad m a
-&gt; (a -&gt; RunMonad m b) -&gt; (a -&gt; RunMonad m c) -&gt; RunMonad m c
$cbracket_ :: forall (m :: * -&gt; *) a b c.
MonadThrow m =&gt;
RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m c -&gt; RunMonad m c
bracket_ :: forall a b c.
RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m c -&gt; RunMonad m c
$cfinally :: forall (m :: * -&gt; *) a b.
MonadThrow m =&gt;
RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m a
finally :: forall a b. RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">MonadThrow</span></span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-496"></span><span>
</span><span id="line-497"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Class.html#MonadTrans"><span class="hs-identifier hs-type">MonadTrans</span></a></span><span> </span><span class="annot"><a href="Hydra.Model.html#RunMonad"><span class="hs-identifier hs-type">RunMonad</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-498"></span><span>  </span><span id="local-6989586621679552065"><span class="annot"><span class="annottext">lift :: forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; RunMonad m a
</span><a href="#local-6989586621679552065"><span class="hs-identifier hs-var hs-var hs-var hs-var">lift</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ReaderT (RunState m) m a -&gt; RunMonad m a
forall (m :: * -&gt; *) a. ReaderT (RunState m) m a -&gt; RunMonad m a
</span><a href="Hydra.Model.html#RunMonad"><span class="hs-identifier hs-var">RunMonad</span></a></span><span> </span><span class="annot"><span class="annottext">(ReaderT (RunState m) m a -&gt; RunMonad m a)
-&gt; (m a -&gt; ReaderT (RunState m) m a) -&gt; m a -&gt; RunMonad m a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">m a -&gt; ReaderT (RunState m) m a
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; ReaderT (RunState m) m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span>
</span><span id="line-499"></span><span>
</span><span id="line-500"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679550818"><span id="local-6989586621679552074"><span class="annot"><span class="hs-identifier hs-type">MonadSTM</span></span><span> </span><span class="annot"><a href="#local-6989586621679550818"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/mtl-2.3.1/src/Control.Monad.State.Class.html#MonadState"><span class="hs-identifier hs-type">MonadState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Model.html#Nodes"><span class="hs-identifier hs-type">Nodes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679550818"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Model.html#RunMonad"><span class="hs-identifier hs-type">RunMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679550818"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-501"></span><span>  </span><span id="local-6989586621679552084"><span class="annot"><span class="annottext">get :: RunMonad m (Nodes m)
</span><a href="#local-6989586621679552084"><span class="hs-identifier hs-var hs-var hs-var hs-var">get</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RunMonad m (RunState m)
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/mtl-2.3.1/src/Control.Monad.Reader.Class.html#ask"><span class="hs-identifier hs-var">ask</span></a></span><span> </span><span class="annot"><span class="annottext">RunMonad m (RunState m)
-&gt; (RunState m -&gt; RunMonad m (Nodes m)) -&gt; RunMonad m (Nodes m)
forall a b. RunMonad m a -&gt; (a -&gt; RunMonad m b) -&gt; RunMonad m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">m (Nodes m) -&gt; RunMonad m (Nodes m)
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; RunMonad m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Nodes m) -&gt; RunMonad m (Nodes m))
-&gt; (RunState m -&gt; m (Nodes m))
-&gt; RunState m
-&gt; RunMonad m (Nodes m)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">TVar m (Nodes m) -&gt; m (Nodes m)
forall a. TVar m a -&gt; m a
forall (m :: * -&gt; *) a. MonadSTM m =&gt; TVar m a -&gt; m a
</span><span class="hs-identifier hs-var">readTVarIO</span></span><span> </span><span class="annot"><span class="annottext">(TVar m (Nodes m) -&gt; m (Nodes m))
-&gt; (RunState m -&gt; TVar m (Nodes m)) -&gt; RunState m -&gt; m (Nodes m)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">RunState m -&gt; TVar m (Nodes m)
forall (m :: * -&gt; *). RunState m -&gt; TVar m (Nodes m)
</span><a href="Hydra.Model.html#%24sel%3AnodesState%3ARunState"><span class="hs-identifier hs-var">nodesState</span></a></span><span>
</span><span id="line-502"></span><span>
</span><span id="line-503"></span><span>  </span><span id="local-6989586621679552095"><span class="annot"><span class="annottext">put :: Nodes m -&gt; RunMonad m ()
</span><a href="#local-6989586621679552095"><span class="hs-identifier hs-var hs-var hs-var hs-var">put</span></a></span></span><span> </span><span id="local-6989586621679552097"><span class="annot"><span class="annottext">Nodes m
</span><a href="#local-6989586621679552097"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RunMonad m (RunState m)
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/mtl-2.3.1/src/Control.Monad.Reader.Class.html#ask"><span class="hs-identifier hs-var">ask</span></a></span><span> </span><span class="annot"><span class="annottext">RunMonad m (RunState m)
-&gt; (RunState m -&gt; RunMonad m ()) -&gt; RunMonad m ()
forall a b. RunMonad m a -&gt; (a -&gt; RunMonad m b) -&gt; RunMonad m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">m () -&gt; RunMonad m ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; RunMonad m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; RunMonad m ())
-&gt; (RunState m -&gt; m ()) -&gt; RunState m -&gt; RunMonad m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">STM m () -&gt; m ()
forall a. HasCallStack =&gt; STM m a -&gt; m a
forall (m :: * -&gt; *) a.
(MonadSTM m, HasCallStack) =&gt;
STM m a -&gt; m a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">(STM m () -&gt; m ())
-&gt; (RunState m -&gt; STM m ()) -&gt; RunState m -&gt; m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(TVar m (Nodes m) -&gt; (Nodes m -&gt; Nodes m) -&gt; STM m ())
-&gt; (Nodes m -&gt; Nodes m) -&gt; TVar m (Nodes m) -&gt; STM m ()
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#flip"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">TVar m (Nodes m) -&gt; (Nodes m -&gt; Nodes m) -&gt; STM m ()
forall a. TVar m a -&gt; (a -&gt; a) -&gt; STM m ()
forall (m :: * -&gt; *) a.
MonadSTM m =&gt;
TVar m a -&gt; (a -&gt; a) -&gt; STM m ()
</span><span class="hs-identifier hs-var">modifyTVar</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Nodes m -&gt; Nodes m -&gt; Nodes m
forall a b. a -&gt; b -&gt; a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">Nodes m
</span><a href="#local-6989586621679552097"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TVar m (Nodes m) -&gt; STM m ())
-&gt; (RunState m -&gt; TVar m (Nodes m)) -&gt; RunState m -&gt; STM m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">RunState m -&gt; TVar m (Nodes m)
forall (m :: * -&gt; *). RunState m -&gt; TVar m (Nodes m)
</span><a href="Hydra.Model.html#%24sel%3AnodesState%3ARunState"><span class="hs-identifier hs-var">nodesState</span></a></span><span>
</span><span id="line-504"></span><span>
</span><span id="line-505"></span><span class="hs-keyword">data</span><span> </span><span id="RunException"><span class="annot"><a href="Hydra.Model.html#RunException"><span class="hs-identifier hs-var">RunException</span></a></span></span><span>
</span><span id="line-506"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="TransactionNotObserved"><span class="annot"><a href="Hydra.Model.html#TransactionNotObserved"><span class="hs-identifier hs-var">TransactionNotObserved</span></a></span></span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html#Payment"><span class="hs-identifier hs-type">Payment</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span>
</span><span id="line-507"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="UnexpectedParty"><span class="annot"><a href="Hydra.Model.html#UnexpectedParty"><span class="hs-identifier hs-var">UnexpectedParty</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Party</span></span><span>
</span><span id="line-508"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="UnknownAddress"><span class="annot"><a href="Hydra.Model.html#UnknownAddress"><span class="hs-identifier hs-var">UnknownAddress</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">AddressInEra</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AddressInEra</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html#CardanoSigningKey"><span class="hs-identifier hs-type">CardanoSigningKey</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-509"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="CannotFindSpendableUTxO"><span class="annot"><a href="Hydra.Model.html#CannotFindSpendableUTxO"><span class="hs-identifier hs-var">CannotFindSpendableUTxO</span></a></span></span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html#Payment"><span class="hs-identifier hs-type">Payment</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span>
</span><span id="line-510"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679552106"><span id="local-6989586621679552119"><span class="annot"><span class="annottext">RunException -&gt; RunException -&gt; Bool
(RunException -&gt; RunException -&gt; Bool)
-&gt; (RunException -&gt; RunException -&gt; Bool) -&gt; Eq RunException
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: RunException -&gt; RunException -&gt; Bool
== :: RunException -&gt; RunException -&gt; Bool
$c/= :: RunException -&gt; RunException -&gt; Bool
/= :: RunException -&gt; RunException -&gt; Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679552124"><span id="local-6989586621679552141"><span id="local-6989586621679552145"><span class="annot"><span class="annottext">Int -&gt; RunException -&gt; ShowS
[RunException] -&gt; ShowS
RunException -&gt; String
(Int -&gt; RunException -&gt; ShowS)
-&gt; (RunException -&gt; String)
-&gt; ([RunException] -&gt; ShowS)
-&gt; Show RunException
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; RunException -&gt; ShowS
showsPrec :: Int -&gt; RunException -&gt; ShowS
$cshow :: RunException -&gt; String
show :: RunException -&gt; String
$cshowList :: [RunException] -&gt; ShowS
showList :: [RunException] -&gt; ShowS
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-511"></span><span>
</span><span id="line-512"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679552154"><span id="local-6989586621679552158"><span id="local-6989586621679552161"><span class="annot"><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Exception.Type.html#Exception"><span class="hs-identifier hs-type">Exception</span></a></span><span> </span><span class="annot"><a href="Hydra.Model.html#RunException"><span class="hs-identifier hs-type">RunException</span></a></span></span></span></span><span>
</span><span id="line-513"></span><span>
</span><span id="line-514"></span><span class="hs-comment">-- | This type family is needed to link the _actual_ output from runnign actions</span><span>
</span><span id="line-515"></span><span class="hs-comment">-- with the ones that are modelled.</span><span>
</span><span id="line-516"></span><span class="hs-comment">--</span><span>
</span><span id="line-517"></span><span class="hs-comment">-- In our case we can keep things simple and use the same types on both side of</span><span>
</span><span id="line-518"></span><span class="hs-comment">-- the fence.</span><span>
</span><span id="line-519"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">instance</span><span> </span><span id="Realized"><span class="annot"><span class="hs-identifier hs-var">Realized</span></span></span><span> </span><span id="local-6989586621679552164"><span id="local-6989586621679552165"><span class="hs-special">(</span><span class="annot"><a href="Hydra.Model.html#RunMonad"><span class="hs-identifier hs-type">RunMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679552164"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679552165"><span class="hs-identifier hs-type">a</span></a></span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679552165"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-520"></span><span>
</span><span id="line-521"></span><span class="hs-keyword">instance</span><span>
</span><span id="line-522"></span><span>  </span><span id="local-6989586621679550867"><span id="local-6989586621679552181"><span id="local-6989586621679552186"><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadAsync</span></span><span> </span><span class="annot"><a href="#local-6989586621679550867"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-523"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadFork</span></span><span> </span><span class="annot"><a href="#local-6989586621679550867"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-524"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadMask</span></span><span> </span><span class="annot"><a href="#local-6989586621679550867"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-525"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadTimer</span></span><span> </span><span class="annot"><a href="#local-6989586621679550867"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-526"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadThrow</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">STM</span></span><span> </span><span class="annot"><a href="#local-6989586621679550867"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-527"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadLabelledSTM</span></span><span> </span><span class="annot"><a href="#local-6989586621679550867"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-528"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadDelay</span></span><span> </span><span class="annot"><a href="#local-6989586621679550867"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-529"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-530"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">RunModel</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Model.html#RunMonad"><span class="hs-identifier hs-type">RunMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679550867"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-531"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-532"></span><span>  </span><span id="local-6989586621679552217"><span class="annot"><span class="annottext">postcondition :: forall a.
(WorldState, WorldState)
-&gt; Action WorldState a
-&gt; LookUp (RunMonad m)
-&gt; Realized (RunMonad m) a
-&gt; PostconditionM (RunMonad m) Bool
</span><a href="#local-6989586621679552217"><span class="hs-identifier hs-var hs-var hs-var hs-var">postcondition</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WorldState
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679552219"><span class="annot"><span class="annottext">WorldState
</span><a href="#local-6989586621679552219"><span class="hs-identifier hs-var">st</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679552220"><span class="annot"><span class="annottext">Action WorldState a
</span><a href="#local-6989586621679552220"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span id="local-6989586621679552221"><span class="annot"><span class="annottext">LookUp (RunMonad m)
</span><a href="#local-6989586621679552221"><span class="hs-identifier hs-var">_lookup</span></a></span></span><span> </span><span id="local-6989586621679552222"><span class="annot"><span class="annottext">Realized (RunMonad m) a
</span><a href="#local-6989586621679552222"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-533"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; PostconditionM (RunMonad m) ()
forall (m :: * -&gt; *). Monad m =&gt; String -&gt; PostconditionM m ()
</span><span class="hs-identifier hs-var">counterexamplePost</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Postcondition failed&quot;</span></span><span>
</span><span id="line-534"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; PostconditionM (RunMonad m) ()
forall (m :: * -&gt; *). Monad m =&gt; String -&gt; PostconditionM m ()
</span><span class="hs-identifier hs-var">counterexamplePost</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Action:   &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Action WorldState a -&gt; String
forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Action WorldState a
</span><a href="#local-6989586621679552220"><span class="hs-identifier hs-var">action</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-535"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; PostconditionM (RunMonad m) ()
forall (m :: * -&gt; *). Monad m =&gt; String -&gt; PostconditionM m ()
</span><span class="hs-identifier hs-var">counterexamplePost</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;State:    &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">WorldState -&gt; String
forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">WorldState
</span><a href="#local-6989586621679552219"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-536"></span><span>
</span><span id="line-537"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Action WorldState a
</span><a href="#local-6989586621679552220"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-538"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Model.html#Commit"><span class="hs-identifier hs-type">Commit</span></a></span><span> </span><span id="local-6989586621679552233"><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679552233"><span class="hs-identifier hs-var">_party</span></a></span></span><span> </span><span id="local-6989586621679552234"><span class="annot"><span class="annottext">UTxOType Payment
</span><a href="#local-6989586621679552234"><span class="hs-identifier hs-var">expectedCommitted</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-539"></span><span>        </span><span class="annot"><span class="annottext">[(CardanoSigningKey, Value)]
UTxOType Payment
</span><a href="#local-6989586621679552234"><span class="hs-identifier hs-var">expectedCommitted</span></a></span><span> </span><span class="annot"><span class="annottext">[(CardanoSigningKey, Value)]
-&gt; [(CardanoSigningKey, Value)] -&gt; PostconditionM (RunMonad m) Bool
forall a (m :: * -&gt; *).
(Eq a, Show a, Monad m) =&gt;
a -&gt; a -&gt; PostconditionM m Bool
</span><a href="Hydra.Model.html#%3D%3D%3D"><span class="hs-operator hs-var">===</span></a></span><span> </span><span class="annot"><span class="annottext">[(CardanoSigningKey, Value)]
Realized (RunMonad m) a
</span><a href="#local-6989586621679552222"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-540"></span><span>      </span><span class="annot"><a href="Hydra.Model.html#Fanout"><span class="hs-identifier hs-type">Fanout</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-541"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">WorldState -&gt; GlobalState
</span><a href="Hydra.Model.html#%24sel%3AhydraState%3AWorldState"><span class="hs-identifier hs-var">hydraState</span></a></span><span> </span><span class="annot"><span class="annottext">WorldState
</span><a href="#local-6989586621679552219"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-542"></span><span>          </span><span class="annot"><a href="Hydra.Model.html#Final"><span class="hs-identifier hs-type">Final</span></a></span><span class="hs-special">{</span><span id="local-6989586621679552245"><span class="annot"><span class="annottext">UTxOType Payment
$sel:finalUTxO:Start :: GlobalState -&gt; UTxOType Payment
finalUTxO :: UTxOType Payment
</span><a href="Hydra.Model.html#%24sel%3AfinalUTxO%3AStart"><span class="hs-identifier hs-var hs-var">finalUTxO</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-543"></span><span>            </span><span class="hs-comment">-- NOTE: Sort `[TxOut]` by the address and values. We want to make</span><span>
</span><span id="line-544"></span><span>            </span><span class="hs-comment">-- sure that the fanout outputs match what we had in the open Head</span><span>
</span><span id="line-545"></span><span>            </span><span class="hs-comment">-- exactly.</span><span>
</span><span id="line-546"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679552252"><span class="annot"><span class="annottext">sorted :: [TxOut ctx] -&gt; [TxOut ctx]
</span><a href="#local-6989586621679552252"><span class="hs-identifier hs-var hs-var">sorted</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TxOut ctx -&gt; (AddressInEra, Coin)) -&gt; [TxOut ctx] -&gt; [TxOut ctx]
forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.OldList.html#sortOn"><span class="hs-identifier hs-var">sortOn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679552254"><span class="annot"><span class="annottext">TxOut ctx
</span><a href="#local-6989586621679552254"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOut ctx -&gt; AddressInEra
forall ctx. TxOut ctx -&gt; AddressInEra
</span><span class="hs-identifier hs-var">txOutAddress</span></span><span> </span><span class="annot"><span class="annottext">TxOut ctx
</span><a href="#local-6989586621679552254"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Coin
</span><span class="hs-identifier hs-var">selectLovelace</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOut ctx -&gt; Value
forall ctx. TxOut ctx -&gt; Value
</span><span class="hs-identifier hs-var">txOutValue</span></span><span> </span><span class="annot"><span class="annottext">TxOut ctx
</span><a href="#local-6989586621679552254"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-547"></span><span>            </span><span class="annot"><span class="annottext">[TxOut CtxUTxO Era] -&gt; [TxOut CtxUTxO Era]
forall {ctx}. [TxOut ctx] -&gt; [TxOut ctx]
</span><a href="#local-6989586621679552252"><span class="hs-identifier hs-var">sorted</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(CardanoSigningKey, Value)] -&gt; [TxOut CtxUTxO Era]
</span><a href="Hydra.Model.html#toTxOuts"><span class="hs-identifier hs-var">toTxOuts</span></a></span><span> </span><span class="annot"><span class="annottext">[(CardanoSigningKey, Value)]
UTxOType Payment
</span><a href="#local-6989586621679552245"><span class="hs-identifier hs-var">finalUTxO</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TxOut CtxUTxO Era]
-&gt; [TxOut CtxUTxO Era] -&gt; PostconditionM (RunMonad m) Bool
forall a (m :: * -&gt; *).
(Eq a, Show a, Monad m) =&gt;
a -&gt; a -&gt; PostconditionM m Bool
</span><a href="Hydra.Model.html#%3D%3D%3D"><span class="hs-operator hs-var">===</span></a></span><span> </span><span class="annot"><span class="annottext">[TxOut CtxUTxO Era] -&gt; [TxOut CtxUTxO Era]
forall {ctx}. [TxOut ctx] -&gt; [TxOut ctx]
</span><a href="#local-6989586621679552252"><span class="hs-identifier hs-var">sorted</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era) -&gt; [TxOut CtxUTxO Era]
forall a. UTxO' a -&gt; [a]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Foldable.html#toList"><span class="hs-identifier hs-var">toList</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era)
Realized (RunMonad m) a
</span><a href="#local-6989586621679552222"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-548"></span><span>          </span><span class="annot"><span class="annottext">GlobalState
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; PostconditionM (RunMonad m) Bool
forall a. a -&gt; PostconditionM (RunMonad m) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-549"></span><span>      </span><span class="annot"><span class="annottext">Action WorldState a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; PostconditionM (RunMonad m) Bool
forall a. a -&gt; PostconditionM (RunMonad m) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-550"></span><span>
</span><span id="line-551"></span><span>  </span><span id="local-6989586621679552268"><span class="annot"><span class="annottext">monitoring :: forall a.
(WorldState, WorldState)
-&gt; Action WorldState a
-&gt; LookUp (RunMonad m)
-&gt; Either (Error WorldState) (Realized (RunMonad m) a)
-&gt; Property
-&gt; Property
</span><a href="#local-6989586621679552268"><span class="hs-identifier hs-var hs-var hs-var hs-var">monitoring</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679552270"><span class="annot"><span class="annottext">WorldState
</span><a href="#local-6989586621679552270"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679552271"><span class="annot"><span class="annottext">WorldState
</span><a href="#local-6989586621679552271"><span class="hs-identifier hs-var">s'</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679552272"><span class="annot"><span class="annottext">Action WorldState a
</span><a href="#local-6989586621679552272"><span class="hs-identifier hs-var">_action</span></a></span></span><span> </span><span id="local-6989586621679552273"><span class="annot"><span class="annottext">LookUp (RunMonad m)
</span><a href="#local-6989586621679552273"><span class="hs-identifier hs-var">_lookup</span></a></span></span><span> </span><span id="local-6989586621679552274"><span class="annot"><span class="annottext">Either (Error WorldState) (Realized (RunMonad m) a)
</span><a href="#local-6989586621679552274"><span class="hs-identifier hs-var">_result</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-552"></span><span>    </span><span class="annot"><span class="annottext">Property -&gt; Property
</span><a href="#local-6989586621679552275"><span class="hs-identifier hs-var">decorateTransitions</span></a></span><span>
</span><span id="line-553"></span><span>   </span><span class="hs-keyword">where</span><span>
</span><span id="line-554"></span><span>    </span><span id="local-6989586621679552275"><span class="annot"><span class="annottext">decorateTransitions :: Property -&gt; Property
</span><a href="#local-6989586621679552275"><span class="hs-identifier hs-var hs-var">decorateTransitions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-555"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WorldState -&gt; GlobalState
</span><a href="Hydra.Model.html#%24sel%3AhydraState%3AWorldState"><span class="hs-identifier hs-var">hydraState</span></a></span><span> </span><span class="annot"><span class="annottext">WorldState
</span><a href="#local-6989586621679552270"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">WorldState -&gt; GlobalState
</span><a href="Hydra.Model.html#%24sel%3AhydraState%3AWorldState"><span class="hs-identifier hs-var">hydraState</span></a></span><span> </span><span class="annot"><span class="annottext">WorldState
</span><a href="#local-6989586621679552271"><span class="hs-identifier hs-var">s'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-556"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679552276"><span class="annot"><span class="annottext">GlobalState
</span><a href="#local-6989586621679552276"><span class="hs-identifier hs-var">st</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679552277"><span class="annot"><span class="annottext">GlobalState
</span><a href="#local-6989586621679552277"><span class="hs-identifier hs-var">st'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; Property -&gt; Property
forall prop.
Testable prop =&gt;
String -&gt; [String] -&gt; prop -&gt; Property
</span><span class="hs-identifier hs-var">tabulate</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Transitions&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">GlobalState -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="Hydra.Model.html#unsafeConstructorName"><span class="hs-identifier hs-var">unsafeConstructorName</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalState
</span><a href="#local-6989586621679552276"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; -&gt; &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalState -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="Hydra.Model.html#unsafeConstructorName"><span class="hs-identifier hs-var">unsafeConstructorName</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalState
</span><a href="#local-6989586621679552277"><span class="hs-identifier hs-var">st'</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-557"></span><span>
</span><span id="line-558"></span><span>  </span><span id="local-6989586621679552279"><span class="annot"><span class="annottext">perform :: forall a.
Typeable a =&gt;
WorldState
-&gt; Action WorldState a
-&gt; LookUp (RunMonad m)
-&gt; RunMonad
     m (PerformResult (Error WorldState) (Realized (RunMonad m) a))
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">perform</span></span></span><span> </span><span id="local-6989586621679552280"><span class="annot"><span class="annottext">WorldState
</span><a href="#local-6989586621679552280"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span id="local-6989586621679552281"><span class="annot"><span class="annottext">Action WorldState a
</span><a href="#local-6989586621679552281"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span id="local-6989586621679552282"><span class="annot"><span class="annottext">LookUp (RunMonad m)
</span><a href="#local-6989586621679552282"><span class="hs-identifier hs-var">lookup</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-559"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Action WorldState a
</span><a href="#local-6989586621679552281"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-560"></span><span>      </span><span class="annot"><a href="Hydra.Model.html#Seed"><span class="hs-identifier hs-type">Seed</span></a></span><span class="hs-special">{</span><span id="local-6989586621679552291"><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
$sel:seedKeys:Seed :: Action WorldState () -&gt; [(SigningKey HydraKey, CardanoSigningKey)]
seedKeys :: [(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="Hydra.Model.html#%24sel%3AseedKeys%3ASeed"><span class="hs-identifier hs-var hs-var">seedKeys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679552292"><span class="annot"><span class="annottext">ContestationPeriod
$sel:seedContestationPeriod:Seed :: Action WorldState () -&gt; ContestationPeriod
seedContestationPeriod :: ContestationPeriod
</span><a href="Hydra.Model.html#%24sel%3AseedContestationPeriod%3ASeed"><span class="hs-identifier hs-var hs-var">seedContestationPeriod</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679552293"><span class="annot"><span class="annottext">Uncommitted
$sel:toCommit:Seed :: Action WorldState () -&gt; Uncommitted
toCommit :: Uncommitted
</span><a href="Hydra.Model.html#%24sel%3AtoCommit%3ASeed"><span class="hs-identifier hs-var hs-var">toCommit</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-561"></span><span>        </span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
-&gt; ContestationPeriod -&gt; Uncommitted -&gt; RunMonad m ()
forall (m :: * -&gt; *).
(MonadAsync m, MonadTimer m, MonadThrow (STM m),
 MonadLabelledSTM m, MonadFork m, MonadMask m, MonadDelay m) =&gt;
[(SigningKey HydraKey, CardanoSigningKey)]
-&gt; ContestationPeriod -&gt; Uncommitted -&gt; RunMonad m ()
</span><a href="Hydra.Model.html#seedWorld"><span class="hs-identifier hs-var">seedWorld</span></a></span><span> </span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="#local-6989586621679552291"><span class="hs-identifier hs-var">seedKeys</span></a></span><span> </span><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="#local-6989586621679552292"><span class="hs-identifier hs-var">seedContestationPeriod</span></a></span><span> </span><span class="annot"><span class="annottext">Uncommitted
</span><a href="#local-6989586621679552293"><span class="hs-identifier hs-var">toCommit</span></a></span><span>
</span><span id="line-562"></span><span>      </span><span class="annot"><a href="Hydra.Model.html#Commit"><span class="hs-identifier hs-type">Commit</span></a></span><span> </span><span id="local-6989586621679552300"><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679552300"><span class="hs-identifier hs-var">party</span></a></span></span><span> </span><span id="local-6989586621679552301"><span class="annot"><span class="annottext">UTxOType Payment
</span><a href="#local-6989586621679552301"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-563"></span><span>        </span><span class="annot"><span class="annottext">[CardanoSigningKey]
-&gt; Party
-&gt; [(CardanoSigningKey, Value)]
-&gt; RunMonad m (UTxOType Payment)
forall (m :: * -&gt; *).
(MonadThrow m, MonadTimer m) =&gt;
[CardanoSigningKey]
-&gt; Party
-&gt; [(CardanoSigningKey, Value)]
-&gt; RunMonad m (UTxOType Payment)
</span><a href="Hydra.Model.html#performCommit"><span class="hs-identifier hs-var">performCommit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SigningKey HydraKey, CardanoSigningKey) -&gt; CardanoSigningKey
forall a b. (a, b) -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">((SigningKey HydraKey, CardanoSigningKey) -&gt; CardanoSigningKey)
-&gt; [(SigningKey HydraKey, CardanoSigningKey)]
-&gt; [CardanoSigningKey]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">WorldState -&gt; [(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="Hydra.Model.html#%24sel%3AhydraParties%3AWorldState"><span class="hs-identifier hs-var">hydraParties</span></a></span><span> </span><span class="annot"><span class="annottext">WorldState
</span><a href="#local-6989586621679552280"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679552300"><span class="hs-identifier hs-var">party</span></a></span><span> </span><span class="annot"><span class="annottext">[(CardanoSigningKey, Value)]
UTxOType Payment
</span><a href="#local-6989586621679552301"><span class="hs-identifier hs-var">utxo</span></a></span><span>
</span><span id="line-564"></span><span>      </span><span class="annot"><a href="Hydra.Model.html#Decommit"><span class="hs-identifier hs-type">Decommit</span></a></span><span> </span><span id="local-6989586621679552308"><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679552308"><span class="hs-identifier hs-var">party</span></a></span></span><span> </span><span id="local-6989586621679552309"><span class="annot"><span class="annottext">Payment
</span><a href="#local-6989586621679552309"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-565"></span><span>        </span><span class="annot"><span class="annottext">Party -&gt; Payment -&gt; RunMonad m ()
forall (m :: * -&gt; *).
(MonadThrow m, MonadTimer m, MonadAsync m, MonadDelay m) =&gt;
Party -&gt; Payment -&gt; RunMonad m ()
</span><a href="Hydra.Model.html#performDecommit"><span class="hs-identifier hs-var">performDecommit</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679552308"><span class="hs-identifier hs-var">party</span></a></span><span> </span><span class="annot"><span class="annottext">Payment
</span><a href="#local-6989586621679552309"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-566"></span><span>      </span><span class="annot"><a href="Hydra.Model.html#NewTx"><span class="hs-identifier hs-type">NewTx</span></a></span><span> </span><span id="local-6989586621679552316"><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679552316"><span class="hs-identifier hs-var">party</span></a></span></span><span> </span><span id="local-6989586621679552317"><span class="annot"><span class="annottext">Payment
</span><a href="#local-6989586621679552317"><span class="hs-identifier hs-var">transaction</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-567"></span><span>        </span><span class="annot"><span class="annottext">Party -&gt; Payment -&gt; RunMonad m Payment
forall (m :: * -&gt; *).
(MonadThrow m, MonadAsync m, MonadTimer m, MonadDelay m) =&gt;
Party -&gt; Payment -&gt; RunMonad m Payment
</span><a href="Hydra.Model.html#performNewTx"><span class="hs-identifier hs-var">performNewTx</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679552316"><span class="hs-identifier hs-var">party</span></a></span><span> </span><span class="annot"><span class="annottext">Payment
</span><a href="#local-6989586621679552317"><span class="hs-identifier hs-var">transaction</span></a></span><span>
</span><span id="line-568"></span><span>      </span><span class="annot"><a href="Hydra.Model.html#Init"><span class="hs-identifier hs-type">Init</span></a></span><span> </span><span id="local-6989586621679552323"><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679552323"><span class="hs-identifier hs-var">party</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-569"></span><span>        </span><span class="annot"><span class="annottext">Party -&gt; RunMonad m ()
forall (m :: * -&gt; *).
(MonadThrow m, MonadAsync m, MonadTimer m) =&gt;
Party -&gt; RunMonad m ()
</span><a href="Hydra.Model.html#performInit"><span class="hs-identifier hs-var">performInit</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679552323"><span class="hs-identifier hs-var">party</span></a></span><span>
</span><span id="line-570"></span><span>      </span><span class="annot"><a href="Hydra.Model.html#Abort"><span class="hs-identifier hs-type">Abort</span></a></span><span> </span><span id="local-6989586621679552329"><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679552329"><span class="hs-identifier hs-var">party</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-571"></span><span>        </span><span class="annot"><span class="annottext">Party -&gt; RunMonad m ()
forall (m :: * -&gt; *).
(MonadThrow m, MonadAsync m, MonadTimer m) =&gt;
Party -&gt; RunMonad m ()
</span><a href="Hydra.Model.html#performAbort"><span class="hs-identifier hs-var">performAbort</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679552329"><span class="hs-identifier hs-var">party</span></a></span><span>
</span><span id="line-572"></span><span>      </span><span class="annot"><a href="Hydra.Model.html#Close"><span class="hs-identifier hs-type">Close</span></a></span><span> </span><span id="local-6989586621679552336"><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679552336"><span class="hs-identifier hs-var">party</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-573"></span><span>        </span><span class="annot"><span class="annottext">Party -&gt; RunMonad m ()
forall (m :: * -&gt; *).
(MonadThrow m, MonadAsync m, MonadTimer m, MonadDelay m) =&gt;
Party -&gt; RunMonad m ()
</span><a href="Hydra.Model.html#performClose"><span class="hs-identifier hs-var">performClose</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679552336"><span class="hs-identifier hs-var">party</span></a></span><span>
</span><span id="line-574"></span><span>      </span><span class="annot"><a href="Hydra.Model.html#Fanout"><span class="hs-identifier hs-type">Fanout</span></a></span><span> </span><span id="local-6989586621679552342"><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679552342"><span class="hs-identifier hs-var">party</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-575"></span><span>        </span><span class="annot"><span class="annottext">Party -&gt; RunMonad m (UTxO' (TxOut CtxUTxO Era))
forall (m :: * -&gt; *).
(MonadThrow m, MonadAsync m, MonadDelay m) =&gt;
Party -&gt; RunMonad m (UTxO' (TxOut CtxUTxO Era))
</span><a href="Hydra.Model.html#performFanout"><span class="hs-identifier hs-var">performFanout</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679552342"><span class="hs-identifier hs-var">party</span></a></span><span>
</span><span id="line-576"></span><span>      </span><span class="annot"><a href="Hydra.Model.html#Wait"><span class="hs-identifier hs-type">Wait</span></a></span><span> </span><span id="local-6989586621679552348"><span class="annot"><span class="annottext">DiffTime
</span><a href="#local-6989586621679552348"><span class="hs-identifier hs-var">delay</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-577"></span><span>        </span><span class="annot"><span class="annottext">m (PerformResult (Error WorldState) (Realized (RunMonad m) a))
-&gt; RunMonad
     m (PerformResult (Error WorldState) (Realized (RunMonad m) a))
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; RunMonad m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">(m (PerformResult (Error WorldState) (Realized (RunMonad m) a))
 -&gt; RunMonad
      m (PerformResult (Error WorldState) (Realized (RunMonad m) a)))
-&gt; m (PerformResult (Error WorldState) (Realized (RunMonad m) a))
-&gt; RunMonad
     m (PerformResult (Error WorldState) (Realized (RunMonad m) a))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DiffTime -&gt; m ()
forall (m :: * -&gt; *). MonadDelay m =&gt; DiffTime -&gt; m ()
</span><span class="hs-identifier hs-var">threadDelay</span></span><span> </span><span class="annot"><span class="annottext">DiffTime
</span><a href="#local-6989586621679552348"><span class="hs-identifier hs-var">delay</span></a></span><span>
</span><span id="line-578"></span><span>      </span><span class="annot"><a href="Hydra.Model.html#ObserveConfirmedTx"><span class="hs-identifier hs-type">ObserveConfirmedTx</span></a></span><span> </span><span id="local-6989586621679552367"><span class="annot"><span class="annottext">Var Payment
</span><a href="#local-6989586621679552367"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-579"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679552368"><span class="annot"><span class="annottext">tx :: Realized (RunMonad m) Payment
</span><a href="#local-6989586621679552368"><span class="hs-identifier hs-var hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var Payment -&gt; Realized (RunMonad m) Payment
LookUp (RunMonad m)
</span><a href="#local-6989586621679552282"><span class="hs-identifier hs-var">lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Var Payment
</span><a href="#local-6989586621679552367"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-580"></span><span>        </span><span id="local-6989586621679552369"><span class="annot"><span class="annottext">[(Party, TestHydraClient Tx m)]
</span><a href="#local-6989586621679552369"><span class="hs-identifier hs-var">nodes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map Party (TestHydraClient Tx m) -&gt; [(Party, TestHydraClient Tx m)]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#toList"><span class="hs-identifier hs-var">Map.toList</span></a></span><span> </span><span class="annot"><span class="annottext">(Map Party (TestHydraClient Tx m)
 -&gt; [(Party, TestHydraClient Tx m)])
-&gt; RunMonad m (Map Party (TestHydraClient Tx m))
-&gt; RunMonad m [(Party, TestHydraClient Tx m)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(Nodes m -&gt; Map Party (TestHydraClient Tx m))
-&gt; RunMonad m (Map Party (TestHydraClient Tx m))
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/mtl-2.3.1/src/Control.Monad.State.Class.html#gets"><span class="hs-identifier hs-var">gets</span></a></span><span> </span><span class="annot"><span class="annottext">Nodes m -&gt; Map Party (TestHydraClient Tx m)
forall (m :: * -&gt; *). Nodes m -&gt; Map Party (TestHydraClient Tx m)
</span><a href="Hydra.Model.html#%24sel%3Anodes%3ANodes"><span class="hs-identifier hs-var">nodes</span></a></span><span>
</span><span id="line-581"></span><span>        </span><span class="annot"><span class="annottext">[(Party, TestHydraClient Tx m)]
-&gt; ((Party, TestHydraClient Tx m) -&gt; RunMonad m ())
-&gt; RunMonad m ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Foldable.html#forM_"><span class="hs-identifier hs-var">forM_</span></a></span><span> </span><span class="annot"><span class="annottext">[(Party, TestHydraClient Tx m)]
</span><a href="#local-6989586621679552369"><span class="hs-identifier hs-var">nodes</span></a></span><span> </span><span class="annot"><span class="annottext">(((Party, TestHydraClient Tx m) -&gt; RunMonad m ()) -&gt; RunMonad m ())
-&gt; ((Party, TestHydraClient Tx m) -&gt; RunMonad m ())
-&gt; RunMonad m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Party
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679552372"><span class="annot"><span class="annottext">TestHydraClient Tx m
</span><a href="#local-6989586621679552372"><span class="hs-identifier hs-var">node</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-582"></span><span>          </span><span class="annot"><span class="annottext">m (Either (UTxO' (TxOut CtxUTxO Era)) (TxIn, TxOut CtxUTxO Era))
-&gt; RunMonad
     m (Either (UTxO' (TxOut CtxUTxO Era)) (TxIn, TxOut CtxUTxO Era))
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; RunMonad m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era)
-&gt; CardanoSigningKey
-&gt; Value
-&gt; TestHydraClient Tx m
-&gt; m (Either (UTxO' (TxOut CtxUTxO Era)) (TxIn, TxOut CtxUTxO Era))
forall (m :: * -&gt; *).
(MonadTimer m, MonadDelay m) =&gt;
UTxO' (TxOut CtxUTxO Era)
-&gt; CardanoSigningKey
-&gt; Value
-&gt; TestHydraClient Tx m
-&gt; m (Either (UTxO' (TxOut CtxUTxO Era)) (TxIn, TxOut CtxUTxO Era))
</span><a href="Hydra.Model.html#waitForUTxOToSpend"><span class="hs-identifier hs-var">waitForUTxOToSpend</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era)
forall a. Monoid a =&gt; a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#mempty"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Payment -&gt; CardanoSigningKey
</span><a href="Hydra.Model.Payment.html#%24sel%3Ato%3APayment"><span class="hs-identifier hs-var">to</span></a></span><span> </span><span class="annot"><span class="annottext">Realized (RunMonad m) Payment
Payment
</span><a href="#local-6989586621679552368"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Payment -&gt; Value
</span><a href="Hydra.Model.Payment.html#%24sel%3Avalue%3APayment"><span class="hs-identifier hs-var">value</span></a></span><span> </span><span class="annot"><span class="annottext">Realized (RunMonad m) Payment
Payment
</span><a href="#local-6989586621679552368"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TestHydraClient Tx m
</span><a href="#local-6989586621679552372"><span class="hs-identifier hs-var">node</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RunMonad
  m (Either (UTxO' (TxOut CtxUTxO Era)) (TxIn, TxOut CtxUTxO Era))
-&gt; (Either (UTxO' (TxOut CtxUTxO Era)) (TxIn, TxOut CtxUTxO Era)
    -&gt; RunMonad m ())
-&gt; RunMonad m ()
forall a b. RunMonad m a -&gt; (a -&gt; RunMonad m b) -&gt; RunMonad m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-583"></span><span>            </span><span class="annot"><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621679552374"><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era)
</span><a href="#local-6989586621679552374"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RunException -&gt; RunMonad m ()
forall e a. Exception e =&gt; e -&gt; RunMonad m a
forall (m :: * -&gt; *) e a. (MonadThrow m, Exception e) =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwIO</span></span><span> </span><span class="annot"><span class="annottext">(RunException -&gt; RunMonad m ()) -&gt; RunException -&gt; RunMonad m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Payment -&gt; UTxO' (TxOut CtxUTxO Era) -&gt; RunException
</span><a href="Hydra.Model.html#TransactionNotObserved"><span class="hs-identifier hs-var">TransactionNotObserved</span></a></span><span> </span><span class="annot"><span class="annottext">Realized (RunMonad m) Payment
Payment
</span><a href="#local-6989586621679552368"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era)
</span><a href="#local-6989586621679552374"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-584"></span><span>            </span><span class="annot"><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="annot"><span class="annottext">(TxIn, TxOut CtxUTxO Era)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; RunMonad m ()
forall a. a -&gt; RunMonad m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-585"></span><span>      </span><span class="annot"><span class="annottext">Action WorldState a
R:ActionWorldStatea a
</span><a href="Hydra.Model.html#ObserveHeadIsOpen"><span class="hs-identifier hs-var">ObserveHeadIsOpen</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-586"></span><span>        </span><span id="local-6989586621679552393"><span class="annot"><span class="annottext">[(Party, TestHydraClient Tx m)]
</span><a href="#local-6989586621679552393"><span class="hs-identifier hs-var">nodes'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map Party (TestHydraClient Tx m) -&gt; [(Party, TestHydraClient Tx m)]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#toList"><span class="hs-identifier hs-var">Map.toList</span></a></span><span> </span><span class="annot"><span class="annottext">(Map Party (TestHydraClient Tx m)
 -&gt; [(Party, TestHydraClient Tx m)])
-&gt; RunMonad m (Map Party (TestHydraClient Tx m))
-&gt; RunMonad m [(Party, TestHydraClient Tx m)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(Nodes m -&gt; Map Party (TestHydraClient Tx m))
-&gt; RunMonad m (Map Party (TestHydraClient Tx m))
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/mtl-2.3.1/src/Control.Monad.State.Class.html#gets"><span class="hs-identifier hs-var">gets</span></a></span><span> </span><span class="annot"><span class="annottext">Nodes m -&gt; Map Party (TestHydraClient Tx m)
forall (m :: * -&gt; *). Nodes m -&gt; Map Party (TestHydraClient Tx m)
</span><a href="Hydra.Model.html#%24sel%3Anodes%3ANodes"><span class="hs-identifier hs-var">nodes</span></a></span><span>
</span><span id="line-587"></span><span>        </span><span class="annot"><span class="annottext">[(Party, TestHydraClient Tx m)]
-&gt; ((Party, TestHydraClient Tx m) -&gt; RunMonad m ())
-&gt; RunMonad m ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Foldable.html#forM_"><span class="hs-identifier hs-var">forM_</span></a></span><span> </span><span class="annot"><span class="annottext">[(Party, TestHydraClient Tx m)]
</span><a href="#local-6989586621679552393"><span class="hs-identifier hs-var">nodes'</span></a></span><span> </span><span class="annot"><span class="annottext">(((Party, TestHydraClient Tx m) -&gt; RunMonad m ()) -&gt; RunMonad m ())
-&gt; ((Party, TestHydraClient Tx m) -&gt; RunMonad m ())
-&gt; RunMonad m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Party
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679552394"><span class="annot"><span class="annottext">TestHydraClient Tx m
</span><a href="#local-6989586621679552394"><span class="hs-identifier hs-var">node</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-588"></span><span>          </span><span id="local-6989586621679552395"><span class="annot"><span class="annottext">[ServerOutput Tx]
</span><a href="#local-6989586621679552395"><span class="hs-identifier hs-var">outputs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m [ServerOutput Tx] -&gt; RunMonad m [ServerOutput Tx]
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; RunMonad m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">(m [ServerOutput Tx] -&gt; RunMonad m [ServerOutput Tx])
-&gt; m [ServerOutput Tx] -&gt; RunMonad m [ServerOutput Tx]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TestHydraClient Tx m -&gt; m [ServerOutput Tx]
forall tx (m :: * -&gt; *).
TestHydraClient tx m -&gt; m [ServerOutput tx]
</span><a href="Hydra.BehaviorSpec.html#%24sel%3AserverOutputs%3ATestHydraClient"><span class="hs-identifier hs-var">serverOutputs</span></a></span><span> </span><span class="annot"><span class="annottext">TestHydraClient Tx m
</span><a href="#local-6989586621679552394"><span class="hs-identifier hs-var">node</span></a></span><span>
</span><span id="line-589"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(ServerOutput Tx -&gt; Bool)
-&gt; [ServerOutput Tx] -&gt; Maybe (ServerOutput Tx)
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Foldable.html#find"><span class="hs-identifier hs-var">find</span></a></span><span> </span><span class="annot"><span class="annottext">ServerOutput Tx -&gt; Bool
forall tx. ServerOutput tx -&gt; Bool
</span><a href="Hydra.Model.html#headIsOpen"><span class="hs-identifier hs-var">headIsOpen</span></a></span><span> </span><span class="annot"><span class="annottext">[ServerOutput Tx]
</span><a href="#local-6989586621679552395"><span class="hs-identifier hs-var">outputs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-590"></span><span>            </span><span class="annot"><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ServerOutput Tx
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; RunMonad m ()
forall a. a -&gt; RunMonad m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-591"></span><span>            </span><span class="annot"><span class="annottext">Maybe (ServerOutput Tx)
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; RunMonad m ()
forall a t. (HasCallStack, IsText t) =&gt; t -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;The head is not open for node&quot;</span></span><span>
</span><span id="line-592"></span><span>      </span><span class="annot"><a href="Hydra.Model.html#CloseWithInitialSnapshot"><span class="hs-identifier hs-type">CloseWithInitialSnapshot</span></a></span><span> </span><span id="local-6989586621679552403"><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679552403"><span class="hs-identifier hs-var">party</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-593"></span><span>        </span><span class="annot"><span class="annottext">WorldState -&gt; Party -&gt; RunMonad m ()
forall (m :: * -&gt; *).
(MonadThrow m, MonadTimer m, MonadDelay m, MonadAsync m) =&gt;
WorldState -&gt; Party -&gt; RunMonad m ()
</span><a href="Hydra.Model.html#performCloseWithInitialSnapshot"><span class="hs-identifier hs-var">performCloseWithInitialSnapshot</span></a></span><span> </span><span class="annot"><span class="annottext">WorldState
</span><a href="#local-6989586621679552280"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679552403"><span class="hs-identifier hs-var">party</span></a></span><span>
</span><span id="line-594"></span><span>      </span><span class="annot"><a href="Hydra.Model.html#RollbackAndForward"><span class="hs-identifier hs-type">RollbackAndForward</span></a></span><span> </span><span id="local-6989586621679552408"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679552408"><span class="hs-identifier hs-var">numberOfBlocks</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-595"></span><span>        </span><span class="annot"><span class="annottext">Natural -&gt; RunMonad m ()
forall (m :: * -&gt; *).
(MonadThrow m, MonadTimer m) =&gt;
Natural -&gt; RunMonad m ()
</span><a href="Hydra.Model.html#performRollbackAndForward"><span class="hs-identifier hs-var">performRollbackAndForward</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679552408"><span class="hs-identifier hs-var">numberOfBlocks</span></a></span><span>
</span><span id="line-596"></span><span>      </span><span class="annot"><span class="annottext">Action WorldState a
R:ActionWorldStatea a
</span><a href="Hydra.Model.html#StopTheWorld"><span class="hs-identifier hs-var">StopTheWorld</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-597"></span><span>        </span><span class="annot"><span class="annottext">RunMonad m ()
RunMonad
  m (PerformResult (Error WorldState) (Realized (RunMonad m) a))
forall (m :: * -&gt; *). MonadAsync m =&gt; RunMonad m ()
</span><a href="Hydra.Model.html#stopTheWorld"><span class="hs-identifier hs-var">stopTheWorld</span></a></span><span>
</span><span id="line-598"></span><span>
</span><span id="line-599"></span><span class="annot"><span class="hs-comment">-- ** Performing actions</span></span><span>
</span><span id="line-600"></span><span>
</span><span id="line-601"></span><span id="local-6989586621679550889"><span class="annot"><a href="Hydra.Model.html#seedWorld"><span class="hs-identifier hs-type">seedWorld</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-602"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadAsync</span></span><span> </span><span class="annot"><a href="#local-6989586621679550889"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-603"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadTimer</span></span><span> </span><span class="annot"><a href="#local-6989586621679550889"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-604"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadThrow</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">STM</span></span><span> </span><span class="annot"><a href="#local-6989586621679550889"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-605"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadLabelledSTM</span></span><span> </span><span class="annot"><a href="#local-6989586621679550889"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-606"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadFork</span></span><span> </span><span class="annot"><a href="#local-6989586621679550889"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-607"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadMask</span></span><span> </span><span class="annot"><a href="#local-6989586621679550889"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-608"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadDelay</span></span><span> </span><span class="annot"><a href="#local-6989586621679550889"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-609"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-610"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SigningKey</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">HydraKey</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html#CardanoSigningKey"><span class="hs-identifier hs-type">CardanoSigningKey</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-611"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">ContestationPeriod</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-612"></span><span>  </span><span class="annot"><a href="Hydra.Model.html#Uncommitted"><span class="hs-identifier hs-type">Uncommitted</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-613"></span><span>  </span><span class="annot"><a href="Hydra.Model.html#RunMonad"><span class="hs-identifier hs-type">RunMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679550889"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-614"></span><span id="seedWorld"><span class="annot"><span class="annottext">seedWorld :: forall (m :: * -&gt; *).
(MonadAsync m, MonadTimer m, MonadThrow (STM m),
 MonadLabelledSTM m, MonadFork m, MonadMask m, MonadDelay m) =&gt;
[(SigningKey HydraKey, CardanoSigningKey)]
-&gt; ContestationPeriod -&gt; Uncommitted -&gt; RunMonad m ()
</span><a href="Hydra.Model.html#seedWorld"><span class="hs-identifier hs-var hs-var">seedWorld</span></a></span></span><span> </span><span id="local-6989586621679552496"><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="#local-6989586621679552496"><span class="hs-identifier hs-var">seedKeys</span></a></span></span><span> </span><span id="local-6989586621679552497"><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="#local-6989586621679552497"><span class="hs-identifier hs-var">seedCP</span></a></span></span><span> </span><span id="local-6989586621679552498"><span class="annot"><span class="annottext">Uncommitted
</span><a href="#local-6989586621679552498"><span class="hs-identifier hs-var">futureCommits</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-615"></span><span>  </span><span id="local-6989586621679552499"><span class="annot"><span class="annottext">Tracer m (HydraLog Tx ())
</span><a href="#local-6989586621679552499"><span class="hs-identifier hs-var">tr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Nodes m -&gt; Tracer m (HydraLog Tx ()))
-&gt; RunMonad m (Tracer m (HydraLog Tx ()))
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/mtl-2.3.1/src/Control.Monad.State.Class.html#gets"><span class="hs-identifier hs-var">gets</span></a></span><span> </span><span class="annot"><span class="annottext">Nodes m -&gt; Tracer m (HydraLog Tx ())
forall (m :: * -&gt; *). Nodes m -&gt; Tracer m (HydraLog Tx ())
</span><a href="Hydra.Model.html#%24sel%3Alogger%3ANodes"><span class="hs-identifier hs-var">logger</span></a></span><span>
</span><span id="line-616"></span><span>
</span><span id="line-617"></span><span>  </span><span id="local-6989586621679552500"><span class="annot"><span class="annottext">mockChain :: SimulatedChainNetwork Tx m
</span><a href="#local-6989586621679552500"><span class="hs-identifier hs-var">mockChain</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Hydra.BehaviorSpec.html#SimulatedChainNetwork"><span class="hs-identifier hs-type">SimulatedChainNetwork</span></a></span><span class="hs-special">{</span><span id="local-6989586621679552502"><span class="annot"><span class="annottext">Async m ()
tickThread :: Async m ()
$sel:tickThread:SimulatedChainNetwork :: forall tx (m :: * -&gt; *). SimulatedChainNetwork tx m -&gt; Async m ()
</span><a href="#local-6989586621679552502"><span class="hs-identifier hs-var hs-var">tickThread</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-618"></span><span>    </span><span class="annot"><span class="annottext">m (SimulatedChainNetwork Tx m)
-&gt; RunMonad m (SimulatedChainNetwork Tx m)
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; RunMonad m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">(m (SimulatedChainNetwork Tx m)
 -&gt; RunMonad m (SimulatedChainNetwork Tx m))
-&gt; m (SimulatedChainNetwork Tx m)
-&gt; RunMonad m (SimulatedChainNetwork Tx m)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-619"></span><span>      </span><span class="annot"><span class="annottext">Tracer m DirectChainLog
-&gt; [(SigningKey HydraKey, CardanoSigningKey)]
-&gt; UTxO' (TxOut CtxUTxO Era)
-&gt; m (SimulatedChainNetwork Tx m)
forall (m :: * -&gt; *).
(MonadTimer m, MonadAsync m, MonadMask m, MonadThrow (STM m),
 MonadLabelledSTM m, MonadFork m, MonadDelay m) =&gt;
Tracer m DirectChainLog
-&gt; [(SigningKey HydraKey, CardanoSigningKey)]
-&gt; UTxO' (TxOut CtxUTxO Era)
-&gt; m (SimulatedChainNetwork Tx m)
</span><a href="Hydra.Model.MockChain.html#mockChainAndNetwork"><span class="hs-identifier hs-var">mockChainAndNetwork</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(DirectChainLog -&gt; HydraLog Tx ())
-&gt; Tracer m (HydraLog Tx ()) -&gt; Tracer m DirectChainLog
forall a' a. (a' -&gt; a) -&gt; Tracer m a -&gt; Tracer m a'
forall (f :: * -&gt; *) a' a.
Contravariant f =&gt;
(a' -&gt; a) -&gt; f a -&gt; f a'
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Functor.Contravariant.html#contramap"><span class="hs-identifier hs-var">contramap</span></a></span><span> </span><span class="annot"><span class="annottext">DirectChainLog -&gt; HydraLog Tx ()
forall tx net. DirectChainLog -&gt; HydraLog tx net
</span><span class="hs-identifier hs-var">DirectChain</span></span><span> </span><span class="annot"><span class="annottext">Tracer m (HydraLog Tx ())
</span><a href="#local-6989586621679552499"><span class="hs-identifier hs-var">tr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="#local-6989586621679552496"><span class="hs-identifier hs-var">seedKeys</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([(CardanoSigningKey, Value)] -&gt; UTxO' (TxOut CtxUTxO Era))
-&gt; [[(CardanoSigningKey, Value)]] -&gt; UTxO' (TxOut CtxUTxO Era)
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; [a] -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Foldable.html#foldMap"><span class="hs-identifier hs-var">foldMap</span></a></span><span> </span><span class="annot"><span class="annottext">[(CardanoSigningKey, Value)] -&gt; UTxO' (TxOut CtxUTxO Era)
UTxOType Payment -&gt; UTxOType Tx
</span><a href="Hydra.Model.html#toRealUTxO"><span class="hs-identifier hs-var">toRealUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">([[(CardanoSigningKey, Value)]] -&gt; UTxO' (TxOut CtxUTxO Era))
-&gt; [[(CardanoSigningKey, Value)]] -&gt; UTxO' (TxOut CtxUTxO Era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Map Party [(CardanoSigningKey, Value)]
-&gt; [[(CardanoSigningKey, Value)]]
forall k a. Map k a -&gt; [a]
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#elems"><span class="hs-identifier hs-var">Map.elems</span></a></span><span> </span><span class="annot"><span class="annottext">Map Party [(CardanoSigningKey, Value)]
Uncommitted
</span><a href="#local-6989586621679552498"><span class="hs-identifier hs-var">futureCommits</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-620"></span><span>  </span><span class="annot"><span class="annottext">Async m () -&gt; RunMonad m ()
forall {m :: * -&gt; *} {m :: * -&gt; *}.
MonadState (Nodes m) m =&gt;
Async m () -&gt; m ()
</span><a href="#local-6989586621679552507"><span class="hs-identifier hs-var">pushThread</span></a></span><span> </span><span class="annot"><span class="annottext">Async m ()
</span><a href="#local-6989586621679552502"><span class="hs-identifier hs-var">tickThread</span></a></span><span>
</span><span id="line-621"></span><span>
</span><span id="line-622"></span><span>  </span><span id="local-6989586621679552508"><span class="annot"><span class="annottext">[(Party, TestHydraClient Tx m)]
</span><a href="#local-6989586621679552508"><span class="hs-identifier hs-var">clients</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
-&gt; ((SigningKey HydraKey, CardanoSigningKey)
    -&gt; RunMonad m (Party, TestHydraClient Tx m))
-&gt; RunMonad m [(Party, TestHydraClient Tx m)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Traversable.html#forM"><span class="hs-identifier hs-var">forM</span></a></span><span> </span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="#local-6989586621679552496"><span class="hs-identifier hs-var">seedKeys</span></a></span><span> </span><span class="annot"><span class="annottext">(((SigningKey HydraKey, CardanoSigningKey)
  -&gt; RunMonad m (Party, TestHydraClient Tx m))
 -&gt; RunMonad m [(Party, TestHydraClient Tx m)])
-&gt; ((SigningKey HydraKey, CardanoSigningKey)
    -&gt; RunMonad m (Party, TestHydraClient Tx m))
-&gt; RunMonad m [(Party, TestHydraClient Tx m)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679552510"><span class="annot"><span class="annottext">SigningKey HydraKey
</span><a href="#local-6989586621679552510"><span class="hs-identifier hs-var">hsk</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679552511"><span class="annot"><span class="annottext">CardanoSigningKey
</span><a href="#local-6989586621679552511"><span class="hs-identifier hs-var">_csk</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-623"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679552512"><span class="annot"><span class="annottext">party :: Party
</span><a href="#local-6989586621679552512"><span class="hs-identifier hs-var hs-var">party</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SigningKey HydraKey -&gt; Party
</span><span class="hs-identifier hs-var">deriveParty</span></span><span> </span><span class="annot"><span class="annottext">SigningKey HydraKey
</span><a href="#local-6989586621679552510"><span class="hs-identifier hs-var">hsk</span></a></span><span>
</span><span id="line-624"></span><span>        </span><span id="local-6989586621679552513"><span class="annot"><span class="annottext">otherParties :: [Party]
</span><a href="#local-6989586621679552513"><span class="hs-identifier hs-var hs-var">otherParties</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Party -&gt; Bool) -&gt; [Party] -&gt; [Party]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Party -&gt; Party -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%2F%3D"><span class="hs-operator hs-var">/=</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679552512"><span class="hs-identifier hs-var">party</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621679552515"><span class="hs-identifier hs-var">parties</span></a></span><span>
</span><span id="line-625"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679552516"><span class="annot"><span class="annottext">TestHydraClient Tx m
</span><a href="#local-6989586621679552516"><span class="hs-identifier hs-var">testClient</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679552517"><span class="annot"><span class="annottext">Async m ()
</span><a href="#local-6989586621679552517"><span class="hs-identifier hs-var">nodeThread</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (TestHydraClient Tx m, Async m ())
-&gt; RunMonad m (TestHydraClient Tx m, Async m ())
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; RunMonad m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">(m (TestHydraClient Tx m, Async m ())
 -&gt; RunMonad m (TestHydraClient Tx m, Async m ()))
-&gt; m (TestHydraClient Tx m, Async m ())
-&gt; RunMonad m (TestHydraClient Tx m, Async m ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-626"></span><span>      </span><span id="local-6989586621679552518"><span class="annot"><span class="annottext">TQueue m (ServerOutput Tx)
</span><a href="#local-6989586621679552518"><span class="hs-identifier hs-var">outputs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">STM m (TQueue m (ServerOutput Tx))
-&gt; m (TQueue m (ServerOutput Tx))
forall a. HasCallStack =&gt; STM m a -&gt; m a
forall (m :: * -&gt; *) a.
(MonadSTM m, HasCallStack) =&gt;
STM m a -&gt; m a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="annot"><span class="annottext">STM m (TQueue m (ServerOutput Tx))
forall a. STM m (TQueue m a)
forall (m :: * -&gt; *) a. MonadSTM m =&gt; STM m (TQueue m a)
</span><span class="hs-identifier hs-var">newTQueue</span></span><span>
</span><span id="line-627"></span><span>      </span><span class="annot"><span class="annottext">TQueue m (ServerOutput Tx) -&gt; String -&gt; m ()
forall a. TQueue m a -&gt; String -&gt; m ()
forall (m :: * -&gt; *) a.
MonadLabelledSTM m =&gt;
TQueue m a -&gt; String -&gt; m ()
</span><span class="hs-identifier hs-var">labelTQueueIO</span></span><span> </span><span class="annot"><span class="annottext">TQueue m (ServerOutput Tx)
</span><a href="#local-6989586621679552518"><span class="hs-identifier hs-var">outputs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;outputs-&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SigningKey HydraKey -&gt; String
</span><a href="Hydra.BehaviorSpec.html#shortLabel"><span class="hs-identifier hs-var">shortLabel</span></a></span><span> </span><span class="annot"><span class="annottext">SigningKey HydraKey
</span><a href="#local-6989586621679552510"><span class="hs-identifier hs-var">hsk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-628"></span><span>      </span><span id="local-6989586621679552519"><span class="annot"><span class="annottext">TVar m [ServerOutput Tx]
</span><a href="#local-6989586621679552519"><span class="hs-identifier hs-var">outputHistory</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ServerOutput Tx] -&gt; m (TVar m [ServerOutput Tx])
forall a. a -&gt; m (TVar m a)
forall (m :: * -&gt; *) a. MonadSTM m =&gt; a -&gt; m (TVar m a)
</span><span class="hs-identifier hs-var">newTVarIO</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-629"></span><span>      </span><span class="annot"><span class="annottext">TVar m [ServerOutput Tx] -&gt; String -&gt; m ()
forall a. TVar m a -&gt; String -&gt; m ()
forall (m :: * -&gt; *) a.
MonadLabelledSTM m =&gt;
TVar m a -&gt; String -&gt; m ()
</span><span class="hs-identifier hs-var">labelTVarIO</span></span><span> </span><span class="annot"><span class="annottext">TVar m [ServerOutput Tx]
</span><a href="#local-6989586621679552519"><span class="hs-identifier hs-var">outputHistory</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;history-&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SigningKey HydraKey -&gt; String
</span><a href="Hydra.BehaviorSpec.html#shortLabel"><span class="hs-identifier hs-var">shortLabel</span></a></span><span> </span><span class="annot"><span class="annottext">SigningKey HydraKey
</span><a href="#local-6989586621679552510"><span class="hs-identifier hs-var">hsk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-630"></span><span>      </span><span id="local-6989586621679552520"><span class="annot"><span class="annottext">HydraNode Tx m
</span><a href="#local-6989586621679552520"><span class="hs-identifier hs-var">node</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Tracer m (HydraNodeLog Tx)
-&gt; Ledger Tx
-&gt; ChainStateType Tx
-&gt; SigningKey HydraKey
-&gt; [Party]
-&gt; TQueue m (ServerOutput Tx)
-&gt; TVar m [ServerOutput Tx]
-&gt; SimulatedChainNetwork Tx m
-&gt; ContestationPeriod
-&gt; m (HydraNode Tx m)
forall (m :: * -&gt; *) tx.
(MonadDelay m, MonadAsync m, MonadLabelledSTM m, IsChainState tx,
 MonadThrow m) =&gt;
Tracer m (HydraNodeLog tx)
-&gt; Ledger tx
-&gt; ChainStateType tx
-&gt; SigningKey HydraKey
-&gt; [Party]
-&gt; TQueue m (ServerOutput tx)
-&gt; TVar m [ServerOutput tx]
-&gt; SimulatedChainNetwork tx m
-&gt; ContestationPeriod
-&gt; m (HydraNode tx m)
</span><a href="Hydra.BehaviorSpec.html#createHydraNode"><span class="hs-identifier hs-var">createHydraNode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(HydraNodeLog Tx -&gt; HydraLog Tx ())
-&gt; Tracer m (HydraLog Tx ()) -&gt; Tracer m (HydraNodeLog Tx)
forall a' a. (a' -&gt; a) -&gt; Tracer m a -&gt; Tracer m a'
forall (f :: * -&gt; *) a' a.
Contravariant f =&gt;
(a' -&gt; a) -&gt; f a -&gt; f a'
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Functor.Contravariant.html#contramap"><span class="hs-identifier hs-var">contramap</span></a></span><span> </span><span class="annot"><span class="annottext">HydraNodeLog Tx -&gt; HydraLog Tx ()
forall tx net. HydraNodeLog tx -&gt; HydraLog tx net
</span><span class="hs-identifier hs-var">Node</span></span><span> </span><span class="annot"><span class="annottext">Tracer m (HydraLog Tx ())
</span><a href="#local-6989586621679552499"><span class="hs-identifier hs-var">tr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Ledger Tx
</span><a href="#local-6989586621679552521"><span class="hs-identifier hs-var">ledger</span></a></span><span> </span><span class="annot"><span class="annottext">ChainStateType Tx
</span><span class="hs-identifier hs-var">initialChainState</span></span><span> </span><span class="annot"><span class="annottext">SigningKey HydraKey
</span><a href="#local-6989586621679552510"><span class="hs-identifier hs-var">hsk</span></a></span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621679552513"><span class="hs-identifier hs-var">otherParties</span></a></span><span> </span><span class="annot"><span class="annottext">TQueue m (ServerOutput Tx)
</span><a href="#local-6989586621679552518"><span class="hs-identifier hs-var">outputs</span></a></span><span> </span><span class="annot"><span class="annottext">TVar m [ServerOutput Tx]
</span><a href="#local-6989586621679552519"><span class="hs-identifier hs-var">outputHistory</span></a></span><span> </span><span class="annot"><span class="annottext">SimulatedChainNetwork Tx m
</span><a href="#local-6989586621679552500"><span class="hs-identifier hs-var">mockChain</span></a></span><span> </span><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="#local-6989586621679552497"><span class="hs-identifier hs-var">seedCP</span></a></span><span>
</span><span id="line-631"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679552522"><span class="annot"><span class="annottext">testClient :: TestHydraClient Tx m
</span><a href="#local-6989586621679552522"><span class="hs-identifier hs-var hs-var">testClient</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TQueue m (ServerOutput Tx)
-&gt; TVar m [ServerOutput Tx]
-&gt; HydraNode Tx m
-&gt; TestHydraClient Tx m
forall (m :: * -&gt; *) tx.
MonadSTM m =&gt;
TQueue m (ServerOutput tx)
-&gt; TVar m [ServerOutput tx]
-&gt; HydraNode tx m
-&gt; TestHydraClient tx m
</span><a href="Hydra.BehaviorSpec.html#createTestHydraClient"><span class="hs-identifier hs-var">createTestHydraClient</span></a></span><span> </span><span class="annot"><span class="annottext">TQueue m (ServerOutput Tx)
</span><a href="#local-6989586621679552518"><span class="hs-identifier hs-var">outputs</span></a></span><span> </span><span class="annot"><span class="annottext">TVar m [ServerOutput Tx]
</span><a href="#local-6989586621679552519"><span class="hs-identifier hs-var">outputHistory</span></a></span><span> </span><span class="annot"><span class="annottext">HydraNode Tx m
</span><a href="#local-6989586621679552520"><span class="hs-identifier hs-var">node</span></a></span><span>
</span><span id="line-632"></span><span>      </span><span id="local-6989586621679552523"><span class="annot"><span class="annottext">Async m ()
</span><a href="#local-6989586621679552523"><span class="hs-identifier hs-var">nodeThread</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m () -&gt; m (Async m ())
forall a. m a -&gt; m (Async m a)
forall (m :: * -&gt; *) a. MonadAsync m =&gt; m a -&gt; m (Async m a)
</span><span class="hs-identifier hs-var">async</span></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m (Async m ())) -&gt; m () -&gt; m (Async m ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; m ()
forall (m :: * -&gt; *). MonadThread m =&gt; String -&gt; m ()
</span><span class="hs-identifier hs-var">labelThisThread</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;node-&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SigningKey HydraKey -&gt; String
</span><a href="Hydra.BehaviorSpec.html#shortLabel"><span class="hs-identifier hs-var">shortLabel</span></a></span><span> </span><span class="annot"><span class="annottext">SigningKey HydraKey
</span><a href="#local-6989586621679552510"><span class="hs-identifier hs-var">hsk</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">m () -&gt; m () -&gt; m ()
forall a b. m a -&gt; m b -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3E%3E"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HydraNode Tx m -&gt; m ()
forall (m :: * -&gt; *) tx.
(MonadCatch m, MonadAsync m, IsChainState tx) =&gt;
HydraNode tx m -&gt; m ()
</span><span class="hs-identifier hs-var">runHydraNode</span></span><span> </span><span class="annot"><span class="annottext">HydraNode Tx m
</span><a href="#local-6989586621679552520"><span class="hs-identifier hs-var">node</span></a></span><span>
</span><span id="line-633"></span><span>      </span><span class="annot"><span class="annottext">Async m () -&gt; m ()
forall (m :: * -&gt; *) a.
(MonadAsync m, MonadFork m, MonadMask m) =&gt;
Async m a -&gt; m ()
</span><span class="hs-identifier hs-var">link</span></span><span> </span><span class="annot"><span class="annottext">Async m ()
</span><a href="#local-6989586621679552523"><span class="hs-identifier hs-var">nodeThread</span></a></span><span>
</span><span id="line-634"></span><span>      </span><span class="annot"><span class="annottext">(TestHydraClient Tx m, Async m ())
-&gt; m (TestHydraClient Tx m, Async m ())
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TestHydraClient Tx m
</span><a href="#local-6989586621679552522"><span class="hs-identifier hs-var">testClient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Async m ()
</span><a href="#local-6989586621679552523"><span class="hs-identifier hs-var">nodeThread</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-635"></span><span>    </span><span class="annot"><span class="annottext">Async m () -&gt; RunMonad m ()
forall {m :: * -&gt; *} {m :: * -&gt; *}.
MonadState (Nodes m) m =&gt;
Async m () -&gt; m ()
</span><a href="#local-6989586621679552507"><span class="hs-identifier hs-var">pushThread</span></a></span><span> </span><span class="annot"><span class="annottext">Async m ()
</span><a href="#local-6989586621679552517"><span class="hs-identifier hs-var">nodeThread</span></a></span><span>
</span><span id="line-636"></span><span>    </span><span class="annot"><span class="annottext">(Party, TestHydraClient Tx m)
-&gt; RunMonad m (Party, TestHydraClient Tx m)
forall a. a -&gt; RunMonad m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679552512"><span class="hs-identifier hs-var">party</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TestHydraClient Tx m
</span><a href="#local-6989586621679552516"><span class="hs-identifier hs-var">testClient</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-637"></span><span>
</span><span id="line-638"></span><span>  </span><span class="annot"><span class="annottext">(Nodes m -&gt; Nodes m) -&gt; RunMonad m ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/mtl-2.3.1/src/Control.Monad.State.Class.html#modify"><span class="hs-identifier hs-var">modify</span></a></span><span> </span><span class="annot"><span class="annottext">((Nodes m -&gt; Nodes m) -&gt; RunMonad m ())
-&gt; (Nodes m -&gt; Nodes m) -&gt; RunMonad m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679552525"><span class="annot"><span class="annottext">Nodes m
</span><a href="#local-6989586621679552525"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-639"></span><span>    </span><span class="annot"><span class="annottext">Nodes m
</span><a href="#local-6989586621679552525"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">{</span><span class="annot"><a href="Hydra.Model.html#%24sel%3Anodes%3ANodes"><span class="hs-identifier hs-var">nodes</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-type">Map.fromList</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679552508"><span class="hs-identifier hs-type">clients</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hydra.Model.html#%24sel%3Achain%3ANodes"><span class="hs-identifier hs-var">chain</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679552500"><span class="hs-identifier hs-type">mockChain</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-640"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-641"></span><span>  </span><span id="local-6989586621679552515"><span class="annot"><span class="annottext">parties :: [Party]
</span><a href="#local-6989586621679552515"><span class="hs-identifier hs-var hs-var">parties</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((SigningKey HydraKey, CardanoSigningKey) -&gt; Party)
-&gt; [(SigningKey HydraKey, CardanoSigningKey)] -&gt; [Party]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SigningKey HydraKey -&gt; Party
</span><span class="hs-identifier hs-var">deriveParty</span></span><span> </span><span class="annot"><span class="annottext">(SigningKey HydraKey -&gt; Party)
-&gt; ((SigningKey HydraKey, CardanoSigningKey)
    -&gt; SigningKey HydraKey)
-&gt; (SigningKey HydraKey, CardanoSigningKey)
-&gt; Party
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(SigningKey HydraKey, CardanoSigningKey) -&gt; SigningKey HydraKey
forall a b. (a, b) -&gt; a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(SigningKey HydraKey, CardanoSigningKey)]
</span><a href="#local-6989586621679552496"><span class="hs-identifier hs-var">seedKeys</span></a></span><span>
</span><span id="line-642"></span><span>
</span><span id="line-643"></span><span>  </span><span id="local-6989586621679552521"><span class="annot"><span class="annottext">ledger :: Ledger Tx
</span><a href="#local-6989586621679552521"><span class="hs-identifier hs-var hs-var">ledger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Globals -&gt; LedgerEnv LedgerEra -&gt; Ledger Tx
</span><span class="hs-identifier hs-var">cardanoLedger</span></span><span> </span><span class="annot"><span class="annottext">Globals
</span><span class="hs-identifier hs-var">defaultGlobals</span></span><span> </span><span class="annot"><span class="annottext">LedgerEnv LedgerEra
</span><span class="hs-identifier hs-var">defaultLedgerEnv</span></span><span>
</span><span id="line-644"></span><span>
</span><span id="line-645"></span><span>  </span><span id="local-6989586621679552507"><span class="annot"><span class="annottext">pushThread :: Async m () -&gt; m ()
</span><a href="#local-6989586621679552507"><span class="hs-identifier hs-var hs-var">pushThread</span></a></span></span><span> </span><span id="local-6989586621679552536"><span class="annot"><span class="annottext">Async m ()
</span><a href="#local-6989586621679552536"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Nodes m -&gt; Nodes m) -&gt; m ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/mtl-2.3.1/src/Control.Monad.State.Class.html#modify"><span class="hs-identifier hs-var">modify</span></a></span><span> </span><span class="annot"><span class="annottext">((Nodes m -&gt; Nodes m) -&gt; m ()) -&gt; (Nodes m -&gt; Nodes m) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679552537"><span class="annot"><span class="annottext">Nodes m
</span><a href="#local-6989586621679552537"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-646"></span><span>    </span><span class="annot"><span class="annottext">Nodes m
</span><a href="#local-6989586621679552537"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">{</span><span class="annot"><a href="Hydra.Model.html#%24sel%3Athreads%3ANodes"><span class="hs-identifier hs-var">threads</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679552536"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#%3A"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span class="annot"><a href="Hydra.Model.html#%24sel%3Athreads%3ANodes"><span class="hs-identifier hs-var">threads</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679552537"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-647"></span><span>
</span><span id="line-648"></span><span id="local-6989586621679550890"><span class="annot"><a href="Hydra.Model.html#performCommit"><span class="hs-identifier hs-type">performCommit</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-649"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadThrow</span></span><span> </span><span class="annot"><a href="#local-6989586621679550890"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadTimer</span></span><span> </span><span class="annot"><a href="#local-6989586621679550890"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-650"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="Hydra.Model.Payment.html#CardanoSigningKey"><span class="hs-identifier hs-type">CardanoSigningKey</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-651"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Party</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-652"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Model.Payment.html#CardanoSigningKey"><span class="hs-identifier hs-type">CardanoSigningKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-653"></span><span>  </span><span class="annot"><a href="Hydra.Model.html#RunMonad"><span class="hs-identifier hs-type">RunMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679550890"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Hydra.Model.html#ActualCommitted"><span class="hs-identifier hs-type">ActualCommitted</span></a></span></span><span>
</span><span id="line-654"></span><span id="performCommit"><span class="annot"><span class="annottext">performCommit :: forall (m :: * -&gt; *).
(MonadThrow m, MonadTimer m) =&gt;
[CardanoSigningKey]
-&gt; Party
-&gt; [(CardanoSigningKey, Value)]
-&gt; RunMonad m (UTxOType Payment)
</span><a href="Hydra.Model.html#performCommit"><span class="hs-identifier hs-var hs-var">performCommit</span></a></span></span><span> </span><span id="local-6989586621679552596"><span class="annot"><span class="annottext">[CardanoSigningKey]
</span><a href="#local-6989586621679552596"><span class="hs-identifier hs-var">parties</span></a></span></span><span> </span><span id="local-6989586621679552597"><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679552597"><span class="hs-identifier hs-var">party</span></a></span></span><span> </span><span id="local-6989586621679552598"><span class="annot"><span class="annottext">[(CardanoSigningKey, Value)]
</span><a href="#local-6989586621679552598"><span class="hs-identifier hs-var">paymentUTxO</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-655"></span><span>  </span><span id="local-6989586621679552599"><span class="annot"><span class="annottext">Map Party (TestHydraClient Tx m)
</span><a href="#local-6989586621679552599"><span class="hs-identifier hs-var">nodes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Nodes m -&gt; Map Party (TestHydraClient Tx m))
-&gt; RunMonad m (Map Party (TestHydraClient Tx m))
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/mtl-2.3.1/src/Control.Monad.State.Class.html#gets"><span class="hs-identifier hs-var">gets</span></a></span><span> </span><span class="annot"><span class="annottext">Nodes m -&gt; Map Party (TestHydraClient Tx m)
forall (m :: * -&gt; *). Nodes m -&gt; Map Party (TestHydraClient Tx m)
</span><a href="Hydra.Model.html#%24sel%3Anodes%3ANodes"><span class="hs-identifier hs-var">nodes</span></a></span><span>
</span><span id="line-656"></span><span>  </span><span class="annot"><a href="Hydra.BehaviorSpec.html#SimulatedChainNetwork"><span class="hs-identifier hs-type">SimulatedChainNetwork</span></a></span><span class="hs-special">{</span><span id="local-6989586621679552600"><span class="annot"><span class="annottext">(Party, UTxOType Tx) -&gt; m ()
simulateCommit :: (Party, UTxOType Tx) -&gt; m ()
$sel:simulateCommit:SimulatedChainNetwork :: forall tx (m :: * -&gt; *).
SimulatedChainNetwork tx m -&gt; (Party, UTxOType tx) -&gt; m ()
</span><a href="#local-6989586621679552600"><span class="hs-identifier hs-var hs-var">simulateCommit</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Nodes m -&gt; SimulatedChainNetwork Tx m)
-&gt; RunMonad m (SimulatedChainNetwork Tx m)
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/mtl-2.3.1/src/Control.Monad.State.Class.html#gets"><span class="hs-identifier hs-var">gets</span></a></span><span> </span><span class="annot"><span class="annottext">Nodes m -&gt; SimulatedChainNetwork Tx m
forall (m :: * -&gt; *). Nodes m -&gt; SimulatedChainNetwork Tx m
</span><a href="Hydra.Model.html#%24sel%3Achain%3ANodes"><span class="hs-identifier hs-var">chain</span></a></span><span>
</span><span id="line-657"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Party
-&gt; Map Party (TestHydraClient Tx m) -&gt; Maybe (TestHydraClient Tx m)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679552597"><span class="hs-identifier hs-var">party</span></a></span><span> </span><span class="annot"><span class="annottext">Map Party (TestHydraClient Tx m)
</span><a href="#local-6989586621679552599"><span class="hs-identifier hs-var">nodes</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-658"></span><span>    </span><span class="annot"><span class="annottext">Maybe (TestHydraClient Tx m)
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RunException -&gt; RunMonad m [(CardanoSigningKey, Value)]
forall e a. Exception e =&gt; e -&gt; RunMonad m a
forall (m :: * -&gt; *) e a. (MonadThrow m, Exception e) =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwIO</span></span><span> </span><span class="annot"><span class="annottext">(RunException -&gt; RunMonad m [(CardanoSigningKey, Value)])
-&gt; RunException -&gt; RunMonad m [(CardanoSigningKey, Value)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Party -&gt; RunException
</span><a href="Hydra.Model.html#UnexpectedParty"><span class="hs-identifier hs-var">UnexpectedParty</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679552597"><span class="hs-identifier hs-var">party</span></a></span><span>
</span><span id="line-659"></span><span>    </span><span class="annot"><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-660"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679552603"><span class="annot"><span class="annottext">realUTxO :: UTxOType Tx
</span><a href="#local-6989586621679552603"><span class="hs-identifier hs-var hs-var">realUTxO</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTxOType Payment -&gt; UTxOType Tx
</span><a href="Hydra.Model.html#toRealUTxO"><span class="hs-identifier hs-var">toRealUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">[(CardanoSigningKey, Value)]
UTxOType Payment
</span><a href="#local-6989586621679552598"><span class="hs-identifier hs-var">paymentUTxO</span></a></span><span>
</span><span id="line-661"></span><span>      </span><span class="annot"><span class="annottext">m () -&gt; RunMonad m ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; RunMonad m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; RunMonad m ()) -&gt; m () -&gt; RunMonad m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Party, UTxOType Tx) -&gt; m ()
</span><a href="#local-6989586621679552600"><span class="hs-identifier hs-var">simulateCommit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679552597"><span class="hs-identifier hs-var">party</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UTxOType Tx
</span><a href="#local-6989586621679552603"><span class="hs-identifier hs-var">realUTxO</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-662"></span><span>      </span><span id="local-6989586621679552604"><span class="annot"><span class="annottext">Map Party (UTxO' (TxOut CtxUTxO Era))
</span><a href="#local-6989586621679552604"><span class="hs-identifier hs-var">observedUTxO</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-663"></span><span>        </span><span class="annot"><span class="annottext">m (Map Party (UTxO' (TxOut CtxUTxO Era)))
-&gt; RunMonad m (Map Party (UTxO' (TxOut CtxUTxO Era)))
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; RunMonad m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Map Party (UTxO' (TxOut CtxUTxO Era)))
 -&gt; RunMonad m (Map Party (UTxO' (TxOut CtxUTxO Era))))
-&gt; m (Map Party (UTxO' (TxOut CtxUTxO Era)))
-&gt; RunMonad m (Map Party (UTxO' (TxOut CtxUTxO Era)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-664"></span><span>          </span><span class="annot"><span class="annottext">Map Party (TestHydraClient Tx m)
-&gt; (TestHydraClient Tx m -&gt; m (UTxO' (TxOut CtxUTxO Era)))
-&gt; m (Map Party (UTxO' (TxOut CtxUTxO Era)))
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Traversable.html#forM"><span class="hs-identifier hs-var">forM</span></a></span><span> </span><span class="annot"><span class="annottext">Map Party (TestHydraClient Tx m)
</span><a href="#local-6989586621679552599"><span class="hs-identifier hs-var">nodes</span></a></span><span> </span><span class="annot"><span class="annottext">((TestHydraClient Tx m -&gt; m (UTxO' (TxOut CtxUTxO Era)))
 -&gt; m (Map Party (UTxO' (TxOut CtxUTxO Era))))
-&gt; (TestHydraClient Tx m -&gt; m (UTxO' (TxOut CtxUTxO Era)))
-&gt; m (Map Party (UTxO' (TxOut CtxUTxO Era)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679552605"><span class="annot"><span class="annottext">TestHydraClient Tx m
</span><a href="#local-6989586621679552605"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-665"></span><span>            </span><span class="annot"><span class="annottext">TestHydraClient Tx m
-&gt; (ServerOutput Tx -&gt; Maybe (UTxO' (TxOut CtxUTxO Era)))
-&gt; m (UTxO' (TxOut CtxUTxO Era))
forall (m :: * -&gt; *) tx a.
MonadThrow m =&gt;
TestHydraClient tx m -&gt; (ServerOutput tx -&gt; Maybe a) -&gt; m a
</span><a href="Hydra.BehaviorSpec.html#waitMatch"><span class="hs-identifier hs-var">waitMatch</span></a></span><span> </span><span class="annot"><span class="annottext">TestHydraClient Tx m
</span><a href="#local-6989586621679552605"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">((ServerOutput Tx -&gt; Maybe (UTxO' (TxOut CtxUTxO Era)))
 -&gt; m (UTxO' (TxOut CtxUTxO Era)))
-&gt; (ServerOutput Tx -&gt; Maybe (UTxO' (TxOut CtxUTxO Era)))
-&gt; m (UTxO' (TxOut CtxUTxO Era))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-666"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Committed</span></span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:party:PeerConnected :: forall tx. ServerOutput tx -&gt; Party
</span><span class="hs-identifier hs-var">party</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679552608"><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679552608"><span class="hs-identifier hs-var">cp</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:utxo:PeerConnected :: forall tx. ServerOutput tx -&gt; UTxOType tx
</span><span class="hs-identifier hs-var">utxo</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679552610"><span class="annot"><span class="annottext">UTxOType Tx
</span><a href="#local-6989586621679552610"><span class="hs-identifier hs-var">committedUTxO</span></a></span></span><span class="hs-special">}</span><span>
</span><span id="line-667"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679552608"><span class="hs-identifier hs-var">cp</span></a></span><span> </span><span class="annot"><span class="annottext">Party -&gt; Party -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679552597"><span class="hs-identifier hs-var">party</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era)
UTxOType Tx
</span><a href="#local-6989586621679552610"><span class="hs-identifier hs-var">committedUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era) -&gt; UTxO' (TxOut CtxUTxO Era) -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era)
UTxOType Tx
</span><a href="#local-6989586621679552603"><span class="hs-identifier hs-var">realUTxO</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era) -&gt; Maybe (UTxO' (TxOut CtxUTxO Era))
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era)
UTxOType Tx
</span><a href="#local-6989586621679552610"><span class="hs-identifier hs-var">committedUTxO</span></a></span><span>
</span><span id="line-668"></span><span>              </span><span id="local-6989586621679552611"><span class="annot"><span class="annottext">err :: ServerOutput Tx
</span><a href="#local-6989586621679552611"><span class="hs-identifier hs-var">err</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">CommandFailed</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe (UTxO' (TxOut CtxUTxO Era))
forall a t. (HasCallStack, IsText t) =&gt; t -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Maybe (UTxO' (TxOut CtxUTxO Era)))
-&gt; Text -&gt; Maybe (UTxO' (TxOut CtxUTxO Era))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ServerOutput Tx -&gt; Text
forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">ServerOutput Tx
</span><a href="#local-6989586621679552611"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-669"></span><span>              </span><span class="annot"><span class="annottext">ServerOutput Tx
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (UTxO' (TxOut CtxUTxO Era))
forall a. Maybe a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-670"></span><span>      </span><span class="annot"><span class="annottext">[(CardanoSigningKey, Value)]
-&gt; RunMonad m [(CardanoSigningKey, Value)]
forall a. a -&gt; RunMonad m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">([(CardanoSigningKey, Value)]
 -&gt; RunMonad m [(CardanoSigningKey, Value)])
-&gt; [(CardanoSigningKey, Value)]
-&gt; RunMonad m [(CardanoSigningKey, Value)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era) -&gt; [(CardanoSigningKey, Value)]
</span><a href="#local-6989586621679552613"><span class="hs-identifier hs-var">fromUtxo</span></a></span><span> </span><span class="annot"><span class="annottext">(UTxO' (TxOut CtxUTxO Era) -&gt; [(CardanoSigningKey, Value)])
-&gt; UTxO' (TxOut CtxUTxO Era) -&gt; [(CardanoSigningKey, Value)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[UTxO' (TxOut CtxUTxO Era)] -&gt; UTxO' (TxOut CtxUTxO Era)
forall a. HasCallStack =&gt; [a] -&gt; a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.List.html#head"><span class="hs-identifier hs-var">List.head</span></a></span><span> </span><span class="annot"><span class="annottext">([UTxO' (TxOut CtxUTxO Era)] -&gt; UTxO' (TxOut CtxUTxO Era))
-&gt; [UTxO' (TxOut CtxUTxO Era)] -&gt; UTxO' (TxOut CtxUTxO Era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Map Party (UTxO' (TxOut CtxUTxO Era))
-&gt; [UTxO' (TxOut CtxUTxO Era)]
forall a. Map Party a -&gt; [a]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Foldable.html#toList"><span class="hs-identifier hs-var">toList</span></a></span><span> </span><span class="annot"><span class="annottext">Map Party (UTxO' (TxOut CtxUTxO Era))
</span><a href="#local-6989586621679552604"><span class="hs-identifier hs-var">observedUTxO</span></a></span><span>
</span><span id="line-671"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-672"></span><span>  </span><span class="annot"><a href="#local-6989586621679552613"><span class="hs-identifier hs-type">fromUtxo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Model.Payment.html#CardanoSigningKey"><span class="hs-identifier hs-type">CardanoSigningKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-673"></span><span>  </span><span id="local-6989586621679552613"><span class="annot"><span class="annottext">fromUtxo :: UTxO' (TxOut CtxUTxO Era) -&gt; [(CardanoSigningKey, Value)]
</span><a href="#local-6989586621679552613"><span class="hs-identifier hs-var hs-var">fromUtxo</span></a></span></span><span> </span><span id="local-6989586621679552614"><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era)
</span><a href="#local-6989586621679552614"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(AddressInEra, Value) -&gt; (CardanoSigningKey, Value)
</span><a href="#local-6989586621679552615"><span class="hs-identifier hs-var">findSigningKey</span></a></span><span> </span><span class="annot"><span class="annottext">((AddressInEra, Value) -&gt; (CardanoSigningKey, Value))
-&gt; ((TxIn, TxOut CtxUTxO Era) -&gt; (AddressInEra, Value))
-&gt; (TxIn, TxOut CtxUTxO Era)
-&gt; (CardanoSigningKey, Value)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOut CtxUTxO Era -&gt; AddressInEra
forall ctx. TxOut ctx -&gt; AddressInEra
</span><span class="hs-identifier hs-var">txOutAddress</span></span><span> </span><span class="annot"><span class="annottext">(TxOut CtxUTxO Era -&gt; AddressInEra)
-&gt; (TxOut CtxUTxO Era -&gt; Value)
-&gt; TxOut CtxUTxO Era
-&gt; (AddressInEra, Value)
forall b c c'. (b -&gt; c) -&gt; (b -&gt; c') -&gt; b -&gt; (c, c')
forall (a :: * -&gt; * -&gt; *) b c c'.
Arrow a =&gt;
a b c -&gt; a b c' -&gt; a b (c, c')
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Control.Arrow.html#%26%26%26"><span class="hs-operator hs-var">&amp;&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO Era -&gt; Value
forall ctx. TxOut ctx -&gt; Value
</span><span class="hs-identifier hs-var">txOutValue</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TxOut CtxUTxO Era -&gt; (AddressInEra, Value))
-&gt; ((TxIn, TxOut CtxUTxO Era) -&gt; TxOut CtxUTxO Era)
-&gt; (TxIn, TxOut CtxUTxO Era)
-&gt; (AddressInEra, Value)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(TxIn, TxOut CtxUTxO Era) -&gt; TxOut CtxUTxO Era
forall a b. (a, b) -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">((TxIn, TxOut CtxUTxO Era) -&gt; (CardanoSigningKey, Value))
-&gt; [(TxIn, TxOut CtxUTxO Era)] -&gt; [(CardanoSigningKey, Value)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era) -&gt; [(TxIn, TxOut CtxUTxO Era)]
forall out. UTxO' out -&gt; [(TxIn, out)]
</span><span class="hs-identifier hs-var">pairs</span></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era)
</span><a href="#local-6989586621679552614"><span class="hs-identifier hs-var">utxo</span></a></span><span>
</span><span id="line-674"></span><span>
</span><span id="line-675"></span><span>  </span><span class="annot"><a href="#local-6989586621679552617"><span class="hs-identifier hs-type">knownAddresses</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AddressInEra</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html#CardanoSigningKey"><span class="hs-identifier hs-type">CardanoSigningKey</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-676"></span><span>  </span><span id="local-6989586621679552617"><span class="annot"><span class="annottext">knownAddresses :: [(AddressInEra, CardanoSigningKey)]
</span><a href="#local-6989586621679552617"><span class="hs-identifier hs-var hs-var">knownAddresses</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[AddressInEra]
-&gt; [CardanoSigningKey] -&gt; [(AddressInEra, CardanoSigningKey)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CardanoSigningKey -&gt; AddressInEra
</span><a href="#local-6989586621679552618"><span class="hs-identifier hs-var">makeAddressFromSigningKey</span></a></span><span> </span><span class="annot"><span class="annottext">(CardanoSigningKey -&gt; AddressInEra)
-&gt; [CardanoSigningKey] -&gt; [AddressInEra]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[CardanoSigningKey]
</span><a href="#local-6989586621679552596"><span class="hs-identifier hs-var">parties</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[CardanoSigningKey]
</span><a href="#local-6989586621679552596"><span class="hs-identifier hs-var">parties</span></a></span><span>
</span><span id="line-677"></span><span>
</span><span id="line-678"></span><span>  </span><span class="annot"><a href="#local-6989586621679552615"><span class="hs-identifier hs-type">findSigningKey</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AddressInEra</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Model.Payment.html#CardanoSigningKey"><span class="hs-identifier hs-type">CardanoSigningKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span class="hs-special">)</span><span>
</span><span id="line-679"></span><span>  </span><span id="local-6989586621679552615"><span class="annot"><span class="annottext">findSigningKey :: (AddressInEra, Value) -&gt; (CardanoSigningKey, Value)
</span><a href="#local-6989586621679552615"><span class="hs-identifier hs-var hs-var">findSigningKey</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679552619"><span class="annot"><span class="annottext">AddressInEra
</span><a href="#local-6989586621679552619"><span class="hs-identifier hs-var">addr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679552620"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679552620"><span class="hs-identifier hs-var">value</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-680"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">AddressInEra
-&gt; [(AddressInEra, CardanoSigningKey)] -&gt; Maybe CardanoSigningKey
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.List.html#lookup"><span class="hs-identifier hs-var">List.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">AddressInEra
</span><a href="#local-6989586621679552619"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="annot"><span class="annottext">[(AddressInEra, CardanoSigningKey)]
</span><a href="#local-6989586621679552617"><span class="hs-identifier hs-var">knownAddresses</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-681"></span><span>      </span><span class="annot"><span class="annottext">Maybe CardanoSigningKey
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; (CardanoSigningKey, Value)
forall a t. (HasCallStack, IsText t) =&gt; t -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; (CardanoSigningKey, Value))
-&gt; Text -&gt; (CardanoSigningKey, Value)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;cannot invert address:  &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">AddressInEra -&gt; Text
forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">AddressInEra
</span><a href="#local-6989586621679552619"><span class="hs-identifier hs-var">addr</span></a></span><span>
</span><span id="line-682"></span><span>      </span><span class="annot"><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679552622"><span class="annot"><span class="annottext">CardanoSigningKey
</span><a href="#local-6989586621679552622"><span class="hs-identifier hs-var">sk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CardanoSigningKey
</span><a href="#local-6989586621679552622"><span class="hs-identifier hs-var">sk</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679552620"><span class="hs-identifier hs-var">value</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-683"></span><span>
</span><span id="line-684"></span><span>  </span><span class="annot"><a href="#local-6989586621679552618"><span class="hs-identifier hs-type">makeAddressFromSigningKey</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html#CardanoSigningKey"><span class="hs-identifier hs-type">CardanoSigningKey</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">AddressInEra</span></span><span>
</span><span id="line-685"></span><span>  </span><span id="local-6989586621679552618"><span class="annot"><span class="annottext">makeAddressFromSigningKey :: CardanoSigningKey -&gt; AddressInEra
</span><a href="#local-6989586621679552618"><span class="hs-identifier hs-var hs-var">makeAddressFromSigningKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NetworkId -&gt; VerificationKey PaymentKey -&gt; AddressInEra
forall era.
IsShelleyBasedEra era =&gt;
NetworkId -&gt; VerificationKey PaymentKey -&gt; AddressInEra era
</span><span class="hs-identifier hs-var">mkVkAddress</span></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><span class="hs-identifier hs-var">testNetworkId</span></span><span> </span><span class="annot"><span class="annottext">(VerificationKey PaymentKey -&gt; AddressInEra)
-&gt; (CardanoSigningKey -&gt; VerificationKey PaymentKey)
-&gt; CardanoSigningKey
-&gt; AddressInEra
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">SigningKey PaymentKey -&gt; VerificationKey PaymentKey
forall keyrole.
(Key keyrole, HasTypeProxy keyrole) =&gt;
SigningKey keyrole -&gt; VerificationKey keyrole
</span><span class="hs-identifier hs-var">getVerificationKey</span></span><span> </span><span class="annot"><span class="annottext">(SigningKey PaymentKey -&gt; VerificationKey PaymentKey)
-&gt; (CardanoSigningKey -&gt; SigningKey PaymentKey)
-&gt; CardanoSigningKey
-&gt; VerificationKey PaymentKey
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">CardanoSigningKey -&gt; SigningKey PaymentKey
</span><a href="Hydra.Model.Payment.html#%24sel%3AsigningKey%3ACardanoSigningKey"><span class="hs-identifier hs-var">signingKey</span></a></span><span>
</span><span id="line-686"></span><span>
</span><span id="line-687"></span><span id="local-6989586621679550891"><span class="annot"><a href="Hydra.Model.html#performDecommit"><span class="hs-identifier hs-type">performDecommit</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-688"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadThrow</span></span><span> </span><span class="annot"><a href="#local-6989586621679550891"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadTimer</span></span><span> </span><span class="annot"><a href="#local-6989586621679550891"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadAsync</span></span><span> </span><span class="annot"><a href="#local-6989586621679550891"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadDelay</span></span><span> </span><span class="annot"><a href="#local-6989586621679550891"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-689"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Party</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-690"></span><span>  </span><span class="annot"><a href="Hydra.Model.Payment.html#Payment"><span class="hs-identifier hs-type">Payment</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-691"></span><span>  </span><span class="annot"><a href="Hydra.Model.html#RunMonad"><span class="hs-identifier hs-type">RunMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679550891"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-692"></span><span id="performDecommit"><span class="annot"><span class="annottext">performDecommit :: forall (m :: * -&gt; *).
(MonadThrow m, MonadTimer m, MonadAsync m, MonadDelay m) =&gt;
Party -&gt; Payment -&gt; RunMonad m ()
</span><a href="Hydra.Model.html#performDecommit"><span class="hs-identifier hs-var hs-var">performDecommit</span></a></span></span><span> </span><span id="local-6989586621679552689"><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679552689"><span class="hs-identifier hs-var">party</span></a></span></span><span> </span><span id="local-6989586621679552690"><span class="annot"><span class="annottext">Payment
</span><a href="#local-6989586621679552690"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-693"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679552691"><span class="annot"><span class="annottext">recipient :: AddressInEra
</span><a href="#local-6989586621679552691"><span class="hs-identifier hs-var hs-var">recipient</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NetworkId -&gt; VerificationKey PaymentKey -&gt; AddressInEra
forall era.
IsShelleyBasedEra era =&gt;
NetworkId -&gt; VerificationKey PaymentKey -&gt; AddressInEra era
</span><span class="hs-identifier hs-var">mkVkAddress</span></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><span class="hs-identifier hs-var">testNetworkId</span></span><span> </span><span class="annot"><span class="annottext">(VerificationKey PaymentKey -&gt; AddressInEra)
-&gt; (CardanoSigningKey -&gt; VerificationKey PaymentKey)
-&gt; CardanoSigningKey
-&gt; AddressInEra
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">SigningKey PaymentKey -&gt; VerificationKey PaymentKey
forall keyrole.
(Key keyrole, HasTypeProxy keyrole) =&gt;
SigningKey keyrole -&gt; VerificationKey keyrole
</span><span class="hs-identifier hs-var">getVerificationKey</span></span><span> </span><span class="annot"><span class="annottext">(SigningKey PaymentKey -&gt; VerificationKey PaymentKey)
-&gt; (CardanoSigningKey -&gt; SigningKey PaymentKey)
-&gt; CardanoSigningKey
-&gt; VerificationKey PaymentKey
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">CardanoSigningKey -&gt; SigningKey PaymentKey
</span><a href="Hydra.Model.Payment.html#%24sel%3AsigningKey%3ACardanoSigningKey"><span class="hs-identifier hs-var">signingKey</span></a></span><span> </span><span class="annot"><span class="annottext">(CardanoSigningKey -&gt; AddressInEra)
-&gt; CardanoSigningKey -&gt; AddressInEra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Payment -&gt; CardanoSigningKey
</span><a href="Hydra.Model.Payment.html#%24sel%3Ato%3APayment"><span class="hs-identifier hs-var">to</span></a></span><span> </span><span class="annot"><span class="annottext">Payment
</span><a href="#local-6989586621679552690"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-694"></span><span>  </span><span id="local-6989586621679552692"><span class="annot"><span class="annottext">Map Party (TestHydraClient Tx m)
</span><a href="#local-6989586621679552692"><span class="hs-identifier hs-var">nodes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Nodes m -&gt; Map Party (TestHydraClient Tx m))
-&gt; RunMonad m (Map Party (TestHydraClient Tx m))
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/mtl-2.3.1/src/Control.Monad.State.Class.html#gets"><span class="hs-identifier hs-var">gets</span></a></span><span> </span><span class="annot"><span class="annottext">Nodes m -&gt; Map Party (TestHydraClient Tx m)
forall (m :: * -&gt; *). Nodes m -&gt; Map Party (TestHydraClient Tx m)
</span><a href="Hydra.Model.html#%24sel%3Anodes%3ANodes"><span class="hs-identifier hs-var">nodes</span></a></span><span>
</span><span id="line-695"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679552693"><span class="annot"><span class="annottext">thisNode :: TestHydraClient Tx m
</span><a href="#local-6989586621679552693"><span class="hs-identifier hs-var hs-var">thisNode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Party (TestHydraClient Tx m)
</span><a href="#local-6989586621679552692"><span class="hs-identifier hs-var">nodes</span></a></span><span> </span><span class="annot"><span class="annottext">Map Party (TestHydraClient Tx m) -&gt; Party -&gt; TestHydraClient Tx m
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#%21"><span class="hs-operator hs-var">!</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679552689"><span class="hs-identifier hs-var">party</span></a></span><span>
</span><span id="line-696"></span><span>  </span><span class="annot"><span class="annottext">TestHydraClient Tx m -&gt; RunMonad m ()
forall (m :: * -&gt; *) tx.
MonadDelay m =&gt;
TestHydraClient tx m -&gt; RunMonad m ()
</span><a href="Hydra.Model.html#waitForOpen"><span class="hs-identifier hs-var">waitForOpen</span></a></span><span> </span><span class="annot"><span class="annottext">TestHydraClient Tx m
</span><a href="#local-6989586621679552693"><span class="hs-identifier hs-var">thisNode</span></a></span><span>
</span><span id="line-697"></span><span>
</span><span id="line-698"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679552695"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679552695"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679552696"><span class="annot"><span class="annottext">TxOut CtxUTxO Era
</span><a href="#local-6989586621679552696"><span class="hs-identifier hs-var">o</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-699"></span><span>    </span><span class="annot"><span class="annottext">m (Either (UTxO' (TxOut CtxUTxO Era)) (TxIn, TxOut CtxUTxO Era))
-&gt; RunMonad
     m (Either (UTxO' (TxOut CtxUTxO Era)) (TxIn, TxOut CtxUTxO Era))
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; RunMonad m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era)
-&gt; CardanoSigningKey
-&gt; Value
-&gt; TestHydraClient Tx m
-&gt; m (Either (UTxO' (TxOut CtxUTxO Era)) (TxIn, TxOut CtxUTxO Era))
forall (m :: * -&gt; *).
(MonadTimer m, MonadDelay m) =&gt;
UTxO' (TxOut CtxUTxO Era)
-&gt; CardanoSigningKey
-&gt; Value
-&gt; TestHydraClient Tx m
-&gt; m (Either (UTxO' (TxOut CtxUTxO Era)) (TxIn, TxOut CtxUTxO Era))
</span><a href="Hydra.Model.html#waitForUTxOToSpend"><span class="hs-identifier hs-var">waitForUTxOToSpend</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era)
forall a. Monoid a =&gt; a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#mempty"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Payment -&gt; CardanoSigningKey
</span><a href="Hydra.Model.Payment.html#%24sel%3Afrom%3APayment"><span class="hs-identifier hs-var">from</span></a></span><span> </span><span class="annot"><span class="annottext">Payment
</span><a href="#local-6989586621679552690"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Payment -&gt; Value
</span><a href="Hydra.Model.Payment.html#%24sel%3Avalue%3APayment"><span class="hs-identifier hs-var">value</span></a></span><span> </span><span class="annot"><span class="annottext">Payment
</span><a href="#local-6989586621679552690"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TestHydraClient Tx m
</span><a href="#local-6989586621679552693"><span class="hs-identifier hs-var">thisNode</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RunMonad
  m (Either (UTxO' (TxOut CtxUTxO Era)) (TxIn, TxOut CtxUTxO Era))
-&gt; (Either (UTxO' (TxOut CtxUTxO Era)) (TxIn, TxOut CtxUTxO Era)
    -&gt; RunMonad m (TxIn, TxOut CtxUTxO Era))
-&gt; RunMonad m (TxIn, TxOut CtxUTxO Era)
forall a b. RunMonad m a -&gt; (a -&gt; RunMonad m b) -&gt; RunMonad m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-700"></span><span>      </span><span class="annot"><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621679552697"><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era)
</span><a href="#local-6989586621679552697"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; RunMonad m (TxIn, TxOut CtxUTxO Era)
forall a t. (HasCallStack, IsText t) =&gt; t -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; RunMonad m (TxIn, TxOut CtxUTxO Era))
-&gt; Text -&gt; RunMonad m (TxIn, TxOut CtxUTxO Era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cannot execute Decommit for &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Payment -&gt; Text
forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Payment
</span><a href="#local-6989586621679552690"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;, no spendable UTxO in &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era) -&gt; Text
forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era)
</span><a href="#local-6989586621679552697"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-701"></span><span>      </span><span class="annot"><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621679552698"><span class="annot"><span class="annottext">(TxIn, TxOut CtxUTxO Era)
</span><a href="#local-6989586621679552698"><span class="hs-identifier hs-var">ok</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(TxIn, TxOut CtxUTxO Era) -&gt; RunMonad m (TxIn, TxOut CtxUTxO Era)
forall a. a -&gt; RunMonad m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(TxIn, TxOut CtxUTxO Era)
</span><a href="#local-6989586621679552698"><span class="hs-identifier hs-var">ok</span></a></span><span>
</span><span id="line-702"></span><span>
</span><span id="line-703"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679552699"><span class="annot"><span class="annottext">realTx :: Tx
</span><a href="#local-6989586621679552699"><span class="hs-identifier hs-var hs-var">realTx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-704"></span><span>        </span><span class="annot"><span class="annottext">(TxBodyError -&gt; Tx) -&gt; (Tx -&gt; Tx) -&gt; Either TxBodyError Tx -&gt; Tx
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Either.html#either"><span class="hs-identifier hs-var">either</span></a></span><span>
</span><span id="line-705"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Tx
forall a t. (HasCallStack, IsText t) =&gt; t -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Tx) -&gt; (TxBodyError -&gt; Text) -&gt; TxBodyError -&gt; Tx
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyError -&gt; Text
forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span class="hs-special">)</span><span>
</span><span id="line-706"></span><span>          </span><span class="annot"><span class="annottext">Tx -&gt; Tx
forall a. a -&gt; a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#id"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-707"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TxIn, TxOut CtxUTxO Era)
-&gt; (AddressInEra, Value)
-&gt; SigningKey PaymentKey
-&gt; Either TxBodyError Tx
</span><span class="hs-identifier hs-var">mkSimpleTx</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679552695"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO Era
</span><a href="#local-6989586621679552696"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AddressInEra
</span><a href="#local-6989586621679552691"><span class="hs-identifier hs-var">recipient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Payment -&gt; Value
</span><a href="Hydra.Model.Payment.html#%24sel%3Avalue%3APayment"><span class="hs-identifier hs-var">value</span></a></span><span> </span><span class="annot"><span class="annottext">Payment
</span><a href="#local-6989586621679552690"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CardanoSigningKey -&gt; SigningKey PaymentKey
</span><a href="Hydra.Model.Payment.html#%24sel%3AsigningKey%3ACardanoSigningKey"><span class="hs-identifier hs-var">signingKey</span></a></span><span> </span><span class="annot"><span class="annottext">(CardanoSigningKey -&gt; SigningKey PaymentKey)
-&gt; CardanoSigningKey -&gt; SigningKey PaymentKey
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Payment -&gt; CardanoSigningKey
</span><a href="Hydra.Model.Payment.html#%24sel%3Afrom%3APayment"><span class="hs-identifier hs-var">from</span></a></span><span> </span><span class="annot"><span class="annottext">Payment
</span><a href="#local-6989586621679552690"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-708"></span><span>
</span><span id="line-709"></span><span>  </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679552689"><span class="hs-identifier hs-var">party</span></a></span><span> </span><span class="annot"><span class="annottext">Party -&gt; ClientInput Tx -&gt; RunMonad m ()
forall (m :: * -&gt; *).
(MonadSTM m, MonadThrow m) =&gt;
Party -&gt; ClientInput Tx -&gt; RunMonad m ()
</span><a href="Hydra.Model.html#sendsInput"><span class="hs-operator hs-var">`sendsInput`</span></a></span><span> </span><span class="annot"><span class="annottext">Tx -&gt; ClientInput Tx
forall tx. tx -&gt; ClientInput tx
</span><span class="hs-identifier hs-var">Input.Decommit</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621679552699"><span class="hs-identifier hs-var">realTx</span></a></span><span>
</span><span id="line-710"></span><span>
</span><span id="line-711"></span><span>  </span><span class="annot"><span class="annottext">m () -&gt; RunMonad m ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; RunMonad m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; RunMonad m ()) -&gt; m () -&gt; RunMonad m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-712"></span><span>    </span><span class="annot"><span class="annottext">[TestHydraClient Tx m] -&gt; (ServerOutput Tx -&gt; Bool) -&gt; m ()
forall tx (m :: * -&gt; *).
(Show (ServerOutput tx), HasCallStack, MonadThrow m, MonadAsync m,
 MonadTimer m) =&gt;
[TestHydraClient tx m] -&gt; (ServerOutput tx -&gt; Bool) -&gt; m ()
</span><a href="Hydra.BehaviorSpec.html#waitUntilMatch"><span class="hs-identifier hs-var">waitUntilMatch</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TestHydraClient Tx m
</span><a href="#local-6989586621679552693"><span class="hs-identifier hs-var">thisNode</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">((ServerOutput Tx -&gt; Bool) -&gt; m ())
-&gt; (ServerOutput Tx -&gt; Bool) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-713"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">DecommitFinalized</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-714"></span><span>      </span><span id="local-6989586621679552705"><span class="annot"><span class="annottext">err :: ServerOutput Tx
</span><a href="#local-6989586621679552705"><span class="hs-identifier hs-var">err</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">CommandFailed</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Bool
forall a t. (HasCallStack, IsText t) =&gt; t -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Bool) -&gt; Text -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ServerOutput Tx -&gt; Text
forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">ServerOutput Tx
</span><a href="#local-6989586621679552705"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-715"></span><span>      </span><span class="annot"><span class="annottext">ServerOutput Tx
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-716"></span><span>
</span><span id="line-717"></span><span id="local-6989586621679550892"><span class="annot"><a href="Hydra.Model.html#performNewTx"><span class="hs-identifier hs-type">performNewTx</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-718"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadThrow</span></span><span> </span><span class="annot"><a href="#local-6989586621679550892"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadAsync</span></span><span> </span><span class="annot"><a href="#local-6989586621679550892"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadTimer</span></span><span> </span><span class="annot"><a href="#local-6989586621679550892"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadDelay</span></span><span> </span><span class="annot"><a href="#local-6989586621679550892"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-719"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Party</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-720"></span><span>  </span><span class="annot"><a href="Hydra.Model.Payment.html#Payment"><span class="hs-identifier hs-type">Payment</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-721"></span><span>  </span><span class="annot"><a href="Hydra.Model.html#RunMonad"><span class="hs-identifier hs-type">RunMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679550892"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html#Payment"><span class="hs-identifier hs-type">Payment</span></a></span></span><span>
</span><span id="line-722"></span><span id="performNewTx"><span class="annot"><span class="annottext">performNewTx :: forall (m :: * -&gt; *).
(MonadThrow m, MonadAsync m, MonadTimer m, MonadDelay m) =&gt;
Party -&gt; Payment -&gt; RunMonad m Payment
</span><a href="Hydra.Model.html#performNewTx"><span class="hs-identifier hs-var hs-var">performNewTx</span></a></span></span><span> </span><span id="local-6989586621679552781"><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679552781"><span class="hs-identifier hs-var">party</span></a></span></span><span> </span><span id="local-6989586621679552782"><span class="annot"><span class="annottext">Payment
</span><a href="#local-6989586621679552782"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-723"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679552783"><span class="annot"><span class="annottext">recipient :: AddressInEra
</span><a href="#local-6989586621679552783"><span class="hs-identifier hs-var hs-var">recipient</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NetworkId -&gt; VerificationKey PaymentKey -&gt; AddressInEra
forall era.
IsShelleyBasedEra era =&gt;
NetworkId -&gt; VerificationKey PaymentKey -&gt; AddressInEra era
</span><span class="hs-identifier hs-var">mkVkAddress</span></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><span class="hs-identifier hs-var">testNetworkId</span></span><span> </span><span class="annot"><span class="annottext">(VerificationKey PaymentKey -&gt; AddressInEra)
-&gt; (CardanoSigningKey -&gt; VerificationKey PaymentKey)
-&gt; CardanoSigningKey
-&gt; AddressInEra
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">SigningKey PaymentKey -&gt; VerificationKey PaymentKey
forall keyrole.
(Key keyrole, HasTypeProxy keyrole) =&gt;
SigningKey keyrole -&gt; VerificationKey keyrole
</span><span class="hs-identifier hs-var">getVerificationKey</span></span><span> </span><span class="annot"><span class="annottext">(SigningKey PaymentKey -&gt; VerificationKey PaymentKey)
-&gt; (CardanoSigningKey -&gt; SigningKey PaymentKey)
-&gt; CardanoSigningKey
-&gt; VerificationKey PaymentKey
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">CardanoSigningKey -&gt; SigningKey PaymentKey
</span><a href="Hydra.Model.Payment.html#%24sel%3AsigningKey%3ACardanoSigningKey"><span class="hs-identifier hs-var">signingKey</span></a></span><span> </span><span class="annot"><span class="annottext">(CardanoSigningKey -&gt; AddressInEra)
-&gt; CardanoSigningKey -&gt; AddressInEra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Payment -&gt; CardanoSigningKey
</span><a href="Hydra.Model.Payment.html#%24sel%3Ato%3APayment"><span class="hs-identifier hs-var">to</span></a></span><span> </span><span class="annot"><span class="annottext">Payment
</span><a href="#local-6989586621679552782"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-724"></span><span>  </span><span id="local-6989586621679552784"><span class="annot"><span class="annottext">Map Party (TestHydraClient Tx m)
</span><a href="#local-6989586621679552784"><span class="hs-identifier hs-var">nodes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Nodes m -&gt; Map Party (TestHydraClient Tx m))
-&gt; RunMonad m (Map Party (TestHydraClient Tx m))
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/mtl-2.3.1/src/Control.Monad.State.Class.html#gets"><span class="hs-identifier hs-var">gets</span></a></span><span> </span><span class="annot"><span class="annottext">Nodes m -&gt; Map Party (TestHydraClient Tx m)
forall (m :: * -&gt; *). Nodes m -&gt; Map Party (TestHydraClient Tx m)
</span><a href="Hydra.Model.html#%24sel%3Anodes%3ANodes"><span class="hs-identifier hs-var">nodes</span></a></span><span>
</span><span id="line-725"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679552785"><span class="annot"><span class="annottext">thisNode :: TestHydraClient Tx m
</span><a href="#local-6989586621679552785"><span class="hs-identifier hs-var hs-var">thisNode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Party (TestHydraClient Tx m)
</span><a href="#local-6989586621679552784"><span class="hs-identifier hs-var">nodes</span></a></span><span> </span><span class="annot"><span class="annottext">Map Party (TestHydraClient Tx m) -&gt; Party -&gt; TestHydraClient Tx m
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#%21"><span class="hs-operator hs-var">!</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679552781"><span class="hs-identifier hs-var">party</span></a></span><span>
</span><span id="line-726"></span><span>  </span><span class="annot"><span class="annottext">TestHydraClient Tx m -&gt; RunMonad m ()
forall (m :: * -&gt; *) tx.
MonadDelay m =&gt;
TestHydraClient tx m -&gt; RunMonad m ()
</span><a href="Hydra.Model.html#waitForOpen"><span class="hs-identifier hs-var">waitForOpen</span></a></span><span> </span><span class="annot"><span class="annottext">TestHydraClient Tx m
</span><a href="#local-6989586621679552785"><span class="hs-identifier hs-var">thisNode</span></a></span><span>
</span><span id="line-727"></span><span>
</span><span id="line-728"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679552786"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679552786"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679552787"><span class="annot"><span class="annottext">TxOut CtxUTxO Era
</span><a href="#local-6989586621679552787"><span class="hs-identifier hs-var">o</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-729"></span><span>    </span><span class="annot"><span class="annottext">m (Either (UTxO' (TxOut CtxUTxO Era)) (TxIn, TxOut CtxUTxO Era))
-&gt; RunMonad
     m (Either (UTxO' (TxOut CtxUTxO Era)) (TxIn, TxOut CtxUTxO Era))
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; RunMonad m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era)
-&gt; CardanoSigningKey
-&gt; Value
-&gt; TestHydraClient Tx m
-&gt; m (Either (UTxO' (TxOut CtxUTxO Era)) (TxIn, TxOut CtxUTxO Era))
forall (m :: * -&gt; *).
(MonadTimer m, MonadDelay m) =&gt;
UTxO' (TxOut CtxUTxO Era)
-&gt; CardanoSigningKey
-&gt; Value
-&gt; TestHydraClient Tx m
-&gt; m (Either (UTxO' (TxOut CtxUTxO Era)) (TxIn, TxOut CtxUTxO Era))
</span><a href="Hydra.Model.html#waitForUTxOToSpend"><span class="hs-identifier hs-var">waitForUTxOToSpend</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era)
forall a. Monoid a =&gt; a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#mempty"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Payment -&gt; CardanoSigningKey
</span><a href="Hydra.Model.Payment.html#%24sel%3Afrom%3APayment"><span class="hs-identifier hs-var">from</span></a></span><span> </span><span class="annot"><span class="annottext">Payment
</span><a href="#local-6989586621679552782"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Payment -&gt; Value
</span><a href="Hydra.Model.Payment.html#%24sel%3Avalue%3APayment"><span class="hs-identifier hs-var">value</span></a></span><span> </span><span class="annot"><span class="annottext">Payment
</span><a href="#local-6989586621679552782"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TestHydraClient Tx m
</span><a href="#local-6989586621679552785"><span class="hs-identifier hs-var">thisNode</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RunMonad
  m (Either (UTxO' (TxOut CtxUTxO Era)) (TxIn, TxOut CtxUTxO Era))
-&gt; (Either (UTxO' (TxOut CtxUTxO Era)) (TxIn, TxOut CtxUTxO Era)
    -&gt; RunMonad m (TxIn, TxOut CtxUTxO Era))
-&gt; RunMonad m (TxIn, TxOut CtxUTxO Era)
forall a b. RunMonad m a -&gt; (a -&gt; RunMonad m b) -&gt; RunMonad m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-730"></span><span>      </span><span class="annot"><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621679552788"><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era)
</span><a href="#local-6989586621679552788"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; RunMonad m (TxIn, TxOut CtxUTxO Era)
forall a t. (HasCallStack, IsText t) =&gt; t -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; RunMonad m (TxIn, TxOut CtxUTxO Era))
-&gt; Text -&gt; RunMonad m (TxIn, TxOut CtxUTxO Era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Cannot execute NewTx for &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Payment -&gt; Text
forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Payment
</span><a href="#local-6989586621679552782"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;, no spendable UTxO in &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era) -&gt; Text
forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era)
</span><a href="#local-6989586621679552788"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-731"></span><span>      </span><span class="annot"><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621679552789"><span class="annot"><span class="annottext">(TxIn, TxOut CtxUTxO Era)
</span><a href="#local-6989586621679552789"><span class="hs-identifier hs-var">ok</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(TxIn, TxOut CtxUTxO Era) -&gt; RunMonad m (TxIn, TxOut CtxUTxO Era)
forall a. a -&gt; RunMonad m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(TxIn, TxOut CtxUTxO Era)
</span><a href="#local-6989586621679552789"><span class="hs-identifier hs-var">ok</span></a></span><span>
</span><span id="line-732"></span><span>
</span><span id="line-733"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679552790"><span class="annot"><span class="annottext">realTx :: Tx
</span><a href="#local-6989586621679552790"><span class="hs-identifier hs-var hs-var">realTx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-734"></span><span>        </span><span class="annot"><span class="annottext">(TxBodyError -&gt; Tx) -&gt; (Tx -&gt; Tx) -&gt; Either TxBodyError Tx -&gt; Tx
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Either.html#either"><span class="hs-identifier hs-var">either</span></a></span><span>
</span><span id="line-735"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Tx
forall a t. (HasCallStack, IsText t) =&gt; t -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Tx) -&gt; (TxBodyError -&gt; Text) -&gt; TxBodyError -&gt; Tx
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyError -&gt; Text
forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span class="hs-special">)</span><span>
</span><span id="line-736"></span><span>          </span><span class="annot"><span class="annottext">Tx -&gt; Tx
forall a. a -&gt; a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#id"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-737"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TxIn, TxOut CtxUTxO Era)
-&gt; (AddressInEra, Value)
-&gt; SigningKey PaymentKey
-&gt; Either TxBodyError Tx
</span><span class="hs-identifier hs-var">mkSimpleTx</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679552786"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO Era
</span><a href="#local-6989586621679552787"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AddressInEra
</span><a href="#local-6989586621679552783"><span class="hs-identifier hs-var">recipient</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Payment -&gt; Value
</span><a href="Hydra.Model.Payment.html#%24sel%3Avalue%3APayment"><span class="hs-identifier hs-var">value</span></a></span><span> </span><span class="annot"><span class="annottext">Payment
</span><a href="#local-6989586621679552782"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CardanoSigningKey -&gt; SigningKey PaymentKey
</span><a href="Hydra.Model.Payment.html#%24sel%3AsigningKey%3ACardanoSigningKey"><span class="hs-identifier hs-var">signingKey</span></a></span><span> </span><span class="annot"><span class="annottext">(CardanoSigningKey -&gt; SigningKey PaymentKey)
-&gt; CardanoSigningKey -&gt; SigningKey PaymentKey
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Payment -&gt; CardanoSigningKey
</span><a href="Hydra.Model.Payment.html#%24sel%3Afrom%3APayment"><span class="hs-identifier hs-var">from</span></a></span><span> </span><span class="annot"><span class="annottext">Payment
</span><a href="#local-6989586621679552782"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-738"></span><span>
</span><span id="line-739"></span><span>  </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679552781"><span class="hs-identifier hs-var">party</span></a></span><span> </span><span class="annot"><span class="annottext">Party -&gt; ClientInput Tx -&gt; RunMonad m ()
forall (m :: * -&gt; *).
(MonadSTM m, MonadThrow m) =&gt;
Party -&gt; ClientInput Tx -&gt; RunMonad m ()
</span><a href="Hydra.Model.html#sendsInput"><span class="hs-operator hs-var">`sendsInput`</span></a></span><span> </span><span class="annot"><span class="annottext">Tx -&gt; ClientInput Tx
forall tx. tx -&gt; ClientInput tx
</span><span class="hs-identifier hs-var">Input.NewTx</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621679552790"><span class="hs-identifier hs-var">realTx</span></a></span><span>
</span><span id="line-740"></span><span>  </span><span class="annot"><span class="annottext">m Payment -&gt; RunMonad m Payment
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; RunMonad m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">(m Payment -&gt; RunMonad m Payment)
-&gt; m Payment -&gt; RunMonad m Payment
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-741"></span><span>    </span><span class="annot"><span class="annottext">[TestHydraClient Tx m] -&gt; (ServerOutput Tx -&gt; Bool) -&gt; m ()
forall tx (m :: * -&gt; *).
(Show (ServerOutput tx), HasCallStack, MonadThrow m, MonadAsync m,
 MonadTimer m) =&gt;
[TestHydraClient tx m] -&gt; (ServerOutput tx -&gt; Bool) -&gt; m ()
</span><a href="Hydra.BehaviorSpec.html#waitUntilMatch"><span class="hs-identifier hs-var">waitUntilMatch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Party (TestHydraClient Tx m) -&gt; [TestHydraClient Tx m]
forall a. Map Party a -&gt; [a]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Foldable.html#toList"><span class="hs-identifier hs-var">toList</span></a></span><span> </span><span class="annot"><span class="annottext">Map Party (TestHydraClient Tx m)
</span><a href="#local-6989586621679552784"><span class="hs-identifier hs-var">nodes</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((ServerOutput Tx -&gt; Bool) -&gt; m ())
-&gt; (ServerOutput Tx -&gt; Bool) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-742"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">SnapshotConfirmed</span></span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:snapshot:PeerConnected :: forall tx. ServerOutput tx -&gt; Snapshot tx
</span><span class="hs-identifier hs-var">snapshot</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679552794"><span class="annot"><span class="annottext">Snapshot Tx
</span><a href="#local-6989586621679552794"><span class="hs-identifier hs-var">snapshot</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-743"></span><span>        </span><span class="annot"><span class="annottext">Tx -&gt; TxIdType Tx
forall tx. IsTx tx =&gt; tx -&gt; TxIdType tx
</span><span class="hs-identifier hs-var">txId</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621679552790"><span class="hs-identifier hs-var">realTx</span></a></span><span> </span><span class="annot"><span class="annottext">TxId -&gt; [TxId] -&gt; Bool
forall (f :: * -&gt; *) a.
(Foldable f, DisallowElem f, Eq a) =&gt;
a -&gt; f a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">Snapshot Tx -&gt; [TxIdType Tx]
forall tx. Snapshot tx -&gt; [TxIdType tx]
</span><span class="hs-identifier hs-var">Snapshot.confirmed</span></span><span> </span><span class="annot"><span class="annottext">Snapshot Tx
</span><a href="#local-6989586621679552794"><span class="hs-identifier hs-var">snapshot</span></a></span><span>
</span><span id="line-744"></span><span>      </span><span id="local-6989586621679552797"><span class="annot"><span class="annottext">err :: ServerOutput Tx
</span><a href="#local-6989586621679552797"><span class="hs-identifier hs-var">err</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">TxInvalid</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Bool
forall a t. (HasCallStack, IsText t) =&gt; t -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;expected tx to be valid: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ServerOutput Tx -&gt; Text
forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">ServerOutput Tx
</span><a href="#local-6989586621679552797"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-745"></span><span>      </span><span class="annot"><span class="annottext">ServerOutput Tx
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-746"></span><span>    </span><span class="annot"><span class="annottext">Payment -&gt; m Payment
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Payment
</span><a href="#local-6989586621679552782"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-747"></span><span>
</span><span id="line-748"></span><span class="hs-comment">-- | Wait for the head to be open by searching from the beginning. Note that</span><span>
</span><span id="line-749"></span><span class="hs-comment">-- there rollbacks or multiple life-cycles of heads are not handled here.</span><span>
</span><span id="line-750"></span><span id="local-6989586621679550992"><span id="local-6989586621679550993"><span class="annot"><a href="Hydra.Model.html#waitForOpen"><span class="hs-identifier hs-type">waitForOpen</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadDelay</span></span><span> </span><span class="annot"><a href="#local-6989586621679550992"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hydra.BehaviorSpec.html#TestHydraClient"><span class="hs-identifier hs-type">TestHydraClient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679550993"><span class="hs-identifier hs-type">tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679550992"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hydra.Model.html#RunMonad"><span class="hs-identifier hs-type">RunMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679550992"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-751"></span><span id="waitForOpen"><span class="annot"><span class="annottext">waitForOpen :: forall (m :: * -&gt; *) tx.
MonadDelay m =&gt;
TestHydraClient tx m -&gt; RunMonad m ()
</span><a href="Hydra.Model.html#waitForOpen"><span class="hs-identifier hs-var hs-var">waitForOpen</span></a></span></span><span> </span><span id="local-6989586621679552817"><span class="annot"><span class="annottext">TestHydraClient tx m
</span><a href="#local-6989586621679552817"><span class="hs-identifier hs-var">node</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-752"></span><span>  </span><span id="local-6989586621679552818"><span class="annot"><span class="annottext">[ServerOutput tx]
</span><a href="#local-6989586621679552818"><span class="hs-identifier hs-var">outs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m [ServerOutput tx] -&gt; RunMonad m [ServerOutput tx]
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; RunMonad m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">(m [ServerOutput tx] -&gt; RunMonad m [ServerOutput tx])
-&gt; m [ServerOutput tx] -&gt; RunMonad m [ServerOutput tx]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TestHydraClient tx m -&gt; m [ServerOutput tx]
forall tx (m :: * -&gt; *).
TestHydraClient tx m -&gt; m [ServerOutput tx]
</span><a href="Hydra.BehaviorSpec.html#%24sel%3AserverOutputs%3ATestHydraClient"><span class="hs-identifier hs-var">serverOutputs</span></a></span><span> </span><span class="annot"><span class="annottext">TestHydraClient tx m
</span><a href="#local-6989586621679552817"><span class="hs-identifier hs-var">node</span></a></span><span>
</span><span id="line-753"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; RunMonad m () -&gt; RunMonad m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ServerOutput tx -&gt; Bool) -&gt; [ServerOutput tx] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a></span><span> </span><span class="annot"><span class="annottext">ServerOutput tx -&gt; Bool
forall tx. ServerOutput tx -&gt; Bool
</span><a href="Hydra.Model.html#headIsOpen"><span class="hs-identifier hs-var">headIsOpen</span></a></span><span> </span><span class="annot"><span class="annottext">[ServerOutput tx]
</span><a href="#local-6989586621679552818"><span class="hs-identifier hs-var">outs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RunMonad m ()
</span><a href="#local-6989586621679552821"><span class="hs-identifier hs-var">waitAndRetry</span></a></span><span>
</span><span id="line-754"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-755"></span><span>  </span><span id="local-6989586621679552821"><span class="annot"><span class="annottext">waitAndRetry :: RunMonad m ()
</span><a href="#local-6989586621679552821"><span class="hs-identifier hs-var hs-var">waitAndRetry</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m () -&gt; RunMonad m ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; RunMonad m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DiffTime -&gt; m ()
forall (m :: * -&gt; *). MonadDelay m =&gt; DiffTime -&gt; m ()
</span><span class="hs-identifier hs-var">threadDelay</span></span><span> </span><span class="annot"><span class="annottext">DiffTime
</span><span class="hs-number">0.1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RunMonad m () -&gt; RunMonad m () -&gt; RunMonad m ()
forall a b. RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3E%3E"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TestHydraClient tx m -&gt; RunMonad m ()
forall (m :: * -&gt; *) tx.
MonadDelay m =&gt;
TestHydraClient tx m -&gt; RunMonad m ()
</span><a href="Hydra.Model.html#waitForOpen"><span class="hs-identifier hs-var">waitForOpen</span></a></span><span> </span><span class="annot"><span class="annottext">TestHydraClient tx m
</span><a href="#local-6989586621679552817"><span class="hs-identifier hs-var">node</span></a></span><span>
</span><span id="line-756"></span><span>
</span><span id="line-757"></span><span class="hs-comment">-- | Wait for the head to be closed by searching from the beginning. Note that</span><span>
</span><span id="line-758"></span><span class="hs-comment">-- there rollbacks or multiple life-cycles of heads are not handled here.</span><span>
</span><span id="line-759"></span><span id="local-6989586621679552822"><span id="local-6989586621679552823"><span class="annot"><a href="Hydra.Model.html#waitForReadyToFanout"><span class="hs-identifier hs-type">waitForReadyToFanout</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadDelay</span></span><span> </span><span class="annot"><a href="#local-6989586621679552822"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hydra.BehaviorSpec.html#TestHydraClient"><span class="hs-identifier hs-type">TestHydraClient</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679552823"><span class="hs-identifier hs-type">tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679552822"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hydra.Model.html#RunMonad"><span class="hs-identifier hs-type">RunMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679552822"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-760"></span><span id="waitForReadyToFanout"><span class="annot"><span class="annottext">waitForReadyToFanout :: forall (m :: * -&gt; *) tx.
MonadDelay m =&gt;
TestHydraClient tx m -&gt; RunMonad m ()
</span><a href="Hydra.Model.html#waitForReadyToFanout"><span class="hs-identifier hs-var hs-var">waitForReadyToFanout</span></a></span></span><span> </span><span id="local-6989586621679552840"><span class="annot"><span class="annottext">TestHydraClient tx m
</span><a href="#local-6989586621679552840"><span class="hs-identifier hs-var">node</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-761"></span><span>  </span><span id="local-6989586621679552841"><span class="annot"><span class="annottext">[ServerOutput tx]
</span><a href="#local-6989586621679552841"><span class="hs-identifier hs-var">outs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m [ServerOutput tx] -&gt; RunMonad m [ServerOutput tx]
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; RunMonad m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">(m [ServerOutput tx] -&gt; RunMonad m [ServerOutput tx])
-&gt; m [ServerOutput tx] -&gt; RunMonad m [ServerOutput tx]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TestHydraClient tx m -&gt; m [ServerOutput tx]
forall tx (m :: * -&gt; *).
TestHydraClient tx m -&gt; m [ServerOutput tx]
</span><a href="Hydra.BehaviorSpec.html#%24sel%3AserverOutputs%3ATestHydraClient"><span class="hs-identifier hs-var">serverOutputs</span></a></span><span> </span><span class="annot"><span class="annottext">TestHydraClient tx m
</span><a href="#local-6989586621679552840"><span class="hs-identifier hs-var">node</span></a></span><span>
</span><span id="line-762"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; RunMonad m () -&gt; RunMonad m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ServerOutput tx -&gt; Bool) -&gt; [ServerOutput tx] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a></span><span> </span><span class="annot"><span class="annottext">ServerOutput tx -&gt; Bool
forall tx. ServerOutput tx -&gt; Bool
</span><a href="Hydra.Model.html#headIsReadyToFanout"><span class="hs-identifier hs-var">headIsReadyToFanout</span></a></span><span> </span><span class="annot"><span class="annottext">[ServerOutput tx]
</span><a href="#local-6989586621679552841"><span class="hs-identifier hs-var">outs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RunMonad m ()
</span><a href="#local-6989586621679552843"><span class="hs-identifier hs-var">waitAndRetry</span></a></span><span>
</span><span id="line-763"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-764"></span><span>  </span><span id="local-6989586621679552843"><span class="annot"><span class="annottext">waitAndRetry :: RunMonad m ()
</span><a href="#local-6989586621679552843"><span class="hs-identifier hs-var hs-var">waitAndRetry</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m () -&gt; RunMonad m ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; RunMonad m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DiffTime -&gt; m ()
forall (m :: * -&gt; *). MonadDelay m =&gt; DiffTime -&gt; m ()
</span><span class="hs-identifier hs-var">threadDelay</span></span><span> </span><span class="annot"><span class="annottext">DiffTime
</span><span class="hs-number">0.1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RunMonad m () -&gt; RunMonad m () -&gt; RunMonad m ()
forall a b. RunMonad m a -&gt; RunMonad m b -&gt; RunMonad m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3E%3E"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TestHydraClient tx m -&gt; RunMonad m ()
forall (m :: * -&gt; *) tx.
MonadDelay m =&gt;
TestHydraClient tx m -&gt; RunMonad m ()
</span><a href="Hydra.Model.html#waitForReadyToFanout"><span class="hs-identifier hs-var">waitForReadyToFanout</span></a></span><span> </span><span class="annot"><span class="annottext">TestHydraClient tx m
</span><a href="#local-6989586621679552840"><span class="hs-identifier hs-var">node</span></a></span><span>
</span><span id="line-765"></span><span>
</span><span id="line-766"></span><span id="local-6989586621679550999"><span class="annot"><a href="Hydra.Model.html#sendsInput"><span class="hs-identifier hs-type">sendsInput</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadSTM</span></span><span> </span><span class="annot"><a href="#local-6989586621679550999"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadThrow</span></span><span> </span><span class="annot"><a href="#local-6989586621679550999"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Party</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ClientInput</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hydra.Model.html#RunMonad"><span class="hs-identifier hs-type">RunMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679550999"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-767"></span><span id="sendsInput"><span class="annot"><span class="annottext">sendsInput :: forall (m :: * -&gt; *).
(MonadSTM m, MonadThrow m) =&gt;
Party -&gt; ClientInput Tx -&gt; RunMonad m ()
</span><a href="Hydra.Model.html#sendsInput"><span class="hs-identifier hs-var hs-var">sendsInput</span></a></span></span><span> </span><span id="local-6989586621679552854"><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679552854"><span class="hs-identifier hs-var">party</span></a></span></span><span> </span><span id="local-6989586621679552855"><span class="annot"><span class="annottext">ClientInput Tx
</span><a href="#local-6989586621679552855"><span class="hs-identifier hs-var">command</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-768"></span><span>  </span><span id="local-6989586621679552856"><span class="annot"><span class="annottext">Map Party (TestHydraClient Tx m)
</span><a href="#local-6989586621679552856"><span class="hs-identifier hs-var">nodes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Nodes m -&gt; Map Party (TestHydraClient Tx m))
-&gt; RunMonad m (Map Party (TestHydraClient Tx m))
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/mtl-2.3.1/src/Control.Monad.State.Class.html#gets"><span class="hs-identifier hs-var">gets</span></a></span><span> </span><span class="annot"><span class="annottext">Nodes m -&gt; Map Party (TestHydraClient Tx m)
forall (m :: * -&gt; *). Nodes m -&gt; Map Party (TestHydraClient Tx m)
</span><a href="Hydra.Model.html#%24sel%3Anodes%3ANodes"><span class="hs-identifier hs-var">nodes</span></a></span><span>
</span><span id="line-769"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Party
-&gt; Map Party (TestHydraClient Tx m) -&gt; Maybe (TestHydraClient Tx m)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679552854"><span class="hs-identifier hs-var">party</span></a></span><span> </span><span class="annot"><span class="annottext">Map Party (TestHydraClient Tx m)
</span><a href="#local-6989586621679552856"><span class="hs-identifier hs-var">nodes</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-770"></span><span>    </span><span class="annot"><span class="annottext">Maybe (TestHydraClient Tx m)
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RunException -&gt; RunMonad m ()
forall e a. Exception e =&gt; e -&gt; RunMonad m a
forall (m :: * -&gt; *) e a. (MonadThrow m, Exception e) =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwIO</span></span><span> </span><span class="annot"><span class="annottext">(RunException -&gt; RunMonad m ()) -&gt; RunException -&gt; RunMonad m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Party -&gt; RunException
</span><a href="Hydra.Model.html#UnexpectedParty"><span class="hs-identifier hs-var">UnexpectedParty</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679552854"><span class="hs-identifier hs-var">party</span></a></span><span>
</span><span id="line-771"></span><span>    </span><span class="annot"><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679552857"><span class="annot"><span class="annottext">TestHydraClient Tx m
</span><a href="#local-6989586621679552857"><span class="hs-identifier hs-var">actorNode</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m () -&gt; RunMonad m ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; RunMonad m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; RunMonad m ()) -&gt; m () -&gt; RunMonad m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TestHydraClient Tx m
</span><a href="#local-6989586621679552857"><span class="hs-identifier hs-var">actorNode</span></a></span><span> </span><span class="annot"><span class="annottext">TestHydraClient Tx m -&gt; ClientInput Tx -&gt; m ()
forall tx (m :: * -&gt; *).
TestHydraClient tx m -&gt; ClientInput tx -&gt; m ()
</span><a href="Hydra.BehaviorSpec.html#%24sel%3Asend%3ATestHydraClient"><span class="hs-operator hs-var">`send`</span></a></span><span> </span><span class="annot"><span class="annottext">ClientInput Tx
</span><a href="#local-6989586621679552855"><span class="hs-identifier hs-var">command</span></a></span><span>
</span><span id="line-772"></span><span>
</span><span id="line-773"></span><span id="local-6989586621679550893"><span class="annot"><a href="Hydra.Model.html#performInit"><span class="hs-identifier hs-type">performInit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadThrow</span></span><span> </span><span class="annot"><a href="#local-6989586621679550893"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadAsync</span></span><span> </span><span class="annot"><a href="#local-6989586621679550893"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadTimer</span></span><span> </span><span class="annot"><a href="#local-6989586621679550893"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Party</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hydra.Model.html#RunMonad"><span class="hs-identifier hs-type">RunMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679550893"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-774"></span><span id="performInit"><span class="annot"><span class="annottext">performInit :: forall (m :: * -&gt; *).
(MonadThrow m, MonadAsync m, MonadTimer m) =&gt;
Party -&gt; RunMonad m ()
</span><a href="Hydra.Model.html#performInit"><span class="hs-identifier hs-var hs-var">performInit</span></a></span></span><span> </span><span id="local-6989586621679552886"><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679552886"><span class="hs-identifier hs-var">party</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-775"></span><span>  </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679552886"><span class="hs-identifier hs-var">party</span></a></span><span> </span><span class="annot"><span class="annottext">Party -&gt; ClientInput Tx -&gt; RunMonad m ()
forall (m :: * -&gt; *).
(MonadSTM m, MonadThrow m) =&gt;
Party -&gt; ClientInput Tx -&gt; RunMonad m ()
</span><a href="Hydra.Model.html#sendsInput"><span class="hs-operator hs-var">`sendsInput`</span></a></span><span> </span><span class="annot"><span class="annottext">ClientInput Tx
forall tx. ClientInput tx
</span><span class="hs-identifier hs-var">Input.Init</span></span><span>
</span><span id="line-776"></span><span>  </span><span id="local-6989586621679552888"><span class="annot"><span class="annottext">Map Party (TestHydraClient Tx m)
</span><a href="#local-6989586621679552888"><span class="hs-identifier hs-var">nodes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Nodes m -&gt; Map Party (TestHydraClient Tx m))
-&gt; RunMonad m (Map Party (TestHydraClient Tx m))
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/mtl-2.3.1/src/Control.Monad.State.Class.html#gets"><span class="hs-identifier hs-var">gets</span></a></span><span> </span><span class="annot"><span class="annottext">Nodes m -&gt; Map Party (TestHydraClient Tx m)
forall (m :: * -&gt; *). Nodes m -&gt; Map Party (TestHydraClient Tx m)
</span><a href="Hydra.Model.html#%24sel%3Anodes%3ANodes"><span class="hs-identifier hs-var">nodes</span></a></span><span>
</span><span id="line-777"></span><span>  </span><span class="annot"><span class="annottext">m () -&gt; RunMonad m ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; RunMonad m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; RunMonad m ()) -&gt; m () -&gt; RunMonad m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-778"></span><span>    </span><span class="annot"><span class="annottext">[TestHydraClient Tx m] -&gt; (ServerOutput Tx -&gt; Bool) -&gt; m ()
forall tx (m :: * -&gt; *).
(Show (ServerOutput tx), HasCallStack, MonadThrow m, MonadAsync m,
 MonadTimer m) =&gt;
[TestHydraClient tx m] -&gt; (ServerOutput tx -&gt; Bool) -&gt; m ()
</span><a href="Hydra.BehaviorSpec.html#waitUntilMatch"><span class="hs-identifier hs-var">waitUntilMatch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Party (TestHydraClient Tx m) -&gt; [TestHydraClient Tx m]
forall a. Map Party a -&gt; [a]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Foldable.html#toList"><span class="hs-identifier hs-var">toList</span></a></span><span> </span><span class="annot"><span class="annottext">Map Party (TestHydraClient Tx m)
</span><a href="#local-6989586621679552888"><span class="hs-identifier hs-var">nodes</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((ServerOutput Tx -&gt; Bool) -&gt; m ())
-&gt; (ServerOutput Tx -&gt; Bool) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-779"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">HeadIsInitializing</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-780"></span><span>      </span><span id="local-6989586621679552890"><span class="annot"><span class="annottext">err :: ServerOutput Tx
</span><a href="#local-6989586621679552890"><span class="hs-identifier hs-var">err</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">CommandFailed</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Bool
forall a t. (HasCallStack, IsText t) =&gt; t -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Bool) -&gt; Text -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ServerOutput Tx -&gt; Text
forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">ServerOutput Tx
</span><a href="#local-6989586621679552890"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-781"></span><span>      </span><span class="annot"><span class="annottext">ServerOutput Tx
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-782"></span><span>
</span><span id="line-783"></span><span id="local-6989586621679552891"><span class="annot"><a href="Hydra.Model.html#performAbort"><span class="hs-identifier hs-type">performAbort</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadThrow</span></span><span> </span><span class="annot"><a href="#local-6989586621679552891"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadAsync</span></span><span> </span><span class="annot"><a href="#local-6989586621679552891"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadTimer</span></span><span> </span><span class="annot"><a href="#local-6989586621679552891"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Party</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hydra.Model.html#RunMonad"><span class="hs-identifier hs-type">RunMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679552891"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-784"></span><span id="performAbort"><span class="annot"><span class="annottext">performAbort :: forall (m :: * -&gt; *).
(MonadThrow m, MonadAsync m, MonadTimer m) =&gt;
Party -&gt; RunMonad m ()
</span><a href="Hydra.Model.html#performAbort"><span class="hs-identifier hs-var hs-var">performAbort</span></a></span></span><span> </span><span id="local-6989586621679552919"><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679552919"><span class="hs-identifier hs-var">party</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-785"></span><span>  </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679552919"><span class="hs-identifier hs-var">party</span></a></span><span> </span><span class="annot"><span class="annottext">Party -&gt; ClientInput Tx -&gt; RunMonad m ()
forall (m :: * -&gt; *).
(MonadSTM m, MonadThrow m) =&gt;
Party -&gt; ClientInput Tx -&gt; RunMonad m ()
</span><a href="Hydra.Model.html#sendsInput"><span class="hs-operator hs-var">`sendsInput`</span></a></span><span> </span><span class="annot"><span class="annottext">ClientInput Tx
forall tx. ClientInput tx
</span><span class="hs-identifier hs-var">Input.Abort</span></span><span>
</span><span id="line-786"></span><span>
</span><span id="line-787"></span><span>  </span><span id="local-6989586621679552921"><span class="annot"><span class="annottext">Map Party (TestHydraClient Tx m)
</span><a href="#local-6989586621679552921"><span class="hs-identifier hs-var">nodes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Nodes m -&gt; Map Party (TestHydraClient Tx m))
-&gt; RunMonad m (Map Party (TestHydraClient Tx m))
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/mtl-2.3.1/src/Control.Monad.State.Class.html#gets"><span class="hs-identifier hs-var">gets</span></a></span><span> </span><span class="annot"><span class="annottext">Nodes m -&gt; Map Party (TestHydraClient Tx m)
forall (m :: * -&gt; *). Nodes m -&gt; Map Party (TestHydraClient Tx m)
</span><a href="Hydra.Model.html#%24sel%3Anodes%3ANodes"><span class="hs-identifier hs-var">nodes</span></a></span><span>
</span><span id="line-788"></span><span>  </span><span class="annot"><span class="annottext">m () -&gt; RunMonad m ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; RunMonad m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; RunMonad m ()) -&gt; m () -&gt; RunMonad m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-789"></span><span>    </span><span class="annot"><span class="annottext">[TestHydraClient Tx m] -&gt; (ServerOutput Tx -&gt; Bool) -&gt; m ()
forall tx (m :: * -&gt; *).
(Show (ServerOutput tx), HasCallStack, MonadThrow m, MonadAsync m,
 MonadTimer m) =&gt;
[TestHydraClient tx m] -&gt; (ServerOutput tx -&gt; Bool) -&gt; m ()
</span><a href="Hydra.BehaviorSpec.html#waitUntilMatch"><span class="hs-identifier hs-var">waitUntilMatch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Party (TestHydraClient Tx m) -&gt; [TestHydraClient Tx m]
forall a. Map Party a -&gt; [a]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Foldable.html#toList"><span class="hs-identifier hs-var">toList</span></a></span><span> </span><span class="annot"><span class="annottext">Map Party (TestHydraClient Tx m)
</span><a href="#local-6989586621679552921"><span class="hs-identifier hs-var">nodes</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((ServerOutput Tx -&gt; Bool) -&gt; m ())
-&gt; (ServerOutput Tx -&gt; Bool) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-790"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">HeadIsAborted</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-791"></span><span>      </span><span id="local-6989586621679552923"><span class="annot"><span class="annottext">err :: ServerOutput Tx
</span><a href="#local-6989586621679552923"><span class="hs-identifier hs-var">err</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">CommandFailed</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Bool
forall a t. (HasCallStack, IsText t) =&gt; t -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Bool) -&gt; Text -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ServerOutput Tx -&gt; Text
forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">ServerOutput Tx
</span><a href="#local-6989586621679552923"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-792"></span><span>      </span><span class="annot"><span class="annottext">ServerOutput Tx
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-793"></span><span>
</span><span id="line-794"></span><span id="local-6989586621679550894"><span class="annot"><a href="Hydra.Model.html#performClose"><span class="hs-identifier hs-type">performClose</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadThrow</span></span><span> </span><span class="annot"><a href="#local-6989586621679550894"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadAsync</span></span><span> </span><span class="annot"><a href="#local-6989586621679550894"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadTimer</span></span><span> </span><span class="annot"><a href="#local-6989586621679550894"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadDelay</span></span><span> </span><span class="annot"><a href="#local-6989586621679550894"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Party</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hydra.Model.html#RunMonad"><span class="hs-identifier hs-type">RunMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679550894"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-795"></span><span id="performClose"><span class="annot"><span class="annottext">performClose :: forall (m :: * -&gt; *).
(MonadThrow m, MonadAsync m, MonadTimer m, MonadDelay m) =&gt;
Party -&gt; RunMonad m ()
</span><a href="Hydra.Model.html#performClose"><span class="hs-identifier hs-var hs-var">performClose</span></a></span></span><span> </span><span id="local-6989586621679552955"><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679552955"><span class="hs-identifier hs-var">party</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-796"></span><span>  </span><span id="local-6989586621679552956"><span class="annot"><span class="annottext">Map Party (TestHydraClient Tx m)
</span><a href="#local-6989586621679552956"><span class="hs-identifier hs-var">nodes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Nodes m -&gt; Map Party (TestHydraClient Tx m))
-&gt; RunMonad m (Map Party (TestHydraClient Tx m))
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/mtl-2.3.1/src/Control.Monad.State.Class.html#gets"><span class="hs-identifier hs-var">gets</span></a></span><span> </span><span class="annot"><span class="annottext">Nodes m -&gt; Map Party (TestHydraClient Tx m)
forall (m :: * -&gt; *). Nodes m -&gt; Map Party (TestHydraClient Tx m)
</span><a href="Hydra.Model.html#%24sel%3Anodes%3ANodes"><span class="hs-identifier hs-var">nodes</span></a></span><span>
</span><span id="line-797"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679552957"><span class="annot"><span class="annottext">thisNode :: TestHydraClient Tx m
</span><a href="#local-6989586621679552957"><span class="hs-identifier hs-var hs-var">thisNode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Party (TestHydraClient Tx m)
</span><a href="#local-6989586621679552956"><span class="hs-identifier hs-var">nodes</span></a></span><span> </span><span class="annot"><span class="annottext">Map Party (TestHydraClient Tx m) -&gt; Party -&gt; TestHydraClient Tx m
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#%21"><span class="hs-operator hs-var">!</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679552955"><span class="hs-identifier hs-var">party</span></a></span><span>
</span><span id="line-798"></span><span>  </span><span class="annot"><span class="annottext">TestHydraClient Tx m -&gt; RunMonad m ()
forall (m :: * -&gt; *) tx.
MonadDelay m =&gt;
TestHydraClient tx m -&gt; RunMonad m ()
</span><a href="Hydra.Model.html#waitForOpen"><span class="hs-identifier hs-var">waitForOpen</span></a></span><span> </span><span class="annot"><span class="annottext">TestHydraClient Tx m
</span><a href="#local-6989586621679552957"><span class="hs-identifier hs-var">thisNode</span></a></span><span>
</span><span id="line-799"></span><span>  </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679552955"><span class="hs-identifier hs-var">party</span></a></span><span> </span><span class="annot"><span class="annottext">Party -&gt; ClientInput Tx -&gt; RunMonad m ()
forall (m :: * -&gt; *).
(MonadSTM m, MonadThrow m) =&gt;
Party -&gt; ClientInput Tx -&gt; RunMonad m ()
</span><a href="Hydra.Model.html#sendsInput"><span class="hs-operator hs-var">`sendsInput`</span></a></span><span> </span><span class="annot"><span class="annottext">ClientInput Tx
forall tx. ClientInput tx
</span><span class="hs-identifier hs-var">Input.Close</span></span><span>
</span><span id="line-800"></span><span>
</span><span id="line-801"></span><span>  </span><span class="annot"><span class="annottext">m () -&gt; RunMonad m ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; RunMonad m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; RunMonad m ()) -&gt; m () -&gt; RunMonad m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-802"></span><span>    </span><span class="annot"><span class="annottext">[TestHydraClient Tx m] -&gt; (ServerOutput Tx -&gt; Bool) -&gt; m ()
forall tx (m :: * -&gt; *).
(Show (ServerOutput tx), HasCallStack, MonadThrow m, MonadAsync m,
 MonadTimer m) =&gt;
[TestHydraClient tx m] -&gt; (ServerOutput tx -&gt; Bool) -&gt; m ()
</span><a href="Hydra.BehaviorSpec.html#waitUntilMatch"><span class="hs-identifier hs-var">waitUntilMatch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Party (TestHydraClient Tx m) -&gt; [TestHydraClient Tx m]
forall a. Map Party a -&gt; [a]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Foldable.html#toList"><span class="hs-identifier hs-var">toList</span></a></span><span> </span><span class="annot"><span class="annottext">Map Party (TestHydraClient Tx m)
</span><a href="#local-6989586621679552956"><span class="hs-identifier hs-var">nodes</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((ServerOutput Tx -&gt; Bool) -&gt; m ())
-&gt; (ServerOutput Tx -&gt; Bool) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-803"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">HeadIsClosed</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-804"></span><span>      </span><span id="local-6989586621679552960"><span class="annot"><span class="annottext">err :: ServerOutput Tx
</span><a href="#local-6989586621679552960"><span class="hs-identifier hs-var">err</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">CommandFailed</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Bool
forall a t. (HasCallStack, IsText t) =&gt; t -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Bool) -&gt; Text -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ServerOutput Tx -&gt; Text
forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">ServerOutput Tx
</span><a href="#local-6989586621679552960"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-805"></span><span>      </span><span class="annot"><span class="annottext">ServerOutput Tx
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-806"></span><span>
</span><span id="line-807"></span><span id="local-6989586621679550895"><span class="annot"><a href="Hydra.Model.html#performFanout"><span class="hs-identifier hs-type">performFanout</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadThrow</span></span><span> </span><span class="annot"><a href="#local-6989586621679550895"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadAsync</span></span><span> </span><span class="annot"><a href="#local-6989586621679550895"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadDelay</span></span><span> </span><span class="annot"><a href="#local-6989586621679550895"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Party</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hydra.Model.html#RunMonad"><span class="hs-identifier hs-type">RunMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679550895"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span></span><span>
</span><span id="line-808"></span><span id="performFanout"><span class="annot"><span class="annottext">performFanout :: forall (m :: * -&gt; *).
(MonadThrow m, MonadAsync m, MonadDelay m) =&gt;
Party -&gt; RunMonad m (UTxO' (TxOut CtxUTxO Era))
</span><a href="Hydra.Model.html#performFanout"><span class="hs-identifier hs-var hs-var">performFanout</span></a></span></span><span> </span><span id="local-6989586621679552980"><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679552980"><span class="hs-identifier hs-var">party</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-809"></span><span>  </span><span id="local-6989586621679552981"><span class="annot"><span class="annottext">Map Party (TestHydraClient Tx m)
</span><a href="#local-6989586621679552981"><span class="hs-identifier hs-var">nodes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Nodes m -&gt; Map Party (TestHydraClient Tx m))
-&gt; RunMonad m (Map Party (TestHydraClient Tx m))
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/mtl-2.3.1/src/Control.Monad.State.Class.html#gets"><span class="hs-identifier hs-var">gets</span></a></span><span> </span><span class="annot"><span class="annottext">Nodes m -&gt; Map Party (TestHydraClient Tx m)
forall (m :: * -&gt; *). Nodes m -&gt; Map Party (TestHydraClient Tx m)
</span><a href="Hydra.Model.html#%24sel%3Anodes%3ANodes"><span class="hs-identifier hs-var">nodes</span></a></span><span>
</span><span id="line-810"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679552982"><span class="annot"><span class="annottext">thisNode :: TestHydraClient Tx m
</span><a href="#local-6989586621679552982"><span class="hs-identifier hs-var hs-var">thisNode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Party (TestHydraClient Tx m)
</span><a href="#local-6989586621679552981"><span class="hs-identifier hs-var">nodes</span></a></span><span> </span><span class="annot"><span class="annottext">Map Party (TestHydraClient Tx m) -&gt; Party -&gt; TestHydraClient Tx m
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#%21"><span class="hs-operator hs-var">!</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679552980"><span class="hs-identifier hs-var">party</span></a></span><span>
</span><span id="line-811"></span><span>  </span><span class="annot"><span class="annottext">TestHydraClient Tx m -&gt; RunMonad m ()
forall (m :: * -&gt; *) tx.
MonadDelay m =&gt;
TestHydraClient tx m -&gt; RunMonad m ()
</span><a href="Hydra.Model.html#waitForReadyToFanout"><span class="hs-identifier hs-var">waitForReadyToFanout</span></a></span><span> </span><span class="annot"><span class="annottext">TestHydraClient Tx m
</span><a href="#local-6989586621679552982"><span class="hs-identifier hs-var">thisNode</span></a></span><span>
</span><span id="line-812"></span><span>  </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679552980"><span class="hs-identifier hs-var">party</span></a></span><span> </span><span class="annot"><span class="annottext">Party -&gt; ClientInput Tx -&gt; RunMonad m ()
forall (m :: * -&gt; *).
(MonadSTM m, MonadThrow m) =&gt;
Party -&gt; ClientInput Tx -&gt; RunMonad m ()
</span><a href="Hydra.Model.html#sendsInput"><span class="hs-operator hs-var">`sendsInput`</span></a></span><span> </span><span class="annot"><span class="annottext">ClientInput Tx
forall tx. ClientInput tx
</span><span class="hs-identifier hs-var">Input.Fanout</span></span><span>
</span><span id="line-813"></span><span>  </span><span class="annot"><span class="annottext">TestHydraClient Tx m -&gt; Int -&gt; RunMonad m (UTxOType Tx)
forall {t} {t :: (* -&gt; *) -&gt; * -&gt; *} {m :: * -&gt; *} {tx}.
(Eq t, Num t, MonadThrow (t m), MonadTrans t, MonadDelay m) =&gt;
TestHydraClient tx m -&gt; t -&gt; t m (UTxOType tx)
</span><a href="#local-6989586621679552984"><span class="hs-identifier hs-var">findInOutput</span></a></span><span> </span><span class="annot"><span class="annottext">TestHydraClient Tx m
</span><a href="#local-6989586621679552982"><span class="hs-identifier hs-var">thisNode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">100</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-814"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-815"></span><span>  </span><span id="local-6989586621679552984"><span class="annot"><span class="annottext">findInOutput :: TestHydraClient tx m -&gt; t -&gt; t m (UTxOType tx)
</span><a href="#local-6989586621679552984"><span class="hs-identifier hs-var hs-var">findInOutput</span></a></span></span><span> </span><span id="local-6989586621679553041"><span class="annot"><span class="annottext">TestHydraClient tx m
</span><a href="#local-6989586621679553041"><span class="hs-identifier hs-var">node</span></a></span></span><span> </span><span id="local-6989586621679553042"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679553042"><span class="hs-identifier hs-var">n</span></a></span></span><span>
</span><span id="line-816"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679553042"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">t -&gt; t -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; t m (UTxOType tx)
forall (m :: * -&gt; *) a.
(HasCallStack, MonadThrow m) =&gt;
String -&gt; m a
</span><span class="hs-identifier hs-var">failure</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Failed to perform Fanout&quot;</span></span><span>
</span><span id="line-817"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-818"></span><span>        </span><span id="local-6989586621679553043"><span class="annot"><span class="annottext">[ServerOutput tx]
</span><a href="#local-6989586621679553043"><span class="hs-identifier hs-var">outputs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m [ServerOutput tx] -&gt; t m [ServerOutput tx]
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; t m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">(m [ServerOutput tx] -&gt; t m [ServerOutput tx])
-&gt; m [ServerOutput tx] -&gt; t m [ServerOutput tx]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TestHydraClient tx m -&gt; m [ServerOutput tx]
forall tx (m :: * -&gt; *).
TestHydraClient tx m -&gt; m [ServerOutput tx]
</span><a href="Hydra.BehaviorSpec.html#%24sel%3AserverOutputs%3ATestHydraClient"><span class="hs-identifier hs-var">serverOutputs</span></a></span><span> </span><span class="annot"><span class="annottext">TestHydraClient tx m
</span><a href="#local-6989586621679553041"><span class="hs-identifier hs-var">node</span></a></span><span>
</span><span id="line-819"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(ServerOutput tx -&gt; Bool)
-&gt; [ServerOutput tx] -&gt; Maybe (ServerOutput tx)
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Foldable.html#find"><span class="hs-identifier hs-var">find</span></a></span><span> </span><span class="annot"><span class="annottext">ServerOutput tx -&gt; Bool
forall tx. ServerOutput tx -&gt; Bool
</span><a href="#local-6989586621679553044"><span class="hs-identifier hs-var">headIsFinalized</span></a></span><span> </span><span class="annot"><span class="annottext">[ServerOutput tx]
</span><a href="#local-6989586621679553043"><span class="hs-identifier hs-var">outputs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-820"></span><span>          </span><span class="annot"><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">HeadIsFinalized</span></span><span class="hs-special">{</span><span id="local-6989586621679553046"><span class="annot"><span class="annottext">UTxOType tx
$sel:utxo:PeerConnected :: forall tx. ServerOutput tx -&gt; UTxOType tx
utxo :: UTxOType tx
</span><span class="hs-identifier hs-var hs-var">utxo</span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UTxOType tx -&gt; t m (UTxOType tx)
forall a. a -&gt; t m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">UTxOType tx
</span><a href="#local-6989586621679553046"><span class="hs-identifier hs-var">utxo</span></a></span><span>
</span><span id="line-821"></span><span>          </span><span class="annot"><span class="annottext">Maybe (ServerOutput tx)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m () -&gt; t m ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; t m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DiffTime -&gt; m ()
forall (m :: * -&gt; *). MonadDelay m =&gt; DiffTime -&gt; m ()
</span><span class="hs-identifier hs-var">threadDelay</span></span><span> </span><span class="annot"><span class="annottext">DiffTime
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">t m () -&gt; t m (UTxOType tx) -&gt; t m (UTxOType tx)
forall a b. t m a -&gt; t m b -&gt; t m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3E%3E"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TestHydraClient tx m -&gt; t -&gt; t m (UTxOType tx)
</span><a href="#local-6989586621679552984"><span class="hs-identifier hs-var">findInOutput</span></a></span><span> </span><span class="annot"><span class="annottext">TestHydraClient tx m
</span><a href="#local-6989586621679553041"><span class="hs-identifier hs-var">node</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679553042"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">t -&gt; t -&gt; t
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-822"></span><span>  </span><span id="local-6989586621679553044"><span class="annot"><span class="annottext">headIsFinalized :: ServerOutput tx -&gt; Bool
</span><a href="#local-6989586621679553044"><span class="hs-identifier hs-var hs-var">headIsFinalized</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-823"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">HeadIsFinalized</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-824"></span><span>    </span><span id="local-6989586621679553047"><span class="annot"><span class="annottext">ServerOutput tx
</span><a href="#local-6989586621679553047"><span class="hs-identifier hs-var">_otherwise</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-825"></span><span>
</span><span id="line-826"></span><span id="local-6989586621679550911"><span class="annot"><a href="Hydra.Model.html#performCloseWithInitialSnapshot"><span class="hs-identifier hs-type">performCloseWithInitialSnapshot</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadThrow</span></span><span> </span><span class="annot"><a href="#local-6989586621679550911"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadTimer</span></span><span> </span><span class="annot"><a href="#local-6989586621679550911"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadDelay</span></span><span> </span><span class="annot"><a href="#local-6989586621679550911"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadAsync</span></span><span> </span><span class="annot"><a href="#local-6989586621679550911"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Party</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hydra.Model.html#RunMonad"><span class="hs-identifier hs-type">RunMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679550911"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-827"></span><span id="performCloseWithInitialSnapshot"><span class="annot"><span class="annottext">performCloseWithInitialSnapshot :: forall (m :: * -&gt; *).
(MonadThrow m, MonadTimer m, MonadDelay m, MonadAsync m) =&gt;
WorldState -&gt; Party -&gt; RunMonad m ()
</span><a href="Hydra.Model.html#performCloseWithInitialSnapshot"><span class="hs-identifier hs-var hs-var">performCloseWithInitialSnapshot</span></a></span></span><span> </span><span id="local-6989586621679553094"><span class="annot"><span class="annottext">WorldState
</span><a href="#local-6989586621679553094"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span id="local-6989586621679553095"><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679553095"><span class="hs-identifier hs-var">party</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-828"></span><span>  </span><span id="local-6989586621679553096"><span class="annot"><span class="annottext">Map Party (TestHydraClient Tx m)
</span><a href="#local-6989586621679553096"><span class="hs-identifier hs-var">nodes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Nodes m -&gt; Map Party (TestHydraClient Tx m))
-&gt; RunMonad m (Map Party (TestHydraClient Tx m))
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/mtl-2.3.1/src/Control.Monad.State.Class.html#gets"><span class="hs-identifier hs-var">gets</span></a></span><span> </span><span class="annot"><span class="annottext">Nodes m -&gt; Map Party (TestHydraClient Tx m)
forall (m :: * -&gt; *). Nodes m -&gt; Map Party (TestHydraClient Tx m)
</span><a href="Hydra.Model.html#%24sel%3Anodes%3ANodes"><span class="hs-identifier hs-var">nodes</span></a></span><span>
</span><span id="line-829"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679553097"><span class="annot"><span class="annottext">thisNode :: TestHydraClient Tx m
</span><a href="#local-6989586621679553097"><span class="hs-identifier hs-var hs-var">thisNode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Party (TestHydraClient Tx m)
</span><a href="#local-6989586621679553096"><span class="hs-identifier hs-var">nodes</span></a></span><span> </span><span class="annot"><span class="annottext">Map Party (TestHydraClient Tx m) -&gt; Party -&gt; TestHydraClient Tx m
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#%21"><span class="hs-operator hs-var">!</span></a></span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679553095"><span class="hs-identifier hs-var">party</span></a></span><span>
</span><span id="line-830"></span><span>  </span><span class="annot"><span class="annottext">TestHydraClient Tx m -&gt; RunMonad m ()
forall (m :: * -&gt; *) tx.
MonadDelay m =&gt;
TestHydraClient tx m -&gt; RunMonad m ()
</span><a href="Hydra.Model.html#waitForOpen"><span class="hs-identifier hs-var">waitForOpen</span></a></span><span> </span><span class="annot"><span class="annottext">TestHydraClient Tx m
</span><a href="#local-6989586621679553097"><span class="hs-identifier hs-var">thisNode</span></a></span><span>
</span><span id="line-831"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">WorldState -&gt; GlobalState
</span><a href="Hydra.Model.html#%24sel%3AhydraState%3AWorldState"><span class="hs-identifier hs-var">hydraState</span></a></span><span> </span><span class="annot"><span class="annottext">WorldState
</span><a href="#local-6989586621679553094"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-832"></span><span>    </span><span class="annot"><a href="Hydra.Model.html#Open"><span class="hs-identifier hs-type">Open</span></a></span><span class="hs-special">{</span><span id="local-6989586621679553098"><span class="annot"><span class="annottext">Uncommitted
$sel:committed:Start :: GlobalState -&gt; Uncommitted
committed :: Uncommitted
</span><a href="Hydra.Model.html#%24sel%3Acommitted%3AStart"><span class="hs-identifier hs-var hs-var">committed</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-833"></span><span>      </span><span class="annot"><a href="Hydra.BehaviorSpec.html#SimulatedChainNetwork"><span class="hs-identifier hs-type">SimulatedChainNetwork</span></a></span><span class="hs-special">{</span><span id="local-6989586621679553099"><span class="annot"><span class="annottext">(Party, UTxOType Tx) -&gt; m ()
closeWithInitialSnapshot :: (Party, UTxOType Tx) -&gt; m ()
$sel:closeWithInitialSnapshot:SimulatedChainNetwork :: forall tx (m :: * -&gt; *).
SimulatedChainNetwork tx m -&gt; (Party, UTxOType tx) -&gt; m ()
</span><a href="#local-6989586621679553099"><span class="hs-identifier hs-var hs-var">closeWithInitialSnapshot</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Nodes m -&gt; SimulatedChainNetwork Tx m)
-&gt; RunMonad m (SimulatedChainNetwork Tx m)
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/mtl-2.3.1/src/Control.Monad.State.Class.html#gets"><span class="hs-identifier hs-var">gets</span></a></span><span> </span><span class="annot"><span class="annottext">Nodes m -&gt; SimulatedChainNetwork Tx m
forall (m :: * -&gt; *). Nodes m -&gt; SimulatedChainNetwork Tx m
</span><a href="Hydra.Model.html#%24sel%3Achain%3ANodes"><span class="hs-identifier hs-var">chain</span></a></span><span>
</span><span id="line-834"></span><span>      </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m () -&gt; RunMonad m ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; RunMonad m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; RunMonad m ()) -&gt; m () -&gt; RunMonad m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Party, UTxOType Tx) -&gt; m ()
</span><a href="#local-6989586621679553099"><span class="hs-identifier hs-var">closeWithInitialSnapshot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621679553095"><span class="hs-identifier hs-var">party</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UTxOType Payment -&gt; UTxOType Tx
</span><a href="Hydra.Model.html#toRealUTxO"><span class="hs-identifier hs-var">toRealUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">(UTxOType Payment -&gt; UTxOType Tx)
-&gt; UTxOType Payment -&gt; UTxOType Tx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((Party, [(CardanoSigningKey, Value)]) -&gt; UTxOType Payment)
-&gt; [(Party, [(CardanoSigningKey, Value)])] -&gt; UTxOType Payment
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; [a] -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Foldable.html#foldMap"><span class="hs-identifier hs-var">foldMap</span></a></span><span> </span><span class="annot"><span class="annottext">(Party, [(CardanoSigningKey, Value)])
-&gt; [(CardanoSigningKey, Value)]
(Party, [(CardanoSigningKey, Value)]) -&gt; UTxOType Payment
forall a b. (a, b) -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">([(Party, [(CardanoSigningKey, Value)])] -&gt; UTxOType Payment)
-&gt; [(Party, [(CardanoSigningKey, Value)])] -&gt; UTxOType Payment
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Map Party [(CardanoSigningKey, Value)]
-&gt; [(Party, [(CardanoSigningKey, Value)])]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#toList"><span class="hs-identifier hs-var">Map.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Map Party [(CardanoSigningKey, Value)]
Uncommitted
</span><a href="#local-6989586621679553098"><span class="hs-identifier hs-var">committed</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-835"></span><span>      </span><span class="annot"><span class="annottext">m () -&gt; RunMonad m ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; RunMonad m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; RunMonad m ()) -&gt; m () -&gt; RunMonad m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-836"></span><span>        </span><span class="annot"><span class="annottext">[TestHydraClient Tx m] -&gt; (ServerOutput Tx -&gt; Bool) -&gt; m ()
forall tx (m :: * -&gt; *).
(Show (ServerOutput tx), HasCallStack, MonadThrow m, MonadAsync m,
 MonadTimer m) =&gt;
[TestHydraClient tx m] -&gt; (ServerOutput tx -&gt; Bool) -&gt; m ()
</span><a href="Hydra.BehaviorSpec.html#waitUntilMatch"><span class="hs-identifier hs-var">waitUntilMatch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Party (TestHydraClient Tx m) -&gt; [TestHydraClient Tx m]
forall a. Map Party a -&gt; [a]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Foldable.html#toList"><span class="hs-identifier hs-var">toList</span></a></span><span> </span><span class="annot"><span class="annottext">Map Party (TestHydraClient Tx m)
</span><a href="#local-6989586621679553096"><span class="hs-identifier hs-var">nodes</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((ServerOutput Tx -&gt; Bool) -&gt; m ())
-&gt; (ServerOutput Tx -&gt; Bool) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-837"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">HeadIsClosed</span></span><span class="hs-special">{</span><span id="local-6989586621679553101"><span class="annot"><span class="annottext">SnapshotNumber
snapshotNumber :: SnapshotNumber
$sel:snapshotNumber:PeerConnected :: forall tx. ServerOutput tx -&gt; SnapshotNumber
</span><a href="#local-6989586621679553101"><span class="hs-identifier hs-var hs-var">snapshotNumber</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-838"></span><span>            </span><span class="hs-comment">-- we deliberately wait to see close with the initial snapshot</span><span>
</span><span id="line-839"></span><span>            </span><span class="hs-comment">-- here to mimic one node not seeing the confirmed tx</span><span>
</span><span id="line-840"></span><span>            </span><span class="annot"><span class="annottext">SnapshotNumber
</span><a href="#local-6989586621679553101"><span class="hs-identifier hs-var">snapshotNumber</span></a></span><span> </span><span class="annot"><span class="annottext">SnapshotNumber -&gt; SnapshotNumber -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; SnapshotNumber
</span><span class="hs-identifier hs-var">Snapshot.UnsafeSnapshotNumber</span></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span>
</span><span id="line-841"></span><span>          </span><span id="local-6989586621679553104"><span class="annot"><span class="annottext">err :: ServerOutput Tx
</span><a href="#local-6989586621679553104"><span class="hs-identifier hs-var">err</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">CommandFailed</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Bool
forall a t. (HasCallStack, IsText t) =&gt; t -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Bool) -&gt; Text -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ServerOutput Tx -&gt; Text
forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">ServerOutput Tx
</span><a href="#local-6989586621679553104"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-842"></span><span>          </span><span class="annot"><span class="annottext">ServerOutput Tx
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-843"></span><span>    </span><span class="annot"><span class="annottext">GlobalState
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; RunMonad m ()
forall a t. (HasCallStack, IsText t) =&gt; t -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Not in open state&quot;</span></span><span>
</span><span id="line-844"></span><span>
</span><span id="line-845"></span><span id="local-6989586621679550912"><span class="annot"><a href="Hydra.Model.html#performRollbackAndForward"><span class="hs-identifier hs-type">performRollbackAndForward</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadThrow</span></span><span> </span><span class="annot"><a href="#local-6989586621679550912"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadTimer</span></span><span> </span><span class="annot"><a href="#local-6989586621679550912"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-bignum-1.3/src/GHC.Num.Natural.html#Natural"><span class="hs-identifier hs-type">Natural</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hydra.Model.html#RunMonad"><span class="hs-identifier hs-type">RunMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679550912"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-846"></span><span id="performRollbackAndForward"><span class="annot"><span class="annottext">performRollbackAndForward :: forall (m :: * -&gt; *).
(MonadThrow m, MonadTimer m) =&gt;
Natural -&gt; RunMonad m ()
</span><a href="Hydra.Model.html#performRollbackAndForward"><span class="hs-identifier hs-var hs-var">performRollbackAndForward</span></a></span></span><span> </span><span id="local-6989586621679553114"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679553114"><span class="hs-identifier hs-var">numberOfBlocks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-847"></span><span>  </span><span class="annot"><a href="Hydra.BehaviorSpec.html#SimulatedChainNetwork"><span class="hs-identifier hs-type">SimulatedChainNetwork</span></a></span><span class="hs-special">{</span><span id="local-6989586621679553115"><span class="annot"><span class="annottext">Natural -&gt; m ()
rollbackAndForward :: Natural -&gt; m ()
$sel:rollbackAndForward:SimulatedChainNetwork :: forall tx (m :: * -&gt; *).
SimulatedChainNetwork tx m -&gt; Natural -&gt; m ()
</span><a href="#local-6989586621679553115"><span class="hs-identifier hs-var hs-var">rollbackAndForward</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Nodes m -&gt; SimulatedChainNetwork Tx m)
-&gt; RunMonad m (SimulatedChainNetwork Tx m)
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/mtl-2.3.1/src/Control.Monad.State.Class.html#gets"><span class="hs-identifier hs-var">gets</span></a></span><span> </span><span class="annot"><span class="annottext">Nodes m -&gt; SimulatedChainNetwork Tx m
forall (m :: * -&gt; *). Nodes m -&gt; SimulatedChainNetwork Tx m
</span><a href="Hydra.Model.html#%24sel%3Achain%3ANodes"><span class="hs-identifier hs-var">chain</span></a></span><span>
</span><span id="line-848"></span><span>  </span><span class="annot"><span class="annottext">m () -&gt; RunMonad m ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; RunMonad m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; RunMonad m ()) -&gt; m () -&gt; RunMonad m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; m ()
</span><a href="#local-6989586621679553115"><span class="hs-identifier hs-var">rollbackAndForward</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679553114"><span class="hs-identifier hs-var">numberOfBlocks</span></a></span><span>
</span><span id="line-849"></span><span>
</span><span id="line-850"></span><span id="local-6989586621679550913"><span class="annot"><a href="Hydra.Model.html#stopTheWorld"><span class="hs-identifier hs-type">stopTheWorld</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadAsync</span></span><span> </span><span class="annot"><a href="#local-6989586621679550913"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hydra.Model.html#RunMonad"><span class="hs-identifier hs-type">RunMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679550913"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-851"></span><span id="stopTheWorld"><span class="annot"><span class="annottext">stopTheWorld :: forall (m :: * -&gt; *). MonadAsync m =&gt; RunMonad m ()
</span><a href="Hydra.Model.html#stopTheWorld"><span class="hs-identifier hs-var hs-var">stopTheWorld</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-852"></span><span>  </span><span class="annot"><span class="annottext">(Nodes m -&gt; [Async m ()]) -&gt; RunMonad m [Async m ()]
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/mtl-2.3.1/src/Control.Monad.State.Class.html#gets"><span class="hs-identifier hs-var">gets</span></a></span><span> </span><span class="annot"><span class="annottext">Nodes m -&gt; [Async m ()]
forall (m :: * -&gt; *). Nodes m -&gt; [Async m ()]
</span><a href="Hydra.Model.html#%24sel%3Athreads%3ANodes"><span class="hs-identifier hs-var">threads</span></a></span><span> </span><span class="annot"><span class="annottext">RunMonad m [Async m ()]
-&gt; ([Async m ()] -&gt; RunMonad m ()) -&gt; RunMonad m ()
forall a b. RunMonad m a -&gt; (a -&gt; RunMonad m b) -&gt; RunMonad m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">(Async m () -&gt; RunMonad m ()) -&gt; [Async m ()] -&gt; RunMonad m ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">m () -&gt; RunMonad m ()
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; RunMonad m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Class.html#lift"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; RunMonad m ())
-&gt; (Async m () -&gt; m ()) -&gt; Async m () -&gt; RunMonad m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Async m () -&gt; m ()
forall a. Async m a -&gt; m ()
forall (m :: * -&gt; *) a. MonadAsync m =&gt; Async m a -&gt; m ()
</span><span class="hs-identifier hs-var">cancel</span></span><span class="hs-special">)</span><span>
</span><span id="line-853"></span><span>
</span><span id="line-854"></span><span class="annot"><span class="hs-comment">-- ** Utility functions</span></span><span>
</span><span id="line-855"></span><span>
</span><span id="line-856"></span><span class="annot"><span class="hs-comment">-- | Convert payment-style utxos into transaction outputs.</span></span><span>
</span><span id="line-857"></span><span class="annot"><a href="Hydra.Model.html#toTxOuts"><span class="hs-identifier hs-type">toTxOuts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Model.Payment.html#CardanoSigningKey"><span class="hs-identifier hs-type">CardanoSigningKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CtxUTxO</span></span><span class="hs-special">]</span><span>
</span><span id="line-858"></span><span id="toTxOuts"><span class="annot"><span class="annottext">toTxOuts :: [(CardanoSigningKey, Value)] -&gt; [TxOut CtxUTxO Era]
</span><a href="Hydra.Model.html#toTxOuts"><span class="hs-identifier hs-var hs-var">toTxOuts</span></a></span></span><span> </span><span id="local-6989586621679553128"><span class="annot"><span class="annottext">[(CardanoSigningKey, Value)]
</span><a href="#local-6989586621679553128"><span class="hs-identifier hs-var">payments</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-859"></span><span>  </span><span class="annot"><span class="annottext">(CardanoSigningKey -&gt; Value -&gt; TxOut CtxUTxO Era)
-&gt; (CardanoSigningKey, Value) -&gt; TxOut CtxUTxO Era
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Tuple.html#uncurry"><span class="hs-identifier hs-var">uncurry</span></a></span><span> </span><span class="annot"><span class="annottext">CardanoSigningKey -&gt; Value -&gt; TxOut CtxUTxO Era
</span><a href="Hydra.Model.html#mkTxOut"><span class="hs-identifier hs-var">mkTxOut</span></a></span><span> </span><span class="annot"><span class="annottext">((CardanoSigningKey, Value) -&gt; TxOut CtxUTxO Era)
-&gt; [(CardanoSigningKey, Value)] -&gt; [TxOut CtxUTxO Era]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[(CardanoSigningKey, Value)]
</span><a href="#local-6989586621679553128"><span class="hs-identifier hs-var">payments</span></a></span><span>
</span><span id="line-860"></span><span>
</span><span id="line-861"></span><span class="hs-comment">-- | Convert payment-style utxos into real utxos. The 'Payment' tx domain is</span><span>
</span><span id="line-862"></span><span class="hs-comment">-- smaller than UTxO and we map every unique signer + value entry to a mocked</span><span>
</span><span id="line-863"></span><span class="hs-comment">-- 'TxIn' on the real cardano domain.</span><span>
</span><span id="line-864"></span><span class="annot"><a href="Hydra.Model.html#toRealUTxO"><span class="hs-identifier hs-type">toRealUTxO</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTxOType</span></span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html#Payment"><span class="hs-identifier hs-type">Payment</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTxOType</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span>
</span><span id="line-865"></span><span id="toRealUTxO"><span class="annot"><span class="annottext">toRealUTxO :: UTxOType Payment -&gt; UTxOType Tx
</span><a href="Hydra.Model.html#toRealUTxO"><span class="hs-identifier hs-var hs-var">toRealUTxO</span></a></span></span><span> </span><span id="local-6989586621679553132"><span class="annot"><span class="annottext">UTxOType Payment
</span><a href="#local-6989586621679553132"><span class="hs-identifier hs-var">paymentUTxO</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-866"></span><span>  </span><span class="annot"><span class="annottext">[(TxIn, TxOut CtxUTxO Era)] -&gt; UTxO' (TxOut CtxUTxO Era)
forall out. [(TxIn, out)] -&gt; UTxO' out
</span><span class="hs-identifier hs-var">UTxO.fromPairs</span></span><span> </span><span class="annot"><span class="annottext">([(TxIn, TxOut CtxUTxO Era)] -&gt; UTxO' (TxOut CtxUTxO Era))
-&gt; [(TxIn, TxOut CtxUTxO Era)] -&gt; UTxO' (TxOut CtxUTxO Era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-867"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CardanoSigningKey -&gt; Word -&gt; TxIn
</span><a href="Hydra.Model.html#mkMockTxIn"><span class="hs-identifier hs-var">mkMockTxIn</span></a></span><span> </span><span class="annot"><span class="annottext">CardanoSigningKey
</span><a href="#local-6989586621679553135"><span class="hs-identifier hs-var">sk</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679553136"><span class="hs-identifier hs-var">ix</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CardanoSigningKey -&gt; Value -&gt; TxOut CtxUTxO Era
</span><a href="Hydra.Model.html#mkTxOut"><span class="hs-identifier hs-var">mkTxOut</span></a></span><span> </span><span class="annot"><span class="annottext">CardanoSigningKey
</span><a href="#local-6989586621679553135"><span class="hs-identifier hs-var">sk</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679553137"><span class="hs-identifier hs-var">val</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-868"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679553135"><span class="annot"><span class="annottext">CardanoSigningKey
</span><a href="#local-6989586621679553135"><span class="hs-identifier hs-var">sk</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679553138"><span class="annot"><span class="annottext">[Value]
</span><a href="#local-6989586621679553138"><span class="hs-identifier hs-var">vals</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map CardanoSigningKey [Value] -&gt; [(CardanoSigningKey, [Value])]
forall k a. Map k a -&gt; [(k, a)]
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#toList"><span class="hs-identifier hs-var">Map.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Map CardanoSigningKey [Value]
</span><a href="#local-6989586621679553139"><span class="hs-identifier hs-var">skMap</span></a></span><span>
</span><span id="line-869"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679553136"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679553136"><span class="hs-identifier hs-var">ix</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679553137"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679553137"><span class="hs-identifier hs-var">val</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Word] -&gt; [Value] -&gt; [(Word, Value)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Value]
</span><a href="#local-6989586621679553138"><span class="hs-identifier hs-var">vals</span></a></span><span>
</span><span id="line-870"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-871"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-872"></span><span>  </span><span id="local-6989586621679553139"><span class="annot"><span class="annottext">skMap :: Map CardanoSigningKey [Value]
</span><a href="#local-6989586621679553139"><span class="hs-identifier hs-var hs-var">skMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((CardanoSigningKey, Value) -&gt; Map CardanoSigningKey [Value])
-&gt; [(CardanoSigningKey, Value)] -&gt; Map CardanoSigningKey [Value]
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; [a] -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Foldable.html#foldMap"><span class="hs-identifier hs-var">foldMap</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679553140"><span class="annot"><span class="annottext">CardanoSigningKey
</span><a href="#local-6989586621679553140"><span class="hs-identifier hs-var">sk</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679553141"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679553141"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CardanoSigningKey -&gt; [Value] -&gt; Map CardanoSigningKey [Value]
forall k a. k -&gt; a -&gt; Map k a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#singleton"><span class="hs-identifier hs-var">Map.singleton</span></a></span><span> </span><span class="annot"><span class="annottext">CardanoSigningKey
</span><a href="#local-6989586621679553140"><span class="hs-identifier hs-var">sk</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679553141"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(CardanoSigningKey, Value)]
UTxOType Payment
</span><a href="#local-6989586621679553132"><span class="hs-identifier hs-var">paymentUTxO</span></a></span><span>
</span><span id="line-873"></span><span>
</span><span id="line-874"></span><span class="annot"><a href="Hydra.Model.html#mkTxOut"><span class="hs-identifier hs-type">mkTxOut</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html#CardanoSigningKey"><span class="hs-identifier hs-type">CardanoSigningKey</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CtxUTxO</span></span><span>
</span><span id="line-875"></span><span id="mkTxOut"><span class="annot"><span class="annottext">mkTxOut :: CardanoSigningKey -&gt; Value -&gt; TxOut CtxUTxO Era
</span><a href="Hydra.Model.html#mkTxOut"><span class="hs-identifier hs-var hs-var">mkTxOut</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Model.Payment.html#CardanoSigningKey"><span class="hs-identifier hs-type">CardanoSigningKey</span></a></span><span> </span><span id="local-6989586621679553142"><span class="annot"><span class="annottext">SigningKey PaymentKey
</span><a href="#local-6989586621679553142"><span class="hs-identifier hs-var">sk</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679553143"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679553143"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-876"></span><span>  </span><span class="annot"><span class="annottext">AddressInEra
-&gt; Value
-&gt; TxOutDatum CtxUTxO
-&gt; ReferenceScript
-&gt; TxOut CtxUTxO Era
forall ctx.
AddressInEra
-&gt; Value -&gt; TxOutDatum ctx -&gt; ReferenceScript -&gt; TxOut ctx
</span><span class="hs-identifier hs-var">TxOut</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NetworkId -&gt; VerificationKey PaymentKey -&gt; AddressInEra
forall era.
IsShelleyBasedEra era =&gt;
NetworkId -&gt; VerificationKey PaymentKey -&gt; AddressInEra era
</span><span class="hs-identifier hs-var">mkVkAddress</span></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><span class="hs-identifier hs-var">testNetworkId</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SigningKey PaymentKey -&gt; VerificationKey PaymentKey
forall keyrole.
(Key keyrole, HasTypeProxy keyrole) =&gt;
SigningKey keyrole -&gt; VerificationKey keyrole
</span><span class="hs-identifier hs-var">getVerificationKey</span></span><span> </span><span class="annot"><span class="annottext">SigningKey PaymentKey
</span><a href="#local-6989586621679553142"><span class="hs-identifier hs-var">sk</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679553143"><span class="hs-identifier hs-var">val</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutDatum CtxUTxO
forall ctx. TxOutDatum ctx
</span><span class="hs-identifier hs-var">TxOutDatumNone</span></span><span> </span><span class="annot"><span class="annottext">ReferenceScript
</span><span class="hs-identifier hs-var">ReferenceScriptNone</span></span><span>
</span><span id="line-877"></span><span>
</span><span id="line-878"></span><span class="annot"><a href="Hydra.Model.html#mkMockTxIn"><span class="hs-identifier hs-type">mkMockTxIn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html#CardanoSigningKey"><span class="hs-identifier hs-type">CardanoSigningKey</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Word"><span class="hs-identifier hs-type">Word</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxIn</span></span><span>
</span><span id="line-879"></span><span id="mkMockTxIn"><span class="annot"><span class="annottext">mkMockTxIn :: CardanoSigningKey -&gt; Word -&gt; TxIn
</span><a href="Hydra.Model.html#mkMockTxIn"><span class="hs-identifier hs-var hs-var">mkMockTxIn</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Model.Payment.html#CardanoSigningKey"><span class="hs-identifier hs-type">CardanoSigningKey</span></a></span><span> </span><span id="local-6989586621679553147"><span class="annot"><span class="annottext">SigningKey PaymentKey
</span><a href="#local-6989586621679553147"><span class="hs-identifier hs-var">sk</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679553148"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679553148"><span class="hs-identifier hs-var">ix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-880"></span><span>  </span><span class="annot"><span class="annottext">TxId -&gt; TxIx -&gt; TxIn
</span><span class="hs-identifier hs-var">TxIn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Hash StandardCrypto EraIndependentTxBody -&gt; TxId
</span><span class="hs-identifier hs-var">TxId</span></span><span> </span><span class="annot"><span class="annottext">Hash StandardCrypto EraIndependentTxBody
Hash Blake2b_256 EraIndependentTxBody
</span><a href="#local-6989586621679553150"><span class="hs-identifier hs-var">tid</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word -&gt; TxIx
</span><span class="hs-identifier hs-var">TxIx</span></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679553148"><span class="hs-identifier hs-var">ix</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-881"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-882"></span><span>  </span><span id="local-6989586621679553152"><span class="annot"><span class="annottext">vk :: VerificationKey PaymentKey
</span><a href="#local-6989586621679553152"><span class="hs-identifier hs-var hs-var">vk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SigningKey PaymentKey -&gt; VerificationKey PaymentKey
forall keyrole.
(Key keyrole, HasTypeProxy keyrole) =&gt;
SigningKey keyrole -&gt; VerificationKey keyrole
</span><span class="hs-identifier hs-var">getVerificationKey</span></span><span> </span><span class="annot"><span class="annottext">SigningKey PaymentKey
</span><a href="#local-6989586621679553147"><span class="hs-identifier hs-var">sk</span></a></span><span>
</span><span id="line-883"></span><span>  </span><span class="hs-comment">-- NOTE: Ugly, works because both binary representations are 32-byte long.</span><span>
</span><span id="line-884"></span><span>  </span><span id="local-6989586621679553150"><span class="annot"><span class="annottext">tid :: Hash Blake2b_256 EraIndependentTxBody
</span><a href="#local-6989586621679553150"><span class="hs-identifier hs-var hs-var">tid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Hash Blake2b_256 EraIndependentTxBody
forall a. FromCBOR a =&gt; ByteString -&gt; a
</span><span class="hs-identifier hs-var">unsafeDeserialize'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VerificationKey PaymentKey -&gt; ByteString
forall a. ToCBOR a =&gt; a -&gt; ByteString
</span><span class="hs-identifier hs-var">serialize'</span></span><span> </span><span class="annot"><span class="annottext">VerificationKey PaymentKey
</span><a href="#local-6989586621679553152"><span class="hs-identifier hs-var">vk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-885"></span><span>
</span><span id="line-886"></span><span class="hs-comment">-- | Bring `Show` instance in scope drawing it from the `Action` type.</span><span>
</span><span id="line-887"></span><span class="hs-comment">--</span><span>
</span><span id="line-888"></span><span class="hs-comment">-- This is a neat trick to provide `show`able results from action in a context where</span><span>
</span><span id="line-889"></span><span class="hs-comment">-- there's no explicit `Show a` instance, eg. in the `monitoring` and `postcondition`</span><span>
</span><span id="line-890"></span><span class="hs-comment">-- functions. We don't have access to an `a` directly because its value depends on</span><span>
</span><span id="line-891"></span><span class="hs-comment">-- type family `Realized`.</span><span>
</span><span id="line-892"></span><span id="local-6989586621679551064"><span id="local-6989586621679551065"><span class="annot"><a href="Hydra.Model.html#showFromAction"><span class="hs-identifier hs-type">showFromAction</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Show.html#Show"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679551064"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679551065"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Action</span></span><span> </span><span class="annot"><a href="Hydra.Model.html#WorldState"><span class="hs-identifier hs-type">WorldState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679551064"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679551065"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-893"></span><span id="showFromAction"><span class="annot"><span class="annottext">showFromAction :: forall a b. (Show a =&gt; b) -&gt; Action WorldState a -&gt; b
</span><a href="Hydra.Model.html#showFromAction"><span class="hs-identifier hs-var hs-var">showFromAction</span></a></span></span><span> </span><span id="local-6989586621679553154"><span class="annot"><span class="annottext">Show a =&gt; b
</span><a href="#local-6989586621679553154"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-894"></span><span>  </span><span class="annot"><a href="Hydra.Model.html#Seed"><span class="hs-identifier hs-type">Seed</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b
Show a =&gt; b
</span><a href="#local-6989586621679553154"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-895"></span><span>  </span><span class="annot"><a href="Hydra.Model.html#Init"><span class="hs-identifier hs-type">Init</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b
Show a =&gt; b
</span><a href="#local-6989586621679553154"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-896"></span><span>  </span><span class="annot"><a href="Hydra.Model.html#Commit"><span class="hs-identifier hs-type">Commit</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b
Show a =&gt; b
</span><a href="#local-6989586621679553154"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-897"></span><span>  </span><span class="annot"><a href="Hydra.Model.html#Decommit"><span class="hs-identifier hs-type">Decommit</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b
Show a =&gt; b
</span><a href="#local-6989586621679553154"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-898"></span><span>  </span><span class="annot"><a href="Hydra.Model.html#Abort"><span class="hs-identifier hs-type">Abort</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b
Show a =&gt; b
</span><a href="#local-6989586621679553154"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-899"></span><span>  </span><span class="annot"><a href="Hydra.Model.html#Close"><span class="hs-identifier hs-type">Close</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b
Show a =&gt; b
</span><a href="#local-6989586621679553154"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-900"></span><span>  </span><span class="annot"><a href="Hydra.Model.html#Fanout"><span class="hs-identifier hs-type">Fanout</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b
Show a =&gt; b
</span><a href="#local-6989586621679553154"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-901"></span><span>  </span><span class="annot"><a href="Hydra.Model.html#NewTx"><span class="hs-identifier hs-type">NewTx</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b
Show a =&gt; b
</span><a href="#local-6989586621679553154"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-902"></span><span>  </span><span class="annot"><a href="Hydra.Model.html#Wait"><span class="hs-identifier hs-type">Wait</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b
Show a =&gt; b
</span><a href="#local-6989586621679553154"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-903"></span><span>  </span><span class="annot"><a href="Hydra.Model.html#ObserveConfirmedTx"><span class="hs-identifier hs-type">ObserveConfirmedTx</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b
Show a =&gt; b
</span><a href="#local-6989586621679553154"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-904"></span><span>  </span><span class="annot"><a href="Hydra.Model.html#CloseWithInitialSnapshot"><span class="hs-identifier hs-type">CloseWithInitialSnapshot</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b
Show a =&gt; b
</span><a href="#local-6989586621679553154"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-905"></span><span>  </span><span class="annot"><a href="Hydra.Model.html#RollbackAndForward"><span class="hs-identifier hs-type">RollbackAndForward</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b
Show a =&gt; b
</span><a href="#local-6989586621679553154"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-906"></span><span>  </span><span class="annot"><span class="annottext">Action WorldState a
R:ActionWorldStatea a
</span><a href="Hydra.Model.html#StopTheWorld"><span class="hs-identifier hs-var">StopTheWorld</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b
Show a =&gt; b
</span><a href="#local-6989586621679553154"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-907"></span><span>  </span><span class="annot"><span class="annottext">Action WorldState a
R:ActionWorldStatea a
</span><a href="Hydra.Model.html#ObserveHeadIsOpen"><span class="hs-identifier hs-var">ObserveHeadIsOpen</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b
Show a =&gt; b
</span><a href="#local-6989586621679553154"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-908"></span><span>
</span><span id="line-909"></span><span class="annot"><span class="hs-comment">-- | Like '===', but works in PostconditionM.</span></span><span>
</span><span id="line-910"></span><span id="local-6989586621679550872"><span id="local-6989586621679550873"><span class="annot"><a href="Hydra.Model.html#%3D%3D%3D"><span class="hs-operator hs-type">(===)</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-type">Eq</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679550872"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Show.html#Show"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679550872"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#Monad"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679550873"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679550872"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679550872"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PostconditionM</span></span><span> </span><span class="annot"><a href="#local-6989586621679550873"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span></span></span><span>
</span><span id="line-911"></span><span id="local-6989586621679553223"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679553223"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="%3D%3D%3D"><span class="annot"><span class="annottext">=== :: forall a (m :: * -&gt; *).
(Eq a, Show a, Monad m) =&gt;
a -&gt; a -&gt; PostconditionM m Bool
</span><a href="Hydra.Model.html#%3D%3D%3D"><span class="hs-operator hs-var hs-var">===</span></a></span></span><span> </span><span id="local-6989586621679553224"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679553224"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-912"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; PostconditionM m ()
forall (m :: * -&gt; *). Monad m =&gt; String -&gt; PostconditionM m ()
</span><span class="hs-identifier hs-var">counterexamplePost</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; String
forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679553223"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; String
forall {a}. IsString a =&gt; Bool -&gt; a
</span><a href="#local-6989586621679553225"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679553226"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; String
forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679553224"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-913"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; PostconditionM m Bool
forall a. a -&gt; PostconditionM m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679553226"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-914"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-915"></span><span>  </span><span id="local-6989586621679553226"><span class="annot"><span class="annottext">res :: Bool
</span><a href="#local-6989586621679553226"><span class="hs-identifier hs-var hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679553223"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679553224"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-916"></span><span>  </span><span id="local-6989586621679553225"><span class="annot"><span class="annottext">interpret :: Bool -&gt; a
</span><a href="#local-6989586621679553225"><span class="hs-identifier hs-var hs-var">interpret</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-string">&quot;==&quot;</span></span><span>
</span><span id="line-917"></span><span>  </span><span class="annot"><a href="#local-6989586621679553225"><span class="hs-identifier hs-var">interpret</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-string">&quot;/=&quot;</span></span><span>
</span><span id="line-918"></span><span>
</span><span id="line-919"></span><span class="annot"><a href="Hydra.Model.html#waitForUTxOToSpend"><span class="hs-identifier hs-type">waitForUTxOToSpend</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-920"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679550906"><span class="annot"><a href="#local-6989586621679550906"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-921"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadTimer</span></span><span> </span><span class="annot"><a href="#local-6989586621679550906"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadDelay</span></span><span> </span><span class="annot"><a href="#local-6989586621679550906"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-922"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-923"></span><span>  </span><span class="annot"><a href="Hydra.Model.Payment.html#CardanoSigningKey"><span class="hs-identifier hs-type">CardanoSigningKey</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-924"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-925"></span><span>  </span><span class="annot"><a href="Hydra.BehaviorSpec.html#TestHydraClient"><span class="hs-identifier hs-type">TestHydraClient</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span> </span><span class="annot"><a href="#local-6989586621679550906"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-926"></span><span>  </span><span class="annot"><a href="#local-6989586621679550906"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxIn</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CtxUTxO</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-927"></span><span id="waitForUTxOToSpend"><span class="annot"><span class="annottext">waitForUTxOToSpend :: forall (m :: * -&gt; *).
(MonadTimer m, MonadDelay m) =&gt;
UTxO' (TxOut CtxUTxO Era)
-&gt; CardanoSigningKey
-&gt; Value
-&gt; TestHydraClient Tx m
-&gt; m (Either (UTxO' (TxOut CtxUTxO Era)) (TxIn, TxOut CtxUTxO Era))
</span><a href="Hydra.Model.html#waitForUTxOToSpend"><span class="hs-identifier hs-var hs-var">waitForUTxOToSpend</span></a></span></span><span> </span><span id="local-6989586621679553255"><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era)
</span><a href="#local-6989586621679553255"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span id="local-6989586621679553256"><span class="annot"><span class="annottext">CardanoSigningKey
</span><a href="#local-6989586621679553256"><span class="hs-identifier hs-var">key</span></a></span></span><span> </span><span id="local-6989586621679553257"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679553257"><span class="hs-identifier hs-var">value</span></a></span></span><span> </span><span id="local-6989586621679553258"><span class="annot"><span class="annottext">TestHydraClient Tx m
</span><a href="#local-6989586621679553258"><span class="hs-identifier hs-var">node</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; m (Either (UTxO' (TxOut CtxUTxO Era)) (TxIn, TxOut CtxUTxO Era))
</span><a href="#local-6989586621679553259"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">100</span></span><span>
</span><span id="line-928"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-929"></span><span>  </span><span class="annot"><a href="#local-6989586621679553259"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Int"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679550906"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxIn</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CtxUTxO</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-930"></span><span>  </span><span id="local-6989586621679553259"><span class="annot"><span class="annottext">go :: Int
-&gt; m (Either (UTxO' (TxOut CtxUTxO Era)) (TxIn, TxOut CtxUTxO Era))
</span><a href="#local-6989586621679553259"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-931"></span><span>    </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-932"></span><span>      </span><span class="annot"><span class="annottext">Either (UTxO' (TxOut CtxUTxO Era)) (TxIn, TxOut CtxUTxO Era)
-&gt; m (Either (UTxO' (TxOut CtxUTxO Era)) (TxIn, TxOut CtxUTxO Era))
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Either (UTxO' (TxOut CtxUTxO Era)) (TxIn, TxOut CtxUTxO Era)
 -&gt; m (Either
         (UTxO' (TxOut CtxUTxO Era)) (TxIn, TxOut CtxUTxO Era)))
-&gt; Either (UTxO' (TxOut CtxUTxO Era)) (TxIn, TxOut CtxUTxO Era)
-&gt; m (Either (UTxO' (TxOut CtxUTxO Era)) (TxIn, TxOut CtxUTxO Era))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era)
-&gt; Either (UTxO' (TxOut CtxUTxO Era)) (TxIn, TxOut CtxUTxO Era)
forall a b. a -&gt; Either a b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era)
</span><a href="#local-6989586621679553255"><span class="hs-identifier hs-var">utxo</span></a></span><span>
</span><span id="line-933"></span><span>    </span><span id="local-6989586621679553260"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679553260"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-934"></span><span>      </span><span class="annot"><span class="annottext">TestHydraClient Tx m
</span><a href="#local-6989586621679553258"><span class="hs-identifier hs-var">node</span></a></span><span> </span><span class="annot"><span class="annottext">TestHydraClient Tx m -&gt; ClientInput Tx -&gt; m ()
forall tx (m :: * -&gt; *).
TestHydraClient tx m -&gt; ClientInput tx -&gt; m ()
</span><a href="Hydra.BehaviorSpec.html#%24sel%3Asend%3ATestHydraClient"><span class="hs-operator hs-var">`send`</span></a></span><span> </span><span class="annot"><span class="annottext">ClientInput Tx
forall tx. ClientInput tx
</span><span class="hs-identifier hs-var">Input.GetUTxO</span></span><span>
</span><span id="line-935"></span><span>      </span><span class="annot"><span class="annottext">DiffTime -&gt; m ()
forall (m :: * -&gt; *). MonadDelay m =&gt; DiffTime -&gt; m ()
</span><span class="hs-identifier hs-var">threadDelay</span></span><span> </span><span class="annot"><span class="annottext">DiffTime
</span><span class="hs-number">5</span></span><span>
</span><span id="line-936"></span><span>      </span><span class="annot"><span class="annottext">DiffTime -&gt; m (ServerOutput Tx) -&gt; m (Maybe (ServerOutput Tx))
forall a. DiffTime -&gt; m a -&gt; m (Maybe a)
forall (m :: * -&gt; *) a.
MonadTimer m =&gt;
DiffTime -&gt; m a -&gt; m (Maybe a)
</span><span class="hs-identifier hs-var">timeout</span></span><span> </span><span class="annot"><span class="annottext">DiffTime
</span><span class="hs-number">10</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TestHydraClient Tx m -&gt; m (ServerOutput Tx)
forall tx (m :: * -&gt; *).
TestHydraClient tx m -&gt; m (ServerOutput tx)
</span><a href="Hydra.BehaviorSpec.html#%24sel%3AwaitForNext%3ATestHydraClient"><span class="hs-identifier hs-var">waitForNext</span></a></span><span> </span><span class="annot"><span class="annottext">TestHydraClient Tx m
</span><a href="#local-6989586621679553258"><span class="hs-identifier hs-var">node</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">m (Maybe (ServerOutput Tx))
-&gt; (Maybe (ServerOutput Tx)
    -&gt; m (Either
            (UTxO' (TxOut CtxUTxO Era)) (TxIn, TxOut CtxUTxO Era)))
-&gt; m (Either (UTxO' (TxOut CtxUTxO Era)) (TxIn, TxOut CtxUTxO Era))
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-937"></span><span>        </span><span class="annot"><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">GetUTxOResponse</span></span><span> </span><span class="annot"><span class="annottext">HeadId
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679553265"><span class="annot"><span class="annottext">UTxOType Tx
</span><a href="#local-6989586621679553265"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-938"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era)
UTxOType Tx
</span><a href="#local-6989586621679553265"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era) -&gt; UTxO' (TxOut CtxUTxO Era) -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%2F%3D"><span class="hs-operator hs-var">/=</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era)
forall a. Monoid a =&gt; a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#mempty"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-939"></span><span>              </span><span class="annot"><span class="annottext">m (Either (UTxO' (TxOut CtxUTxO Era)) (TxIn, TxOut CtxUTxO Era))
-&gt; ((TxIn, TxOut CtxUTxO Era)
    -&gt; m (Either
            (UTxO' (TxOut CtxUTxO Era)) (TxIn, TxOut CtxUTxO Era)))
-&gt; Maybe (TxIn, TxOut CtxUTxO Era)
-&gt; m (Either (UTxO' (TxOut CtxUTxO Era)) (TxIn, TxOut CtxUTxO Era))
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Maybe.html#maybe"><span class="hs-identifier hs-var">maybe</span></a></span><span>
</span><span id="line-940"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
-&gt; m (Either (UTxO' (TxOut CtxUTxO Era)) (TxIn, TxOut CtxUTxO Era))
</span><a href="#local-6989586621679553259"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679553260"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-941"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Either (UTxO' (TxOut CtxUTxO Era)) (TxIn, TxOut CtxUTxO Era)
-&gt; m (Either (UTxO' (TxOut CtxUTxO Era)) (TxIn, TxOut CtxUTxO Era))
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Either (UTxO' (TxOut CtxUTxO Era)) (TxIn, TxOut CtxUTxO Era)
 -&gt; m (Either
         (UTxO' (TxOut CtxUTxO Era)) (TxIn, TxOut CtxUTxO Era)))
-&gt; ((TxIn, TxOut CtxUTxO Era)
    -&gt; Either (UTxO' (TxOut CtxUTxO Era)) (TxIn, TxOut CtxUTxO Era))
-&gt; (TxIn, TxOut CtxUTxO Era)
-&gt; m (Either (UTxO' (TxOut CtxUTxO Era)) (TxIn, TxOut CtxUTxO Era))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(TxIn, TxOut CtxUTxO Era)
-&gt; Either (UTxO' (TxOut CtxUTxO Era)) (TxIn, TxOut CtxUTxO Era)
forall a b. b -&gt; Either a b
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-942"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((TxIn, TxOut CtxUTxO Era) -&gt; Bool)
-&gt; [(TxIn, TxOut CtxUTxO Era)] -&gt; Maybe (TxIn, TxOut CtxUTxO Era)
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Foldable.html#find"><span class="hs-identifier hs-var">find</span></a></span><span> </span><span class="annot"><span class="annottext">(TxIn, TxOut CtxUTxO Era) -&gt; Bool
</span><a href="#local-6989586621679553267"><span class="hs-identifier hs-var">matchPayment</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era) -&gt; [(TxIn, TxOut CtxUTxO Era)]
forall out. UTxO' out -&gt; [(TxIn, out)]
</span><span class="hs-identifier hs-var">UTxO.pairs</span></span><span> </span><span class="annot"><span class="annottext">UTxO' (TxOut CtxUTxO Era)
UTxOType Tx
</span><a href="#local-6989586621679553265"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-943"></span><span>        </span><span class="annot"><span class="annottext">Maybe (ServerOutput Tx)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; m (Either (UTxO' (TxOut CtxUTxO Era)) (TxIn, TxOut CtxUTxO Era))
</span><a href="#local-6989586621679553259"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679553260"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-944"></span><span>
</span><span id="line-945"></span><span>  </span><span id="local-6989586621679553267"><span class="annot"><span class="annottext">matchPayment :: (TxIn, TxOut CtxUTxO Era) -&gt; Bool
</span><a href="#local-6989586621679553267"><span class="hs-identifier hs-var hs-var">matchPayment</span></a></span></span><span> </span><span id="local-6989586621679553268"><span class="annot"><span class="annottext">p :: (TxIn, TxOut CtxUTxO Era)
</span><a href="#local-6989586621679553268"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679553269"><span class="annot"><span class="annottext">TxOut CtxUTxO Era
</span><a href="#local-6989586621679553269"><span class="hs-identifier hs-var">txOut</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-946"></span><span>    </span><span class="annot"><span class="annottext">CardanoSigningKey -&gt; (TxIn, TxOut CtxUTxO Era) -&gt; Bool
forall ctx. CardanoSigningKey -&gt; (TxIn, TxOut ctx) -&gt; Bool
</span><a href="Hydra.Model.html#isOwned"><span class="hs-identifier hs-var">isOwned</span></a></span><span> </span><span class="annot"><span class="annottext">CardanoSigningKey
</span><a href="#local-6989586621679553256"><span class="hs-identifier hs-var">key</span></a></span><span> </span><span class="annot"><span class="annottext">(TxIn, TxOut CtxUTxO Era)
</span><a href="#local-6989586621679553268"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679553257"><span class="hs-identifier hs-var">value</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO Era -&gt; Value
forall ctx. TxOut ctx -&gt; Value
</span><span class="hs-identifier hs-var">txOutValue</span></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO Era
</span><a href="#local-6989586621679553269"><span class="hs-identifier hs-var">txOut</span></a></span><span>
</span><span id="line-947"></span><span>
</span><span id="line-948"></span><span id="local-6989586621679551080"><span class="annot"><a href="Hydra.Model.html#isOwned"><span class="hs-identifier hs-type">isOwned</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Model.Payment.html#CardanoSigningKey"><span class="hs-identifier hs-type">CardanoSigningKey</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxIn</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="annot"><a href="#local-6989586621679551080"><span class="hs-identifier hs-type">ctx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span></span><span>
</span><span id="line-949"></span><span id="isOwned"><span class="annot"><span class="annottext">isOwned :: forall ctx. CardanoSigningKey -&gt; (TxIn, TxOut ctx) -&gt; Bool
</span><a href="Hydra.Model.html#isOwned"><span class="hs-identifier hs-var hs-var">isOwned</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hydra.Model.Payment.html#CardanoSigningKey"><span class="hs-identifier hs-type">CardanoSigningKey</span></a></span><span> </span><span id="local-6989586621679553272"><span class="annot"><span class="annottext">SigningKey PaymentKey
</span><a href="#local-6989586621679553272"><span class="hs-identifier hs-var">sk</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span class="hs-special">{</span><span class="annot"><span class="annottext">txOutAddress :: forall ctx. TxOut ctx -&gt; AddressInEra
</span><span class="hs-identifier hs-var">txOutAddress</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ShelleyAddressInEra</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ShelleyAddress</span></span><span> </span><span class="annot"><span class="annottext">Network
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679553281"><span class="annot"><span class="annottext">PaymentCredential StandardCrypto
</span><a href="#local-6989586621679553281"><span class="hs-identifier hs-var">cre</span></a></span></span><span> </span><span class="annot"><span class="annottext">StakeReference StandardCrypto
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-950"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PaymentCredential StandardCrypto -&gt; PaymentCredential
</span><span class="hs-identifier hs-var">fromShelleyPaymentCredential</span></span><span> </span><span class="annot"><span class="annottext">PaymentCredential StandardCrypto
</span><a href="#local-6989586621679553281"><span class="hs-identifier hs-var">cre</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-951"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PaymentCredentialByKey</span></span><span> </span><span id="local-6989586621679553283"><span class="annot"><span class="annottext">Hash PaymentKey
</span><a href="#local-6989586621679553283"><span class="hs-identifier hs-var">ha</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">VerificationKey PaymentKey -&gt; Hash PaymentKey
forall keyrole.
Key keyrole =&gt;
VerificationKey keyrole -&gt; Hash keyrole
</span><span class="hs-identifier hs-var">verificationKeyHash</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SigningKey PaymentKey -&gt; VerificationKey PaymentKey
forall keyrole.
(Key keyrole, HasTypeProxy keyrole) =&gt;
SigningKey keyrole -&gt; VerificationKey keyrole
</span><span class="hs-identifier hs-var">getVerificationKey</span></span><span> </span><span class="annot"><span class="annottext">SigningKey PaymentKey
</span><a href="#local-6989586621679553272"><span class="hs-identifier hs-var">sk</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Hash PaymentKey -&gt; Hash PaymentKey -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Hash PaymentKey
</span><a href="#local-6989586621679553283"><span class="hs-identifier hs-var">ha</span></a></span><span>
</span><span id="line-952"></span><span>    </span><span class="annot"><span class="annottext">PaymentCredential
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-953"></span><span class="annot"><a href="Hydra.Model.html#isOwned"><span class="hs-identifier hs-var">isOwned</span></a></span><span> </span><span class="annot"><span class="annottext">CardanoSigningKey
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">(TxIn, TxOut ctx)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-954"></span><span>
</span><span id="line-955"></span><span id="local-6989586621679550910"><span class="annot"><a href="Hydra.Model.html#headIsOpen"><span class="hs-identifier hs-type">headIsOpen</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ServerOutput</span></span><span> </span><span class="annot"><a href="#local-6989586621679550910"><span class="hs-identifier hs-type">tx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span></span><span>
</span><span id="line-956"></span><span id="headIsOpen"><span class="annot"><span class="annottext">headIsOpen :: forall tx. ServerOutput tx -&gt; Bool
</span><a href="Hydra.Model.html#headIsOpen"><span class="hs-identifier hs-var hs-var">headIsOpen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-957"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">HeadIsOpen</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-958"></span><span>  </span><span id="local-6989586621679553286"><span class="annot"><span class="annottext">ServerOutput tx
</span><a href="#local-6989586621679553286"><span class="hs-identifier hs-var">_otherwise</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-959"></span><span>
</span><span id="line-960"></span><span id="local-6989586621679553287"><span class="annot"><a href="Hydra.Model.html#headIsReadyToFanout"><span class="hs-identifier hs-type">headIsReadyToFanout</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ServerOutput</span></span><span> </span><span class="annot"><a href="#local-6989586621679553287"><span class="hs-identifier hs-type">tx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span></span><span>
</span><span id="line-961"></span><span id="headIsReadyToFanout"><span class="annot"><span class="annottext">headIsReadyToFanout :: forall tx. ServerOutput tx -&gt; Bool
</span><a href="Hydra.Model.html#headIsReadyToFanout"><span class="hs-identifier hs-var hs-var">headIsReadyToFanout</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-962"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">ReadyToFanout</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#True"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-963"></span><span>  </span><span id="local-6989586621679553289"><span class="annot"><span class="annottext">ServerOutput tx
</span><a href="#local-6989586621679553289"><span class="hs-identifier hs-var">_otherwise</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/pqpbfdxf2whidgls6zlh21rmwffz2vnd-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-964"></span></pre></body></html>