<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE AllowAmbiguousTypes #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DuplicateRecordFields #-}</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-comment">-- | Smart constructors for creating Hydra protocol transactions to be used in</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- the 'Hydra.Chain.Direct' way of talking to the main-chain.</span><span>
</span><span id="line-6"></span><span class="hs-comment">--</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- This module also encapsulates the transaction format used when talking to the</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- cardano-node, which is currently different from the 'Hydra.Ledger.Cardano',</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- thus we have not yet &quot;reached&quot; 'isomorphism'.</span><span>
</span><span id="line-10"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Hydra.Chain.Direct.Tx</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-11"></span><span>  </span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html"><span class="hs-identifier">Hydra.Chain.Direct.Tx</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Cardano.Api</span></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Foldable.html#toList"><span class="hs-identifier">toList</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Api.UTxO</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">UTxO</span></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Aeson</span></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/bytestring-0.11.5.3/src/Data.ByteString.html"><span class="hs-identifier">Data.ByteString</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BS</span></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.IsList.html"><span class="hs-identifier">GHC.IsList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.IsList.html#IsList"><span class="hs-identifier">IsList</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Contract.Commit</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Commit</span></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Contract.Deposit</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Deposit</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Contract.Head</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Head</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Contract.HeadState</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Head</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Contract.HeadTokens</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HeadTokens</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Data.ContestationPeriod</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">OnChain</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Data.Party</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">OnChain</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Plutus</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">commitValidatorScript</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">depositValidatorScript</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">initialValidatorScript</span></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Plutus.Extras</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">posixToUTCTime</span></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Plutus.Orphans</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Tx</span></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-32"></span><span>  </span><span class="annot"><span class="hs-identifier">HeadId</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>  </span><span class="annot"><span class="hs-identifier">HeadSeed</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>  </span><span class="annot"><span class="hs-identifier">Party</span></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>  </span><span class="annot"><span class="hs-identifier">SnapshotNumber</span></span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>  </span><span class="annot"><span class="hs-identifier">SnapshotVersion</span></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>  </span><span class="annot"><span class="hs-identifier">fromChainSnapshotNumber</span></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>  </span><span class="annot"><span class="hs-identifier">fromChainSnapshotVersion</span></span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>  </span><span class="annot"><span class="hs-identifier">headIdToCurrencySymbol</span></span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span>  </span><span class="annot"><span class="hs-identifier">mkHeadId</span></span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>  </span><span class="annot"><span class="hs-identifier">partyFromChain</span></span><span class="hs-special">,</span><span>
</span><span id="line-42"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Tx.Close</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">OpenThreadOutput</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Tx.Contest</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ClosedThreadOutput</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Tx.ContestationPeriod</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ContestationPeriod</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">fromChain</span></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Tx.Deposit</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">DepositObservation</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">observeDepositTx</span></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Tx.OnChainId</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">OnChainId</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Tx.Recover</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">RecoverObservation</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">observeRecoverTx</span></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Hydra.Tx.Utils</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">assetNameToOnChainId</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">findFirst</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">hydraHeadV1AssetName</span></span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusLedgerApi.V3</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">CurrencySymbol</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">fromBuiltin</span></span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusLedgerApi.V3</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Plutus</span></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Test.Hydra.Tx.Gen</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Test.QuickCheck</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">vectorOf</span></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span class="annot"><span class="hs-comment">-- | Needed on-chain data to create Head transactions.</span></span><span>
</span><span id="line-56"></span><span class="hs-keyword">type</span><span> </span><span id="UTxOWithScript"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#UTxOWithScript"><span class="hs-identifier hs-var">UTxOWithScript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxIn</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CtxUTxO</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HashableScriptData</span></span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span>
</span><span id="line-58"></span><span class="hs-keyword">newtype</span><span> </span><span id="UTxOHash"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#UTxOHash"><span class="hs-identifier hs-var">UTxOHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="UTxOHash"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#UTxOHash"><span class="hs-identifier hs-var">UTxOHash</span></a></span></span><span> </span><span class="annot"><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/bytestring-0.11.5.3/src/Data.ByteString.Internal.Type.html#ByteString"><span class="hs-identifier hs-type">ByteString</span></a></span><span>
</span><span id="line-59"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680178675"><span id="local-6989586621680178679"><span class="annot"><span class="annottext">UTxOHash -&gt; UTxOHash -&gt; Bool
(UTxOHash -&gt; UTxOHash -&gt; Bool)
-&gt; (UTxOHash -&gt; UTxOHash -&gt; Bool) -&gt; Eq UTxOHash
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: UTxOHash -&gt; UTxOHash -&gt; Bool
== :: UTxOHash -&gt; UTxOHash -&gt; Bool
$c/= :: UTxOHash -&gt; UTxOHash -&gt; Bool
/= :: UTxOHash -&gt; UTxOHash -&gt; Bool
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680178684"><span id="local-6989586621680178690"><span id="local-6989586621680178694"><span class="annot"><span class="annottext">Int -&gt; UTxOHash -&gt; ShowS
[UTxOHash] -&gt; ShowS
UTxOHash -&gt; String
(Int -&gt; UTxOHash -&gt; ShowS)
-&gt; (UTxOHash -&gt; String) -&gt; ([UTxOHash] -&gt; ShowS) -&gt; Show UTxOHash
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; UTxOHash -&gt; ShowS
showsPrec :: Int -&gt; UTxOHash -&gt; ShowS
$cshow :: UTxOHash -&gt; String
show :: UTxOHash -&gt; String
$cshowList :: [UTxOHash] -&gt; ShowS
showList :: [UTxOHash] -&gt; ShowS
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680178698"><span id="local-6989586621680178700"><span class="annot"><span class="annottext">(forall x. UTxOHash -&gt; Rep UTxOHash x)
-&gt; (forall x. Rep UTxOHash x -&gt; UTxOHash) -&gt; Generic UTxOHash
forall x. Rep UTxOHash x -&gt; UTxOHash
forall x. UTxOHash -&gt; Rep UTxOHash x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. UTxOHash -&gt; Rep UTxOHash x
from :: forall x. UTxOHash -&gt; Rep UTxOHash x
$cto :: forall x. Rep UTxOHash x -&gt; UTxOHash
to :: forall x. Rep UTxOHash x -&gt; UTxOHash
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Generics.html#Generic"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680178705"><span class="annot"><span class="hs-identifier hs-type">Arbitrary</span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#UTxOHash"><span class="hs-identifier hs-type">UTxOHash</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-62"></span><span>  </span><span id="local-6989586621680178713"><span class="annot"><span class="annottext">arbitrary :: Gen UTxOHash
</span><a href="#local-6989586621680178713"><span class="hs-identifier hs-var hs-var hs-var hs-var">arbitrary</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; UTxOHash
</span><a href="Hydra.Chain.Direct.Tx.html#UTxOHash"><span class="hs-identifier hs-var">UTxOHash</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; UTxOHash)
-&gt; ([Word8] -&gt; ByteString) -&gt; [Word8] -&gt; UTxOHash
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[Word8] -&gt; ByteString
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/bytestring-0.11.5.3/src/Data.ByteString.html#pack"><span class="hs-identifier hs-var">BS.pack</span></a></span><span> </span><span class="annot"><span class="annottext">([Word8] -&gt; UTxOHash) -&gt; Gen [Word8] -&gt; Gen UTxOHash
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Gen Word8 -&gt; Gen [Word8]
forall a. Int -&gt; Gen a -&gt; Gen [a]
</span><span class="hs-identifier hs-var">vectorOf</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">32</span></span><span> </span><span class="annot"><span class="annottext">Gen Word8
forall a. Arbitrary a =&gt; Gen a
</span><span class="hs-identifier hs-var">arbitrary</span></span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span class="annot"><span class="hs-comment">-- | Representation of the Head output after an Init transaction.</span></span><span>
</span><span id="line-65"></span><span class="hs-keyword">data</span><span> </span><span id="InitialThreadOutput"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#InitialThreadOutput"><span class="hs-identifier hs-var">InitialThreadOutput</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="InitialThreadOutput"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#InitialThreadOutput"><span class="hs-identifier hs-var">InitialThreadOutput</span></a></span></span><span>
</span><span id="line-66"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AinitialThreadUTxO%3AInitialThreadOutput"><span class="annot"><span class="annottext">InitialThreadOutput -&gt; (TxIn, TxOut CtxUTxO)
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AinitialThreadUTxO%3AInitialThreadOutput"><span class="hs-identifier hs-var hs-var">initialThreadUTxO</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxIn</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CtxUTxO</span></span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AinitialContestationPeriod%3AInitialThreadOutput"><span class="annot"><span class="annottext">InitialThreadOutput -&gt; ContestationPeriod
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AinitialContestationPeriod%3AInitialThreadOutput"><span class="hs-identifier hs-var hs-var">initialContestationPeriod</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">OnChain.ContestationPeriod</span></span><span>
</span><span id="line-68"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AinitialParties%3AInitialThreadOutput"><span class="annot"><span class="annottext">InitialThreadOutput -&gt; [Party]
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AinitialParties%3AInitialThreadOutput"><span class="hs-identifier hs-var hs-var">initialParties</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">OnChain.Party</span></span><span class="hs-special">]</span><span>
</span><span id="line-69"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-70"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680178723"><span id="local-6989586621680178734"><span class="annot"><span class="annottext">InitialThreadOutput -&gt; InitialThreadOutput -&gt; Bool
(InitialThreadOutput -&gt; InitialThreadOutput -&gt; Bool)
-&gt; (InitialThreadOutput -&gt; InitialThreadOutput -&gt; Bool)
-&gt; Eq InitialThreadOutput
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: InitialThreadOutput -&gt; InitialThreadOutput -&gt; Bool
== :: InitialThreadOutput -&gt; InitialThreadOutput -&gt; Bool
$c/= :: InitialThreadOutput -&gt; InitialThreadOutput -&gt; Bool
/= :: InitialThreadOutput -&gt; InitialThreadOutput -&gt; Bool
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680178741"><span id="local-6989586621680178753"><span id="local-6989586621680178757"><span class="annot"><span class="annottext">Int -&gt; InitialThreadOutput -&gt; ShowS
[InitialThreadOutput] -&gt; ShowS
InitialThreadOutput -&gt; String
(Int -&gt; InitialThreadOutput -&gt; ShowS)
-&gt; (InitialThreadOutput -&gt; String)
-&gt; ([InitialThreadOutput] -&gt; ShowS)
-&gt; Show InitialThreadOutput
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; InitialThreadOutput -&gt; ShowS
showsPrec :: Int -&gt; InitialThreadOutput -&gt; ShowS
$cshow :: InitialThreadOutput -&gt; String
show :: InitialThreadOutput -&gt; String
$cshowList :: [InitialThreadOutput] -&gt; ShowS
showList :: [InitialThreadOutput] -&gt; ShowS
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680178763"><span id="local-6989586621680178765"><span class="annot"><span class="annottext">(forall x. InitialThreadOutput -&gt; Rep InitialThreadOutput x)
-&gt; (forall x. Rep InitialThreadOutput x -&gt; InitialThreadOutput)
-&gt; Generic InitialThreadOutput
forall x. Rep InitialThreadOutput x -&gt; InitialThreadOutput
forall x. InitialThreadOutput -&gt; Rep InitialThreadOutput x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. InitialThreadOutput -&gt; Rep InitialThreadOutput x
from :: forall x. InitialThreadOutput -&gt; Rep InitialThreadOutput x
$cto :: forall x. Rep InitialThreadOutput x -&gt; InitialThreadOutput
to :: forall x. Rep InitialThreadOutput x -&gt; InitialThreadOutput
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Generics.html#Generic"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span class="annot"><span class="hs-comment">-- * Observe Hydra Head transactions</span></span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span class="annot"><span class="hs-comment">-- | Generalised type for arbitrary Head observations on-chain.</span></span><span>
</span><span id="line-75"></span><span class="hs-keyword">data</span><span> </span><span id="HeadObservation"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#HeadObservation"><span class="hs-identifier hs-var">HeadObservation</span></a></span></span><span>
</span><span id="line-76"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="NoHeadTx"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#NoHeadTx"><span class="hs-identifier hs-var">NoHeadTx</span></a></span></span><span>
</span><span id="line-77"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Init"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#Init"><span class="hs-identifier hs-var">Init</span></a></span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#InitObservation"><span class="hs-identifier hs-type">InitObservation</span></a></span><span>
</span><span id="line-78"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Abort"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#Abort"><span class="hs-identifier hs-var">Abort</span></a></span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#AbortObservation"><span class="hs-identifier hs-type">AbortObservation</span></a></span><span>
</span><span id="line-79"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Commit"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#Commit"><span class="hs-identifier hs-var">Commit</span></a></span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CommitObservation"><span class="hs-identifier hs-type">CommitObservation</span></a></span><span>
</span><span id="line-80"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="CollectCom"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CollectCom"><span class="hs-identifier hs-var">CollectCom</span></a></span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CollectComObservation"><span class="hs-identifier hs-type">CollectComObservation</span></a></span><span>
</span><span id="line-81"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Deposit"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#Deposit"><span class="hs-identifier hs-var">Deposit</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DepositObservation</span></span><span>
</span><span id="line-82"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Recover"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#Recover"><span class="hs-identifier hs-var">Recover</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">RecoverObservation</span></span><span>
</span><span id="line-83"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Increment"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#Increment"><span class="hs-identifier hs-var">Increment</span></a></span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#IncrementObservation"><span class="hs-identifier hs-type">IncrementObservation</span></a></span><span>
</span><span id="line-84"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Decrement"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#Decrement"><span class="hs-identifier hs-var">Decrement</span></a></span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#DecrementObservation"><span class="hs-identifier hs-type">DecrementObservation</span></a></span><span>
</span><span id="line-85"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Close"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#Close"><span class="hs-identifier hs-var">Close</span></a></span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CloseObservation"><span class="hs-identifier hs-type">CloseObservation</span></a></span><span>
</span><span id="line-86"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Contest"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#Contest"><span class="hs-identifier hs-var">Contest</span></a></span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#ContestObservation"><span class="hs-identifier hs-type">ContestObservation</span></a></span><span>
</span><span id="line-87"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Fanout"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#Fanout"><span class="hs-identifier hs-var">Fanout</span></a></span></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#FanoutObservation"><span class="hs-identifier hs-type">FanoutObservation</span></a></span><span>
</span><span id="line-88"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680178780"><span id="local-6989586621680178804"><span class="annot"><span class="annottext">HeadObservation -&gt; HeadObservation -&gt; Bool
(HeadObservation -&gt; HeadObservation -&gt; Bool)
-&gt; (HeadObservation -&gt; HeadObservation -&gt; Bool)
-&gt; Eq HeadObservation
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: HeadObservation -&gt; HeadObservation -&gt; Bool
== :: HeadObservation -&gt; HeadObservation -&gt; Bool
$c/= :: HeadObservation -&gt; HeadObservation -&gt; Bool
/= :: HeadObservation -&gt; HeadObservation -&gt; Bool
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680178808"><span id="local-6989586621680178843"><span id="local-6989586621680178847"><span class="annot"><span class="annottext">Int -&gt; HeadObservation -&gt; ShowS
[HeadObservation] -&gt; ShowS
HeadObservation -&gt; String
(Int -&gt; HeadObservation -&gt; ShowS)
-&gt; (HeadObservation -&gt; String)
-&gt; ([HeadObservation] -&gt; ShowS)
-&gt; Show HeadObservation
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; HeadObservation -&gt; ShowS
showsPrec :: Int -&gt; HeadObservation -&gt; ShowS
$cshow :: HeadObservation -&gt; String
show :: HeadObservation -&gt; String
$cshowList :: [HeadObservation] -&gt; ShowS
showList :: [HeadObservation] -&gt; ShowS
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680178850"><span id="local-6989586621680178852"><span class="annot"><span class="annottext">(forall x. HeadObservation -&gt; Rep HeadObservation x)
-&gt; (forall x. Rep HeadObservation x -&gt; HeadObservation)
-&gt; Generic HeadObservation
forall x. Rep HeadObservation x -&gt; HeadObservation
forall x. HeadObservation -&gt; Rep HeadObservation x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. HeadObservation -&gt; Rep HeadObservation x
from :: forall x. HeadObservation -&gt; Rep HeadObservation x
$cto :: forall x. Rep HeadObservation x -&gt; HeadObservation
to :: forall x. Rep HeadObservation x -&gt; HeadObservation
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Generics.html#Generic"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span class="annot"><span class="hs-comment">-- | Observe any Hydra head transaction.</span></span><span>
</span><span id="line-91"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#observeHeadTx"><span class="hs-identifier hs-type">observeHeadTx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NetworkId</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#HeadObservation"><span class="hs-identifier hs-type">HeadObservation</span></a></span><span>
</span><span id="line-92"></span><span id="observeHeadTx"><span class="annot"><span class="annottext">observeHeadTx :: NetworkId -&gt; UTxO -&gt; Tx -&gt; HeadObservation
</span><a href="Hydra.Chain.Direct.Tx.html#observeHeadTx"><span class="hs-identifier hs-var hs-var">observeHeadTx</span></a></span></span><span> </span><span id="local-6989586621680178855"><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621680178855"><span class="hs-identifier hs-var">networkId</span></a></span></span><span> </span><span id="local-6989586621680178856"><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621680178856"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span id="local-6989586621680178857"><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680178857"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-93"></span><span>  </span><span class="annot"><span class="annottext">HeadObservation -&gt; Maybe HeadObservation -&gt; HeadObservation
forall a. a -&gt; Maybe a -&gt; a
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Maybe.html#fromMaybe"><span class="hs-identifier hs-var">fromMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">HeadObservation
</span><a href="Hydra.Chain.Direct.Tx.html#NoHeadTx"><span class="hs-identifier hs-var">NoHeadTx</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe HeadObservation -&gt; HeadObservation)
-&gt; Maybe HeadObservation -&gt; HeadObservation
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-94"></span><span>    </span><span class="annot"><span class="annottext">(NotAnInitReason -&gt; Maybe HeadObservation)
-&gt; (InitObservation -&gt; Maybe HeadObservation)
-&gt; Either NotAnInitReason InitObservation
-&gt; Maybe HeadObservation
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Either.html#either"><span class="hs-identifier hs-var">either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe HeadObservation -&gt; NotAnInitReason -&gt; Maybe HeadObservation
forall a b. a -&gt; b -&gt; a
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe HeadObservation
forall a. Maybe a
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeadObservation -&gt; Maybe HeadObservation
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(HeadObservation -&gt; Maybe HeadObservation)
-&gt; (InitObservation -&gt; HeadObservation)
-&gt; InitObservation
-&gt; Maybe HeadObservation
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">InitObservation -&gt; HeadObservation
</span><a href="Hydra.Chain.Direct.Tx.html#Init"><span class="hs-identifier hs-var">Init</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx -&gt; Either NotAnInitReason InitObservation
</span><a href="Hydra.Chain.Direct.Tx.html#observeInitTx"><span class="hs-identifier hs-var">observeInitTx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680178857"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span>      </span><span class="annot"><span class="annottext">Maybe HeadObservation
-&gt; Maybe HeadObservation -&gt; Maybe HeadObservation
forall a. Maybe a -&gt; Maybe a -&gt; Maybe a
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3C%7C%3E"><span class="hs-operator hs-var">&lt;|&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">AbortObservation -&gt; HeadObservation
</span><a href="Hydra.Chain.Direct.Tx.html#Abort"><span class="hs-identifier hs-var">Abort</span></a></span><span> </span><span class="annot"><span class="annottext">(AbortObservation -&gt; HeadObservation)
-&gt; Maybe AbortObservation -&gt; Maybe HeadObservation
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO -&gt; Tx -&gt; Maybe AbortObservation
</span><a href="Hydra.Chain.Direct.Tx.html#observeAbortTx"><span class="hs-identifier hs-var">observeAbortTx</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621680178856"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680178857"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-96"></span><span>      </span><span class="annot"><span class="annottext">Maybe HeadObservation
-&gt; Maybe HeadObservation -&gt; Maybe HeadObservation
forall a. Maybe a -&gt; Maybe a -&gt; Maybe a
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3C%7C%3E"><span class="hs-operator hs-var">&lt;|&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CommitObservation -&gt; HeadObservation
</span><a href="Hydra.Chain.Direct.Tx.html#Commit"><span class="hs-identifier hs-var">Commit</span></a></span><span> </span><span class="annot"><span class="annottext">(CommitObservation -&gt; HeadObservation)
-&gt; Maybe CommitObservation -&gt; Maybe HeadObservation
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkId -&gt; UTxO -&gt; Tx -&gt; Maybe CommitObservation
</span><a href="Hydra.Chain.Direct.Tx.html#observeCommitTx"><span class="hs-identifier hs-var">observeCommitTx</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621680178855"><span class="hs-identifier hs-var">networkId</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621680178856"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680178857"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-97"></span><span>      </span><span class="annot"><span class="annottext">Maybe HeadObservation
-&gt; Maybe HeadObservation -&gt; Maybe HeadObservation
forall a. Maybe a -&gt; Maybe a -&gt; Maybe a
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3C%7C%3E"><span class="hs-operator hs-var">&lt;|&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CollectComObservation -&gt; HeadObservation
</span><a href="Hydra.Chain.Direct.Tx.html#CollectCom"><span class="hs-identifier hs-var">CollectCom</span></a></span><span> </span><span class="annot"><span class="annottext">(CollectComObservation -&gt; HeadObservation)
-&gt; Maybe CollectComObservation -&gt; Maybe HeadObservation
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO -&gt; Tx -&gt; Maybe CollectComObservation
</span><a href="Hydra.Chain.Direct.Tx.html#observeCollectComTx"><span class="hs-identifier hs-var">observeCollectComTx</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621680178856"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680178857"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-98"></span><span>      </span><span class="annot"><span class="annottext">Maybe HeadObservation
-&gt; Maybe HeadObservation -&gt; Maybe HeadObservation
forall a. Maybe a -&gt; Maybe a -&gt; Maybe a
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3C%7C%3E"><span class="hs-operator hs-var">&lt;|&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">DepositObservation -&gt; HeadObservation
</span><a href="Hydra.Chain.Direct.Tx.html#Deposit"><span class="hs-identifier hs-var">Deposit</span></a></span><span> </span><span class="annot"><span class="annottext">(DepositObservation -&gt; HeadObservation)
-&gt; Maybe DepositObservation -&gt; Maybe HeadObservation
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkId -&gt; Tx -&gt; Maybe DepositObservation
</span><span class="hs-identifier hs-var">observeDepositTx</span></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621680178855"><span class="hs-identifier hs-var">networkId</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680178857"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-99"></span><span>      </span><span class="annot"><span class="annottext">Maybe HeadObservation
-&gt; Maybe HeadObservation -&gt; Maybe HeadObservation
forall a. Maybe a -&gt; Maybe a -&gt; Maybe a
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3C%7C%3E"><span class="hs-operator hs-var">&lt;|&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">RecoverObservation -&gt; HeadObservation
</span><a href="Hydra.Chain.Direct.Tx.html#Recover"><span class="hs-identifier hs-var">Recover</span></a></span><span> </span><span class="annot"><span class="annottext">(RecoverObservation -&gt; HeadObservation)
-&gt; Maybe RecoverObservation -&gt; Maybe HeadObservation
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkId -&gt; UTxO -&gt; Tx -&gt; Maybe RecoverObservation
</span><span class="hs-identifier hs-var">observeRecoverTx</span></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621680178855"><span class="hs-identifier hs-var">networkId</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621680178856"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680178857"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-100"></span><span>      </span><span class="annot"><span class="annottext">Maybe HeadObservation
-&gt; Maybe HeadObservation -&gt; Maybe HeadObservation
forall a. Maybe a -&gt; Maybe a -&gt; Maybe a
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3C%7C%3E"><span class="hs-operator hs-var">&lt;|&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">IncrementObservation -&gt; HeadObservation
</span><a href="Hydra.Chain.Direct.Tx.html#Increment"><span class="hs-identifier hs-var">Increment</span></a></span><span> </span><span class="annot"><span class="annottext">(IncrementObservation -&gt; HeadObservation)
-&gt; Maybe IncrementObservation -&gt; Maybe HeadObservation
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO -&gt; Tx -&gt; Maybe IncrementObservation
</span><a href="Hydra.Chain.Direct.Tx.html#observeIncrementTx"><span class="hs-identifier hs-var">observeIncrementTx</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621680178856"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680178857"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-101"></span><span>      </span><span class="annot"><span class="annottext">Maybe HeadObservation
-&gt; Maybe HeadObservation -&gt; Maybe HeadObservation
forall a. Maybe a -&gt; Maybe a -&gt; Maybe a
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3C%7C%3E"><span class="hs-operator hs-var">&lt;|&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">DecrementObservation -&gt; HeadObservation
</span><a href="Hydra.Chain.Direct.Tx.html#Decrement"><span class="hs-identifier hs-var">Decrement</span></a></span><span> </span><span class="annot"><span class="annottext">(DecrementObservation -&gt; HeadObservation)
-&gt; Maybe DecrementObservation -&gt; Maybe HeadObservation
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO -&gt; Tx -&gt; Maybe DecrementObservation
</span><a href="Hydra.Chain.Direct.Tx.html#observeDecrementTx"><span class="hs-identifier hs-var">observeDecrementTx</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621680178856"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680178857"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-102"></span><span>      </span><span class="annot"><span class="annottext">Maybe HeadObservation
-&gt; Maybe HeadObservation -&gt; Maybe HeadObservation
forall a. Maybe a -&gt; Maybe a -&gt; Maybe a
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3C%7C%3E"><span class="hs-operator hs-var">&lt;|&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CloseObservation -&gt; HeadObservation
</span><a href="Hydra.Chain.Direct.Tx.html#Close"><span class="hs-identifier hs-var">Close</span></a></span><span> </span><span class="annot"><span class="annottext">(CloseObservation -&gt; HeadObservation)
-&gt; Maybe CloseObservation -&gt; Maybe HeadObservation
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO -&gt; Tx -&gt; Maybe CloseObservation
</span><a href="Hydra.Chain.Direct.Tx.html#observeCloseTx"><span class="hs-identifier hs-var">observeCloseTx</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621680178856"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680178857"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-103"></span><span>      </span><span class="annot"><span class="annottext">Maybe HeadObservation
-&gt; Maybe HeadObservation -&gt; Maybe HeadObservation
forall a. Maybe a -&gt; Maybe a -&gt; Maybe a
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3C%7C%3E"><span class="hs-operator hs-var">&lt;|&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ContestObservation -&gt; HeadObservation
</span><a href="Hydra.Chain.Direct.Tx.html#Contest"><span class="hs-identifier hs-var">Contest</span></a></span><span> </span><span class="annot"><span class="annottext">(ContestObservation -&gt; HeadObservation)
-&gt; Maybe ContestObservation -&gt; Maybe HeadObservation
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO -&gt; Tx -&gt; Maybe ContestObservation
</span><a href="Hydra.Chain.Direct.Tx.html#observeContestTx"><span class="hs-identifier hs-var">observeContestTx</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621680178856"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680178857"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-104"></span><span>      </span><span class="annot"><span class="annottext">Maybe HeadObservation
-&gt; Maybe HeadObservation -&gt; Maybe HeadObservation
forall a. Maybe a -&gt; Maybe a -&gt; Maybe a
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3C%7C%3E"><span class="hs-operator hs-var">&lt;|&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">FanoutObservation -&gt; HeadObservation
</span><a href="Hydra.Chain.Direct.Tx.html#Fanout"><span class="hs-identifier hs-var">Fanout</span></a></span><span> </span><span class="annot"><span class="annottext">(FanoutObservation -&gt; HeadObservation)
-&gt; Maybe FanoutObservation -&gt; Maybe HeadObservation
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO -&gt; Tx -&gt; Maybe FanoutObservation
</span><a href="Hydra.Chain.Direct.Tx.html#observeFanoutTx"><span class="hs-identifier hs-var">observeFanoutTx</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621680178856"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680178857"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span class="annot"><span class="hs-comment">-- | Data which can be observed from an `initTx`.</span></span><span>
</span><span id="line-107"></span><span class="hs-keyword">data</span><span> </span><span id="InitObservation"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#InitObservation"><span class="hs-identifier hs-var">InitObservation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="InitObservation"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#InitObservation"><span class="hs-identifier hs-var">InitObservation</span></a></span></span><span>
</span><span id="line-108"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AinitialThreadUTxO%3AInitObservation"><span class="annot"><span class="annottext">InitObservation -&gt; (TxIn, TxOut CtxUTxO)
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AinitialThreadUTxO%3AInitObservation"><span class="hs-identifier hs-var hs-var">initialThreadUTxO</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxIn</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CtxUTxO</span></span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3Ainitials%3AInitObservation"><span class="annot"><span class="annottext">InitObservation -&gt; [(TxIn, TxOut CtxUTxO)]
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3Ainitials%3AInitObservation"><span class="hs-identifier hs-var hs-var">initials</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxIn</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CtxUTxO</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-110"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AheadId%3AInitObservation"><span class="annot"><span class="annottext">InitObservation -&gt; HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AheadId%3AInitObservation"><span class="hs-identifier hs-var hs-var">headId</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HeadId</span></span><span>
</span><span id="line-111"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- XXX: This is cardano-specific, while headId, parties and</span><span>
</span><span id="line-112"></span><span>    </span><span class="hs-comment">-- contestationPeriod are already generic here. Check which is more</span><span>
</span><span id="line-113"></span><span>    </span><span class="hs-comment">-- convenient and consistent!</span><span>
</span><span id="line-114"></span><span>    </span><span id="%24sel%3AseedTxIn%3AInitObservation"><span class="annot"><span class="annottext">InitObservation -&gt; TxIn
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AseedTxIn%3AInitObservation"><span class="hs-identifier hs-var hs-var">seedTxIn</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxIn</span></span><span>
</span><span id="line-115"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AcontestationPeriod%3AInitObservation"><span class="annot"><span class="annottext">InitObservation -&gt; ContestationPeriod
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AcontestationPeriod%3AInitObservation"><span class="hs-identifier hs-var hs-var">contestationPeriod</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ContestationPeriod</span></span><span>
</span><span id="line-116"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3Aparties%3AInitObservation"><span class="annot"><span class="annottext">InitObservation -&gt; [Party]
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3Aparties%3AInitObservation"><span class="hs-identifier hs-var hs-var">parties</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Party</span></span><span class="hs-special">]</span><span>
</span><span id="line-117"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- XXX: Improve naming</span><span>
</span><span id="line-118"></span><span>    </span><span id="%24sel%3Aparticipants%3AInitObservation"><span class="annot"><span class="annottext">InitObservation -&gt; [OnChainId]
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3Aparticipants%3AInitObservation"><span class="hs-identifier hs-var hs-var">participants</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">OnChainId</span></span><span class="hs-special">]</span><span>
</span><span id="line-119"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-120"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680178880"><span id="local-6989586621680178896"><span id="local-6989586621680178899"><span class="annot"><span class="annottext">Int -&gt; InitObservation -&gt; ShowS
[InitObservation] -&gt; ShowS
InitObservation -&gt; String
(Int -&gt; InitObservation -&gt; ShowS)
-&gt; (InitObservation -&gt; String)
-&gt; ([InitObservation] -&gt; ShowS)
-&gt; Show InitObservation
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; InitObservation -&gt; ShowS
showsPrec :: Int -&gt; InitObservation -&gt; ShowS
$cshow :: InitObservation -&gt; String
show :: InitObservation -&gt; String
$cshowList :: [InitObservation] -&gt; ShowS
showList :: [InitObservation] -&gt; ShowS
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680178904"><span id="local-6989586621680178919"><span class="annot"><span class="annottext">InitObservation -&gt; InitObservation -&gt; Bool
(InitObservation -&gt; InitObservation -&gt; Bool)
-&gt; (InitObservation -&gt; InitObservation -&gt; Bool)
-&gt; Eq InitObservation
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: InitObservation -&gt; InitObservation -&gt; Bool
== :: InitObservation -&gt; InitObservation -&gt; Bool
$c/= :: InitObservation -&gt; InitObservation -&gt; Bool
/= :: InitObservation -&gt; InitObservation -&gt; Bool
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680178924"><span id="local-6989586621680178926"><span class="annot"><span class="annottext">(forall x. InitObservation -&gt; Rep InitObservation x)
-&gt; (forall x. Rep InitObservation x -&gt; InitObservation)
-&gt; Generic InitObservation
forall x. Rep InitObservation x -&gt; InitObservation
forall x. InitObservation -&gt; Rep InitObservation x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. InitObservation -&gt; Rep InitObservation x
from :: forall x. InitObservation -&gt; Rep InitObservation x
$cto :: forall x. Rep InitObservation x -&gt; InitObservation
to :: forall x. Rep InitObservation x -&gt; InitObservation
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Generics.html#Generic"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-121"></span><span>
</span><span id="line-122"></span><span class="hs-keyword">data</span><span> </span><span id="NotAnInitReason"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#NotAnInitReason"><span class="hs-identifier hs-var">NotAnInitReason</span></a></span></span><span>
</span><span id="line-123"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="NoHeadOutput"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#NoHeadOutput"><span class="hs-identifier hs-var">NoHeadOutput</span></a></span></span><span>
</span><span id="line-124"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="NotAHeadDatum"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#NotAHeadDatum"><span class="hs-identifier hs-var">NotAHeadDatum</span></a></span></span><span>
</span><span id="line-125"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="NoSTFound"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#NoSTFound"><span class="hs-identifier hs-var">NoSTFound</span></a></span></span><span>
</span><span id="line-126"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="NotAHeadPolicy"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#NotAHeadPolicy"><span class="hs-identifier hs-var">NotAHeadPolicy</span></a></span></span><span>
</span><span id="line-127"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680178933"><span id="local-6989586621680178935"><span id="local-6989586621680178939"><span class="annot"><span class="annottext">Int -&gt; NotAnInitReason -&gt; ShowS
[NotAnInitReason] -&gt; ShowS
NotAnInitReason -&gt; String
(Int -&gt; NotAnInitReason -&gt; ShowS)
-&gt; (NotAnInitReason -&gt; String)
-&gt; ([NotAnInitReason] -&gt; ShowS)
-&gt; Show NotAnInitReason
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; NotAnInitReason -&gt; ShowS
showsPrec :: Int -&gt; NotAnInitReason -&gt; ShowS
$cshow :: NotAnInitReason -&gt; String
show :: NotAnInitReason -&gt; String
$cshowList :: [NotAnInitReason] -&gt; ShowS
showList :: [NotAnInitReason] -&gt; ShowS
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680178942"><span id="local-6989586621680178944"><span class="annot"><span class="annottext">NotAnInitReason -&gt; NotAnInitReason -&gt; Bool
(NotAnInitReason -&gt; NotAnInitReason -&gt; Bool)
-&gt; (NotAnInitReason -&gt; NotAnInitReason -&gt; Bool)
-&gt; Eq NotAnInitReason
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: NotAnInitReason -&gt; NotAnInitReason -&gt; Bool
== :: NotAnInitReason -&gt; NotAnInitReason -&gt; Bool
$c/= :: NotAnInitReason -&gt; NotAnInitReason -&gt; Bool
/= :: NotAnInitReason -&gt; NotAnInitReason -&gt; Bool
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680178948"><span id="local-6989586621680178950"><span class="annot"><span class="annottext">(forall x. NotAnInitReason -&gt; Rep NotAnInitReason x)
-&gt; (forall x. Rep NotAnInitReason x -&gt; NotAnInitReason)
-&gt; Generic NotAnInitReason
forall x. Rep NotAnInitReason x -&gt; NotAnInitReason
forall x. NotAnInitReason -&gt; Rep NotAnInitReason x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. NotAnInitReason -&gt; Rep NotAnInitReason x
from :: forall x. NotAnInitReason -&gt; Rep NotAnInitReason x
$cto :: forall x. Rep NotAnInitReason x -&gt; NotAnInitReason
to :: forall x. Rep NotAnInitReason x -&gt; NotAnInitReason
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Generics.html#Generic"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span class="hs-comment">-- | Identify a init tx by checking the output value for holding tokens that are</span><span>
</span><span id="line-130"></span><span class="hs-comment">-- valid head tokens (checked by seed + policy).</span><span>
</span><span id="line-131"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#observeInitTx"><span class="hs-identifier hs-type">observeInitTx</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-132"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-133"></span><span>  </span><span class="annot"><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#NotAnInitReason"><span class="hs-identifier hs-type">NotAnInitReason</span></a></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#InitObservation"><span class="hs-identifier hs-type">InitObservation</span></a></span><span>
</span><span id="line-134"></span><span id="observeInitTx"><span class="annot"><span class="annottext">observeInitTx :: Tx -&gt; Either NotAnInitReason InitObservation
</span><a href="Hydra.Chain.Direct.Tx.html#observeInitTx"><span class="hs-identifier hs-var hs-var">observeInitTx</span></a></span></span><span> </span><span id="local-6989586621680178952"><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680178952"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-135"></span><span>  </span><span class="hs-comment">-- XXX: Lots of redundant information here</span><span>
</span><span id="line-136"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621680178953"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680178953"><span class="hs-identifier hs-var">ix</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680178954"><span class="annot"><span class="annottext">TxOut CtxTx Era
</span><a href="#local-6989586621680178954"><span class="hs-identifier hs-var">headOut</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680178955"><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621680178955"><span class="hs-identifier hs-var">headState</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-137"></span><span>    </span><span class="annot"><span class="annottext">NotAnInitReason
-&gt; Maybe (Word, TxOut CtxTx Era, State)
-&gt; Either NotAnInitReason (Word, TxOut CtxTx Era, State)
forall {a} {b}. a -&gt; Maybe b -&gt; Either a b
</span><a href="#local-6989586621680178956"><span class="hs-identifier hs-var">maybeLeft</span></a></span><span> </span><span class="annot"><span class="annottext">NotAnInitReason
</span><a href="Hydra.Chain.Direct.Tx.html#NoHeadOutput"><span class="hs-identifier hs-var">NoHeadOutput</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (Word, TxOut CtxTx Era, State)
 -&gt; Either NotAnInitReason (Word, TxOut CtxTx Era, State))
-&gt; Maybe (Word, TxOut CtxTx Era, State)
-&gt; Either NotAnInitReason (Word, TxOut CtxTx Era, State)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-138"></span><span>      </span><span class="annot"><span class="annottext">((Word, TxOut CtxTx Era) -&gt; Maybe (Word, TxOut CtxTx Era, State))
-&gt; [(Word, TxOut CtxTx Era)]
-&gt; Maybe (Word, TxOut CtxTx Era, State)
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; Maybe b) -&gt; t a -&gt; Maybe b
</span><span class="hs-identifier hs-var">findFirst</span></span><span> </span><span class="annot"><span class="annottext">(Word, TxOut CtxTx Era) -&gt; Maybe (Word, TxOut CtxTx Era, State)
forall {a} {t} {era}.
FromData a =&gt;
(t, TxOut CtxTx era) -&gt; Maybe (t, TxOut CtxTx era, a)
</span><a href="#local-6989586621680178957"><span class="hs-identifier hs-var">matchHeadOutput</span></a></span><span> </span><span class="annot"><span class="annottext">[(Word, TxOut CtxTx Era)]
</span><a href="#local-6989586621680178958"><span class="hs-identifier hs-var">indexedOutputs</span></a></span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span>  </span><span class="hs-comment">-- check that we have a proper head</span><span>
</span><span id="line-141"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621680178959"><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621680178959"><span class="hs-identifier hs-var">pid</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680178960"><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="#local-6989586621680178960"><span class="hs-identifier hs-var">contestationPeriod</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680178961"><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621680178961"><span class="hs-identifier hs-var">onChainParties</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680178962"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680178962"><span class="hs-identifier hs-var">seedTxIn</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621680178955"><span class="hs-identifier hs-var">headState</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-142"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Head.Initial</span></span><span> </span><span id="local-6989586621680178964"><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="#local-6989586621680178964"><span class="hs-identifier hs-var">cp</span></a></span></span><span> </span><span id="local-6989586621680178965"><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621680178965"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span id="local-6989586621680178966"><span class="annot"><span class="annottext">CurrencySymbol
</span><a href="#local-6989586621680178966"><span class="hs-identifier hs-var">cid</span></a></span></span><span> </span><span id="local-6989586621680178967"><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621680178967"><span class="hs-identifier hs-var">outRef</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-143"></span><span>      </span><span id="local-6989586621680178968"><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621680178968"><span class="hs-identifier hs-var">pid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CurrencySymbol -&gt; Maybe PolicyId
forall (m :: * -&gt; *). MonadFail m =&gt; CurrencySymbol -&gt; m PolicyId
</span><span class="hs-identifier hs-var">fromPlutusCurrencySymbol</span></span><span> </span><span class="annot"><span class="annottext">CurrencySymbol
</span><a href="#local-6989586621680178966"><span class="hs-identifier hs-var">cid</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe PolicyId
-&gt; NotAnInitReason -&gt; Either NotAnInitReason PolicyId
forall a e. Maybe a -&gt; e -&gt; Either e a
</span><span class="hs-operator hs-var">?&gt;</span></span><span> </span><span class="annot"><span class="annottext">NotAnInitReason
</span><a href="Hydra.Chain.Direct.Tx.html#NotAHeadPolicy"><span class="hs-identifier hs-var">NotAHeadPolicy</span></a></span><span>
</span><span id="line-144"></span><span>      </span><span class="annot"><span class="annottext">(PolicyId, ContestationPeriod, [Party], TxIn)
-&gt; Either
     NotAnInitReason (PolicyId, ContestationPeriod, [Party], TxIn)
forall a. a -&gt; Either NotAnInitReason a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621680178968"><span class="hs-identifier hs-var">pid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ContestationPeriod -&gt; ContestationPeriod
</span><span class="hs-identifier hs-var">fromChain</span></span><span> </span><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="#local-6989586621680178964"><span class="hs-identifier hs-var">cp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621680178965"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxOutRef -&gt; TxIn
</span><span class="hs-identifier hs-var">fromPlutusTxOutRef</span></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621680178967"><span class="hs-identifier hs-var">outRef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-145"></span><span>    </span><span class="annot"><span class="annottext">State
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NotAnInitReason
-&gt; Either
     NotAnInitReason (PolicyId, ContestationPeriod, [Party], TxIn)
forall a b. a -&gt; Either a b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">NotAnInitReason
</span><a href="Hydra.Chain.Direct.Tx.html#NotAHeadDatum"><span class="hs-identifier hs-var">NotAHeadDatum</span></a></span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680178972"><span class="annot"><span class="annottext">stQuantity :: Quantity
</span><a href="#local-6989586621680178972"><span class="hs-identifier hs-var hs-var">stQuantity</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; AssetId -&gt; Quantity
</span><span class="hs-identifier hs-var">selectAsset</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOut CtxTx Era -&gt; Value
forall ctx. TxOut ctx -&gt; Value
</span><span class="hs-identifier hs-var">txOutValue</span></span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx Era
</span><a href="#local-6989586621680178954"><span class="hs-identifier hs-var">headOut</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PolicyId -&gt; AssetName -&gt; AssetId
</span><span class="hs-identifier hs-var">AssetId</span></span><span> </span><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621680178959"><span class="hs-identifier hs-var">pid</span></a></span><span> </span><span class="annot"><span class="annottext">AssetName
</span><span class="hs-identifier hs-var">hydraHeadV1AssetName</span></span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span>
</span><span id="line-149"></span><span>  </span><span class="hs-comment">-- check that ST is present in the head output</span><span>
</span><span id="line-150"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; Either NotAnInitReason () -&gt; Either NotAnInitReason ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Quantity
</span><a href="#local-6989586621680178972"><span class="hs-identifier hs-var">stQuantity</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity -&gt; Quantity -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Either NotAnInitReason () -&gt; Either NotAnInitReason ())
-&gt; Either NotAnInitReason () -&gt; Either NotAnInitReason ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-151"></span><span>    </span><span class="annot"><span class="annottext">NotAnInitReason -&gt; Either NotAnInitReason ()
forall a b. a -&gt; Either a b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">NotAnInitReason
</span><a href="Hydra.Chain.Direct.Tx.html#NoSTFound"><span class="hs-identifier hs-var">NoSTFound</span></a></span><span>
</span><span id="line-152"></span><span>
</span><span id="line-153"></span><span>  </span><span class="hs-comment">-- check that we are using the same seed and headId matches</span><span>
</span><span id="line-154"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; Either NotAnInitReason () -&gt; Either NotAnInitReason ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621680178959"><span class="hs-identifier hs-var">pid</span></a></span><span> </span><span class="annot"><span class="annottext">PolicyId -&gt; PolicyId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn -&gt; PolicyId
</span><span class="hs-identifier hs-var">HeadTokens.headPolicyId</span></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680178962"><span class="hs-identifier hs-var">seedTxIn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Either NotAnInitReason () -&gt; Either NotAnInitReason ())
-&gt; Either NotAnInitReason () -&gt; Either NotAnInitReason ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-155"></span><span>    </span><span class="annot"><span class="annottext">NotAnInitReason -&gt; Either NotAnInitReason ()
forall a b. a -&gt; Either a b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">NotAnInitReason
</span><a href="Hydra.Chain.Direct.Tx.html#NotAHeadPolicy"><span class="hs-identifier hs-var">NotAHeadPolicy</span></a></span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span>  </span><span class="annot"><span class="annottext">InitObservation -&gt; Either NotAnInitReason InitObservation
forall a. a -&gt; Either NotAnInitReason a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(InitObservation -&gt; Either NotAnInitReason InitObservation)
-&gt; InitObservation -&gt; Either NotAnInitReason InitObservation
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-158"></span><span>    </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#InitObservation"><span class="hs-identifier hs-type">InitObservation</span></a></span><span>
</span><span id="line-159"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:headId:InitObservation :: HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AheadId%3AInitObservation"><span class="hs-identifier hs-var">headId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PolicyId -&gt; HeadId
</span><span class="hs-identifier hs-var">mkHeadId</span></span><span> </span><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621680178959"><span class="hs-identifier hs-var">pid</span></a></span><span>
</span><span id="line-160"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxIn
$sel:seedTxIn:InitObservation :: TxIn
seedTxIn :: TxIn
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AseedTxIn%3AInitObservation"><span class="hs-identifier hs-var hs-var">seedTxIn</span></a></span><span>
</span><span id="line-161"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:initialThreadUTxO:InitObservation :: (TxIn, TxOut CtxUTxO)
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AinitialThreadUTxO%3AInitObservation"><span class="hs-identifier hs-var">initialThreadUTxO</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx -&gt; Word -&gt; TxIn
forall era. Tx era -&gt; Word -&gt; TxIn
</span><span class="hs-identifier hs-var">mkTxIn</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680178952"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621680178953"><span class="hs-identifier hs-var">ix</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx Era -&gt; TxOut CtxUTxO
forall era. TxOut CtxTx era -&gt; TxOut CtxUTxO era
</span><span class="hs-identifier hs-var">toCtxUTxOTxOut</span></span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx Era
</span><a href="#local-6989586621680178954"><span class="hs-identifier hs-var">headOut</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-162"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(TxIn, TxOut CtxUTxO)]
$sel:initials:InitObservation :: [(TxIn, TxOut CtxUTxO)]
initials :: [(TxIn, TxOut CtxUTxO)]
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3Ainitials%3AInitObservation"><span class="hs-identifier hs-var hs-var">initials</span></a></span><span>
</span><span id="line-163"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ContestationPeriod
$sel:contestationPeriod:InitObservation :: ContestationPeriod
contestationPeriod :: ContestationPeriod
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AcontestationPeriod%3AInitObservation"><span class="hs-identifier hs-var hs-var">contestationPeriod</span></a></span><span>
</span><span id="line-164"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:parties:InitObservation :: [Party]
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3Aparties%3AInitObservation"><span class="hs-identifier hs-var">parties</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Party -&gt; Maybe Party) -&gt; [Party] -&gt; [Party]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Maybe.html#mapMaybe"><span class="hs-identifier hs-var">mapMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Party -&gt; Maybe Party
forall (m :: * -&gt; *). MonadFail m =&gt; Party -&gt; m Party
</span><span class="hs-identifier hs-var">partyFromChain</span></span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621680178961"><span class="hs-identifier hs-var">onChainParties</span></a></span><span>
</span><span id="line-165"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:participants:InitObservation :: [OnChainId]
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3Aparticipants%3AInitObservation"><span class="hs-identifier hs-var">participants</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AssetName -&gt; OnChainId
</span><span class="hs-identifier hs-var">assetNameToOnChainId</span></span><span> </span><span class="annot"><span class="annottext">(AssetName -&gt; OnChainId) -&gt; [AssetName] -&gt; [OnChainId]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">PolicyId -&gt; [AssetName]
</span><a href="#local-6989586621680178982"><span class="hs-identifier hs-var">mintedTokenNames</span></a></span><span> </span><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621680178959"><span class="hs-identifier hs-var">pid</span></a></span><span>
</span><span id="line-166"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-167"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-168"></span><span>  </span><span id="local-6989586621680178956"><span class="annot"><span class="annottext">maybeLeft :: a -&gt; Maybe b -&gt; Either a b
</span><a href="#local-6989586621680178956"><span class="hs-identifier hs-var hs-var">maybeLeft</span></a></span></span><span> </span><span id="local-6989586621680178983"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680178983"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either a b -&gt; (b -&gt; Either a b) -&gt; Maybe b -&gt; Either a b
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Maybe.html#maybe"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Either a b
forall a b. a -&gt; Either a b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680178983"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">b -&gt; Either a b
forall a b. b -&gt; Either a b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span>  </span><span id="local-6989586621680178957"><span class="annot"><span class="annottext">matchHeadOutput :: (t, TxOut CtxTx era) -&gt; Maybe (t, TxOut CtxTx era, a)
</span><a href="#local-6989586621680178957"><span class="hs-identifier hs-var hs-var">matchHeadOutput</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680178992"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621680178992"><span class="hs-identifier hs-var">ix</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680178993"><span class="annot"><span class="annottext">TxOut CtxTx era
</span><a href="#local-6989586621680178993"><span class="hs-identifier hs-var">out</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-171"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Maybe ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Control.Monad.html#guard"><span class="hs-identifier hs-var">guard</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Maybe ()) -&gt; Bool -&gt; Maybe ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript PlutusScriptV3 -&gt; TxOut CtxTx era -&gt; Bool
forall lang ctx era.
IsPlutusScriptLanguage lang =&gt;
PlutusScript lang -&gt; TxOut ctx era -&gt; Bool
</span><span class="hs-identifier hs-var">isScriptTxOut</span></span><span> </span><span class="annot"><span class="annottext">PlutusScript PlutusScriptV3
</span><span class="hs-identifier hs-var">Head.validatorScript</span></span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx era
</span><a href="#local-6989586621680178993"><span class="hs-identifier hs-var">out</span></a></span><span>
</span><span id="line-172"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621680178992"><span class="hs-identifier hs-var">ix</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TxOut CtxTx era
</span><a href="#local-6989586621680178993"><span class="hs-identifier hs-var">out</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(a -&gt; (t, TxOut CtxTx era, a))
-&gt; Maybe a -&gt; Maybe (t, TxOut CtxTx era, a)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashableScriptData -&gt; Maybe a
forall a. FromScriptData a =&gt; HashableScriptData -&gt; Maybe a
</span><span class="hs-identifier hs-var">fromScriptData</span></span><span> </span><span class="annot"><span class="annottext">(HashableScriptData -&gt; Maybe a)
-&gt; Maybe HashableScriptData -&gt; Maybe a
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3D%3C%3C"><span class="hs-operator hs-var">=&lt;&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx era -&gt; Maybe HashableScriptData
forall era. TxOut CtxTx era -&gt; Maybe HashableScriptData
</span><span class="hs-identifier hs-var">txOutScriptData</span></span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx era
</span><a href="#local-6989586621680178993"><span class="hs-identifier hs-var">out</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-173"></span><span>
</span><span id="line-174"></span><span>  </span><span id="local-6989586621680178958"><span class="annot"><span class="annottext">indexedOutputs :: [(Word, TxOut CtxTx Era)]
</span><a href="#local-6989586621680178958"><span class="hs-identifier hs-var hs-var">indexedOutputs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Word] -&gt; [TxOut CtxTx Era] -&gt; [(Word, TxOut CtxTx Era)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx -&gt; [TxOut CtxTx Era]
forall era. Tx era -&gt; [TxOut CtxTx era]
</span><span class="hs-identifier hs-var">txOuts'</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680178952"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span>  </span><span id="local-6989586621680179000"><span class="annot"><span class="annottext">initialOutputs :: [(Word, TxOut CtxTx Era)]
</span><a href="#local-6989586621680179000"><span class="hs-identifier hs-var hs-var">initialOutputs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Word, TxOut CtxTx Era) -&gt; Bool)
-&gt; [(Word, TxOut CtxTx Era)] -&gt; [(Word, TxOut CtxTx Era)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOut CtxTx Era -&gt; Bool
forall {ctx} {era}. TxOut ctx era -&gt; Bool
</span><a href="#local-6989586621680179001"><span class="hs-identifier hs-var">isInitial</span></a></span><span> </span><span class="annot"><span class="annottext">(TxOut CtxTx Era -&gt; Bool)
-&gt; ((Word, TxOut CtxTx Era) -&gt; TxOut CtxTx Era)
-&gt; (Word, TxOut CtxTx Era)
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Word, TxOut CtxTx Era) -&gt; TxOut CtxTx Era
forall a b. (a, b) -&gt; b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Word, TxOut CtxTx Era)]
</span><a href="#local-6989586621680178958"><span class="hs-identifier hs-var">indexedOutputs</span></a></span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span>  </span><span id="local-6989586621680178980"><span class="annot"><span class="annottext">initials :: [(TxIn, TxOut CtxUTxO)]
</span><a href="#local-6989586621680178980"><span class="hs-identifier hs-var hs-var">initials</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-179"></span><span>    </span><span class="annot"><span class="annottext">((Word, TxOut CtxTx Era) -&gt; (TxIn, TxOut CtxUTxO))
-&gt; [(Word, TxOut CtxTx Era)] -&gt; [(TxIn, TxOut CtxUTxO)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span>
</span><span id="line-180"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Word -&gt; TxIn)
-&gt; (TxOut CtxTx Era -&gt; TxOut CtxUTxO)
-&gt; (Word, TxOut CtxTx Era)
-&gt; (TxIn, TxOut CtxUTxO)
forall a b c d. (a -&gt; b) -&gt; (c -&gt; d) -&gt; (a, c) -&gt; (b, d)
forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Bifunctor.html#bimap"><span class="hs-identifier hs-var">bimap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx -&gt; Word -&gt; TxIn
forall era. Tx era -&gt; Word -&gt; TxIn
</span><span class="hs-identifier hs-var">mkTxIn</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680178952"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx Era -&gt; TxOut CtxUTxO
forall era. TxOut CtxTx era -&gt; TxOut CtxUTxO era
</span><span class="hs-identifier hs-var">toCtxUTxOTxOut</span></span><span class="hs-special">)</span><span>
</span><span id="line-181"></span><span>      </span><span class="annot"><span class="annottext">[(Word, TxOut CtxTx Era)]
</span><a href="#local-6989586621680179000"><span class="hs-identifier hs-var">initialOutputs</span></a></span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span>  </span><span id="local-6989586621680179001"><span class="annot"><span class="annottext">isInitial :: TxOut ctx era -&gt; Bool
</span><a href="#local-6989586621680179001"><span class="hs-identifier hs-var hs-var">isInitial</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PlutusScript PlutusScriptV3 -&gt; TxOut ctx era -&gt; Bool
forall lang ctx era.
IsPlutusScriptLanguage lang =&gt;
PlutusScript lang -&gt; TxOut ctx era -&gt; Bool
</span><span class="hs-identifier hs-var">isScriptTxOut</span></span><span> </span><span class="annot"><span class="annottext">PlutusScript PlutusScriptV3
</span><span class="hs-identifier hs-var">initialValidatorScript</span></span><span>
</span><span id="line-184"></span><span>
</span><span id="line-185"></span><span>  </span><span id="local-6989586621680178982"><span class="annot"><span class="annottext">mintedTokenNames :: PolicyId -&gt; [AssetName]
</span><a href="#local-6989586621680178982"><span class="hs-identifier hs-var hs-var">mintedTokenNames</span></a></span></span><span> </span><span id="local-6989586621680179005"><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621680179005"><span class="hs-identifier hs-var">pid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-186"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621680179006"><span class="hs-identifier hs-var">assetName</span></a></span><span>
</span><span id="line-187"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AssetId</span></span><span> </span><span id="local-6989586621680179007"><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621680179007"><span class="hs-identifier hs-var">policyId</span></a></span></span><span> </span><span id="local-6989586621680179006"><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621680179006"><span class="hs-identifier hs-var">assetName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680179008"><span class="annot"><span class="annottext">Quantity
</span><a href="#local-6989586621680179008"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Value -&gt; [Item Value]
forall l. IsList l =&gt; l -&gt; [Item l]
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.IsList.html#toList"><span class="hs-identifier hs-var">toList</span></a></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; [Item Value]) -&gt; Value -&gt; [Item Value]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxMintValue ViewTx Era -&gt; Value
forall build era. TxMintValue build era -&gt; Value
</span><span class="hs-identifier hs-var">txMintValueToValue</span></span><span> </span><span class="annot"><span class="annottext">(TxMintValue ViewTx Era -&gt; Value)
-&gt; TxMintValue ViewTx Era -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyContent ViewTx -&gt; TxMintValue ViewTx Era
forall buidl. TxBodyContent buidl -&gt; TxMintValue buidl
</span><span class="hs-identifier hs-var">txMintValue</span></span><span> </span><span class="annot"><span class="annottext">(TxBodyContent ViewTx -&gt; TxMintValue ViewTx Era)
-&gt; TxBodyContent ViewTx -&gt; TxMintValue ViewTx Era
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxBody Era -&gt; TxBodyContent ViewTx
forall era. TxBody era -&gt; TxBodyContent ViewTx era
</span><span class="hs-identifier hs-var">getTxBodyContent</span></span><span> </span><span class="annot"><span class="annottext">(TxBody Era -&gt; TxBodyContent ViewTx)
-&gt; TxBody Era -&gt; TxBodyContent ViewTx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Tx -&gt; TxBody Era
forall era. Tx era -&gt; TxBody era
</span><span class="hs-identifier hs-var">getTxBody</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680178952"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-188"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Quantity
</span><a href="#local-6989586621680179008"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity -&gt; Quantity -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity
</span><span class="hs-number">1</span></span><span> </span><span class="hs-comment">-- NOTE: Only consider unique tokens</span><span>
</span><span id="line-189"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621680179007"><span class="hs-identifier hs-var">policyId</span></a></span><span> </span><span class="annot"><span class="annottext">PolicyId -&gt; PolicyId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621680179005"><span class="hs-identifier hs-var">pid</span></a></span><span>
</span><span id="line-190"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621680179006"><span class="hs-identifier hs-var">assetName</span></a></span><span> </span><span class="annot"><span class="annottext">AssetName -&gt; AssetName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%2F%3D"><span class="hs-operator hs-var">/=</span></a></span><span> </span><span class="annot"><span class="annottext">AssetName
</span><span class="hs-identifier hs-var">hydraHeadV1AssetName</span></span><span>
</span><span id="line-191"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-192"></span><span>
</span><span id="line-193"></span><span class="annot"><span class="hs-comment">-- | Full observation of a commit transaction.</span></span><span>
</span><span id="line-194"></span><span class="hs-keyword">data</span><span> </span><span id="CommitObservation"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CommitObservation"><span class="hs-identifier hs-var">CommitObservation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="CommitObservation"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CommitObservation"><span class="hs-identifier hs-var">CommitObservation</span></a></span></span><span>
</span><span id="line-195"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AcommitOutput%3ACommitObservation"><span class="annot"><span class="annottext">CommitObservation -&gt; (TxIn, TxOut CtxUTxO)
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AcommitOutput%3ACommitObservation"><span class="hs-identifier hs-var hs-var">commitOutput</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxIn</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CtxUTxO</span></span><span class="hs-special">)</span><span>
</span><span id="line-196"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3Aparty%3ACommitObservation"><span class="annot"><span class="annottext">CommitObservation -&gt; Party
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3Aparty%3ACommitObservation"><span class="hs-identifier hs-var hs-var">party</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Party</span></span><span>
</span><span id="line-197"></span><span>  </span><span class="annot"><span class="hs-comment">-- ^ Hydra participant who committed the UTxO.</span></span><span>
</span><span id="line-198"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3Acommitted%3ACommitObservation"><span class="annot"><span class="annottext">CommitObservation -&gt; UTxO
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3Acommitted%3ACommitObservation"><span class="hs-identifier hs-var hs-var">committed</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span>
</span><span id="line-199"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AheadId%3ACommitObservation"><span class="annot"><span class="annottext">CommitObservation -&gt; HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AheadId%3ACommitObservation"><span class="hs-identifier hs-var hs-var">headId</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HeadId</span></span><span>
</span><span id="line-200"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-201"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680179020"><span id="local-6989586621680179029"><span class="annot"><span class="annottext">CommitObservation -&gt; CommitObservation -&gt; Bool
(CommitObservation -&gt; CommitObservation -&gt; Bool)
-&gt; (CommitObservation -&gt; CommitObservation -&gt; Bool)
-&gt; Eq CommitObservation
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: CommitObservation -&gt; CommitObservation -&gt; Bool
== :: CommitObservation -&gt; CommitObservation -&gt; Bool
$c/= :: CommitObservation -&gt; CommitObservation -&gt; Bool
/= :: CommitObservation -&gt; CommitObservation -&gt; Bool
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680179032"><span id="local-6989586621680179042"><span id="local-6989586621680179045"><span class="annot"><span class="annottext">Int -&gt; CommitObservation -&gt; ShowS
[CommitObservation] -&gt; ShowS
CommitObservation -&gt; String
(Int -&gt; CommitObservation -&gt; ShowS)
-&gt; (CommitObservation -&gt; String)
-&gt; ([CommitObservation] -&gt; ShowS)
-&gt; Show CommitObservation
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; CommitObservation -&gt; ShowS
showsPrec :: Int -&gt; CommitObservation -&gt; ShowS
$cshow :: CommitObservation -&gt; String
show :: CommitObservation -&gt; String
$cshowList :: [CommitObservation] -&gt; ShowS
showList :: [CommitObservation] -&gt; ShowS
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680179048"><span id="local-6989586621680179050"><span class="annot"><span class="annottext">(forall x. CommitObservation -&gt; Rep CommitObservation x)
-&gt; (forall x. Rep CommitObservation x -&gt; CommitObservation)
-&gt; Generic CommitObservation
forall x. Rep CommitObservation x -&gt; CommitObservation
forall x. CommitObservation -&gt; Rep CommitObservation x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. CommitObservation -&gt; Rep CommitObservation x
from :: forall x. CommitObservation -&gt; Rep CommitObservation x
$cto :: forall x. Rep CommitObservation x -&gt; CommitObservation
to :: forall x. Rep CommitObservation x -&gt; CommitObservation
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Generics.html#Generic"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-202"></span><span>
</span><span id="line-203"></span><span class="hs-comment">-- | Identify a commit tx by:</span><span>
</span><span id="line-204"></span><span class="hs-comment">--</span><span>
</span><span id="line-205"></span><span class="hs-comment">-- - Check that its spending from the init validator,</span><span>
</span><span id="line-206"></span><span class="hs-comment">-- - Find the outputs which pays to the commit validator,</span><span>
</span><span id="line-207"></span><span class="hs-comment">-- - Using the datum of that output, deserialize the committed output,</span><span>
</span><span id="line-208"></span><span class="hs-comment">-- - Reconstruct the committed UTxO from both values (tx input and output).</span><span>
</span><span id="line-209"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#observeCommitTx"><span class="hs-identifier hs-type">observeCommitTx</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-210"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">NetworkId</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-211"></span><span>  </span><span class="hs-comment">-- | A UTxO set to lookup tx inputs. Should at least contain the input</span><span>
</span><span id="line-212"></span><span>  </span><span class="hs-comment">-- spending from &#957;Initial.</span><span>
</span><span id="line-213"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-214"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-215"></span><span>  </span><span class="annot"><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CommitObservation"><span class="hs-identifier hs-type">CommitObservation</span></a></span><span>
</span><span id="line-216"></span><span id="observeCommitTx"><span class="annot"><span class="annottext">observeCommitTx :: NetworkId -&gt; UTxO -&gt; Tx -&gt; Maybe CommitObservation
</span><a href="Hydra.Chain.Direct.Tx.html#observeCommitTx"><span class="hs-identifier hs-var hs-var">observeCommitTx</span></a></span></span><span> </span><span id="local-6989586621680179052"><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621680179052"><span class="hs-identifier hs-var">networkId</span></a></span></span><span> </span><span id="local-6989586621680179053"><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621680179053"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span id="local-6989586621680179054"><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680179054"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-217"></span><span>  </span><span class="hs-comment">-- NOTE: Instead checking to spend from initial we could be looking at the</span><span>
</span><span id="line-218"></span><span>  </span><span class="hs-comment">-- seed:</span><span>
</span><span id="line-219"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-220"></span><span>  </span><span class="hs-comment">--  - We must check that participation token in output satisfies</span><span>
</span><span id="line-221"></span><span>  </span><span class="hs-comment">--      policyId = hash(mu_head(seed))</span><span>
</span><span id="line-222"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-223"></span><span>  </span><span class="hs-comment">--  - This allows us to assume (by induction) the output datum at the commit</span><span>
</span><span id="line-224"></span><span>  </span><span class="hs-comment">--    script is legit</span><span>
</span><span id="line-225"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-226"></span><span>  </span><span class="hs-comment">--  - Further, we need to assert / assume that only one script is spent = onle</span><span>
</span><span id="line-227"></span><span>  </span><span class="hs-comment">--    one redeemer matches the InitialRedeemer, as we do not have information</span><span>
</span><span id="line-228"></span><span>  </span><span class="hs-comment">--    which of the inputs is spending from the initial script otherwise.</span><span>
</span><span id="line-229"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-230"></span><span>  </span><span class="hs-comment">--  Right now we only have the headId in the datum, so we use that in place of</span><span>
</span><span id="line-231"></span><span>  </span><span class="hs-comment">--  the seed -&gt; THIS CAN NOT BE TRUSTED.</span><span>
</span><span id="line-232"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; Maybe ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Control.Monad.html#guard"><span class="hs-identifier hs-var">guard</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680179055"><span class="hs-identifier hs-var">isSpendingFromInitial</span></a></span><span>
</span><span id="line-233"></span><span>
</span><span id="line-234"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621680179056"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680179056"><span class="hs-identifier hs-var">commitIn</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680179057"><span class="annot"><span class="annottext">TxOut CtxTx Era
</span><a href="#local-6989586621680179057"><span class="hs-identifier hs-var">commitOut</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">AddressInEra -&gt; Tx -&gt; Maybe (TxIn, TxOut CtxTx Era)
forall era.
AddressInEra era -&gt; Tx era -&gt; Maybe (TxIn, TxOut CtxTx era)
</span><span class="hs-identifier hs-var">findTxOutByAddress</span></span><span> </span><span class="annot"><span class="annottext">AddressInEra
</span><a href="#local-6989586621680179059"><span class="hs-identifier hs-var">commitAddress</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680179054"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-235"></span><span>  </span><span id="local-6989586621680179060"><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621680179060"><span class="hs-identifier hs-var">dat</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx Era -&gt; Maybe HashableScriptData
forall era. TxOut CtxTx era -&gt; Maybe HashableScriptData
</span><span class="hs-identifier hs-var">txOutScriptData</span></span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx Era
</span><a href="#local-6989586621680179057"><span class="hs-identifier hs-var">commitOut</span></a></span><span>
</span><span id="line-236"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621680179061"><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621680179061"><span class="hs-identifier hs-var">onChainParty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680179062"><span class="annot"><span class="annottext">[Commit]
</span><a href="#local-6989586621680179062"><span class="hs-identifier hs-var">onChainCommits</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680179063"><span class="annot"><span class="annottext">CurrencySymbol
</span><a href="#local-6989586621680179063"><span class="hs-identifier hs-var">headId</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Commit.DatumType</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HashableScriptData -&gt; Maybe DatumType
forall a. FromScriptData a =&gt; HashableScriptData -&gt; Maybe a
</span><span class="hs-identifier hs-var">fromScriptData</span></span><span> </span><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621680179060"><span class="hs-identifier hs-var">dat</span></a></span><span>
</span><span id="line-237"></span><span>  </span><span id="local-6989586621680179064"><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621680179064"><span class="hs-identifier hs-var">party</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Party -&gt; Maybe Party
forall (m :: * -&gt; *). MonadFail m =&gt; Party -&gt; m Party
</span><span class="hs-identifier hs-var">partyFromChain</span></span><span> </span><span class="annot"><span class="annottext">Party
</span><a href="#local-6989586621680179061"><span class="hs-identifier hs-var">onChainParty</span></a></span><span>
</span><span id="line-238"></span><span>
</span><span id="line-239"></span><span>  </span><span class="hs-comment">-- NOTE: If we have the resolved inputs (utxo) then we could avoid putting</span><span>
</span><span id="line-240"></span><span>  </span><span class="hs-comment">-- the commit into the datum (+ changing the hashing strategy of</span><span>
</span><span id="line-241"></span><span>  </span><span class="hs-comment">-- collect/fanout)</span><span>
</span><span id="line-242"></span><span>  </span><span id="local-6989586621680179065"><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621680179065"><span class="hs-identifier hs-var">committed</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-243"></span><span>    </span><span id="local-6989586621680179066"><span class="annot"><span class="annottext">[(TxIn, TxOut CtxUTxO)]
</span><a href="#local-6989586621680179066"><span class="hs-identifier hs-var">committedUTxO</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Commit -&gt; Maybe (TxIn, TxOut CtxUTxO))
-&gt; [Commit] -&gt; Maybe [(TxIn, TxOut CtxUTxO)]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; [a] -&gt; f [b]
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Traversable.html#traverse"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Network -&gt; Commit -&gt; Maybe (TxIn, TxOut CtxUTxO)
</span><span class="hs-identifier hs-var">Commit.deserializeCommit</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NetworkId -&gt; Network
</span><span class="hs-identifier hs-var">networkIdToNetwork</span></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621680179052"><span class="hs-identifier hs-var">networkId</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Commit]
</span><a href="#local-6989586621680179062"><span class="hs-identifier hs-var">onChainCommits</span></a></span><span>
</span><span id="line-244"></span><span>    </span><span class="annot"><span class="annottext">UTxO -&gt; Maybe UTxO
forall a. a -&gt; Maybe a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(UTxO -&gt; Maybe UTxO)
-&gt; ([(TxIn, TxOut CtxUTxO)] -&gt; UTxO)
-&gt; [(TxIn, TxOut CtxUTxO)]
-&gt; Maybe UTxO
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[(TxIn, TxOut CtxUTxO)] -&gt; UTxO
forall out. [(TxIn, out)] -&gt; UTxO' out
</span><span class="hs-identifier hs-var">UTxO.fromPairs</span></span><span> </span><span class="annot"><span class="annottext">([(TxIn, TxOut CtxUTxO)] -&gt; Maybe UTxO)
-&gt; [(TxIn, TxOut CtxUTxO)] -&gt; Maybe UTxO
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(TxIn, TxOut CtxUTxO)]
</span><a href="#local-6989586621680179066"><span class="hs-identifier hs-var">committedUTxO</span></a></span><span>
</span><span id="line-245"></span><span>
</span><span id="line-246"></span><span>  </span><span id="local-6989586621680179071"><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621680179071"><span class="hs-identifier hs-var">policyId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CurrencySymbol -&gt; Maybe PolicyId
forall (m :: * -&gt; *). MonadFail m =&gt; CurrencySymbol -&gt; m PolicyId
</span><span class="hs-identifier hs-var">fromPlutusCurrencySymbol</span></span><span> </span><span class="annot"><span class="annottext">CurrencySymbol
</span><a href="#local-6989586621680179063"><span class="hs-identifier hs-var">headId</span></a></span><span>
</span><span id="line-247"></span><span>  </span><span class="annot"><span class="annottext">CommitObservation -&gt; Maybe CommitObservation
forall a. a -&gt; Maybe a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span>
</span><span id="line-248"></span><span>    </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CommitObservation"><span class="hs-identifier hs-type">CommitObservation</span></a></span><span>
</span><span id="line-249"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:commitOutput:CommitObservation :: (TxIn, TxOut CtxUTxO)
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AcommitOutput%3ACommitObservation"><span class="hs-identifier hs-var">commitOutput</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680179056"><span class="hs-identifier hs-var">commitIn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx Era -&gt; TxOut CtxUTxO
forall era. TxOut CtxTx era -&gt; TxOut CtxUTxO era
</span><span class="hs-identifier hs-var">toCtxUTxOTxOut</span></span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx Era
</span><a href="#local-6989586621680179057"><span class="hs-identifier hs-var">commitOut</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-250"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Party
$sel:party:CommitObservation :: Party
party :: Party
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3Aparty%3ACommitObservation"><span class="hs-identifier hs-var hs-var">party</span></a></span><span>
</span><span id="line-251"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UTxO
$sel:committed:CommitObservation :: UTxO
committed :: UTxO
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3Acommitted%3ACommitObservation"><span class="hs-identifier hs-var hs-var">committed</span></a></span><span>
</span><span id="line-252"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:headId:CommitObservation :: HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AheadId%3ACommitObservation"><span class="hs-identifier hs-var">headId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PolicyId -&gt; HeadId
</span><span class="hs-identifier hs-var">mkHeadId</span></span><span> </span><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621680179071"><span class="hs-identifier hs-var">policyId</span></a></span><span>
</span><span id="line-253"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-254"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-255"></span><span>  </span><span class="annot"><a href="#local-6989586621680179055"><span class="hs-identifier hs-type">isSpendingFromInitial</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-256"></span><span>  </span><span id="local-6989586621680179055"><span class="annot"><span class="annottext">isSpendingFromInitial :: Bool
</span><a href="#local-6989586621680179055"><span class="hs-identifier hs-var hs-var">isSpendingFromInitial</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-257"></span><span>    </span><span class="annot"><span class="annottext">(TxOut CtxUTxO -&gt; Bool) -&gt; UTxO -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680179073"><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680179073"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; AddressInEra
forall ctx. TxOut ctx -&gt; AddressInEra
</span><span class="hs-identifier hs-var">txOutAddress</span></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680179073"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">AddressInEra -&gt; AddressInEra -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">AddressInEra
</span><a href="#local-6989586621680179075"><span class="hs-identifier hs-var">initialAddress</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UTxO -&gt; Tx -&gt; UTxO
</span><span class="hs-identifier hs-var">resolveInputsUTxO</span></span><span> </span><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621680179053"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680179054"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-258"></span><span>
</span><span id="line-259"></span><span>  </span><span id="local-6989586621680179075"><span class="annot"><span class="annottext">initialAddress :: AddressInEra
</span><a href="#local-6989586621680179075"><span class="hs-identifier hs-var hs-var">initialAddress</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NetworkId -&gt; PlutusScript PlutusScriptV3 -&gt; AddressInEra
forall lang era.
(IsShelleyBasedEra era, IsPlutusScriptLanguage lang) =&gt;
NetworkId -&gt; PlutusScript lang -&gt; AddressInEra era
</span><span class="hs-identifier hs-var">mkScriptAddress</span></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621680179052"><span class="hs-identifier hs-var">networkId</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript PlutusScriptV3
</span><span class="hs-identifier hs-var">initialValidatorScript</span></span><span>
</span><span id="line-260"></span><span>
</span><span id="line-261"></span><span>  </span><span id="local-6989586621680179059"><span class="annot"><span class="annottext">commitAddress :: AddressInEra
</span><a href="#local-6989586621680179059"><span class="hs-identifier hs-var hs-var">commitAddress</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NetworkId -&gt; PlutusScript PlutusScriptV3 -&gt; AddressInEra
forall lang era.
(IsShelleyBasedEra era, IsPlutusScriptLanguage lang) =&gt;
NetworkId -&gt; PlutusScript lang -&gt; AddressInEra era
</span><span class="hs-identifier hs-var">mkScriptAddress</span></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621680179052"><span class="hs-identifier hs-var">networkId</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript PlutusScriptV3
</span><span class="hs-identifier hs-var">commitValidatorScript</span></span><span>
</span><span id="line-262"></span><span>
</span><span id="line-263"></span><span class="hs-keyword">data</span><span> </span><span id="CollectComObservation"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CollectComObservation"><span class="hs-identifier hs-var">CollectComObservation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="CollectComObservation"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CollectComObservation"><span class="hs-identifier hs-var">CollectComObservation</span></a></span></span><span>
</span><span id="line-264"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AthreadOutput%3ACollectComObservation"><span class="annot"><span class="annottext">CollectComObservation -&gt; OpenThreadOutput
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AthreadOutput%3ACollectComObservation"><span class="hs-identifier hs-var hs-var">threadOutput</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">OpenThreadOutput</span></span><span>
</span><span id="line-265"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AheadId%3ACollectComObservation"><span class="annot"><span class="annottext">CollectComObservation -&gt; HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AheadId%3ACollectComObservation"><span class="hs-identifier hs-var hs-var">headId</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HeadId</span></span><span>
</span><span id="line-266"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AutxoHash%3ACollectComObservation"><span class="annot"><span class="annottext">CollectComObservation -&gt; UTxOHash
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AutxoHash%3ACollectComObservation"><span class="hs-identifier hs-var hs-var">utxoHash</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#UTxOHash"><span class="hs-identifier hs-type">UTxOHash</span></a></span><span>
</span><span id="line-267"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-268"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680179083"><span id="local-6989586621680179090"><span id="local-6989586621680179093"><span class="annot"><span class="annottext">Int -&gt; CollectComObservation -&gt; ShowS
[CollectComObservation] -&gt; ShowS
CollectComObservation -&gt; String
(Int -&gt; CollectComObservation -&gt; ShowS)
-&gt; (CollectComObservation -&gt; String)
-&gt; ([CollectComObservation] -&gt; ShowS)
-&gt; Show CollectComObservation
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; CollectComObservation -&gt; ShowS
showsPrec :: Int -&gt; CollectComObservation -&gt; ShowS
$cshow :: CollectComObservation -&gt; String
show :: CollectComObservation -&gt; String
$cshowList :: [CollectComObservation] -&gt; ShowS
showList :: [CollectComObservation] -&gt; ShowS
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680179096"><span id="local-6989586621680179102"><span class="annot"><span class="annottext">CollectComObservation -&gt; CollectComObservation -&gt; Bool
(CollectComObservation -&gt; CollectComObservation -&gt; Bool)
-&gt; (CollectComObservation -&gt; CollectComObservation -&gt; Bool)
-&gt; Eq CollectComObservation
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: CollectComObservation -&gt; CollectComObservation -&gt; Bool
== :: CollectComObservation -&gt; CollectComObservation -&gt; Bool
$c/= :: CollectComObservation -&gt; CollectComObservation -&gt; Bool
/= :: CollectComObservation -&gt; CollectComObservation -&gt; Bool
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680179105"><span id="local-6989586621680179107"><span class="annot"><span class="annottext">(forall x. CollectComObservation -&gt; Rep CollectComObservation x)
-&gt; (forall x. Rep CollectComObservation x -&gt; CollectComObservation)
-&gt; Generic CollectComObservation
forall x. Rep CollectComObservation x -&gt; CollectComObservation
forall x. CollectComObservation -&gt; Rep CollectComObservation x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. CollectComObservation -&gt; Rep CollectComObservation x
from :: forall x. CollectComObservation -&gt; Rep CollectComObservation x
$cto :: forall x. Rep CollectComObservation x -&gt; CollectComObservation
to :: forall x. Rep CollectComObservation x -&gt; CollectComObservation
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Generics.html#Generic"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-269"></span><span>
</span><span id="line-270"></span><span class="hs-comment">-- | Identify a collectCom tx by lookup up the input spending the Head output</span><span>
</span><span id="line-271"></span><span class="hs-comment">-- and decoding its redeemer.</span><span>
</span><span id="line-272"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#observeCollectComTx"><span class="hs-identifier hs-type">observeCollectComTx</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-273"></span><span>  </span><span class="annot"><span class="hs-comment">-- | A UTxO set to lookup tx inputs</span></span><span>
</span><span id="line-274"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-275"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-276"></span><span>  </span><span class="annot"><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CollectComObservation"><span class="hs-identifier hs-type">CollectComObservation</span></a></span><span>
</span><span id="line-277"></span><span id="observeCollectComTx"><span class="annot"><span class="annottext">observeCollectComTx :: UTxO -&gt; Tx -&gt; Maybe CollectComObservation
</span><a href="Hydra.Chain.Direct.Tx.html#observeCollectComTx"><span class="hs-identifier hs-var hs-var">observeCollectComTx</span></a></span></span><span> </span><span id="local-6989586621680179109"><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621680179109"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span id="local-6989586621680179110"><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680179110"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-278"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680179111"><span class="annot"><span class="annottext">inputUTxO :: UTxO
</span><a href="#local-6989586621680179111"><span class="hs-identifier hs-var hs-var">inputUTxO</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTxO -&gt; Tx -&gt; UTxO
</span><span class="hs-identifier hs-var">resolveInputsUTxO</span></span><span> </span><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621680179109"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680179110"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-279"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621680179112"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680179112"><span class="hs-identifier hs-var">headInput</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680179113"><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680179113"><span class="hs-identifier hs-var">headOutput</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UTxO -&gt; PlutusScript PlutusScriptV3 -&gt; Maybe (TxIn, TxOut CtxUTxO)
forall lang.
IsPlutusScriptLanguage lang =&gt;
UTxO -&gt; PlutusScript lang -&gt; Maybe (TxIn, TxOut CtxUTxO)
</span><span class="hs-identifier hs-var">findTxOutByScript</span></span><span> </span><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621680179111"><span class="hs-identifier hs-var">inputUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript PlutusScriptV3
</span><span class="hs-identifier hs-var">Head.validatorScript</span></span><span>
</span><span id="line-280"></span><span>  </span><span id="local-6989586621680179115"><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621680179115"><span class="hs-identifier hs-var">redeemer</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Tx -&gt; TxIn -&gt; Maybe Input
forall a. FromData a =&gt; Tx -&gt; TxIn -&gt; Maybe a
</span><span class="hs-identifier hs-var">findRedeemerSpending</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680179110"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680179112"><span class="hs-identifier hs-var">headInput</span></a></span><span>
</span><span id="line-281"></span><span>  </span><span id="local-6989586621680179117"><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621680179117"><span class="hs-identifier hs-var">oldHeadDatum</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx Era -&gt; Maybe HashableScriptData
forall era. TxOut CtxTx era -&gt; Maybe HashableScriptData
</span><span class="hs-identifier hs-var">txOutScriptData</span></span><span> </span><span class="annot"><span class="annottext">(TxOut CtxTx Era -&gt; Maybe HashableScriptData)
-&gt; TxOut CtxTx Era -&gt; Maybe HashableScriptData
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; TxOut CtxTx Era
forall era. TxOut CtxUTxO era -&gt; TxOut CtxTx era
forall {k} (f :: * -&gt; k -&gt; *) (era :: k).
ToTxContext f =&gt;
f CtxUTxO era -&gt; f CtxTx era
</span><span class="hs-identifier hs-var">toTxContext</span></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680179113"><span class="hs-identifier hs-var">headOutput</span></a></span><span>
</span><span id="line-282"></span><span>  </span><span id="local-6989586621680179119"><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621680179119"><span class="hs-identifier hs-var">datum</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HashableScriptData -&gt; Maybe State
forall a. FromScriptData a =&gt; HashableScriptData -&gt; Maybe a
</span><span class="hs-identifier hs-var">fromScriptData</span></span><span> </span><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621680179117"><span class="hs-identifier hs-var">oldHeadDatum</span></a></span><span>
</span><span id="line-283"></span><span>  </span><span id="local-6989586621680179120"><span class="annot"><span class="annottext">HeadId
</span><a href="#local-6989586621680179120"><span class="hs-identifier hs-var">headId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; Maybe HeadId
forall ctx. TxOut ctx -&gt; Maybe HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#findStateToken"><span class="hs-identifier hs-var">findStateToken</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680179113"><span class="hs-identifier hs-var">headOutput</span></a></span><span>
</span><span id="line-284"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621680179119"><span class="hs-identifier hs-var">datum</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621680179115"><span class="hs-identifier hs-var">redeemer</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-285"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Head.Initial</span></span><span class="hs-special">{</span><span id="local-6989586621680179122"><span class="annot"><span class="annottext">[Party]
parties :: [Party]
$sel:parties:Initial :: State -&gt; [Party]
</span><a href="#local-6989586621680179122"><span class="hs-identifier hs-var hs-var">parties</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680179124"><span class="annot"><span class="annottext">ContestationPeriod
contestationPeriod :: ContestationPeriod
$sel:contestationPeriod:Initial :: State -&gt; ContestationPeriod
</span><a href="#local-6989586621680179124"><span class="hs-identifier hs-var hs-var">contestationPeriod</span></a></span></span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Input
</span><span class="hs-identifier hs-var">Head.CollectCom</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-286"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621680179127"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680179127"><span class="hs-identifier hs-var">newHeadInput</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680179128"><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680179128"><span class="hs-identifier hs-var">newHeadOutput</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UTxO -&gt; PlutusScript PlutusScriptV3 -&gt; Maybe (TxIn, TxOut CtxUTxO)
forall lang.
IsPlutusScriptLanguage lang =&gt;
UTxO -&gt; PlutusScript lang -&gt; Maybe (TxIn, TxOut CtxUTxO)
</span><span class="hs-identifier hs-var">findTxOutByScript</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx -&gt; UTxO
</span><span class="hs-identifier hs-var">utxoFromTx</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680179110"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PlutusScript PlutusScriptV3
</span><span class="hs-identifier hs-var">Head.validatorScript</span></span><span>
</span><span id="line-287"></span><span>      </span><span id="local-6989586621680179130"><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621680179130"><span class="hs-identifier hs-var">newHeadDatum</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx Era -&gt; Maybe HashableScriptData
forall era. TxOut CtxTx era -&gt; Maybe HashableScriptData
</span><span class="hs-identifier hs-var">txOutScriptData</span></span><span> </span><span class="annot"><span class="annottext">(TxOut CtxTx Era -&gt; Maybe HashableScriptData)
-&gt; TxOut CtxTx Era -&gt; Maybe HashableScriptData
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; TxOut CtxTx Era
forall era. TxOut CtxUTxO era -&gt; TxOut CtxTx era
forall {k} (f :: * -&gt; k -&gt; *) (era :: k).
ToTxContext f =&gt;
f CtxUTxO era -&gt; f CtxTx era
</span><span class="hs-identifier hs-var">toTxContext</span></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680179128"><span class="hs-identifier hs-var">newHeadOutput</span></a></span><span>
</span><span id="line-288"></span><span>      </span><span id="local-6989586621680179131"><span class="annot"><span class="annottext">UTxOHash
</span><a href="#local-6989586621680179131"><span class="hs-identifier hs-var">utxoHash</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; UTxOHash
</span><a href="Hydra.Chain.Direct.Tx.html#UTxOHash"><span class="hs-identifier hs-var">UTxOHash</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; UTxOHash) -&gt; Maybe ByteString -&gt; Maybe UTxOHash
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HashableScriptData -&gt; Maybe ByteString
</span><a href="#local-6989586621680179132"><span class="hs-identifier hs-var">decodeUtxoHash</span></a></span><span> </span><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621680179130"><span class="hs-identifier hs-var">newHeadDatum</span></a></span><span>
</span><span id="line-289"></span><span>      </span><span class="annot"><span class="annottext">CollectComObservation -&gt; Maybe CollectComObservation
forall a. a -&gt; Maybe a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span>
</span><span id="line-290"></span><span>        </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CollectComObservation"><span class="hs-identifier hs-type">CollectComObservation</span></a></span><span>
</span><span id="line-291"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:threadOutput:CollectComObservation :: OpenThreadOutput
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AthreadOutput%3ACollectComObservation"><span class="hs-identifier hs-var">threadOutput</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-292"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">OpenThreadOutput</span></span><span>
</span><span id="line-293"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:openThreadUTxO:OpenThreadOutput :: (TxIn, TxOut CtxUTxO)
</span><span class="hs-identifier hs-var">openThreadUTxO</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680179127"><span class="hs-identifier hs-var">newHeadInput</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680179128"><span class="hs-identifier hs-var">newHeadOutput</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-294"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:openParties:OpenThreadOutput :: [Party]
</span><span class="hs-identifier hs-var">openParties</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621680179122"><span class="hs-identifier hs-var">parties</span></a></span><span>
</span><span id="line-295"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:openContestationPeriod:OpenThreadOutput :: ContestationPeriod
</span><span class="hs-identifier hs-var">openContestationPeriod</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ContestationPeriod
</span><a href="#local-6989586621680179124"><span class="hs-identifier hs-var">contestationPeriod</span></a></span><span>
</span><span id="line-296"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-297"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HeadId
$sel:headId:CollectComObservation :: HeadId
headId :: HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AheadId%3ACollectComObservation"><span class="hs-identifier hs-var hs-var">headId</span></a></span><span>
</span><span id="line-298"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UTxOHash
$sel:utxoHash:CollectComObservation :: UTxOHash
utxoHash :: UTxOHash
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AutxoHash%3ACollectComObservation"><span class="hs-identifier hs-var hs-var">utxoHash</span></a></span><span>
</span><span id="line-299"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-300"></span><span>    </span><span class="annot"><span class="annottext">(State, Input)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe CollectComObservation
forall a. Maybe a
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-301"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-302"></span><span>  </span><span id="local-6989586621680179132"><span class="annot"><span class="annottext">decodeUtxoHash :: HashableScriptData -&gt; Maybe ByteString
</span><a href="#local-6989586621680179132"><span class="hs-identifier hs-var hs-var">decodeUtxoHash</span></a></span></span><span> </span><span id="local-6989586621680179140"><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621680179140"><span class="hs-identifier hs-var">datum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-303"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HashableScriptData -&gt; Maybe State
forall a. FromScriptData a =&gt; HashableScriptData -&gt; Maybe a
</span><span class="hs-identifier hs-var">fromScriptData</span></span><span> </span><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621680179140"><span class="hs-identifier hs-var">datum</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-304"></span><span>      </span><span class="annot"><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Head.Open</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Head.OpenDatum</span></span><span class="hs-special">{</span><span id="local-6989586621680179143"><span class="annot"><span class="annottext">Hash
utxoHash :: Hash
$sel:utxoHash:OpenDatum :: OpenDatum -&gt; Hash
</span><a href="#local-6989586621680179143"><span class="hs-identifier hs-var hs-var">utxoHash</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe ByteString
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Maybe ByteString) -&gt; ByteString -&gt; Maybe ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Hash -&gt; FromBuiltin Hash
forall arep. HasFromBuiltin arep =&gt; arep -&gt; FromBuiltin arep
</span><span class="hs-identifier hs-var">fromBuiltin</span></span><span> </span><span class="annot"><span class="annottext">Hash
</span><a href="#local-6989586621680179143"><span class="hs-identifier hs-var">utxoHash</span></a></span><span>
</span><span id="line-305"></span><span>      </span><span class="annot"><span class="annottext">Maybe State
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
forall a. Maybe a
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-306"></span><span>
</span><span id="line-307"></span><span class="hs-keyword">data</span><span> </span><span id="IncrementObservation"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#IncrementObservation"><span class="hs-identifier hs-var">IncrementObservation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="IncrementObservation"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#IncrementObservation"><span class="hs-identifier hs-var">IncrementObservation</span></a></span></span><span>
</span><span id="line-308"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AheadId%3AIncrementObservation"><span class="annot"><span class="annottext">IncrementObservation -&gt; HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AheadId%3AIncrementObservation"><span class="hs-identifier hs-var hs-var">headId</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HeadId</span></span><span>
</span><span id="line-309"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AnewVersion%3AIncrementObservation"><span class="annot"><span class="annottext">IncrementObservation -&gt; SnapshotVersion
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AnewVersion%3AIncrementObservation"><span class="hs-identifier hs-var hs-var">newVersion</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SnapshotVersion</span></span><span>
</span><span id="line-310"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AdepositTxId%3AIncrementObservation"><span class="annot"><span class="annottext">IncrementObservation -&gt; TxId
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AdepositTxId%3AIncrementObservation"><span class="hs-identifier hs-var hs-var">depositTxId</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxId</span></span><span>
</span><span id="line-311"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-312"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680179150"><span id="local-6989586621680179158"><span id="local-6989586621680179161"><span class="annot"><span class="annottext">Int -&gt; IncrementObservation -&gt; ShowS
[IncrementObservation] -&gt; ShowS
IncrementObservation -&gt; String
(Int -&gt; IncrementObservation -&gt; ShowS)
-&gt; (IncrementObservation -&gt; String)
-&gt; ([IncrementObservation] -&gt; ShowS)
-&gt; Show IncrementObservation
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; IncrementObservation -&gt; ShowS
showsPrec :: Int -&gt; IncrementObservation -&gt; ShowS
$cshow :: IncrementObservation -&gt; String
show :: IncrementObservation -&gt; String
$cshowList :: [IncrementObservation] -&gt; ShowS
showList :: [IncrementObservation] -&gt; ShowS
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680179164"><span id="local-6989586621680179171"><span class="annot"><span class="annottext">IncrementObservation -&gt; IncrementObservation -&gt; Bool
(IncrementObservation -&gt; IncrementObservation -&gt; Bool)
-&gt; (IncrementObservation -&gt; IncrementObservation -&gt; Bool)
-&gt; Eq IncrementObservation
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: IncrementObservation -&gt; IncrementObservation -&gt; Bool
== :: IncrementObservation -&gt; IncrementObservation -&gt; Bool
$c/= :: IncrementObservation -&gt; IncrementObservation -&gt; Bool
/= :: IncrementObservation -&gt; IncrementObservation -&gt; Bool
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680179174"><span id="local-6989586621680179176"><span class="annot"><span class="annottext">(forall x. IncrementObservation -&gt; Rep IncrementObservation x)
-&gt; (forall x. Rep IncrementObservation x -&gt; IncrementObservation)
-&gt; Generic IncrementObservation
forall x. Rep IncrementObservation x -&gt; IncrementObservation
forall x. IncrementObservation -&gt; Rep IncrementObservation x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. IncrementObservation -&gt; Rep IncrementObservation x
from :: forall x. IncrementObservation -&gt; Rep IncrementObservation x
$cto :: forall x. Rep IncrementObservation x -&gt; IncrementObservation
to :: forall x. Rep IncrementObservation x -&gt; IncrementObservation
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Generics.html#Generic"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-313"></span><span>
</span><span id="line-314"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#observeIncrementTx"><span class="hs-identifier hs-type">observeIncrementTx</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-315"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-316"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-317"></span><span>  </span><span class="annot"><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#IncrementObservation"><span class="hs-identifier hs-type">IncrementObservation</span></a></span><span>
</span><span id="line-318"></span><span id="observeIncrementTx"><span class="annot"><span class="annottext">observeIncrementTx :: UTxO -&gt; Tx -&gt; Maybe IncrementObservation
</span><a href="Hydra.Chain.Direct.Tx.html#observeIncrementTx"><span class="hs-identifier hs-var hs-var">observeIncrementTx</span></a></span></span><span> </span><span id="local-6989586621680179178"><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621680179178"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span id="local-6989586621680179179"><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680179179"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-319"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680179180"><span class="annot"><span class="annottext">inputUTxO :: UTxO
</span><a href="#local-6989586621680179180"><span class="hs-identifier hs-var hs-var">inputUTxO</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTxO -&gt; Tx -&gt; UTxO
</span><span class="hs-identifier hs-var">resolveInputsUTxO</span></span><span> </span><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621680179178"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680179179"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-320"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621680179181"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680179181"><span class="hs-identifier hs-var">headInput</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680179182"><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680179182"><span class="hs-identifier hs-var">headOutput</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UTxO -&gt; PlutusScript PlutusScriptV3 -&gt; Maybe (TxIn, TxOut CtxUTxO)
forall lang.
IsPlutusScriptLanguage lang =&gt;
UTxO -&gt; PlutusScript lang -&gt; Maybe (TxIn, TxOut CtxUTxO)
</span><span class="hs-identifier hs-var">findTxOutByScript</span></span><span> </span><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621680179180"><span class="hs-identifier hs-var">inputUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript PlutusScriptV3
</span><span class="hs-identifier hs-var">Head.validatorScript</span></span><span>
</span><span id="line-321"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxIn</span></span><span> </span><span id="local-6989586621680179184"><span class="annot"><span class="annottext">TxId
</span><a href="#local-6989586621680179184"><span class="hs-identifier hs-var">depositTxId</span></a></span></span><span> </span><span class="annot"><span class="annottext">TxIx
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680179185"><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680179185"><span class="hs-identifier hs-var">depositOutput</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UTxO -&gt; PlutusScript PlutusScriptV3 -&gt; Maybe (TxIn, TxOut CtxUTxO)
forall lang.
IsPlutusScriptLanguage lang =&gt;
UTxO -&gt; PlutusScript lang -&gt; Maybe (TxIn, TxOut CtxUTxO)
</span><span class="hs-identifier hs-var">findTxOutByScript</span></span><span> </span><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621680179178"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript PlutusScriptV3
</span><span class="hs-identifier hs-var">depositValidatorScript</span></span><span>
</span><span id="line-322"></span><span>  </span><span id="local-6989586621680179186"><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621680179186"><span class="hs-identifier hs-var">dat</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx Era -&gt; Maybe HashableScriptData
forall era. TxOut CtxTx era -&gt; Maybe HashableScriptData
</span><span class="hs-identifier hs-var">txOutScriptData</span></span><span> </span><span class="annot"><span class="annottext">(TxOut CtxTx Era -&gt; Maybe HashableScriptData)
-&gt; TxOut CtxTx Era -&gt; Maybe HashableScriptData
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; TxOut CtxTx Era
forall era. TxOut CtxUTxO era -&gt; TxOut CtxTx era
forall {k} (f :: * -&gt; k -&gt; *) (era :: k).
ToTxContext f =&gt;
f CtxUTxO era -&gt; f CtxTx era
</span><span class="hs-identifier hs-var">toTxContext</span></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680179185"><span class="hs-identifier hs-var">depositOutput</span></a></span><span>
</span><span id="line-323"></span><span>  </span><span class="hs-comment">-- we need to be able to decode the datum, no need to use it tho</span><span>
</span><span id="line-324"></span><span>  </span><span class="annot"><span class="annottext">DepositDatum
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Deposit.DepositDatum</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HashableScriptData -&gt; Maybe DepositDatum
forall a. FromScriptData a =&gt; HashableScriptData -&gt; Maybe a
</span><span class="hs-identifier hs-var">fromScriptData</span></span><span> </span><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621680179186"><span class="hs-identifier hs-var">dat</span></a></span><span>
</span><span id="line-325"></span><span>  </span><span id="local-6989586621680179187"><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621680179187"><span class="hs-identifier hs-var">redeemer</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Tx -&gt; TxIn -&gt; Maybe Input
forall a. FromData a =&gt; Tx -&gt; TxIn -&gt; Maybe a
</span><span class="hs-identifier hs-var">findRedeemerSpending</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680179179"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680179181"><span class="hs-identifier hs-var">headInput</span></a></span><span>
</span><span id="line-326"></span><span>  </span><span id="local-6989586621680179188"><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621680179188"><span class="hs-identifier hs-var">oldHeadDatum</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx Era -&gt; Maybe HashableScriptData
forall era. TxOut CtxTx era -&gt; Maybe HashableScriptData
</span><span class="hs-identifier hs-var">txOutScriptData</span></span><span> </span><span class="annot"><span class="annottext">(TxOut CtxTx Era -&gt; Maybe HashableScriptData)
-&gt; TxOut CtxTx Era -&gt; Maybe HashableScriptData
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; TxOut CtxTx Era
forall era. TxOut CtxUTxO era -&gt; TxOut CtxTx era
forall {k} (f :: * -&gt; k -&gt; *) (era :: k).
ToTxContext f =&gt;
f CtxUTxO era -&gt; f CtxTx era
</span><span class="hs-identifier hs-var">toTxContext</span></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680179182"><span class="hs-identifier hs-var">headOutput</span></a></span><span>
</span><span id="line-327"></span><span>  </span><span id="local-6989586621680179189"><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621680179189"><span class="hs-identifier hs-var">datum</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HashableScriptData -&gt; Maybe State
forall a. FromScriptData a =&gt; HashableScriptData -&gt; Maybe a
</span><span class="hs-identifier hs-var">fromScriptData</span></span><span> </span><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621680179188"><span class="hs-identifier hs-var">oldHeadDatum</span></a></span><span>
</span><span id="line-328"></span><span>  </span><span id="local-6989586621680179190"><span class="annot"><span class="annottext">HeadId
</span><a href="#local-6989586621680179190"><span class="hs-identifier hs-var">headId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; Maybe HeadId
forall ctx. TxOut ctx -&gt; Maybe HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#findStateToken"><span class="hs-identifier hs-var">findStateToken</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680179182"><span class="hs-identifier hs-var">headOutput</span></a></span><span>
</span><span id="line-329"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621680179189"><span class="hs-identifier hs-var">datum</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621680179187"><span class="hs-identifier hs-var">redeemer</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-330"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Head.Open</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Head.Increment</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Head.IncrementRedeemer</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-331"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680179193"><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680179193"><span class="hs-identifier hs-var">newHeadOutput</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UTxO -&gt; PlutusScript PlutusScriptV3 -&gt; Maybe (TxIn, TxOut CtxUTxO)
forall lang.
IsPlutusScriptLanguage lang =&gt;
UTxO -&gt; PlutusScript lang -&gt; Maybe (TxIn, TxOut CtxUTxO)
</span><span class="hs-identifier hs-var">findTxOutByScript</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx -&gt; UTxO
</span><span class="hs-identifier hs-var">utxoFromTx</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680179179"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PlutusScript PlutusScriptV3
</span><span class="hs-identifier hs-var">Head.validatorScript</span></span><span>
</span><span id="line-332"></span><span>      </span><span id="local-6989586621680179194"><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621680179194"><span class="hs-identifier hs-var">newHeadDatum</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx Era -&gt; Maybe HashableScriptData
forall era. TxOut CtxTx era -&gt; Maybe HashableScriptData
</span><span class="hs-identifier hs-var">txOutScriptData</span></span><span> </span><span class="annot"><span class="annottext">(TxOut CtxTx Era -&gt; Maybe HashableScriptData)
-&gt; TxOut CtxTx Era -&gt; Maybe HashableScriptData
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; TxOut CtxTx Era
forall era. TxOut CtxUTxO era -&gt; TxOut CtxTx era
forall {k} (f :: * -&gt; k -&gt; *) (era :: k).
ToTxContext f =&gt;
f CtxUTxO era -&gt; f CtxTx era
</span><span class="hs-identifier hs-var">toTxContext</span></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680179193"><span class="hs-identifier hs-var">newHeadOutput</span></a></span><span>
</span><span id="line-333"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HashableScriptData -&gt; Maybe State
forall a. FromScriptData a =&gt; HashableScriptData -&gt; Maybe a
</span><span class="hs-identifier hs-var">fromScriptData</span></span><span> </span><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621680179194"><span class="hs-identifier hs-var">newHeadDatum</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-334"></span><span>        </span><span class="annot"><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Head.Open</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Head.OpenDatum</span></span><span class="hs-special">{</span><span id="local-6989586621680179195"><span class="annot"><span class="annottext">Integer
version :: Integer
$sel:version:OpenDatum :: OpenDatum -&gt; Integer
</span><a href="#local-6989586621680179195"><span class="hs-identifier hs-var hs-var">version</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-335"></span><span>          </span><span class="annot"><span class="annottext">IncrementObservation -&gt; Maybe IncrementObservation
forall a. a -&gt; Maybe a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span>
</span><span id="line-336"></span><span>            </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#IncrementObservation"><span class="hs-identifier hs-type">IncrementObservation</span></a></span><span>
</span><span id="line-337"></span><span>              </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">HeadId
$sel:headId:IncrementObservation :: HeadId
headId :: HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AheadId%3AIncrementObservation"><span class="hs-identifier hs-var hs-var">headId</span></a></span><span>
</span><span id="line-338"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:newVersion:IncrementObservation :: SnapshotVersion
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AnewVersion%3AIncrementObservation"><span class="hs-identifier hs-var">newVersion</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; SnapshotVersion
</span><span class="hs-identifier hs-var">fromChainSnapshotVersion</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680179195"><span class="hs-identifier hs-var">version</span></a></span><span>
</span><span id="line-339"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxId
$sel:depositTxId:IncrementObservation :: TxId
depositTxId :: TxId
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AdepositTxId%3AIncrementObservation"><span class="hs-identifier hs-var hs-var">depositTxId</span></a></span><span>
</span><span id="line-340"></span><span>              </span><span class="hs-special">}</span><span>
</span><span id="line-341"></span><span>        </span><span class="annot"><span class="annottext">Maybe State
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe IncrementObservation
forall a. Maybe a
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-342"></span><span>    </span><span class="annot"><span class="annottext">(State, Input)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe IncrementObservation
forall a. Maybe a
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-343"></span><span>
</span><span id="line-344"></span><span class="hs-keyword">data</span><span> </span><span id="DecrementObservation"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#DecrementObservation"><span class="hs-identifier hs-var">DecrementObservation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="DecrementObservation"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#DecrementObservation"><span class="hs-identifier hs-var">DecrementObservation</span></a></span></span><span>
</span><span id="line-345"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AheadId%3ADecrementObservation"><span class="annot"><span class="annottext">DecrementObservation -&gt; HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AheadId%3ADecrementObservation"><span class="hs-identifier hs-var hs-var">headId</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HeadId</span></span><span>
</span><span id="line-346"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AnewVersion%3ADecrementObservation"><span class="annot"><span class="annottext">DecrementObservation -&gt; SnapshotVersion
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AnewVersion%3ADecrementObservation"><span class="hs-identifier hs-var hs-var">newVersion</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SnapshotVersion</span></span><span>
</span><span id="line-347"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AdistributedOutputs%3ADecrementObservation"><span class="annot"><span class="annottext">DecrementObservation -&gt; [TxOut CtxUTxO]
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AdistributedOutputs%3ADecrementObservation"><span class="hs-identifier hs-var hs-var">distributedOutputs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CtxUTxO</span></span><span class="hs-special">]</span><span>
</span><span id="line-348"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-349"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680179202"><span id="local-6989586621680179209"><span id="local-6989586621680179212"><span class="annot"><span class="annottext">Int -&gt; DecrementObservation -&gt; ShowS
[DecrementObservation] -&gt; ShowS
DecrementObservation -&gt; String
(Int -&gt; DecrementObservation -&gt; ShowS)
-&gt; (DecrementObservation -&gt; String)
-&gt; ([DecrementObservation] -&gt; ShowS)
-&gt; Show DecrementObservation
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; DecrementObservation -&gt; ShowS
showsPrec :: Int -&gt; DecrementObservation -&gt; ShowS
$cshow :: DecrementObservation -&gt; String
show :: DecrementObservation -&gt; String
$cshowList :: [DecrementObservation] -&gt; ShowS
showList :: [DecrementObservation] -&gt; ShowS
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680179215"><span id="local-6989586621680179221"><span class="annot"><span class="annottext">DecrementObservation -&gt; DecrementObservation -&gt; Bool
(DecrementObservation -&gt; DecrementObservation -&gt; Bool)
-&gt; (DecrementObservation -&gt; DecrementObservation -&gt; Bool)
-&gt; Eq DecrementObservation
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: DecrementObservation -&gt; DecrementObservation -&gt; Bool
== :: DecrementObservation -&gt; DecrementObservation -&gt; Bool
$c/= :: DecrementObservation -&gt; DecrementObservation -&gt; Bool
/= :: DecrementObservation -&gt; DecrementObservation -&gt; Bool
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680179224"><span id="local-6989586621680179226"><span class="annot"><span class="annottext">(forall x. DecrementObservation -&gt; Rep DecrementObservation x)
-&gt; (forall x. Rep DecrementObservation x -&gt; DecrementObservation)
-&gt; Generic DecrementObservation
forall x. Rep DecrementObservation x -&gt; DecrementObservation
forall x. DecrementObservation -&gt; Rep DecrementObservation x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. DecrementObservation -&gt; Rep DecrementObservation x
from :: forall x. DecrementObservation -&gt; Rep DecrementObservation x
$cto :: forall x. Rep DecrementObservation x -&gt; DecrementObservation
to :: forall x. Rep DecrementObservation x -&gt; DecrementObservation
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Generics.html#Generic"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-350"></span><span>
</span><span id="line-351"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#observeDecrementTx"><span class="hs-identifier hs-type">observeDecrementTx</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-352"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-353"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-354"></span><span>  </span><span class="annot"><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#DecrementObservation"><span class="hs-identifier hs-type">DecrementObservation</span></a></span><span>
</span><span id="line-355"></span><span id="observeDecrementTx"><span class="annot"><span class="annottext">observeDecrementTx :: UTxO -&gt; Tx -&gt; Maybe DecrementObservation
</span><a href="Hydra.Chain.Direct.Tx.html#observeDecrementTx"><span class="hs-identifier hs-var hs-var">observeDecrementTx</span></a></span></span><span> </span><span id="local-6989586621680179228"><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621680179228"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span id="local-6989586621680179229"><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680179229"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-356"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680179230"><span class="annot"><span class="annottext">inputUTxO :: UTxO
</span><a href="#local-6989586621680179230"><span class="hs-identifier hs-var hs-var">inputUTxO</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTxO -&gt; Tx -&gt; UTxO
</span><span class="hs-identifier hs-var">resolveInputsUTxO</span></span><span> </span><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621680179228"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680179229"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-357"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621680179231"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680179231"><span class="hs-identifier hs-var">headInput</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680179232"><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680179232"><span class="hs-identifier hs-var">headOutput</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UTxO -&gt; PlutusScript PlutusScriptV3 -&gt; Maybe (TxIn, TxOut CtxUTxO)
forall lang.
IsPlutusScriptLanguage lang =&gt;
UTxO -&gt; PlutusScript lang -&gt; Maybe (TxIn, TxOut CtxUTxO)
</span><span class="hs-identifier hs-var">findTxOutByScript</span></span><span> </span><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621680179230"><span class="hs-identifier hs-var">inputUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript PlutusScriptV3
</span><span class="hs-identifier hs-var">Head.validatorScript</span></span><span>
</span><span id="line-358"></span><span>  </span><span id="local-6989586621680179233"><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621680179233"><span class="hs-identifier hs-var">redeemer</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Tx -&gt; TxIn -&gt; Maybe Input
forall a. FromData a =&gt; Tx -&gt; TxIn -&gt; Maybe a
</span><span class="hs-identifier hs-var">findRedeemerSpending</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680179229"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680179231"><span class="hs-identifier hs-var">headInput</span></a></span><span>
</span><span id="line-359"></span><span>  </span><span id="local-6989586621680179234"><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621680179234"><span class="hs-identifier hs-var">oldHeadDatum</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx Era -&gt; Maybe HashableScriptData
forall era. TxOut CtxTx era -&gt; Maybe HashableScriptData
</span><span class="hs-identifier hs-var">txOutScriptData</span></span><span> </span><span class="annot"><span class="annottext">(TxOut CtxTx Era -&gt; Maybe HashableScriptData)
-&gt; TxOut CtxTx Era -&gt; Maybe HashableScriptData
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; TxOut CtxTx Era
forall era. TxOut CtxUTxO era -&gt; TxOut CtxTx era
forall {k} (f :: * -&gt; k -&gt; *) (era :: k).
ToTxContext f =&gt;
f CtxUTxO era -&gt; f CtxTx era
</span><span class="hs-identifier hs-var">toTxContext</span></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680179232"><span class="hs-identifier hs-var">headOutput</span></a></span><span>
</span><span id="line-360"></span><span>  </span><span id="local-6989586621680179235"><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621680179235"><span class="hs-identifier hs-var">datum</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HashableScriptData -&gt; Maybe State
forall a. FromScriptData a =&gt; HashableScriptData -&gt; Maybe a
</span><span class="hs-identifier hs-var">fromScriptData</span></span><span> </span><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621680179234"><span class="hs-identifier hs-var">oldHeadDatum</span></a></span><span>
</span><span id="line-361"></span><span>  </span><span id="local-6989586621680179236"><span class="annot"><span class="annottext">HeadId
</span><a href="#local-6989586621680179236"><span class="hs-identifier hs-var">headId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; Maybe HeadId
forall ctx. TxOut ctx -&gt; Maybe HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#findStateToken"><span class="hs-identifier hs-var">findStateToken</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680179232"><span class="hs-identifier hs-var">headOutput</span></a></span><span>
</span><span id="line-362"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621680179235"><span class="hs-identifier hs-var">datum</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621680179233"><span class="hs-identifier hs-var">redeemer</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-363"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Head.Open</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Head.Decrement</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Head.DecrementRedeemer</span></span><span class="hs-special">{</span><span id="local-6989586621680179239"><span class="annot"><span class="annottext">Integer
numberOfDecommitOutputs :: Integer
$sel:numberOfDecommitOutputs:DecrementRedeemer :: DecrementRedeemer -&gt; Integer
</span><a href="#local-6989586621680179239"><span class="hs-identifier hs-var hs-var">numberOfDecommitOutputs</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-364"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680179241"><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680179241"><span class="hs-identifier hs-var">newHeadOutput</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UTxO -&gt; PlutusScript PlutusScriptV3 -&gt; Maybe (TxIn, TxOut CtxUTxO)
forall lang.
IsPlutusScriptLanguage lang =&gt;
UTxO -&gt; PlutusScript lang -&gt; Maybe (TxIn, TxOut CtxUTxO)
</span><span class="hs-identifier hs-var">findTxOutByScript</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx -&gt; UTxO
</span><span class="hs-identifier hs-var">utxoFromTx</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680179229"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PlutusScript PlutusScriptV3
</span><span class="hs-identifier hs-var">Head.validatorScript</span></span><span>
</span><span id="line-365"></span><span>      </span><span id="local-6989586621680179242"><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621680179242"><span class="hs-identifier hs-var">newHeadDatum</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx Era -&gt; Maybe HashableScriptData
forall era. TxOut CtxTx era -&gt; Maybe HashableScriptData
</span><span class="hs-identifier hs-var">txOutScriptData</span></span><span> </span><span class="annot"><span class="annottext">(TxOut CtxTx Era -&gt; Maybe HashableScriptData)
-&gt; TxOut CtxTx Era -&gt; Maybe HashableScriptData
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; TxOut CtxTx Era
forall era. TxOut CtxUTxO era -&gt; TxOut CtxTx era
forall {k} (f :: * -&gt; k -&gt; *) (era :: k).
ToTxContext f =&gt;
f CtxUTxO era -&gt; f CtxTx era
</span><span class="hs-identifier hs-var">toTxContext</span></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680179241"><span class="hs-identifier hs-var">newHeadOutput</span></a></span><span>
</span><span id="line-366"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HashableScriptData -&gt; Maybe State
forall a. FromScriptData a =&gt; HashableScriptData -&gt; Maybe a
</span><span class="hs-identifier hs-var">fromScriptData</span></span><span> </span><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621680179242"><span class="hs-identifier hs-var">newHeadDatum</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-367"></span><span>        </span><span class="annot"><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Head.Open</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Head.OpenDatum</span></span><span class="hs-special">{</span><span id="local-6989586621680179243"><span class="annot"><span class="annottext">Integer
$sel:version:OpenDatum :: OpenDatum -&gt; Integer
version :: Integer
</span><span class="hs-identifier hs-var hs-var">version</span></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-368"></span><span>          </span><span class="annot"><span class="annottext">DecrementObservation -&gt; Maybe DecrementObservation
forall a. a -&gt; Maybe a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span>
</span><span id="line-369"></span><span>            </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#DecrementObservation"><span class="hs-identifier hs-type">DecrementObservation</span></a></span><span>
</span><span id="line-370"></span><span>              </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">HeadId
$sel:headId:DecrementObservation :: HeadId
headId :: HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AheadId%3ADecrementObservation"><span class="hs-identifier hs-var hs-var">headId</span></a></span><span>
</span><span id="line-371"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:newVersion:DecrementObservation :: SnapshotVersion
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AnewVersion%3ADecrementObservation"><span class="hs-identifier hs-var">newVersion</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; SnapshotVersion
</span><span class="hs-identifier hs-var">fromChainSnapshotVersion</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680179243"><span class="hs-identifier hs-var">version</span></a></span><span>
</span><span id="line-372"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:distributedOutputs:DecrementObservation :: [TxOut CtxUTxO]
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AdistributedOutputs%3ADecrementObservation"><span class="hs-identifier hs-var">distributedOutputs</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-373"></span><span>                  </span><span class="annot"><span class="annottext">TxOut CtxTx Era -&gt; TxOut CtxUTxO
forall era. TxOut CtxTx era -&gt; TxOut CtxUTxO era
</span><span class="hs-identifier hs-var">toCtxUTxOTxOut</span></span><span> </span><span class="annot"><span class="annottext">(TxOut CtxTx Era -&gt; TxOut CtxUTxO)
-&gt; [TxOut CtxTx Era] -&gt; [TxOut CtxUTxO]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Tx -&gt; [TxOut CtxTx Era]
forall era. Tx era -&gt; [TxOut CtxTx era]
</span><span class="hs-identifier hs-var">txOuts'</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680179229"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-374"></span><span>                    </span><span class="annot"><span class="annottext">[TxOut CtxUTxO]
-&gt; ([TxOut CtxUTxO] -&gt; [TxOut CtxUTxO]) -&gt; [TxOut CtxUTxO]
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [TxOut CtxUTxO] -&gt; [TxOut CtxUTxO]
forall a. Int -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.List.html#drop"><span class="hs-identifier hs-var">drop</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-comment">-- NOTE: Head output must be in first position</span><span>
</span><span id="line-375"></span><span>                    </span><span class="annot"><span class="annottext">[TxOut CtxUTxO]
-&gt; ([TxOut CtxUTxO] -&gt; [TxOut CtxUTxO]) -&gt; [TxOut CtxUTxO]
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [TxOut CtxUTxO] -&gt; [TxOut CtxUTxO]
forall a. Int -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.List.html#take"><span class="hs-identifier hs-var">take</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680179239"><span class="hs-identifier hs-var">numberOfDecommitOutputs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-376"></span><span>              </span><span class="hs-special">}</span><span>
</span><span id="line-377"></span><span>        </span><span class="annot"><span class="annottext">Maybe State
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe DecrementObservation
forall a. Maybe a
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-378"></span><span>    </span><span class="annot"><span class="annottext">(State, Input)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe DecrementObservation
forall a. Maybe a
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-379"></span><span>
</span><span id="line-380"></span><span class="hs-keyword">data</span><span> </span><span id="CloseObservation"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CloseObservation"><span class="hs-identifier hs-var">CloseObservation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="CloseObservation"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CloseObservation"><span class="hs-identifier hs-var">CloseObservation</span></a></span></span><span>
</span><span id="line-381"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AthreadOutput%3ACloseObservation"><span class="annot"><span class="annottext">CloseObservation -&gt; ClosedThreadOutput
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AthreadOutput%3ACloseObservation"><span class="hs-identifier hs-var hs-var">threadOutput</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ClosedThreadOutput</span></span><span>
</span><span id="line-382"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AheadId%3ACloseObservation"><span class="annot"><span class="annottext">CloseObservation -&gt; HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AheadId%3ACloseObservation"><span class="hs-identifier hs-var hs-var">headId</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HeadId</span></span><span>
</span><span id="line-383"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AsnapshotNumber%3ACloseObservation"><span class="annot"><span class="annottext">CloseObservation -&gt; SnapshotNumber
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AsnapshotNumber%3ACloseObservation"><span class="hs-identifier hs-var hs-var">snapshotNumber</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SnapshotNumber</span></span><span>
</span><span id="line-384"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-385"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680179252"><span id="local-6989586621680179260"><span id="local-6989586621680179263"><span class="annot"><span class="annottext">Int -&gt; CloseObservation -&gt; ShowS
[CloseObservation] -&gt; ShowS
CloseObservation -&gt; String
(Int -&gt; CloseObservation -&gt; ShowS)
-&gt; (CloseObservation -&gt; String)
-&gt; ([CloseObservation] -&gt; ShowS)
-&gt; Show CloseObservation
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; CloseObservation -&gt; ShowS
showsPrec :: Int -&gt; CloseObservation -&gt; ShowS
$cshow :: CloseObservation -&gt; String
show :: CloseObservation -&gt; String
$cshowList :: [CloseObservation] -&gt; ShowS
showList :: [CloseObservation] -&gt; ShowS
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680179266"><span id="local-6989586621680179273"><span class="annot"><span class="annottext">CloseObservation -&gt; CloseObservation -&gt; Bool
(CloseObservation -&gt; CloseObservation -&gt; Bool)
-&gt; (CloseObservation -&gt; CloseObservation -&gt; Bool)
-&gt; Eq CloseObservation
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: CloseObservation -&gt; CloseObservation -&gt; Bool
== :: CloseObservation -&gt; CloseObservation -&gt; Bool
$c/= :: CloseObservation -&gt; CloseObservation -&gt; Bool
/= :: CloseObservation -&gt; CloseObservation -&gt; Bool
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680179276"><span id="local-6989586621680179278"><span class="annot"><span class="annottext">(forall x. CloseObservation -&gt; Rep CloseObservation x)
-&gt; (forall x. Rep CloseObservation x -&gt; CloseObservation)
-&gt; Generic CloseObservation
forall x. Rep CloseObservation x -&gt; CloseObservation
forall x. CloseObservation -&gt; Rep CloseObservation x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. CloseObservation -&gt; Rep CloseObservation x
from :: forall x. CloseObservation -&gt; Rep CloseObservation x
$cto :: forall x. Rep CloseObservation x -&gt; CloseObservation
to :: forall x. Rep CloseObservation x -&gt; CloseObservation
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Generics.html#Generic"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-386"></span><span>
</span><span id="line-387"></span><span class="hs-comment">-- | Identify a close tx by lookup up the input spending the Head output and</span><span>
</span><span id="line-388"></span><span class="hs-comment">-- decoding its redeemer.</span><span>
</span><span id="line-389"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#observeCloseTx"><span class="hs-identifier hs-type">observeCloseTx</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-390"></span><span>  </span><span class="annot"><span class="hs-comment">-- | A UTxO set to lookup tx inputs</span></span><span>
</span><span id="line-391"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-392"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-393"></span><span>  </span><span class="annot"><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CloseObservation"><span class="hs-identifier hs-type">CloseObservation</span></a></span><span>
</span><span id="line-394"></span><span id="observeCloseTx"><span class="annot"><span class="annottext">observeCloseTx :: UTxO -&gt; Tx -&gt; Maybe CloseObservation
</span><a href="Hydra.Chain.Direct.Tx.html#observeCloseTx"><span class="hs-identifier hs-var hs-var">observeCloseTx</span></a></span></span><span> </span><span id="local-6989586621680179280"><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621680179280"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span id="local-6989586621680179281"><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680179281"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-395"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680179282"><span class="annot"><span class="annottext">inputUTxO :: UTxO
</span><a href="#local-6989586621680179282"><span class="hs-identifier hs-var hs-var">inputUTxO</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTxO -&gt; Tx -&gt; UTxO
</span><span class="hs-identifier hs-var">resolveInputsUTxO</span></span><span> </span><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621680179280"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680179281"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-396"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621680179283"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680179283"><span class="hs-identifier hs-var">headInput</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680179284"><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680179284"><span class="hs-identifier hs-var">headOutput</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UTxO -&gt; PlutusScript PlutusScriptV3 -&gt; Maybe (TxIn, TxOut CtxUTxO)
forall lang.
IsPlutusScriptLanguage lang =&gt;
UTxO -&gt; PlutusScript lang -&gt; Maybe (TxIn, TxOut CtxUTxO)
</span><span class="hs-identifier hs-var">findTxOutByScript</span></span><span> </span><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621680179282"><span class="hs-identifier hs-var">inputUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript PlutusScriptV3
</span><span class="hs-identifier hs-var">Head.validatorScript</span></span><span>
</span><span id="line-397"></span><span>  </span><span id="local-6989586621680179285"><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621680179285"><span class="hs-identifier hs-var">redeemer</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Tx -&gt; TxIn -&gt; Maybe Input
forall a. FromData a =&gt; Tx -&gt; TxIn -&gt; Maybe a
</span><span class="hs-identifier hs-var">findRedeemerSpending</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680179281"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680179283"><span class="hs-identifier hs-var">headInput</span></a></span><span>
</span><span id="line-398"></span><span>  </span><span id="local-6989586621680179286"><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621680179286"><span class="hs-identifier hs-var">oldHeadDatum</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx Era -&gt; Maybe HashableScriptData
forall era. TxOut CtxTx era -&gt; Maybe HashableScriptData
</span><span class="hs-identifier hs-var">txOutScriptData</span></span><span> </span><span class="annot"><span class="annottext">(TxOut CtxTx Era -&gt; Maybe HashableScriptData)
-&gt; TxOut CtxTx Era -&gt; Maybe HashableScriptData
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; TxOut CtxTx Era
forall era. TxOut CtxUTxO era -&gt; TxOut CtxTx era
forall {k} (f :: * -&gt; k -&gt; *) (era :: k).
ToTxContext f =&gt;
f CtxUTxO era -&gt; f CtxTx era
</span><span class="hs-identifier hs-var">toTxContext</span></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680179284"><span class="hs-identifier hs-var">headOutput</span></a></span><span>
</span><span id="line-399"></span><span>  </span><span id="local-6989586621680179287"><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621680179287"><span class="hs-identifier hs-var">datum</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HashableScriptData -&gt; Maybe State
forall a. FromScriptData a =&gt; HashableScriptData -&gt; Maybe a
</span><span class="hs-identifier hs-var">fromScriptData</span></span><span> </span><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621680179286"><span class="hs-identifier hs-var">oldHeadDatum</span></a></span><span>
</span><span id="line-400"></span><span>  </span><span id="local-6989586621680179288"><span class="annot"><span class="annottext">HeadId
</span><a href="#local-6989586621680179288"><span class="hs-identifier hs-var">headId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; Maybe HeadId
forall ctx. TxOut ctx -&gt; Maybe HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#findStateToken"><span class="hs-identifier hs-var">findStateToken</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680179284"><span class="hs-identifier hs-var">headOutput</span></a></span><span>
</span><span id="line-401"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621680179287"><span class="hs-identifier hs-var">datum</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621680179285"><span class="hs-identifier hs-var">redeemer</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-402"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Head.Open</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Head.OpenDatum</span></span><span class="hs-special">{</span><span id="local-6989586621680179289"><span class="annot"><span class="annottext">[Party]
parties :: [Party]
$sel:parties:OpenDatum :: OpenDatum -&gt; [Party]
</span><a href="#local-6989586621680179289"><span class="hs-identifier hs-var hs-var">parties</span></a></span></span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Head.Close</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-403"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621680179292"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680179292"><span class="hs-identifier hs-var">newHeadInput</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680179293"><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680179293"><span class="hs-identifier hs-var">newHeadOutput</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UTxO -&gt; PlutusScript PlutusScriptV3 -&gt; Maybe (TxIn, TxOut CtxUTxO)
forall lang.
IsPlutusScriptLanguage lang =&gt;
UTxO -&gt; PlutusScript lang -&gt; Maybe (TxIn, TxOut CtxUTxO)
</span><span class="hs-identifier hs-var">findTxOutByScript</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx -&gt; UTxO
</span><span class="hs-identifier hs-var">utxoFromTx</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680179281"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PlutusScript PlutusScriptV3
</span><span class="hs-identifier hs-var">Head.validatorScript</span></span><span>
</span><span id="line-404"></span><span>      </span><span id="local-6989586621680179294"><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621680179294"><span class="hs-identifier hs-var">newHeadDatum</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx Era -&gt; Maybe HashableScriptData
forall era. TxOut CtxTx era -&gt; Maybe HashableScriptData
</span><span class="hs-identifier hs-var">txOutScriptData</span></span><span> </span><span class="annot"><span class="annottext">(TxOut CtxTx Era -&gt; Maybe HashableScriptData)
-&gt; TxOut CtxTx Era -&gt; Maybe HashableScriptData
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; TxOut CtxTx Era
forall era. TxOut CtxUTxO era -&gt; TxOut CtxTx era
forall {k} (f :: * -&gt; k -&gt; *) (era :: k).
ToTxContext f =&gt;
f CtxUTxO era -&gt; f CtxTx era
</span><span class="hs-identifier hs-var">toTxContext</span></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680179293"><span class="hs-identifier hs-var">newHeadOutput</span></a></span><span>
</span><span id="line-405"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621680179295"><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621680179295"><span class="hs-identifier hs-var">closeContestationDeadline</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680179296"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680179296"><span class="hs-identifier hs-var">onChainSnapshotNumber</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HashableScriptData -&gt; Maybe State
forall a. FromScriptData a =&gt; HashableScriptData -&gt; Maybe a
</span><span class="hs-identifier hs-var">fromScriptData</span></span><span> </span><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621680179294"><span class="hs-identifier hs-var">newHeadDatum</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-406"></span><span>        </span><span class="annot"><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Head.Closed</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Head.ClosedDatum</span></span><span class="hs-special">{</span><span id="local-6989586621680179299"><span class="annot"><span class="annottext">POSIXTime
contestationDeadline :: POSIXTime
$sel:contestationDeadline:ClosedDatum :: ClosedDatum -&gt; POSIXTime
</span><a href="#local-6989586621680179299"><span class="hs-identifier hs-var hs-var">contestationDeadline</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680179301"><span class="annot"><span class="annottext">Integer
snapshotNumber :: Integer
$sel:snapshotNumber:ClosedDatum :: ClosedDatum -&gt; Integer
</span><a href="#local-6989586621680179301"><span class="hs-identifier hs-var hs-var">snapshotNumber</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-407"></span><span>          </span><span class="annot"><span class="annottext">(POSIXTime, Integer) -&gt; Maybe (POSIXTime, Integer)
forall a. a -&gt; Maybe a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621680179299"><span class="hs-identifier hs-var">contestationDeadline</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680179301"><span class="hs-identifier hs-var">snapshotNumber</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-408"></span><span>        </span><span class="annot"><span class="annottext">Maybe State
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (POSIXTime, Integer)
forall a. Maybe a
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-409"></span><span>      </span><span class="annot"><span class="annottext">CloseObservation -&gt; Maybe CloseObservation
forall a. a -&gt; Maybe a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span>
</span><span id="line-410"></span><span>        </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#CloseObservation"><span class="hs-identifier hs-type">CloseObservation</span></a></span><span>
</span><span id="line-411"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:threadOutput:CloseObservation :: ClosedThreadOutput
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AthreadOutput%3ACloseObservation"><span class="hs-identifier hs-var">threadOutput</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-412"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">ClosedThreadOutput</span></span><span>
</span><span id="line-413"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:closedThreadUTxO:ClosedThreadOutput :: (TxIn, TxOut CtxUTxO)
</span><span class="hs-identifier hs-var">closedThreadUTxO</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680179292"><span class="hs-identifier hs-var">newHeadInput</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680179293"><span class="hs-identifier hs-var">newHeadOutput</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-414"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:closedParties:ClosedThreadOutput :: [Party]
</span><span class="hs-identifier hs-var">closedParties</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Party]
</span><a href="#local-6989586621680179289"><span class="hs-identifier hs-var">parties</span></a></span><span>
</span><span id="line-415"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:closedContestationDeadline:ClosedThreadOutput :: POSIXTime
</span><span class="hs-identifier hs-var">closedContestationDeadline</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621680179295"><span class="hs-identifier hs-var">closeContestationDeadline</span></a></span><span>
</span><span id="line-416"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:closedContesters:ClosedThreadOutput :: [PubKeyHash]
</span><span class="hs-identifier hs-var">closedContesters</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-417"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-418"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HeadId
$sel:headId:CloseObservation :: HeadId
headId :: HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AheadId%3ACloseObservation"><span class="hs-identifier hs-var hs-var">headId</span></a></span><span>
</span><span id="line-419"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:snapshotNumber:CloseObservation :: SnapshotNumber
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AsnapshotNumber%3ACloseObservation"><span class="hs-identifier hs-var">snapshotNumber</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; SnapshotNumber
</span><span class="hs-identifier hs-var">fromChainSnapshotNumber</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680179296"><span class="hs-identifier hs-var">onChainSnapshotNumber</span></a></span><span>
</span><span id="line-420"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-421"></span><span>    </span><span class="annot"><span class="annottext">(State, Input)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe CloseObservation
forall a. Maybe a
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-422"></span><span>
</span><span id="line-423"></span><span class="hs-keyword">data</span><span> </span><span id="ContestObservation"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#ContestObservation"><span class="hs-identifier hs-var">ContestObservation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ContestObservation"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#ContestObservation"><span class="hs-identifier hs-var">ContestObservation</span></a></span></span><span>
</span><span id="line-424"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AcontestedThreadOutput%3AContestObservation"><span class="annot"><span class="annottext">ContestObservation -&gt; (TxIn, TxOut CtxUTxO)
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AcontestedThreadOutput%3AContestObservation"><span class="hs-identifier hs-var hs-var">contestedThreadOutput</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxIn</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CtxUTxO</span></span><span class="hs-special">)</span><span>
</span><span id="line-425"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AheadId%3AContestObservation"><span class="annot"><span class="annottext">ContestObservation -&gt; HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AheadId%3AContestObservation"><span class="hs-identifier hs-var hs-var">headId</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HeadId</span></span><span>
</span><span id="line-426"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AsnapshotNumber%3AContestObservation"><span class="annot"><span class="annottext">ContestObservation -&gt; SnapshotNumber
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AsnapshotNumber%3AContestObservation"><span class="hs-identifier hs-var hs-var">snapshotNumber</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SnapshotNumber</span></span><span>
</span><span id="line-427"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AcontestationDeadline%3AContestObservation"><span class="annot"><span class="annottext">ContestObservation -&gt; UTCTime
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AcontestationDeadline%3AContestObservation"><span class="hs-identifier hs-var hs-var">contestationDeadline</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/time-1.12.2/src/Data.Time.Clock.Internal.UTCTime.html#UTCTime"><span class="hs-identifier hs-type">UTCTime</span></a></span><span>
</span><span id="line-428"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3Acontesters%3AContestObservation"><span class="annot"><span class="annottext">ContestObservation -&gt; [PubKeyHash]
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3Acontesters%3AContestObservation"><span class="hs-identifier hs-var hs-var">contesters</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Plutus.PubKeyHash</span></span><span class="hs-special">]</span><span>
</span><span id="line-429"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-430"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680179315"><span id="local-6989586621680179327"><span id="local-6989586621680179330"><span class="annot"><span class="annottext">Int -&gt; ContestObservation -&gt; ShowS
[ContestObservation] -&gt; ShowS
ContestObservation -&gt; String
(Int -&gt; ContestObservation -&gt; ShowS)
-&gt; (ContestObservation -&gt; String)
-&gt; ([ContestObservation] -&gt; ShowS)
-&gt; Show ContestObservation
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; ContestObservation -&gt; ShowS
showsPrec :: Int -&gt; ContestObservation -&gt; ShowS
$cshow :: ContestObservation -&gt; String
show :: ContestObservation -&gt; String
$cshowList :: [ContestObservation] -&gt; ShowS
showList :: [ContestObservation] -&gt; ShowS
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680179334"><span id="local-6989586621680179345"><span class="annot"><span class="annottext">ContestObservation -&gt; ContestObservation -&gt; Bool
(ContestObservation -&gt; ContestObservation -&gt; Bool)
-&gt; (ContestObservation -&gt; ContestObservation -&gt; Bool)
-&gt; Eq ContestObservation
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: ContestObservation -&gt; ContestObservation -&gt; Bool
== :: ContestObservation -&gt; ContestObservation -&gt; Bool
$c/= :: ContestObservation -&gt; ContestObservation -&gt; Bool
/= :: ContestObservation -&gt; ContestObservation -&gt; Bool
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680179349"><span id="local-6989586621680179351"><span class="annot"><span class="annottext">(forall x. ContestObservation -&gt; Rep ContestObservation x)
-&gt; (forall x. Rep ContestObservation x -&gt; ContestObservation)
-&gt; Generic ContestObservation
forall x. Rep ContestObservation x -&gt; ContestObservation
forall x. ContestObservation -&gt; Rep ContestObservation x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. ContestObservation -&gt; Rep ContestObservation x
from :: forall x. ContestObservation -&gt; Rep ContestObservation x
$cto :: forall x. Rep ContestObservation x -&gt; ContestObservation
to :: forall x. Rep ContestObservation x -&gt; ContestObservation
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Generics.html#Generic"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-431"></span><span>
</span><span id="line-432"></span><span class="hs-comment">-- | Identify a close tx by lookup up the input spending the Head output and</span><span>
</span><span id="line-433"></span><span class="hs-comment">-- decoding its redeemer.</span><span>
</span><span id="line-434"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#observeContestTx"><span class="hs-identifier hs-type">observeContestTx</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-435"></span><span>  </span><span class="annot"><span class="hs-comment">-- | A UTxO set to lookup tx inputs</span></span><span>
</span><span id="line-436"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-437"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-438"></span><span>  </span><span class="annot"><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#ContestObservation"><span class="hs-identifier hs-type">ContestObservation</span></a></span><span>
</span><span id="line-439"></span><span id="observeContestTx"><span class="annot"><span class="annottext">observeContestTx :: UTxO -&gt; Tx -&gt; Maybe ContestObservation
</span><a href="Hydra.Chain.Direct.Tx.html#observeContestTx"><span class="hs-identifier hs-var hs-var">observeContestTx</span></a></span></span><span> </span><span id="local-6989586621680179353"><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621680179353"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span id="local-6989586621680179354"><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680179354"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-440"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680179355"><span class="annot"><span class="annottext">inputUTxO :: UTxO
</span><a href="#local-6989586621680179355"><span class="hs-identifier hs-var hs-var">inputUTxO</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTxO -&gt; Tx -&gt; UTxO
</span><span class="hs-identifier hs-var">resolveInputsUTxO</span></span><span> </span><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621680179353"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680179354"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-441"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621680179356"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680179356"><span class="hs-identifier hs-var">headInput</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680179357"><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680179357"><span class="hs-identifier hs-var">headOutput</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UTxO -&gt; PlutusScript PlutusScriptV3 -&gt; Maybe (TxIn, TxOut CtxUTxO)
forall lang.
IsPlutusScriptLanguage lang =&gt;
UTxO -&gt; PlutusScript lang -&gt; Maybe (TxIn, TxOut CtxUTxO)
</span><span class="hs-identifier hs-var">findTxOutByScript</span></span><span> </span><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621680179355"><span class="hs-identifier hs-var">inputUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript PlutusScriptV3
</span><span class="hs-identifier hs-var">Head.validatorScript</span></span><span>
</span><span id="line-442"></span><span>  </span><span id="local-6989586621680179358"><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621680179358"><span class="hs-identifier hs-var">redeemer</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Tx -&gt; TxIn -&gt; Maybe Input
forall a. FromData a =&gt; Tx -&gt; TxIn -&gt; Maybe a
</span><span class="hs-identifier hs-var">findRedeemerSpending</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680179354"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680179356"><span class="hs-identifier hs-var">headInput</span></a></span><span>
</span><span id="line-443"></span><span>  </span><span id="local-6989586621680179359"><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621680179359"><span class="hs-identifier hs-var">oldHeadDatum</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx Era -&gt; Maybe HashableScriptData
forall era. TxOut CtxTx era -&gt; Maybe HashableScriptData
</span><span class="hs-identifier hs-var">txOutScriptData</span></span><span> </span><span class="annot"><span class="annottext">(TxOut CtxTx Era -&gt; Maybe HashableScriptData)
-&gt; TxOut CtxTx Era -&gt; Maybe HashableScriptData
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; TxOut CtxTx Era
forall era. TxOut CtxUTxO era -&gt; TxOut CtxTx era
forall {k} (f :: * -&gt; k -&gt; *) (era :: k).
ToTxContext f =&gt;
f CtxUTxO era -&gt; f CtxTx era
</span><span class="hs-identifier hs-var">toTxContext</span></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680179357"><span class="hs-identifier hs-var">headOutput</span></a></span><span>
</span><span id="line-444"></span><span>  </span><span id="local-6989586621680179360"><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621680179360"><span class="hs-identifier hs-var">datum</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HashableScriptData -&gt; Maybe State
forall a. FromScriptData a =&gt; HashableScriptData -&gt; Maybe a
</span><span class="hs-identifier hs-var">fromScriptData</span></span><span> </span><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621680179359"><span class="hs-identifier hs-var">oldHeadDatum</span></a></span><span>
</span><span id="line-445"></span><span>  </span><span id="local-6989586621680179361"><span class="annot"><span class="annottext">HeadId
</span><a href="#local-6989586621680179361"><span class="hs-identifier hs-var">headId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; Maybe HeadId
forall ctx. TxOut ctx -&gt; Maybe HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#findStateToken"><span class="hs-identifier hs-var">findStateToken</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680179357"><span class="hs-identifier hs-var">headOutput</span></a></span><span>
</span><span id="line-446"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621680179360"><span class="hs-identifier hs-var">datum</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621680179358"><span class="hs-identifier hs-var">redeemer</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-447"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Head.Closed</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Head.ClosedDatum</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Head.Contest</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-448"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621680179363"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680179363"><span class="hs-identifier hs-var">newHeadInput</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680179364"><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680179364"><span class="hs-identifier hs-var">newHeadOutput</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UTxO -&gt; PlutusScript PlutusScriptV3 -&gt; Maybe (TxIn, TxOut CtxUTxO)
forall lang.
IsPlutusScriptLanguage lang =&gt;
UTxO -&gt; PlutusScript lang -&gt; Maybe (TxIn, TxOut CtxUTxO)
</span><span class="hs-identifier hs-var">findTxOutByScript</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx -&gt; UTxO
</span><span class="hs-identifier hs-var">utxoFromTx</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680179354"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PlutusScript PlutusScriptV3
</span><span class="hs-identifier hs-var">Head.validatorScript</span></span><span>
</span><span id="line-449"></span><span>      </span><span id="local-6989586621680179365"><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621680179365"><span class="hs-identifier hs-var">newHeadDatum</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx Era -&gt; Maybe HashableScriptData
forall era. TxOut CtxTx era -&gt; Maybe HashableScriptData
</span><span class="hs-identifier hs-var">txOutScriptData</span></span><span> </span><span class="annot"><span class="annottext">(TxOut CtxTx Era -&gt; Maybe HashableScriptData)
-&gt; TxOut CtxTx Era -&gt; Maybe HashableScriptData
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; TxOut CtxTx Era
forall era. TxOut CtxUTxO era -&gt; TxOut CtxTx era
forall {k} (f :: * -&gt; k -&gt; *) (era :: k).
ToTxContext f =&gt;
f CtxUTxO era -&gt; f CtxTx era
</span><span class="hs-identifier hs-var">toTxContext</span></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680179364"><span class="hs-identifier hs-var">newHeadOutput</span></a></span><span>
</span><span id="line-450"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680179366"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680179366"><span class="hs-identifier hs-var">onChainSnapshotNumber</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680179367"><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621680179367"><span class="hs-identifier hs-var">contestationDeadline</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680179368"><span class="annot"><span class="annottext">[PubKeyHash]
</span><a href="#local-6989586621680179368"><span class="hs-identifier hs-var">contesters</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashableScriptData -&gt; (Integer, POSIXTime, [PubKeyHash])
</span><a href="#local-6989586621680179369"><span class="hs-identifier hs-var">decodeDatum</span></a></span><span> </span><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621680179365"><span class="hs-identifier hs-var">newHeadDatum</span></a></span><span>
</span><span id="line-451"></span><span>      </span><span class="annot"><span class="annottext">ContestObservation -&gt; Maybe ContestObservation
forall a. a -&gt; Maybe a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span>
</span><span id="line-452"></span><span>        </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#ContestObservation"><span class="hs-identifier hs-type">ContestObservation</span></a></span><span>
</span><span id="line-453"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:contestedThreadOutput:ContestObservation :: (TxIn, TxOut CtxUTxO)
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AcontestedThreadOutput%3AContestObservation"><span class="hs-identifier hs-var">contestedThreadOutput</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680179363"><span class="hs-identifier hs-var">newHeadInput</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680179364"><span class="hs-identifier hs-var">newHeadOutput</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-454"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HeadId
$sel:headId:ContestObservation :: HeadId
headId :: HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AheadId%3AContestObservation"><span class="hs-identifier hs-var hs-var">headId</span></a></span><span>
</span><span id="line-455"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:snapshotNumber:ContestObservation :: SnapshotNumber
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AsnapshotNumber%3AContestObservation"><span class="hs-identifier hs-var">snapshotNumber</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; SnapshotNumber
</span><span class="hs-identifier hs-var">fromChainSnapshotNumber</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680179366"><span class="hs-identifier hs-var">onChainSnapshotNumber</span></a></span><span>
</span><span id="line-456"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:contestationDeadline:ContestObservation :: UTCTime
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AcontestationDeadline%3AContestObservation"><span class="hs-identifier hs-var">contestationDeadline</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">POSIXTime -&gt; UTCTime
</span><span class="hs-identifier hs-var">posixToUTCTime</span></span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621680179367"><span class="hs-identifier hs-var">contestationDeadline</span></a></span><span>
</span><span id="line-457"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[PubKeyHash]
$sel:contesters:ContestObservation :: [PubKeyHash]
contesters :: [PubKeyHash]
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3Acontesters%3AContestObservation"><span class="hs-identifier hs-var hs-var">contesters</span></a></span><span>
</span><span id="line-458"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-459"></span><span>    </span><span class="annot"><span class="annottext">(State, Input)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe ContestObservation
forall a. Maybe a
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-460"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-461"></span><span>  </span><span id="local-6989586621680179369"><span class="annot"><span class="annottext">decodeDatum :: HashableScriptData -&gt; (Integer, POSIXTime, [PubKeyHash])
</span><a href="#local-6989586621680179369"><span class="hs-identifier hs-var hs-var">decodeDatum</span></a></span></span><span> </span><span id="local-6989586621680179379"><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621680179379"><span class="hs-identifier hs-var">headDatum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-462"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HashableScriptData -&gt; Maybe State
forall a. FromScriptData a =&gt; HashableScriptData -&gt; Maybe a
</span><span class="hs-identifier hs-var">fromScriptData</span></span><span> </span><span class="annot"><span class="annottext">HashableScriptData
</span><a href="#local-6989586621680179379"><span class="hs-identifier hs-var">headDatum</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-463"></span><span>      </span><span class="annot"><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Head.Closed</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Head.ClosedDatum</span></span><span class="hs-special">{</span><span id="local-6989586621680179380"><span class="annot"><span class="annottext">Integer
$sel:snapshotNumber:ClosedDatum :: ClosedDatum -&gt; Integer
snapshotNumber :: Integer
</span><span class="hs-identifier hs-var hs-var">snapshotNumber</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680179381"><span class="annot"><span class="annottext">POSIXTime
$sel:contestationDeadline:ClosedDatum :: ClosedDatum -&gt; POSIXTime
contestationDeadline :: POSIXTime
</span><span class="hs-identifier hs-var hs-var">contestationDeadline</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680179382"><span class="annot"><span class="annottext">[PubKeyHash]
contesters :: [PubKeyHash]
$sel:contesters:ClosedDatum :: ClosedDatum -&gt; [PubKeyHash]
</span><a href="#local-6989586621680179382"><span class="hs-identifier hs-var hs-var">contesters</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-464"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680179380"><span class="hs-identifier hs-var">snapshotNumber</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621680179381"><span class="hs-identifier hs-var">contestationDeadline</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[PubKeyHash]
</span><a href="#local-6989586621680179382"><span class="hs-identifier hs-var">contesters</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-465"></span><span>      </span><span class="annot"><span class="annottext">Maybe State
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; (Integer, POSIXTime, [PubKeyHash])
forall a t. (HasCallStack, IsText t) =&gt; t -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;wrong state in output datum&quot;</span></span><span>
</span><span id="line-466"></span><span>
</span><span id="line-467"></span><span class="hs-keyword">newtype</span><span> </span><span id="FanoutObservation"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#FanoutObservation"><span class="hs-identifier hs-var">FanoutObservation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="FanoutObservation"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#FanoutObservation"><span class="hs-identifier hs-var">FanoutObservation</span></a></span></span><span> </span><span class="hs-special">{</span><span id="%24sel%3AheadId%3AFanoutObservation"><span class="annot"><span class="annottext">FanoutObservation -&gt; HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AheadId%3AFanoutObservation"><span class="hs-identifier hs-var hs-var">headId</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HeadId</span></span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680179388"><span id="local-6989586621680179391"><span class="annot"><span class="annottext">FanoutObservation -&gt; FanoutObservation -&gt; Bool
(FanoutObservation -&gt; FanoutObservation -&gt; Bool)
-&gt; (FanoutObservation -&gt; FanoutObservation -&gt; Bool)
-&gt; Eq FanoutObservation
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: FanoutObservation -&gt; FanoutObservation -&gt; Bool
== :: FanoutObservation -&gt; FanoutObservation -&gt; Bool
$c/= :: FanoutObservation -&gt; FanoutObservation -&gt; Bool
/= :: FanoutObservation -&gt; FanoutObservation -&gt; Bool
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680179394"><span id="local-6989586621680179398"><span id="local-6989586621680179401"><span class="annot"><span class="annottext">Int -&gt; FanoutObservation -&gt; ShowS
[FanoutObservation] -&gt; ShowS
FanoutObservation -&gt; String
(Int -&gt; FanoutObservation -&gt; ShowS)
-&gt; (FanoutObservation -&gt; String)
-&gt; ([FanoutObservation] -&gt; ShowS)
-&gt; Show FanoutObservation
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; FanoutObservation -&gt; ShowS
showsPrec :: Int -&gt; FanoutObservation -&gt; ShowS
$cshow :: FanoutObservation -&gt; String
show :: FanoutObservation -&gt; String
$cshowList :: [FanoutObservation] -&gt; ShowS
showList :: [FanoutObservation] -&gt; ShowS
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680179404"><span id="local-6989586621680179406"><span class="annot"><span class="annottext">(forall x. FanoutObservation -&gt; Rep FanoutObservation x)
-&gt; (forall x. Rep FanoutObservation x -&gt; FanoutObservation)
-&gt; Generic FanoutObservation
forall x. Rep FanoutObservation x -&gt; FanoutObservation
forall x. FanoutObservation -&gt; Rep FanoutObservation x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. FanoutObservation -&gt; Rep FanoutObservation x
from :: forall x. FanoutObservation -&gt; Rep FanoutObservation x
$cto :: forall x. Rep FanoutObservation x -&gt; FanoutObservation
to :: forall x. Rep FanoutObservation x -&gt; FanoutObservation
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Generics.html#Generic"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-468"></span><span>
</span><span id="line-469"></span><span class="hs-comment">-- | Identify a fanout tx by lookup up the input spending the Head output and</span><span>
</span><span id="line-470"></span><span class="hs-comment">-- decoding its redeemer.</span><span>
</span><span id="line-471"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#observeFanoutTx"><span class="hs-identifier hs-type">observeFanoutTx</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-472"></span><span>  </span><span class="annot"><span class="hs-comment">-- | A UTxO set to lookup tx inputs</span></span><span>
</span><span id="line-473"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-474"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-475"></span><span>  </span><span class="annot"><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#FanoutObservation"><span class="hs-identifier hs-type">FanoutObservation</span></a></span><span>
</span><span id="line-476"></span><span id="observeFanoutTx"><span class="annot"><span class="annottext">observeFanoutTx :: UTxO -&gt; Tx -&gt; Maybe FanoutObservation
</span><a href="Hydra.Chain.Direct.Tx.html#observeFanoutTx"><span class="hs-identifier hs-var hs-var">observeFanoutTx</span></a></span></span><span> </span><span id="local-6989586621680179408"><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621680179408"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span id="local-6989586621680179409"><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680179409"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-477"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680179410"><span class="annot"><span class="annottext">inputUTxO :: UTxO
</span><a href="#local-6989586621680179410"><span class="hs-identifier hs-var hs-var">inputUTxO</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTxO -&gt; Tx -&gt; UTxO
</span><span class="hs-identifier hs-var">resolveInputsUTxO</span></span><span> </span><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621680179408"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680179409"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-478"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621680179411"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680179411"><span class="hs-identifier hs-var">headInput</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680179412"><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680179412"><span class="hs-identifier hs-var">headOutput</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UTxO -&gt; PlutusScript PlutusScriptV3 -&gt; Maybe (TxIn, TxOut CtxUTxO)
forall lang.
IsPlutusScriptLanguage lang =&gt;
UTxO -&gt; PlutusScript lang -&gt; Maybe (TxIn, TxOut CtxUTxO)
</span><span class="hs-identifier hs-var">findTxOutByScript</span></span><span> </span><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621680179410"><span class="hs-identifier hs-var">inputUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript PlutusScriptV3
</span><span class="hs-identifier hs-var">Head.validatorScript</span></span><span>
</span><span id="line-479"></span><span>  </span><span id="local-6989586621680179413"><span class="annot"><span class="annottext">HeadId
</span><a href="#local-6989586621680179413"><span class="hs-identifier hs-var">headId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; Maybe HeadId
forall ctx. TxOut ctx -&gt; Maybe HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#findStateToken"><span class="hs-identifier hs-var">findStateToken</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680179412"><span class="hs-identifier hs-var">headOutput</span></a></span><span>
</span><span id="line-480"></span><span>  </span><span class="annot"><span class="annottext">Tx -&gt; TxIn -&gt; Maybe Input
forall a. FromData a =&gt; Tx -&gt; TxIn -&gt; Maybe a
</span><span class="hs-identifier hs-var">findRedeemerSpending</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680179409"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680179411"><span class="hs-identifier hs-var">headInput</span></a></span><span>
</span><span id="line-481"></span><span>    </span><span class="annot"><span class="annottext">Maybe Input
-&gt; (Input -&gt; Maybe FanoutObservation) -&gt; Maybe FanoutObservation
forall a b. Maybe a -&gt; (a -&gt; Maybe b) -&gt; Maybe b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-482"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Head.Fanout</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FanoutObservation -&gt; Maybe FanoutObservation
forall a. a -&gt; Maybe a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#FanoutObservation"><span class="hs-identifier hs-type">FanoutObservation</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">HeadId
$sel:headId:FanoutObservation :: HeadId
headId :: HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AheadId%3AFanoutObservation"><span class="hs-identifier hs-var hs-var">headId</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-483"></span><span>      </span><span class="annot"><span class="annottext">Input
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe FanoutObservation
forall a. Maybe a
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-484"></span><span>
</span><span id="line-485"></span><span class="hs-keyword">newtype</span><span> </span><span id="AbortObservation"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#AbortObservation"><span class="hs-identifier hs-var">AbortObservation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="AbortObservation"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#AbortObservation"><span class="hs-identifier hs-var">AbortObservation</span></a></span></span><span> </span><span class="hs-special">{</span><span id="%24sel%3AheadId%3AAbortObservation"><span class="annot"><span class="annottext">AbortObservation -&gt; HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#%24sel%3AheadId%3AAbortObservation"><span class="hs-identifier hs-var hs-var">headId</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HeadId</span></span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680179418"><span id="local-6989586621680179421"><span class="annot"><span class="annottext">AbortObservation -&gt; AbortObservation -&gt; Bool
(AbortObservation -&gt; AbortObservation -&gt; Bool)
-&gt; (AbortObservation -&gt; AbortObservation -&gt; Bool)
-&gt; Eq AbortObservation
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: AbortObservation -&gt; AbortObservation -&gt; Bool
== :: AbortObservation -&gt; AbortObservation -&gt; Bool
$c/= :: AbortObservation -&gt; AbortObservation -&gt; Bool
/= :: AbortObservation -&gt; AbortObservation -&gt; Bool
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680179424"><span id="local-6989586621680179428"><span id="local-6989586621680179431"><span class="annot"><span class="annottext">Int -&gt; AbortObservation -&gt; ShowS
[AbortObservation] -&gt; ShowS
AbortObservation -&gt; String
(Int -&gt; AbortObservation -&gt; ShowS)
-&gt; (AbortObservation -&gt; String)
-&gt; ([AbortObservation] -&gt; ShowS)
-&gt; Show AbortObservation
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; AbortObservation -&gt; ShowS
showsPrec :: Int -&gt; AbortObservation -&gt; ShowS
$cshow :: AbortObservation -&gt; String
show :: AbortObservation -&gt; String
$cshowList :: [AbortObservation] -&gt; ShowS
showList :: [AbortObservation] -&gt; ShowS
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680179434"><span id="local-6989586621680179436"><span class="annot"><span class="annottext">(forall x. AbortObservation -&gt; Rep AbortObservation x)
-&gt; (forall x. Rep AbortObservation x -&gt; AbortObservation)
-&gt; Generic AbortObservation
forall x. Rep AbortObservation x -&gt; AbortObservation
forall x. AbortObservation -&gt; Rep AbortObservation x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. AbortObservation -&gt; Rep AbortObservation x
from :: forall x. AbortObservation -&gt; Rep AbortObservation x
$cto :: forall x. Rep AbortObservation x -&gt; AbortObservation
to :: forall x. Rep AbortObservation x -&gt; AbortObservation
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Generics.html#Generic"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-486"></span><span>
</span><span id="line-487"></span><span class="hs-comment">-- | Identify an abort tx by looking up the input spending the Head output and</span><span>
</span><span id="line-488"></span><span class="hs-comment">-- decoding its redeemer.</span><span>
</span><span id="line-489"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#observeAbortTx"><span class="hs-identifier hs-type">observeAbortTx</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-490"></span><span>  </span><span class="annot"><span class="hs-comment">-- | A UTxO set to lookup tx inputs</span></span><span>
</span><span id="line-491"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-492"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Tx</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-493"></span><span>  </span><span class="annot"><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#AbortObservation"><span class="hs-identifier hs-type">AbortObservation</span></a></span><span>
</span><span id="line-494"></span><span id="observeAbortTx"><span class="annot"><span class="annottext">observeAbortTx :: UTxO -&gt; Tx -&gt; Maybe AbortObservation
</span><a href="Hydra.Chain.Direct.Tx.html#observeAbortTx"><span class="hs-identifier hs-var hs-var">observeAbortTx</span></a></span></span><span> </span><span id="local-6989586621680179438"><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621680179438"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span id="local-6989586621680179439"><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680179439"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-495"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680179440"><span class="annot"><span class="annottext">inputUTxO :: UTxO
</span><a href="#local-6989586621680179440"><span class="hs-identifier hs-var hs-var">inputUTxO</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTxO -&gt; Tx -&gt; UTxO
</span><span class="hs-identifier hs-var">resolveInputsUTxO</span></span><span> </span><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621680179438"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680179439"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-496"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621680179441"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680179441"><span class="hs-identifier hs-var">headInput</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680179442"><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680179442"><span class="hs-identifier hs-var">headOutput</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UTxO -&gt; PlutusScript PlutusScriptV3 -&gt; Maybe (TxIn, TxOut CtxUTxO)
forall lang.
IsPlutusScriptLanguage lang =&gt;
UTxO -&gt; PlutusScript lang -&gt; Maybe (TxIn, TxOut CtxUTxO)
</span><span class="hs-identifier hs-var">findTxOutByScript</span></span><span> </span><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621680179440"><span class="hs-identifier hs-var">inputUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">PlutusScript PlutusScriptV3
</span><span class="hs-identifier hs-var">Head.validatorScript</span></span><span>
</span><span id="line-497"></span><span>  </span><span id="local-6989586621680179443"><span class="annot"><span class="annottext">HeadId
</span><a href="#local-6989586621680179443"><span class="hs-identifier hs-var">headId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO -&gt; Maybe HeadId
forall ctx. TxOut ctx -&gt; Maybe HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#findStateToken"><span class="hs-identifier hs-var">findStateToken</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO
</span><a href="#local-6989586621680179442"><span class="hs-identifier hs-var">headOutput</span></a></span><span>
</span><span id="line-498"></span><span>  </span><span class="annot"><span class="annottext">Tx -&gt; TxIn -&gt; Maybe Input
forall a. FromData a =&gt; Tx -&gt; TxIn -&gt; Maybe a
</span><span class="hs-identifier hs-var">findRedeemerSpending</span></span><span> </span><span class="annot"><span class="annottext">Tx
</span><a href="#local-6989586621680179439"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680179441"><span class="hs-identifier hs-var">headInput</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Input
-&gt; (Input -&gt; Maybe AbortObservation) -&gt; Maybe AbortObservation
forall a b. Maybe a -&gt; (a -&gt; Maybe b) -&gt; Maybe b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-499"></span><span>    </span><span class="annot"><span class="annottext">Input
</span><span class="hs-identifier hs-var">Head.Abort</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AbortObservation -&gt; Maybe AbortObservation
forall a. a -&gt; Maybe a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(AbortObservation -&gt; Maybe AbortObservation)
-&gt; AbortObservation -&gt; Maybe AbortObservation
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HeadId -&gt; AbortObservation
</span><a href="Hydra.Chain.Direct.Tx.html#AbortObservation"><span class="hs-identifier hs-var">AbortObservation</span></a></span><span> </span><span class="annot"><span class="annottext">HeadId
</span><a href="#local-6989586621680179443"><span class="hs-identifier hs-var">headId</span></a></span><span>
</span><span id="line-500"></span><span>    </span><span class="annot"><span class="annottext">Input
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe AbortObservation
forall a. Maybe a
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-501"></span><span>
</span><span id="line-502"></span><span class="annot"><span class="hs-comment">-- * Cardano specific identifiers</span></span><span>
</span><span id="line-503"></span><span>
</span><span id="line-504"></span><span id="local-6989586621680178417"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#currencySymbolToHeadId"><span class="hs-identifier hs-type">currencySymbolToHeadId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Control.Monad.Fail.html#MonadFail"><span class="hs-identifier hs-type">MonadFail</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680178417"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CurrencySymbol</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680178417"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">HeadId</span></span></span><span>
</span><span id="line-505"></span><span id="currencySymbolToHeadId"><span class="annot"><span class="annottext">currencySymbolToHeadId :: forall (m :: * -&gt; *). MonadFail m =&gt; CurrencySymbol -&gt; m HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#currencySymbolToHeadId"><span class="hs-identifier hs-var hs-var">currencySymbolToHeadId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PolicyId -&gt; HeadId) -&gt; m PolicyId -&gt; m HeadId
forall a b. (a -&gt; b) -&gt; m a -&gt; m b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">PolicyId -&gt; HeadId
</span><span class="hs-identifier hs-var">mkHeadId</span></span><span> </span><span class="annot"><span class="annottext">(m PolicyId -&gt; m HeadId)
-&gt; (CurrencySymbol -&gt; m PolicyId) -&gt; CurrencySymbol -&gt; m HeadId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">CurrencySymbol -&gt; m PolicyId
forall (m :: * -&gt; *). MonadFail m =&gt; CurrencySymbol -&gt; m PolicyId
</span><span class="hs-identifier hs-var">fromPlutusCurrencySymbol</span></span><span>
</span><span id="line-506"></span><span>
</span><span id="line-507"></span><span id="local-6989586621680178423"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#headIdToPolicyId"><span class="hs-identifier hs-type">headIdToPolicyId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Control.Monad.Fail.html#MonadFail"><span class="hs-identifier hs-type">MonadFail</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680178423"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HeadId</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680178423"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PolicyId</span></span></span><span>
</span><span id="line-508"></span><span id="headIdToPolicyId"><span class="annot"><span class="annottext">headIdToPolicyId :: forall (m :: * -&gt; *). MonadFail m =&gt; HeadId -&gt; m PolicyId
</span><a href="Hydra.Chain.Direct.Tx.html#headIdToPolicyId"><span class="hs-identifier hs-var hs-var">headIdToPolicyId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CurrencySymbol -&gt; m PolicyId
forall (m :: * -&gt; *). MonadFail m =&gt; CurrencySymbol -&gt; m PolicyId
</span><span class="hs-identifier hs-var">fromPlutusCurrencySymbol</span></span><span> </span><span class="annot"><span class="annottext">(CurrencySymbol -&gt; m PolicyId)
-&gt; (HeadId -&gt; CurrencySymbol) -&gt; HeadId -&gt; m PolicyId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">HeadId -&gt; CurrencySymbol
</span><span class="hs-identifier hs-var">headIdToCurrencySymbol</span></span><span>
</span><span id="line-509"></span><span>
</span><span id="line-510"></span><span id="local-6989586621680178425"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#headSeedToTxIn"><span class="hs-identifier hs-type">headSeedToTxIn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Control.Monad.Fail.html#MonadFail"><span class="hs-identifier hs-type">MonadFail</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680178425"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HeadSeed</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680178425"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxIn</span></span></span><span>
</span><span id="line-511"></span><span id="headSeedToTxIn"><span class="annot"><span class="annottext">headSeedToTxIn :: forall (m :: * -&gt; *). MonadFail m =&gt; HeadSeed -&gt; m TxIn
</span><a href="Hydra.Chain.Direct.Tx.html#headSeedToTxIn"><span class="hs-identifier hs-var hs-var">headSeedToTxIn</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">UnsafeHeadSeed</span></span><span> </span><span id="local-6989586621680179474"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621680179474"><span class="hs-identifier hs-var">bytes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-512"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe TxIn
forall a. FromJSON a =&gt; ByteString -&gt; Maybe a
</span><span class="hs-identifier hs-var">Aeson.decodeStrict</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621680179474"><span class="hs-identifier hs-var">bytes</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-513"></span><span>    </span><span class="annot"><span class="annottext">Maybe TxIn
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; m TxIn
forall a. String -&gt; m a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Control.Monad.Fail.html#fail"><span class="hs-identifier hs-var">fail</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; m TxIn) -&gt; String -&gt; m TxIn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Failed to decode HeadSeed &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; String
forall b a. (Show a, IsString b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621680179474"><span class="hs-identifier hs-var">bytes</span></a></span><span>
</span><span id="line-514"></span><span>    </span><span class="annot"><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680179477"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680179477"><span class="hs-identifier hs-var">txIn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TxIn -&gt; m TxIn
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680179477"><span class="hs-identifier hs-var">txIn</span></a></span><span>
</span><span id="line-515"></span><span>
</span><span id="line-516"></span><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#txInToHeadSeed"><span class="hs-identifier hs-type">txInToHeadSeed</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxIn</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HeadSeed</span></span><span>
</span><span id="line-517"></span><span id="txInToHeadSeed"><span class="annot"><span class="annottext">txInToHeadSeed :: TxIn -&gt; HeadSeed
</span><a href="Hydra.Chain.Direct.Tx.html#txInToHeadSeed"><span class="hs-identifier hs-var hs-var">txInToHeadSeed</span></a></span></span><span> </span><span id="local-6989586621680179479"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680179479"><span class="hs-identifier hs-var">txin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; HeadSeed
</span><span class="hs-identifier hs-var">UnsafeHeadSeed</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; HeadSeed) -&gt; ByteString -&gt; HeadSeed
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
forall l s. LazyStrict l s =&gt; l -&gt; s
</span><span class="hs-identifier hs-var">toStrict</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString) -&gt; ByteString -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn -&gt; ByteString
forall a. ToJSON a =&gt; a -&gt; ByteString
</span><span class="hs-identifier hs-var">Aeson.encode</span></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680179479"><span class="hs-identifier hs-var">txin</span></a></span><span>
</span><span id="line-518"></span><span>
</span><span id="line-519"></span><span class="annot"><span class="hs-comment">-- * Helpers</span></span><span>
</span><span id="line-520"></span><span>
</span><span id="line-521"></span><span id="local-6989586621680178439"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#findHeadAssetId"><span class="hs-identifier hs-type">findHeadAssetId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="annot"><a href="#local-6989586621680178439"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PolicyId</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">AssetName</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-522"></span><span id="findHeadAssetId"><span class="annot"><span class="annottext">findHeadAssetId :: forall ctx. TxOut ctx -&gt; Maybe (PolicyId, AssetName)
</span><a href="Hydra.Chain.Direct.Tx.html#findHeadAssetId"><span class="hs-identifier hs-var hs-var">findHeadAssetId</span></a></span></span><span> </span><span id="local-6989586621680179488"><span class="annot"><span class="annottext">TxOut ctx
</span><a href="#local-6989586621680179488"><span class="hs-identifier hs-var">txOut</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-523"></span><span>  </span><span class="annot"><span class="annottext">(((AssetId, Quantity) -&gt; Maybe (PolicyId, AssetName))
 -&gt; [(AssetId, Quantity)] -&gt; Maybe (PolicyId, AssetName))
-&gt; [(AssetId, Quantity)]
-&gt; ((AssetId, Quantity) -&gt; Maybe (PolicyId, AssetName))
-&gt; Maybe (PolicyId, AssetName)
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#flip"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">((AssetId, Quantity) -&gt; Maybe (PolicyId, AssetName))
-&gt; [(AssetId, Quantity)] -&gt; Maybe (PolicyId, AssetName)
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; Maybe b) -&gt; t a -&gt; Maybe b
</span><span class="hs-identifier hs-var">findFirst</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; [Item Value]
forall l. IsList l =&gt; l -&gt; [Item l]
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.IsList.html#toList"><span class="hs-identifier hs-var">toList</span></a></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; [Item Value]) -&gt; Value -&gt; [Item Value]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut ctx -&gt; Value
forall ctx. TxOut ctx -&gt; Value
</span><span class="hs-identifier hs-var">txOutValue</span></span><span> </span><span class="annot"><span class="annottext">TxOut ctx
</span><a href="#local-6989586621680179488"><span class="hs-identifier hs-var">txOut</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(((AssetId, Quantity) -&gt; Maybe (PolicyId, AssetName))
 -&gt; Maybe (PolicyId, AssetName))
-&gt; ((AssetId, Quantity) -&gt; Maybe (PolicyId, AssetName))
-&gt; Maybe (PolicyId, AssetName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-524"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">AssetId</span></span><span> </span><span id="local-6989586621680179490"><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621680179490"><span class="hs-identifier hs-var">pid</span></a></span></span><span> </span><span id="local-6989586621680179491"><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621680179491"><span class="hs-identifier hs-var">aname</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680179492"><span class="annot"><span class="annottext">Quantity
</span><a href="#local-6989586621680179492"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-525"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621680179491"><span class="hs-identifier hs-var">aname</span></a></span><span> </span><span class="annot"><span class="annottext">AssetName -&gt; AssetName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">AssetName
</span><span class="hs-identifier hs-var">hydraHeadV1AssetName</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity
</span><a href="#local-6989586621680179492"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity -&gt; Quantity -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Quantity
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-526"></span><span>          </span><span class="annot"><span class="annottext">(PolicyId, AssetName) -&gt; Maybe (PolicyId, AssetName)
forall a. a -&gt; Maybe a
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621680179490"><span class="hs-identifier hs-var">pid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621680179491"><span class="hs-identifier hs-var">aname</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-527"></span><span>    </span><span class="annot"><span class="annottext">(AssetId, Quantity)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-528"></span><span>      </span><span class="annot"><span class="annottext">Maybe (PolicyId, AssetName)
forall a. Maybe a
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-529"></span><span>
</span><span id="line-530"></span><span class="annot"><span class="hs-comment">-- | Find (if it exists) the head identifier contained in given `TxOut`.</span></span><span>
</span><span id="line-531"></span><span id="local-6989586621680178384"><span class="annot"><a href="Hydra.Chain.Direct.Tx.html#findStateToken"><span class="hs-identifier hs-type">findStateToken</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="annot"><a href="#local-6989586621680178384"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">HeadId</span></span></span><span>
</span><span id="line-532"></span><span id="findStateToken"><span class="annot"><span class="annottext">findStateToken :: forall ctx. TxOut ctx -&gt; Maybe HeadId
</span><a href="Hydra.Chain.Direct.Tx.html#findStateToken"><span class="hs-identifier hs-var hs-var">findStateToken</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-533"></span><span>  </span><span class="annot"><span class="annottext">((PolicyId, AssetName) -&gt; HeadId)
-&gt; Maybe (PolicyId, AssetName) -&gt; Maybe HeadId
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PolicyId -&gt; HeadId
</span><span class="hs-identifier hs-var">mkHeadId</span></span><span> </span><span class="annot"><span class="annottext">(PolicyId -&gt; HeadId)
-&gt; ((PolicyId, AssetName) -&gt; PolicyId)
-&gt; (PolicyId, AssetName)
-&gt; HeadId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(PolicyId, AssetName) -&gt; PolicyId
forall a b. (a, b) -&gt; a
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe (PolicyId, AssetName) -&gt; Maybe HeadId)
-&gt; (TxOut ctx -&gt; Maybe (PolicyId, AssetName))
-&gt; TxOut ctx
-&gt; Maybe HeadId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/6b4grlnsja5lm7704cn0yw3ljjvzk909-ghc-9.6.6-doc/share/doc/ghc-9.6.6/html/libraries/base-4.18.2.1/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut ctx -&gt; Maybe (PolicyId, AssetName)
forall ctx. TxOut ctx -&gt; Maybe (PolicyId, AssetName)
</span><a href="Hydra.Chain.Direct.Tx.html#findHeadAssetId"><span class="hs-identifier hs-var">findHeadAssetId</span></a></span><span>
</span><span id="line-534"></span></pre></body></html>