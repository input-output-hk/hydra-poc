"use strict";(self.webpackChunkhydra_head_protocol_docs=self.webpackChunkhydra_head_protocol_docs||[]).push([[2060],{8995:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"how-to/event-sinks-and-sources","title":"Extend the node with event source and sinks","description":"There are certain use cases in which multiple features of the Hydra platform are beneficial. However, interfacing with the entire hydra node, particularly with regard to IO, may be impractical. For a use case that requires different persistence requirements than the default Hydra setup, it may initially appear that there are two options available:","source":"@site/docs/how-to/event-sinks-and-sources.md","sourceDirName":"how-to","slug":"/how-to/event-sinks-and-sources","permalink":"/head-protocol/unstable/docs/how-to/event-sinks-and-sources","draft":false,"unlisted":false,"editUrl":"https://github.com/cardano-scaling/hydra/tree/master/docs/docs/how-to/event-sinks-and-sources.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5},"sidebar":"userDocumentation","previous":{"title":"Operate a Hydra node","permalink":"/head-protocol/unstable/docs/how-to/operating-hydra"},"next":{"title":"Commit funds to an open Head","permalink":"/head-protocol/unstable/docs/how-to/incremental-commit"}}');var i=t(74848),a=t(28453);const r={sidebar_position:5},o="Extend the node with event source and sinks",d={},c=[{value:"Deciding between forking and using event sinks",id:"deciding-between-forking-and-using-event-sinks",level:2},{value:"Implementation of event sinks and source",id:"implementation-of-event-sinks-and-source",level:2},{value:"Examples",id:"examples",level:3},{value:"Building event sinks and sources",id:"building-event-sinks-and-sources",level:3},{value:"Offline mode",id:"offline-mode",level:2}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"extend-the-node-with-event-source-and-sinks",children:"Extend the node with event source and sinks"})}),"\n",(0,i.jsxs)(n.p,{children:["There are certain use cases in which multiple features of the Hydra platform are beneficial. However, interfacing with the entire ",(0,i.jsx)(n.code,{children:"hydra node"}),", particularly with regard to IO, may be impractical. For a use case that requires different persistence requirements than the default Hydra setup, it may initially appear that there are two options available:"]}),"\n",(0,i.jsx)(n.h2,{id:"deciding-between-forking-and-using-event-sinks",children:"Deciding between forking and using event sinks"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Forking the Hydra codebase"}),". Customizing the Hydra codebase can provide precise control over node behavior but introduces a significant maintenance burden due to the instability and lack of internal code documentation."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Using event sinks and source"}),". Running a full ",(0,i.jsx)(n.code,{children:"hydra node"})," requires preparing a persistence file beforehand or parsing the file as it is written. However, this approach has downsides, including reduced control, code duplication, increased resource usage, and reliance on interfacing with an unstable external API (the persistence file on disk)."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"implementation-of-event-sinks-and-source",children:"Implementation of event sinks and source"}),"\n",(0,i.jsxs)(n.p,{children:["Hydra introduces alternate event sinks and a single alternate event source to enhance these use cases. Event sinks permanently store new transactions processed at runtime, while the event source provides the initial transactions that a ",(0,i.jsx)(n.code,{children:"hydra node"})," loads upon startup."]}),"\n",(0,i.jsxs)(n.p,{children:["Multiple event sinks can be utilized simultaneously, whereas only one event source can be used at a time. The event source is loaded only during startup. Each event sink runs for every new transaction. Currently, the order of the event sinks must be specified by customizing the order of the event sink list in the ",(0,i.jsx)(n.code,{children:"hydra node"})," source code, in the ",(0,i.jsx)(n.code,{children:"eventSinks"})," parameter to hydrate, invoked in ",(0,i.jsx)(n.code,{children:"Hydra.Node.Run.run"})," ",(0,i.jsx)(n.a,{href:"https://github.com/SundaeSwap-finance/hydra/blob/4785bd86a03b92ba8fa8fb34c9d485a1e2f4f7d7/hydra-node/src/Hydra/Node/Run.hs#L104",children:"here"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"The default Hydra file-based persistence is implemented as an event sink and source pair. They can be used independently. For example, you can use the default event source to process previous transactions from a file on disk, along with an event sink that could store new transactions on S3, on several machines, or not at all."}),"\n",(0,i.jsx)(n.h3,{id:"examples",children:"Examples"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Simple basic implementation"}),". For a basic implementation that sends new transactions over UDP, please refer to ",(0,i.jsx)(n.a,{href:"https://github.com/ffakenz/hydra/tree/udp-sink",children:"this fork"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Complex implementation"}),". For more advanced implementations using S3 and AWS Kinesis as event sources and sinks, visit the ",(0,i.jsx)(n.code,{children:"doug_hydra_changes"})," branch ",(0,i.jsx)(n.a,{href:"https://github.com/SundaeSwap-finance/hydra",children:"here"}),", particularly the ",(0,i.jsx)(n.a,{href:"https://github.com/SundaeSwap-finance/hydra/blob/f27e51c001e7b64c3679eab4efd9f17f08db53fe/hydra-node/src/Hydra/Events/AWS/Kinesis.hs",children:"AWS Kinesis implementation"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Currently, there is no CLI API to toggle which sources and sinks are utilized; this configuration must be manually implemented by the developers of the sources and sinks. Refer to the source and sink configuration example ",(0,i.jsx)(n.a,{href:"https://github.com/SundaeSwap-finance/hydra/blob/4785bd86a03b92ba8fa8fb34c9d485a1e2f4f7d7/hydra-node/src/Hydra/Node/Run.hs#L97",children:"here"}),", where the event sinks and source are toggled through CLI options."]}),"\n",(0,i.jsx)(n.h3,{id:"building-event-sinks-and-sources",children:"Building event sinks and sources"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Event sink construction"}),". Create an ",(0,i.jsx)(n.code,{children:"EventSink e m"})," object, where ",(0,i.jsx)(n.code,{children:"m"})," denotes the monad (such as IO) in which the event sink operates, and ",(0,i.jsx)(n.code,{children:"e"})," represents the event type. The only field in the ",(0,i.jsx)(n.code,{children:"EventSink"})," record corresponds to the monadic action taken upon a new event. See an example with AWS Kinesis ",(0,i.jsx)(n.a,{href:"https://github.com/SundaeSwap-finance/hydra/blob/598b20fcee9669a196781f70e02e13779967e470/hydra-node/src/Hydra/Events/AWS/Kinesis.hs#L85",children:"here"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Event source construction"}),". Construct an ",(0,i.jsx)(n.code,{children:"EventSource e m"})," object, where the encapsulated monadic action produces a list of events ",(0,i.jsx)(n.code,{children:"[e]"}),". An example loading events from AWS Kinesis is available ",(0,i.jsx)(n.a,{href:"https://github.com/SundaeSwap-finance/hydra/blob/598b20fcee9669a196781f70e02e13779967e470/hydra-node/src/Hydra/Events/AWS/Kinesis.hs#L85",children:"here"}),". Consider implementing delays to manage the rate of event list construction, as the entire list is replayed at node startup, potentially overwhelming any API if not adequately throttled."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"offline-mode",children:"Offline mode"}),"\n",(0,i.jsxs)(n.p,{children:["Hydra also supports an offline mode, which allows for disabling the layer 1 interface (that is, the underlying Cardano blockchain, which Hydra heads use to seed and withdraw funds to). This offline mode makes operation only influenced by the HTTP/WebSocket APIs, and the configured event sinks and sources. While separate from the event sinks and event source functionality, disabling layer 1 interactions allows for further customization, enabling use cases that would otherwise require running and configuring an entire layer 1 private devnet. See offline mode documentation ",(0,i.jsx)(n.a,{href:"/head-protocol/unstable/docs/configuration#offline-mode",children:"here"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>o});var s=t(96540);const i={},a=s.createContext(i);function r(e){const n=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);