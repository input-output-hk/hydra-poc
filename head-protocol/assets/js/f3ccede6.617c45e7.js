"use strict";(self.webpackChunkhydra_head_protocol_docs=self.webpackChunkhydra_head_protocol_docs||[]).push([[8026],{24676:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>c,contentTitle:()=>h,default:()=>g,frontMatter:()=>l,metadata:()=>m,toc:()=>p});var n=a(87462),o=a(67294),i=a(3905),r=a(89916);const s={terminalWindow:"terminalWindow_wGrl",terminalWindowHeader:"terminalWindowHeader_o9Cs",terminalWindowBody:"terminalWindowBody_tzdS",row:"row_Rn7G",buttons:"buttons_IGLB",right:"right_fWp9",dot:"dot_fGZE"};function d(e){let{children:t,minHeight:a}=e;const n="string"==typeof t?o.createElement(r.Z,null,t):t;return o.createElement("div",{className:s.terminalWindow,style:{minHeight:a}},o.createElement("div",{className:s.terminalWindowHeader},o.createElement("div",{className:s.buttons},o.createElement("span",{className:s.dot,style:{background:"#f25f58"}}),o.createElement("span",{className:s.dot,style:{background:"#fbbe3c"}}),o.createElement("span",{className:s.dot,style:{background:"#58cb42"}}))),o.createElement("div",{className:s.terminalWindowBody},n))}const l={sidebar_position:4},h="Operate a Hydra node",m={unversionedId:"how-to/operating-hydra",id:"how-to/operating-hydra",title:"Operate a Hydra node",description:"This page guides Hydra users on troubleshooting issues when running their instances of hydra-node and participating in a Hydra head.",source:"@site/docs/how-to/operating-hydra.md",sourceDirName:"how-to",slug:"/how-to/operating-hydra",permalink:"/head-protocol/docs/how-to/operating-hydra",draft:!1,editUrl:"https://github.com/cardano-scaling/hydra/tree/master/docs/docs/how-to/operating-hydra.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"userDocumentation",previous:{title:"Decommit funds",permalink:"/head-protocol/docs/how-to/incremental-decommit"},next:{title:"Extend the node with event source and sinks",permalink:"/head-protocol/docs/how-to/event-sinks-and-sources"}},c={},p=[{value:"Example setup",id:"example-setup",level:2},{value:"Google Cloud with Terraform",id:"google-cloud-with-terraform",level:3},{value:"Logs",id:"logs",level:2},{value:"Monitoring",id:"monitoring",level:2},{value:"Common issues",id:"common-issues",level:2},{value:"No head is observed from the chain",id:"no-head-is-observed-from-the-chain",level:3},{value:"Head does not make progress",id:"head-does-not-make-progress",level:3}],u={toc:p},k="wrapper";function g(e){let{components:t,...a}=e;return(0,i.kt)(k,(0,n.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"operate-a-hydra-node"},"Operate a Hydra node"),(0,i.kt)("p",null,"This page guides Hydra users on troubleshooting issues when running their instances of ",(0,i.kt)("inlineCode",{parentName:"p"},"hydra-node")," and participating in a Hydra head."),(0,i.kt)("h2",{id:"example-setup"},"Example setup"),(0,i.kt)("p",null,"We offer sample node configurations that will help you get started with hosting a Hydra node on virtual machines in the cloud. These configurations are available in the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/cardano-scaling/hydra/tree/master/sample-node-config/"},(0,i.kt)("inlineCode",{parentName:"a"},"sample-node-config/")," directory"),"."),(0,i.kt)("h3",{id:"google-cloud-with-terraform"},"Google Cloud with Terraform"),(0,i.kt)("p",null,"This setup includes a ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/input-output-hk/hydra/blob/master/sample-node-config/gcp/docker-compose.yaml"},"docker-compose.yaml")," file, which serves as a robust template for configuring ",(0,i.kt)("inlineCode",{parentName:"p"},"cardano-node")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"hydra-node")," services. Also, various scripts are provided to help you set up your cluster."),(0,i.kt)("h2",{id:"logs"},"Logs"),(0,i.kt)("p",null,"Following the principles outlined in ",(0,i.kt)("a",{parentName:"p",href:"/adr/9"},"ADR-9"),", the ",(0,i.kt)("inlineCode",{parentName:"p"},"hydra-node")," emits ",(0,i.kt)("a",{parentName:"p",href:"https://json.org"},"JSON")," formatted logs to the ",(0,i.kt)("inlineCode",{parentName:"p"},"stdout")," stream, with one log item per line. These log entries conform to a specific ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/input-output-hk/hydra/blob/master/hydra-node/json-schemas/logs.yaml"},"JSON schema"),". We deliberately maintain the logging mechanism simple and non-configurable to facilitate the integration of Hydra logs into broader log analysis infrastructures, including custom ELK stacks, third-party services, or Docker sidecars."),(0,i.kt)("h2",{id:"monitoring"},"Monitoring"),(0,i.kt)("p",null,"When the ",(0,i.kt)("inlineCode",{parentName:"p"},"--monitoring-port PORT")," argument is provided, the ",(0,i.kt)("inlineCode",{parentName:"p"},"hydra-node")," executable will expose a ",(0,i.kt)("a",{parentName:"p",href:"https://prometheus.io"},"Prometheus")," compatible HTTP ",(0,i.kt)("inlineCode",{parentName:"p"},"/metrics")," endpoint on the specified port to enable metrics scraping."),(0,i.kt)("p",null,"For instance, if a ",(0,i.kt)("inlineCode",{parentName:"p"},"hydra-node")," is initiated with ",(0,i.kt)("inlineCode",{parentName:"p"},"--monitoring-port 6001"),", the following command:"),(0,i.kt)(d,{mdxType:"TerminalWindow"},"curl http://localhost:6001/metrics"),(0,i.kt)("p",null,"will output:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'# TYPE hydra_head_confirmed_tx counter\nhydra_head_confirmed_tx  0\n# TYPE hydra_head_inputs counter\nhydra_head_inputs  50467\n# TYPE hydra_head_requested_tx counter\nhydra_head_requested_tx  0\n# TYPE hydra_head_tx_confirmation_time_ms histogram\nhydra_head_tx_confirmation_time_ms_bucket{le="5.0"} 0.0\nhydra_head_tx_confirmation_time_ms_bucket{le="10.0"} 0.0\nhydra_head_tx_confirmation_time_ms_bucket{le="50.0"} 0.0\nhydra_head_tx_confirmation_time_ms_bucket{le="100.0"} 0.0\nhydra_head_tx_confirmation_time_ms_bucket{le="1000.0"} 0.0\nhydra_head_tx_confirmation_time_ms_bucket{le="+Inf"} 0.0\nhydra_head_tx_confirmation_time_ms_sum  0.0\nhydra_head_tx_confirmation_time_ms_count  0\n')),(0,i.kt)("h2",{id:"common-issues"},"Common issues"),(0,i.kt)("h3",{id:"no-head-is-observed-from-the-chain"},"No head is observed from the chain"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Ensure the ",(0,i.kt)("inlineCode",{parentName:"li"},"hydra-node")," is connected to a ",(0,i.kt)("inlineCode",{parentName:"li"},"cardano-node")," operating on the correct network. Verify the ",(0,i.kt)("inlineCode",{parentName:"li"},"--network")," command-line argument and the ",(0,i.kt)("inlineCode",{parentName:"li"},"cardano-node")," configuration."),(0,i.kt)("li",{parentName:"ul"},"Remember, the ",(0,i.kt)("inlineCode",{parentName:"li"},"hydra-node")," cannot start if it cannot connect to the ",(0,i.kt)("inlineCode",{parentName:"li"},"cardano-node"),", which might require time as the ",(0,i.kt)("inlineCode",{parentName:"li"},"cardano-node")," must revalidate its database and potentially reconstruct its ledger state upon startup. Its connections are not open until it is fully prepared. If running as a service or a container, ensure that the orchestrator restarts the process when it crashes."),(0,i.kt)("li",{parentName:"ul"},"Check that the ",(0,i.kt)("em",{parentName:"li"},"Scripts")," transaction identifier is valid. This identifier is provided on the ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/cardano-scaling/hydra/releases/tag/0.10.0"},"release")," page for the three major networks (",(0,i.kt)("inlineCode",{parentName:"li"},"preview"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"pre-production"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"mainnet"),")."),(0,i.kt)("li",{parentName:"ul"},"Verify that the ",(0,i.kt)("inlineCode",{parentName:"li"},"hydra-node"),"'s ",(0,i.kt)("em",{parentName:"li"},"Cardano signing key")," is consistent with the ",(0,i.kt)("em",{parentName:"li"},"Verification key")," from the ",(0,i.kt)("inlineCode",{parentName:"li"},"Init")," transaction. Ensure the ",(0,i.kt)("inlineCode",{parentName:"li"},"--cardano-signing-key")," parameter points to the correct key, and that peers have the accurate ",(0,i.kt)("inlineCode",{parentName:"li"},"--cardano-verification-key")," for your node."),(0,i.kt)("li",{parentName:"ul"},"Confirm that peers' ",(0,i.kt)("em",{parentName:"li"},"Cardano verification keys")," are accurate. This mirrors the above issue; check parameters on all peers.")),(0,i.kt)("h3",{id:"head-does-not-make-progress"},"Head does not make progress"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Confirm peers are properly connected to each other. Verify the ",(0,i.kt)("inlineCode",{parentName:"li"},"--peer")," arguments point to the correct ",(0,i.kt)("inlineCode",{parentName:"li"},"host:port")," for each peer. The ",(0,i.kt)("inlineCode",{parentName:"li"},"PeerConnected")," message should be observed by the client or appear in the logs and be consistent across all peers involved in a head."),(0,i.kt)("li",{parentName:"ul"},"Ensure the ",(0,i.kt)("em",{parentName:"li"},"Hydra signing key")," for your node or the ",(0,i.kt)("em",{parentName:"li"},"Hydra verification keys")," for peers match each node's expectations. Verify that ",(0,i.kt)("inlineCode",{parentName:"li"},"AckSn")," messages are received by all parties and that the ",(0,i.kt)("inlineCode",{parentName:"li"},"LogicOutcome")," log contains no errors.")))}g.isMDXComponent=!0}}]);